"use strict";(globalThis.webpackChunkydb_embedded_ui=globalThis.webpackChunkydb_embedded_ui||[]).push([["77406"],{12543:function(e,t,a){a.d(t,{a:()=>n.a});var n=a(17549)},60198:function(e,t,a){a.r(t),a.d(t,{YDBSyntaxHighlighter:()=>v});var n=a(74848),r=a(96540),i=a(50934),s=a(9243);let l=(0,a(25247).cn)("ydb-syntax-highlighter"),o={name:"yql-light",type:"light",tokenColors:[{scope:["comment.block"],settings:{foreground:"#969896",fontStyle:"italic"}},{scope:["string.quoted.double"],settings:{foreground:"#a31515"}},{scope:["string.interpolated"],settings:{foreground:"#338186"}},{scope:["entity.name.function"],settings:{foreground:"#7a3e9d"}},{scope:["entity.name.type"],settings:{foreground:"#4d932d"}},{scope:["keyword.control"],settings:{foreground:"#0000ff"}},{scope:["constant.numeric"],settings:{foreground:"#098658"}},{scope:["support.constant"],settings:{foreground:"#7497c4"}},{scope:["variable.parameter"],settings:{foreground:"#000000"}},{scope:["variable.other"],settings:{foreground:"#000000"}}]},c={name:"yql-dark",type:"dark",colors:{"editor.foreground":"#d4d4d4","editor.background":"#1e1e1e"},tokenColors:[{scope:["comment.block"],settings:{foreground:"#969896",fontStyle:"italic"}},{scope:["string.quoted.double"],settings:{foreground:"#ce9178"}},{scope:["string.interpolated"],settings:{foreground:"#338186"}},{scope:["entity.name.function"],settings:{foreground:"#9e7bb0"}},{scope:["entity.name.type"],settings:{foreground:"#6A8759"}},{scope:["keyword.control"],settings:{foreground:"#569cd6"}},{scope:["constant.numeric"],settings:{foreground:"#b5cea8"}},{scope:["support.constant"],settings:{foreground:"#7497c4"}},{scope:["variable.parameter"],settings:{foreground:"#D4D4D4"}},{scope:["variable.other"],settings:{foreground:"#D4D4D4"}}]};var d=a(4095);let u="yql-light",m="yql-dark",p=null,h=new Set,g=new Set;async function x(){return p||(p=(async()=>{let{createHighlighter:e}=await a.e("91798").then(a.bind(a,14613));return e({themes:[],langs:[]})})()),p}async function y(e){if(h.has(e))return;let t=await x();try{"yql"===e?await t.loadLanguage(d):await t.loadLanguage(e),h.add(e)}catch(t){throw console.error(`Failed to load language: ${e}`,t),t}}async function b(e){if(g.has(e))return;let t=await x();try{e===u?await t.loadTheme(o):e===m?await t.loadTheme(c):await t.loadTheme(e),g.add(e)}catch(t){throw console.error(`Failed to load theme: ${e}`,t),t}}async function f(e,t,a){let n="dark"===a,r=n?"github-dark":"github-light";return"yql"===t&&(r=n?m:u),await Promise.all([y(t),b(r)]),(await x()).codeToHtml(e,{lang:t,theme:r})}function v({text:e,language:t,className:a,transparentBackground:o=!0,withClipboardButton:c}){let[d,u]=r.useState(""),[m,p]=r.useState(!0),h=(0,i.x)();r.useEffect(()=>{let a=!1;return async function(){p(!0);try{let n=await f(e,t,h);a||u(n)}catch(e){console.error("Failed to highlight code:",e)}finally{a||p(!1)}}(),()=>{a=!0}},[e,t,h]);let g={};c?.alwaysVisible&&(g=!1===c.withLabel?{paddingRight:40}:{paddingRight:80});let x={...g};return o&&(x.background="transparent"),(0,n.jsxs)("div",{className:l(null,a),children:[(()=>{if(!c)return null;let{alwaysVisible:t,copyText:a,...r}=c;return(0,n.jsx)("div",{className:l("sticky-container"),onClick:e=>e.stopPropagation(),children:(0,n.jsx)(s.b,{...r,copyText:a||e,className:l("copy",{visible:t}),view:"flat-secondary"})})})(),m||!d?(0,n.jsx)("div",{style:x,className:l("content",{transparent:o}),children:(0,n.jsx)("pre",{children:(0,n.jsx)("code",{children:e})})}):(0,n.jsx)("div",{className:l("content",{transparent:o}),style:x,dangerouslySetInnerHTML:{__html:d}})]})}},43696:function(e,t,a){a.d(t,{A:()=>s,X:()=>l});var n=a(74848),r=a(51936);let i=(0,a(25247).cn)("ydb-table");function s({children:e,className:t}){return(0,n.jsx)("div",{className:i("table-header-content",t),children:e})}function l({className:e,width:t,wrapperClassName:a,...s}){return(0,n.jsx)("div",{className:i(null,a),children:(0,n.jsx)(r.WE,{headerCellClassName:({column:e})=>i("table-header-cell",{align:e.columnDef.meta?.align}),cellClassName:e=>i("table-cell",{align:e?.column.columnDef.meta?.align,"vertical-align":e?.column.columnDef.meta?.verticalAlign}),className:i("table",{width:t},e),...s})})}},42880:function(e,t,a){a.d(t,{$:()=>s});var n=a(74848),r=a(85169),i=a(46086);function s({header:e,note:t}){return(0,n.jsxs)(r.s,{gap:1,alignItems:"center",children:[e,(0,n.jsx)(i.H,{popoverProps:{placement:["right","left"]},children:t})]})}},51950:function(e,t,a){a.d(t,{C:()=>j});var n=a(74848),r=a(96540),i=a(18117),s=a(2543),l=a(71790),o=a(25508),c=a(2404),d=a.n(c),u=a(56496),m=a(56321);let p=u.F.injectEndpoints({endpoints:e=>({getTabletsInfo:e.query({queryFn:async(e,{signal:t})=>{try{return{data:await window.api.viewer.getTabletsInfo(e,{signal:t})}}catch(e){return{error:e}}},providesTags:["All",{type:"Tablet",id:"LIST"}]})}),overrideExisting:"throw"}),h=(0,o.Mz)(e=>e,e=>p.endpoints.getTabletsInfo.select(e),{argsMemoize:o.i5,argsMemoizeOptions:{equalityCheck:d()}}),g=(0,o.Mz)(e=>e,(e,t)=>h(t),(e,t)=>t(e).data),x=(0,o.Mz)((e,t)=>g(e,t),(e,t)=>(0,m.K)(e,t.database),(e,t)=>e?.TabletStateInfo?t?e.TabletStateInfo.map(e=>{let a=void 0===e.NodeId?void 0:t.get(e.NodeId)?.Host;return{...e,fqdn:a}}):e.TabletStateInfo:[]);var y=a(33172),b=a(61738),f=a(6168);let v=["Created","ResolveStateStorage","Candidate","BlockBlobStorage","RebuildGraph","WriteZeroEntry","Restored","Discover","Lock","Active","ResolveLeader","Terminating"];function j({nodeId:e,path:t,database:a,databaseFullPath:o,onlyActive:c,scrollContainerRef:d}){let[u]=(0,b.Nt)(),m=(0,l.kK)(),h={},g=c?`(State=[${v.join(",")}])`:void 0,j=r.useMemo(()=>{if(!(0,s.isNil)(t)&&!(0,s.isNil)(o))return{path:t,databaseFullPath:o,useMetaProxy:m}},[t,o,m]);(0,y.f8)(e)?h={nodeId:e,database:a,filter:g}:j&&(h={path:j,database:a,filter:g});let{isLoading:T,error:w}=p.useGetTabletsInfoQuery(0===Object.keys(h).length?i.hT:h,{pollingInterval:u}),S=(0,b.N4)(e=>x(e,h));return(0,n.jsx)(f.Q,{scrollContainerRef:d,tablets:S,loading:T,error:w,nodeId:e})}},20036:function(e,t,a){a.r(t),a.d(t,{Tenant:()=>yY});var n=a(74848),r=a(96540),i=a(85902),s=a(30919),l=a(42724),o=a(2543),c=a(83107),d=a(25247),u=a(75442);let m=(0,d.cn)("kv-split"),p=[0,100],h=[50,50],g=function(e){let[t,a]=r.useState(),{collapsedSizes:i,triggerCollapse:s,triggerExpand:l,defaultSizes:d,initialSizes:g}=e,[x,y]=(0,u.i)(e.defaultSizePaneKey),b=r.useMemo(()=>(0,o.debounce)(e=>y(e),200),[y]);r.useEffect(()=>()=>{b.cancel()},[b]);let f=r.useMemo(()=>{if(g)return g;let e=d||h;if(!x)return e;let t=x.split(",").map(e=>{let t=e.trim();return t?Number(t):NaN}),a=e.length;return t.length===a&&t.every(e=>Number.isFinite(e))?t:e},[d,g,x]),v=r.useCallback(e=>{b(e.join(","))},[b]);return r.useEffect(()=>{if(s){let e=i||p;v(e),a(e)}},[i,s,v]),r.useEffect(()=>{let e=d||h;l&&(v(e),a(e))},[d,l,v]),(0,n.jsx)(r.Fragment,{children:(0,n.jsx)(c.A,{direction:e.direction||"horizontal",sizes:t||f,minSize:e.minSize||[0,0],onDrag:t=>{let{onSplitDragAdditional:a}=e;a&&a(),v(t)},className:m(null,e.direction||"horizontal"),gutterSize:8,onDragStart:()=>{let{onSplitStartDragAdditional:t}=e;t&&t(),a(void 0)},expandToMin:!0,children:e.children})})};var x=a(71790),y=a(39471),b=a(56496);let f=b.F.injectEndpoints({endpoints:e=>({getOverview:e.query({queryFn:async({path:e,database:t,timeout:a,databaseFullPath:n,useMetaProxy:r},{signal:i})=>{try{return{data:await window.api.viewer.getDescribe({path:{path:e,databaseFullPath:n,useMetaProxy:r},database:t,timeout:a},{signal:i})}}catch(e){return{error:e}}},serializeQueryArgs:({queryArgs:e})=>{let{database:t,path:a}=e;return{database:t,path:a}},keepUnusedDataFor:0,providesTags:["All","SchemaTree"]})})});var v=a(82691),j=a(36928),T=a(98821),w=a(67222),S=a(35537),_=a(61738),N=a(69045),E=a(12499),C=a(96927),A=a(4329),I=a(38482),P=a(83081),k=a(5434),D=a(23273),R=a(15749),M=a(56347),O=a(8946),q=a(67664),L=a(88727);let z={EPathSubTypeSyncIndexImplTable:"index_table",EPathSubTypeAsyncIndexImplTable:"index_table",EPathSubTypeVectorKmeansTreeIndexImplTable:"index_table",EPathSubTypeFulltextIndexImplTable:"index_table",EPathSubTypeStreamImpl:void 0,EPathSubTypeEmpty:void 0},F={EPathTypeInvalid:void 0,EPathTypeSubDomain:"database",EPathTypeExtSubDomain:"database",EPathTypeDir:"directory",EPathTypeColumnStore:"directory",EPathTypeTable:"table",EPathTypeSysView:"system_table",EPathTypeTableIndex:"index",EPathTypeColumnTable:"column_table",EPathTypeCdcStream:"stream",EPathTypePersQueueGroup:"topic",EPathTypeExternalDataSource:"external_data_source",EPathTypeExternalTable:"external_table",EPathTypeView:"view",EPathTypeReplication:"async_replication",EPathTypeTransfer:"transfer",EPathTypeResourcePool:"resource_pool",EPathTypeStreamingQuery:"streaming_query"},Q={table:"EPathTypeTable",index:"EPathTypeTableIndex",column_table:"EPathTypeColumnTable",external_table:"EPathTypeExternalTable",view:"EPathTypeView"},U={table:"EPathTypeTable",column_table:"EPathTypeColumnTable"},$={streaming_query:"EPathTypeStreamingQuery"},G=(e="EPathTypeDir",t,a="directory")=>t&&z[t]||F[e]||a,B={EPathSubTypeSyncIndexImplTable:(0,L.A)("entity-name_secondary-index-table"),EPathSubTypeAsyncIndexImplTable:(0,L.A)("entity-name_secondary-index-table"),EPathSubTypeVectorKmeansTreeIndexImplTable:(0,L.A)("entity-name_vector-index-table"),EPathSubTypeFulltextIndexImplTable:(0,L.A)("entity-name_fulltext-index-table"),EPathSubTypeStreamImpl:void 0,EPathSubTypeEmpty:void 0},H={EPathTypeInvalid:void 0,EPathTypeSubDomain:(0,L.A)("entity-name_database"),EPathTypeExtSubDomain:(0,L.A)("entity-name_database"),EPathTypeDir:(0,L.A)("entity-name_directory"),EPathTypeTable:(0,L.A)("entity-name_table"),EPathTypeSysView:(0,L.A)("entity-name_system-view"),EPathTypeTableIndex:(0,L.A)("entity-name_secondary-index"),EPathTypeColumnStore:(0,L.A)("entity-name_tablestore"),EPathTypeColumnTable:(0,L.A)("entity-name_column-oriented-table"),EPathTypeCdcStream:(0,L.A)("entity-name_changefeed"),EPathTypePersQueueGroup:(0,L.A)("entity-name_topic"),EPathTypeExternalDataSource:(0,L.A)("entity-name_external-data-source"),EPathTypeExternalTable:(0,L.A)("entity-name_external-table"),EPathTypeStreamingQuery:(0,L.A)("entity-name_streaming_query"),EPathTypeView:(0,L.A)("entity-name_view"),EPathTypeReplication:(0,L.A)("entity-name_async-replication"),EPathTypeTransfer:(0,L.A)("entity-name_transfer"),EPathTypeResourcePool:(0,L.A)("entity-name_resource-pool")},W={EIndexTypeInvalid:void 0,EIndexTypeGlobal:(0,L.A)("entity-name_secondary-index"),EIndexTypeGlobalAsync:(0,L.A)("entity-name_secondary-index"),EIndexTypeGlobalVectorKmeansTree:(0,L.A)("entity-name_vector-index"),EIndexTypeGlobalFulltext:(0,L.A)("entity-name_fulltext-index")},V={UnknownTenantType:"Database",Domain:"Cluster Root",Dedicated:"Dedicated Database",Shared:"Shared Database",Serverless:"Serverless Database"},J={EPathTypeTable:!0,EPathTypeColumnTable:!0,EPathTypeSysView:!0,EPathTypeExternalTable:!0,EPathTypeView:!0,EPathTypeInvalid:!1,EPathTypeDir:!1,EPathTypeSubDomain:!1,EPathTypeTableIndex:!1,EPathTypeExtSubDomain:!1,EPathTypeColumnStore:!1,EPathTypeCdcStream:!1,EPathTypePersQueueGroup:!1,EPathTypeExternalDataSource:!1,EPathTypeReplication:!1,EPathTypeTransfer:!1,EPathTypeResourcePool:!1,EPathTypeStreamingQuery:!1},K=e=>(e&&J[e])??!1,Y={EPathTypeColumnStore:!0,EPathTypeColumnTable:!0,EPathTypeInvalid:!1,EPathTypeDir:!1,EPathTypeTable:!1,EPathTypeSysView:!1,EPathTypeSubDomain:!1,EPathTypeTableIndex:!1,EPathTypeExtSubDomain:!1,EPathTypeCdcStream:!1,EPathTypePersQueueGroup:!1,EPathTypeExternalDataSource:!1,EPathTypeExternalTable:!1,EPathTypeStreamingQuery:!1,EPathTypeView:!1,EPathTypeReplication:!1,EPathTypeTransfer:!1,EPathTypeResourcePool:!1},Z=e=>(e&&Y[e])??!1,X={EPathTypeSubDomain:!0,EPathTypeExtSubDomain:!0,EPathTypeInvalid:!1,EPathTypeDir:!1,EPathTypeColumnStore:!1,EPathTypeColumnTable:!1,EPathTypeTable:!1,EPathTypeSysView:!1,EPathTypeTableIndex:!1,EPathTypeCdcStream:!1,EPathTypePersQueueGroup:!1,EPathTypeExternalDataSource:!1,EPathTypeExternalTable:!1,EPathTypeStreamingQuery:!1,EPathTypeView:!1,EPathTypeReplication:!1,EPathTypeTransfer:!1,EPathTypeResourcePool:!1},ee=e=>(e&&X[e])??!1,et={EPathSubTypeSyncIndexImplTable:!0,EPathSubTypeAsyncIndexImplTable:!0,EPathSubTypeVectorKmeansTreeIndexImplTable:!0,EPathSubTypeFulltextIndexImplTable:!0,EPathSubTypeStreamImpl:!0,EPathSubTypeEmpty:!1},ea={EPathTypeCdcStream:!1,EPathTypePersQueueGroup:!0,EPathTypeExternalDataSource:!0,EPathTypeExternalTable:!0,EPathTypeView:!0,EPathTypeResourcePool:!0,EPathTypeReplication:!0,EPathTypeTransfer:!0,EPathTypeInvalid:!1,EPathTypeColumnStore:!1,EPathTypeColumnTable:!1,EPathTypeDir:!1,EPathTypeTable:!1,EPathTypeSysView:!1,EPathTypeSubDomain:!1,EPathTypeTableIndex:!1,EPathTypeExtSubDomain:!1,EPathTypeStreamingQuery:!0};var en=a(51432),er=JSON.parse('{"no-data":"No data","title_database-overview":"Overview","title_info":"Info","title_schema":"Schema","title_queries":"Queries","title_top-shards":"Top shards","title_access":"Access","title_backups":"Backups","title_nodes":"Nodes","title_tablets":"Tablets","title_storage":"Storage","title_network":"Network","title_describe":"Describe","title_hot-keys":"Hot keys","title_graph":"Graph","title_consumers":"Consumers","title_partitions":"Partitions","title_data":"Data","title_configs":"Configs","title_operations":"Operations","title_monitoring":"Monitoring","value_new":"New"}');let ei=(0,en.g4)("ydb-diagnostics",{en:er}),es={id:j.iJ.database,title:ei("title_database-overview")},el={id:j.iJ.overview,title:ei("title_info")},eo={id:j.iJ.schema,title:ei("title_schema")},ec={id:j.iJ.topQueries,title:ei("title_queries")},ed={id:j.iJ.topShards,title:ei("title_top-shards")},eu={id:j.iJ.access,title:ei("title_access")},em={id:j.iJ.backups,title:ei("title_backups")},ep={id:j.iJ.nodes,title:ei("title_nodes")},eh={id:j.iJ.tablets,title:ei("title_tablets")},eg={id:j.iJ.storage,title:ei("title_storage")},ex={id:j.iJ.network,title:ei("title_network")},ey={id:j.iJ.describe,title:ei("title_describe")},eb={id:j.iJ.hotKeys,title:ei("title_hot-keys")},ef={id:j.iJ.graph,title:ei("title_graph")},ev={id:j.iJ.consumers,title:ei("title_consumers")},ej={id:j.iJ.partitions,title:ei("title_partitions")},eT={id:j.iJ.topicData,title:ei("title_data")},ew={id:j.iJ.configs,title:ei("title_configs")},eS={id:j.iJ.operations,title:ei("title_operations")},e_={id:j.iJ.monitoring,title:ei("title_monitoring"),badge:{text:ei("value_new"),theme:"normal",size:"xs"}},eN=[el,e_,ec,ed,ep,eh,eg,ex,ey,ew,eu,eS,em],eE=[el,ed,ep,eh,ey,eu],eC=[es,e_,ec,eg,ex,ew,eS,em],eA=[el,e_,ec,ed,eh,ey,ew,eS],eI=[el,ed,eh,ey],eP=[es,e_,ec,ew,eS],ek=[el,ed,ep,ey,eu],eD={EPathTypeInvalid:void 0,EPathTypeSubDomain:eN,EPathTypeExtSubDomain:eN,EPathTypeColumnStore:eN,EPathTypeTable:[el,eo,ed,ep,ef,eh,eb,ey,eu],EPathTypeColumnTable:[el,eo,ed,ep,eh,ey,eu],EPathTypeSysView:[el,eo,ep,ey,eu],EPathTypeDir:ek,EPathTypeTableIndex:ek,EPathTypeCdcStream:[el,ev,ej,eT,ep,ey,eu],EPathTypePersQueueGroup:[el,ev,ej,eT,ep,eh,ey,eu],EPathTypeExternalDataSource:[el,ey,eu],EPathTypeExternalTable:[el,eo,ey,eu],EPathTypeStreamingQuery:[el,ey,eu],EPathTypeView:[el,eo,ey,eu],EPathTypeReplication:[el,eh,ey,eu],EPathTypeTransfer:[el,eh,ey,eu],EPathTypeResourcePool:ek},eR={EPathSubTypeStreamImpl:[el,ep,eh,ey,eu],EPathSubTypeSyncIndexImplTable:void 0,EPathSubTypeAsyncIndexImplTable:void 0,EPathSubTypeVectorKmeansTreeIndexImplTable:void 0,EPathSubTypeFulltextIndexImplTable:void 0,EPathSubTypeEmpty:void 0},eM=()=>{let e=(0,M.zy)(),t=(0,O.mA)(e);return r.useCallback((e,a)=>(0,O.YL)({...t,[q.vh.diagnosticsTab]:e,...a}),[t])},eO=(0,d.cn)("ydb-database-diagnostics-tabs");function eq({activeTab:e,tabs:t}){let a=eM();return(0,n.jsx)("div",{className:eO("header-wrapper"),children:(0,n.jsxs)("div",{className:eO("tabs"),children:[(0,n.jsx)(A.f,{value:e?.id,children:(0,n.jsx)(I.w,{size:"l",children:t.map(({id:e,title:t,badge:r})=>(0,n.jsx)(eL,{id:e,title:t,linkPath:a(e),badge:r},e))})}),(0,n.jsx)(D.E,{})]})})}function eL({id:e,title:t,linkPath:a,badge:r}){return(0,n.jsx)(P.o,{value:e,children:(0,n.jsxs)(R.E,{to:a,as:"tab",children:[t,r&&(0,n.jsx)(k.J,{className:eO("tab-badge"),theme:r.theme,size:r.size,children:r.text})]})},e)}var ez=a(35461),eF=a(54403),eQ=a(43834),eU=a(68243),e$=a(67103),eG=a(12543),eB=a(9185),eH=a(23172),eW=a(97855),eV=a(7350),eJ=a.n(eV),eK=a(29620);let eY=(0,d.cn)("heatmap"),eZ={width:0,height:0,columnsCount:0,rowsCount:0},eX=e=>{let[t,a]=r.useState(eZ),{tablets:i,onShowTabletTooltip:s,onHideTabletTooltip:l}=e,o=r.useRef(null),c=r.useRef(null),d=(0,O.Cs)();r.useEffect(()=>{let e=o.current;if(!e)return;let a=e.getContext("2d");a&&(a.clearRect(0,0,e.offsetWidth,e.offsetHeight),i.forEach((e,n)=>{let{columnsCount:r}=t,i=12*Math.floor(n/r);a.fillStyle=e.color||"grey",a.fillRect(n%r*12,i,10,10)}))},[i,t]);let u=i.length;r.useLayoutEffect(()=>{let e=c.current;if(e){let t=e.offsetWidth-15,n=Math.floor(t/12),r=Math.ceil(u/n);a({width:t,height:12*r,columnsCount:n,rowsCount:r})}},[u]);let m=()=>{let e=o.current,t=0;for(;e;)t+=e.offsetTop,e=e.offsetParent;return t},p=()=>{let e=o.current,t=0;for(;e;)t+=e.offsetLeft,e=e.offsetParent;return t},h=(e,a)=>{let{columnsCount:n}=t;return n*Math.floor(a/12)+Math.floor(e/12)},g=eJ()((a,n)=>{let r=e.parentRef.current;if(!r)return;let o=h(a-p()+r.scrollLeft,n-m()+r.scrollTop),c=i[o];if(c){let{columnsCount:e}=t;if(!e)return;let a=Math.floor(o/e);s(c,{left:o%e*12+5,top:12*a+5})}else l()},20);return(0,n.jsx)("div",{ref:c,className:eY("canvas-container"),onMouseLeave:()=>{setTimeout(()=>{l()},40)},children:(0,n.jsx)("canvas",{ref:o,width:t.width,height:t.height,onClick:t=>{let a=e.parentRef.current;if(!a)return;let n=i[h(t.clientX-p()+a.scrollLeft,t.clientY-m()+a.scrollTop)];n&&window.open((e=>{let{TabletId:t}=e;if(!t)return"#";let a=window.location.hostname,n=d(t),r=[a,eK.P8,n].map(e=>e.startsWith("/")?e.slice(1):e).filter(Boolean).join("/");return`https://${r}`})(n),"_blank")},onMouseMove:e=>g(e.clientX,e.clientY)})})},e0={r:255,g:4,b:0},e1={r:255,g:219,b:77},e2={r:59,g:201,b:53},e3={CPU:{min:0,max:1e6},Network:{min:0,max:1e9},Storage:{min:0,max:2e9},DataSize:{min:0,max:2e9},RowCount:{min:0},IndexSize:{min:0}},e4=e=>{let t=e.toString(16);return 1===t.length?`0${t}`:t},e5=(e,t,a)=>{if(1===e)return[t];if(2===e)return[t,a];let n=(t.r-a.r)/(e-1),r=(t.g-a.g)/(e-1),i=(t.b-a.b)/(e-1),s=[];for(let a=0;a<e;a++)s.push({r:Math.round(t.r-n*a),g:Math.round(t.g-r*a),b:Math.round(t.b-i*a)});return s.map(e=>(({r:e,g:t,b:a})=>`#${e4(e)}${e4(t)}${e4(a)}`)(e))},e6=e=>{let t=Math.floor(e/2);return[...e5(e%2==0?t:t+1,e2,e1),...e5(t+1,e1,e0).slice(1)]},e7=(e,t)=>{let a=new Set,n=e3[e]||{};t.forEach(t=>{a.add(Number(t.metrics?.[e]))}),Number.isInteger(n.min)&&a.add(n.min),Number.isInteger(n.max)&&a.add(n.max);let r=Array.from(a.values()).sort((e,t)=>e-t);return{min:r[0],max:r[r.length-1]}};var e8=JSON.parse('{"label_count":"Count","label_from":"From","label_to":"To"}');let e9=(0,en.g4)("ydb-heatmap-histogram",{en:e8}),te=(0,d.cn)("histogram"),tt=(0,d.cn)("histogram-tooltip"),ta=({data:e})=>{if(!e)return null;let{count:t,leftBound:a,rightBound:r}=e;return(0,n.jsx)("div",{className:tt(),children:(0,n.jsx)("table",{children:(0,n.jsxs)("tbody",{children:[(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{className:tt("label"),children:e9("label_count")}),(0,n.jsx)("td",{className:tt("value"),children:t||"?"})]}),(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{className:tt("label"),children:e9("label_from")}),(0,n.jsx)("td",{className:tt("value"),children:a||"?"})]}),(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{className:tt("label"),children:e9("label_to")}),(0,n.jsx)("td",{className:tt("value"),children:r||"?"})]})]})})})},tn=({data:e={},maxCount:t,onShowTooltip:a,onHideTooltip:i})=>{let s=r.useRef(null),{count:l,leftBound:o,rightBound:c,color:d}=e,u=Number(l)||0;return(0,n.jsx)("div",{ref:s,className:te("item"),style:{backgroundColor:d,height:`${t>0?u/t*100:0}%`},onMouseEnter:()=>{let e=s.current;e&&a(e,{count:l,leftBound:o,rightBound:c})},onMouseLeave:()=>{i()}})},tr=({tablets:e,currentMetric:t})=>{let{min:a,max:i}=e7(t,e),{histogramRange:s,maxCount:l}=r.useMemo(()=>{let n=e6(50),r=(i-a)/50;if(0===r||!isFinite(r))return{histogramRange:[],maxCount:0};let s=n.map((e,t)=>({color:e,count:0,leftBound:(0,eW.ZV)(a+t*r),rightBound:(0,eW.ZV)(a+(t+1)*r)})),l=0;return e.forEach(e=>{let n=Number(t&&e.metrics?.[t]);if(!isFinite(n)||n<a||n>i)return;let o=Math.min(Math.floor((n-a)/r),s.length-1),c=s[o],d=(c?.count||0)+1;d>l&&(l=d),c&&(s[o]={...c,count:d})}),{histogramRange:s,maxCount:l}},[e,t,a,i]),[o,c]=r.useState({anchor:null,data:null}),d=r.useCallback((e,t)=>{c({anchor:e,data:t})},[]),u=r.useCallback(()=>{c({anchor:null,data:null})},[]);return(0,n.jsxs)("div",{className:te(),children:[o.anchor&&o.data?(0,n.jsx)(eF.z,{open:!0,hasArrow:!0,placement:["top","bottom"],anchorElement:o.anchor,onOutsideClick:u,children:(0,n.jsx)(ta,{data:o.data})}):null,(0,n.jsxs)("div",{className:te("chart"),children:[!!i&&s.map((e,t)=>(0,n.jsx)(tn,{data:e,maxCount:l,onShowTooltip:d,onHideTooltip:u},t)),(0,n.jsx)("div",{className:te("x-min"),children:(0,eW.ZV)(a)}),(0,n.jsx)("div",{className:te("x-max"),children:(0,eW.ZV)(i)}),(0,n.jsx)("div",{className:te("y-min"),children:"0"}),(0,n.jsx)("div",{className:te("y-max"),children:(0,eW.ZV)(l)})]})]})},ti=(0,d.cn)("heatmap"),ts=e6(500),tl=({path:e,database:t,databaseFullPath:a})=>{let i=(0,_.YQ)(),s=(0,x.kK)(),l=r.useRef(null),[o,c]=r.useState(null),[d,u]=r.useState(null),m=r.useRef(!1),[p]=(0,_.Nt)(),{currentData:h,isFetching:g,error:y}=eH.f1.useGetHeatmapTabletsInfoQuery({path:e,database:t,databaseFullPath:a,useMetaProxy:s},{pollingInterval:p}),{tablets:b=[],metrics:f}=h||{},{sort:v,heatmap:j,currentMetric:T}=(0,_.N4)(e=>e.heatmap),w=r.useCallback((e,t)=>{c({tablet:e,position:t})},[]),N=r.useCallback(()=>{c(null)},[]),E=r.useCallback(()=>{c(e=>!e||m.current?e:null)},[]),C=r.useCallback(()=>{m.current=!0},[]),A=r.useCallback(()=>{m.current=!1,N()},[N]),I=e=>{i((0,eH.nd)({currentMetric:e[0]}))},P=()=>{i((0,eH.nd)({sort:!v}))},k=()=>{i((0,eH.nd)({heatmap:!j}))};return g&&void 0===h?(0,n.jsx)(eG.a,{}):(()=>{let e,{min:t,max:a}=e7(T,b),r=!!(o&&d);return(!y||h)&&(e=j?(()=>{let{min:e,max:t}=e7(T,b),a=b.map(a=>{let n=T&&Number(a.metrics?.[T]),r=ts[0===t?0:Math.round((n-e)/(t-e)*499)];return{...a,color:r,value:n,formattedValue:(0,eW.ZV)(n),currentMetric:T}}),r=v?a.sort((e,t)=>Number(t.value)-Number(e.value)):a;return(0,n.jsxs)("div",{ref:l,className:ti("items"),children:[o?(0,n.jsx)("div",{ref:u,className:ti("tooltip-anchor"),style:{left:o.position.left,top:o.position.top}},`${o.position.left}-${o.position.top}`):null,(0,n.jsx)(eX,{tablets:r,parentRef:l,onShowTabletTooltip:w,onHideTabletTooltip:E})]})})():(0,n.jsx)(tr,{tablets:b,currentMetric:T})),(0,n.jsxs)("div",{className:ti(),children:[r?(0,n.jsx)(eF.z,{open:!0,hasArrow:!0,placement:["top","bottom","left","right"],anchorElement:d,onOutsideClick:N,children:(0,n.jsx)("div",{className:ti("tooltip"),onMouseEnter:C,onMouseLeave:A,children:(0,n.jsx)(eB.nL,{data:o?.tablet})})}):null,(0,n.jsxs)("div",{className:ti("filters"),children:[(0,n.jsx)(eQ.l,{className:ti("heatmap-select"),value:T?[T]:[],options:f,onUpdate:I,width:200}),(0,n.jsx)("div",{className:ti("sort-checkbox"),children:(0,n.jsx)(eU.S,{onUpdate:P,checked:v,children:"Sort"})}),(0,n.jsx)("div",{className:ti("histogram-checkbox"),children:(0,n.jsx)(eU.S,{onUpdate:k,checked:j,children:"Heatmap"})}),(0,n.jsxs)("div",{className:ti("limits"),children:[(0,n.jsxs)("div",{className:ti("limits-block"),children:[(0,n.jsx)("div",{className:ti("limits-title"),children:"min:"}),(0,n.jsx)("div",{className:ti("limits-value"),children:Number.isInteger(t)?(0,eW.ZV)(t):S.Pd})]}),(0,n.jsxs)("div",{className:ti("limits-block"),children:[(0,n.jsx)("div",{className:ti("limits-title"),children:"max:"}),(0,n.jsx)("div",{className:ti("limits-value"),children:Number.isInteger(a)?(0,eW.ZV)(a):S.Pd})]}),(0,n.jsxs)("div",{className:ti("limits-block"),children:[(0,n.jsx)("div",{className:ti("limits-title"),children:"count:"}),(0,n.jsx)("div",{className:ti("limits-value"),children:(0,eW.ZV)(b.length)})]})]})]}),y?(0,n.jsx)(e$.o,{error:y}):null,e]})})()};var to=a(11025),tc=a(74010),td=a(78951),tu=a(48849),tm=a(4320),tp=JSON.parse('{"title_empty":"No operations data","pleaceholder_search":"Search operations","placeholder_kind":"Select operation kind","kind_ssBackgrounds":"SS/Backgrounds","kind_export_s3":"Export/S3","kind_export_yt":"Export/YT","kind_import_s3":"Import/S3","kind_buildIndex":"Build Index","column_operationId":"Operation ID","column_status":"Status","column_createdBy":"Created By","column_createTime":"Create Time","column_endTime":"End Time","column_duration":"Duration","column_state":"State","label_duration-ongoing":"{{value}} (ongoing)","label_in-progress":"In progress","value_progress_unspecified":"Unspecified","value_progress_preparing":"Preparing","value_progress_transfer_data":"Transferring Data","value_progress_build_indexes":"Building Indexes","value_progress_done":"Done","value_progress_cancellation":"Cancelling","value_progress_cancelled":"Cancelled","value_progress_create_changefeeds":"Creating Changefeeds","header_cancel":"Cancel operation","header_forget":"Forget operation","text_cancel":"The operation will be cancelled. Do you want to proceed?","text_forget":"The operation will be forgotten. Do you want to proceed?","text_forgotten":"The operation {{id}} has been forgotten","text_cancelled":"The operation {{id}} has been cancelled"}');let th=(0,en.g4)("ydb-operations",{en:tp}),tg="status",tx="created_by",ty="create_time",tb="end_time",tf="duration",tv="state",tj={id:th("column_operationId"),[tg]:th("column_status"),[tx]:th("column_createdBy"),[ty]:th("column_createTime"),[tb]:th("column_endTime"),[tf]:th("column_duration"),[tv]:th("column_state")},tT=[{value:"export/s3",content:th("kind_export_s3")},{value:"export/yt",content:th("kind_export_yt")},{value:"import/s3",content:th("kind_import_s3")},{value:"ss/backgrounds",content:th("kind_ssBackgrounds")},{value:"buildindex",content:th("kind_buildIndex")}],tw=(0,d.cn)("operations");function tS({kind:e,searchValue:t,handleKindChange:a,handleSearchChange:i}){return(0,n.jsxs)(r.Fragment,{children:[(0,n.jsx)(tm.v,{value:t,onChange:i,placeholder:th("pleaceholder_search"),className:tw("search")}),(0,n.jsx)(eQ.l,{value:[e],width:150,options:tT,onUpdate:e=>a(e[0])})]})}var t_=a(93704),tN=a(13177),tE=a(77269),tC=a(85169),tA=a(6876),tI=a(17427),tP=a(32692),tk=a(5948);let tD=b.F.injectEndpoints({endpoints:e=>({getOperationList:e.infiniteQuery({infiniteQueryOptions:{initialPageParam:void 0,getNextPageParam:e=>"0"===e.next_page_token?void 0:e.next_page_token},queryFn:async({queryArg:e,pageParam:t},{signal:a})=>{try{var n;let r={database:e.database,kind:e.kind,page_size:e.page_size??20,page_token:t};return{data:(n=await window.api.operation.getOperationList(r,{signal:a}),Array.isArray(n.operations)?n:{...n,operations:[],next_page_token:"0"})}}catch(e){return{error:e}}},providesTags:["All"]}),cancelOperation:e.mutation({queryFn:async(e,{signal:t})=>{try{return{data:await window.api.operation.cancelOperation(e,{signal:t})}}catch(e){return{error:e}}}}),forgetOperation:e.mutation({queryFn:async(e,{signal:t})=>{try{return{data:await window.api.operation.forgetOperation(e,{signal:t})}}catch(e){return{error:e}}}})}),overrideExisting:"throw"});var tR=a(91349),tM=a(51630);function tO(e){return!!e&&"type.googleapis.com/Ydb.Table.IndexBuildMetadata"===e["@type"]}function tq({operation:e,database:t,refreshTable:a}){let[r,{isLoading:i}]=tD.useCancelOperationMutation(),[s,{isLoading:l}]=tD.useForgetOperationMutation(),o=e.id;if(!o)return null;let c=i||!0===e.ready;return(0,n.jsxs)(tC.s,{gap:"2",children:[(0,n.jsx)(tA.m,{title:th("header_forget"),placement:["left","bottom"],disabled:l,children:(0,n.jsx)("div",{children:(0,n.jsx)(tP.B,{buttonView:"outlined",dialogHeader:th("header_forget"),dialogText:th("text_forget"),onConfirmAction:()=>s({id:o,database:t}).unwrap().then(()=>{(0,tR.A)({name:"Forgotten",title:th("text_forgotten",{id:o}),theme:"success"}),a()}),buttonDisabled:l,children:(0,n.jsx)(tI.I,{data:t_.A})})})}),(0,n.jsx)(tA.m,{title:th("header_cancel"),placement:["right","bottom"],disabled:c,children:(0,n.jsx)("div",{children:(0,n.jsx)(tP.B,{popoverDisabled:c,buttonView:"outlined",dialogHeader:th("header_cancel"),dialogText:th("text_cancel"),onConfirmAction:()=>r({id:o,database:t}).unwrap().then(()=>{(0,tR.A)({name:"Cancelled",title:th("text_cancelled",{id:o}),theme:"success"}),a()}),buttonDisabled:c,children:(0,n.jsx)(tI.I,{data:tN.A})})})})]})}var tL=a(22708),tz=a(14476);let tF=tz.z.enum(["ss/backgrounds","export/s3","export/yt","import/s3","buildindex"]).catch("buildindex");function tQ({database:e,scrollContainerRef:t}){let{kind:a,searchValue:i,pageSize:l,handleKindChange:c,handleSearchChange:d}=function(){let[e,t]=(0,tL.useQueryParams)({kind:tL.StringParam,search:tL.StringParam,pageSize:tL.NumberParam,pageToken:tL.StringParam}),a=tF.parse(e.kind),n=e.search??"",r=e.pageSize??void 0;return{kind:a,searchValue:n,pageSize:r,pageToken:e.pageToken??void 0,handleKindChange:e=>{t({kind:e},"replaceIn")},handleSearchChange:e=>{t({search:e||void 0},"replaceIn")},handlePageSizeChange:e=>{t({pageSize:e},"replaceIn")},handlePageTokenChange:e=>{t({pageToken:e},"replaceIn")}}}(),{operations:u,isLoading:m,isLoadingMore:p,error:h,refreshTable:g}=function({database:e,kind:t,pageSize:a=20,searchValue:n,scrollContainerRef:i}){let{data:s,error:l,isLoading:c,isFetchingNextPage:d,hasNextPage:u,fetchNextPage:m,refetch:p}=tD.useGetOperationListInfiniteQuery({database:e,kind:t,page_size:a}),h=r.useMemo(()=>s?.pages?s.pages.flatMap(e=>e.operations||[]):[],[s]),g=r.useMemo(()=>n?h.filter(e=>e.id?.toLowerCase().includes(n.toLowerCase())):h,[h,n]),x=r.useCallback(async()=>{let e=i?.current;if(!e||!u||d)return;let{scrollHeight:t,clientHeight:a}=e;t<=a&&await m()},[i,u,d,m]);return r.useLayoutEffect(()=>{if(!d){let e=requestAnimationFrame(()=>{x()});return()=>cancelAnimationFrame(e)}},[s,d,x]),r.useEffect(()=>{let e=i?.current;if(!e)return;let t=()=>{let{scrollTop:t,scrollHeight:a,clientHeight:n}=e;a-t-n<100&&u&&!d&&m()};return e.addEventListener("scroll",t),()=>e.removeEventListener("scroll",t)},[i,u,d,m]),r.useEffect(()=>{let e=(0,o.throttle)(x,200,{trailing:!0,leading:!0});return window.addEventListener("resize",e),()=>{e.cancel(),window.removeEventListener("resize",e)}},[x]),{operations:g,isLoading:c,isLoadingMore:d,error:l,refreshTable:p}}({database:e,kind:a,pageSize:l,searchValue:i,scrollContainerRef:t}),x=r.useMemo(()=>({...S.N3,sortable:!1}),[]);return h?(0,n.jsx)(s.A,{error:h,position:"left"}):(0,n.jsxs)(tu.L,{children:[(0,n.jsx)(tu.L.Controls,{children:(0,n.jsx)(tS,{kind:a,searchValue:i,handleKindChange:c,handleSearchChange:d})}),(0,n.jsxs)(tu.L.Table,{loading:m,className:tw("table"),children:[u.length>0||m?(0,n.jsx)(tc.l,{columns:function({database:e,refreshTable:t,kind:a}){let r="buildindex"===a,i=[{name:"id",header:tj.id,width:340,render:({row:e})=>{if(!e.id)return S.Pd;let t=r&&(e=>{let{metadata:t}=e;return tO(t)&&t.description?JSON.stringify(t.description,null,2):""})(e)||e.id;return(0,n.jsx)(tk.s,{placement:["top","bottom"],content:t,children:e.id})}},{name:tg,header:tj[tg],render:({row:e})=>{var t;let a;return a=function(e,t){let a=e.metadata;if(!a)return null;if(tO(a)&&"number"==typeof a.progress)return`${Math.round(a.progress)}%`;if(a&&"type.googleapis.com/Ydb.Import.ImportFromS3Metadata"===a["@type"]||a&&"type.googleapis.com/Ydb.Export.ExportToS3Metadata"===a["@type"]||a&&"type.googleapis.com/Ydb.Export.ExportToYtMetadata"===a["@type"]){let e=function(e){if(!e?.items_progress||0===e.items_progress.length)return null;let t=0,a=0;for(let n of e.items_progress)void 0!==n.parts_total&&n.parts_total>0&&(t+=n.parts_total,a+=n.parts_completed||0);return 0===t?null:Math.round(a/t*100)}(a);if(null!==e)return`${e}%`;if(a.progress){let e="string"==typeof a.progress?a.progress:String(a.progress),n=e.replace(/^PROGRESS_/,"").toLowerCase(),r=`value_progress_${n}`;try{let e=t(r);if(e&&e!==r)return e}catch{}return e}}return null}(t=e,th),t.ready?t.status?(0,n.jsx)(tE.E,{color:"SUCCESS"===t.status?"positive":"danger",children:t.status}):S.Pd:t.status&&"SUCCESS"!==t.status?(0,n.jsx)(tE.E,{color:"danger",children:t.status}):null!==a?a:th("label_in-progress")}}];return r&&i.push({name:tv,header:tj[tv],render:({row:e})=>{let t=e.metadata;return t?.state?t.state:S.Pd}}),i.push({name:tx,header:tj[tx],render:({row:e})=>e.created_by?e.created_by:S.Pd},{name:ty,header:tj[ty],render:({row:e})=>e.create_time?(0,eW.r6)((0,tM.ee)(e.create_time)):S.Pd},{name:tb,header:tj[tb],render:({row:e})=>e.end_time?(0,eW.r6)((0,tM.ee)(e.end_time)):S.Pd},{name:tf,header:tj[tf],render:({row:e})=>{let t=0;if(!e.create_time)return S.Pd;let a=(0,tM.ee)(e.create_time),n=(t=e.end_time?(0,tM.ee)(e.end_time)-a:Date.now()-a)<0?0:t,r=(0,eW.uH)(n);return e.end_time?r:th("label_duration-ongoing",{value:r})}}),i.push({name:"Actions",sortable:!1,resizeable:!1,header:"",render:({row:a})=>(0,n.jsx)(tq,{operation:a,database:e,refreshTable:t})}),i}({database:e,refreshTable:g,kind:a}),columnsWidthLSKey:"selectedOperationColumns",data:u,settings:x,emptyDataMessage:th("title_empty")}):(0,n.jsx)("div",{children:th("title_empty")}),p&&(0,n.jsx)(td.Q,{showHeader:!1,rows:3,delay:0,className:tw("loading-more")})]})]})}var tU=a(25041),t$=a(51950);function tG(e,t){let a=e.replace(/^\/+|\/+$/g,""),n=t.replace(/^\/+|\/+$/g,"");if(!a.startsWith(n))return a||"/";if(a===n)return`/${a}`;let r=a.slice(n.length);return r.replace(/^\/+/,"")||"/"}function tB(e,t){return"EPathTypeDir"===t&&2===e.split("/").length&&e.startsWith("/")}var tH=a(55028);let tW=b.F.injectEndpoints({endpoints:e=>({getViewSchema:e.query({queryFn:async({database:e,path:t,databaseFullPath:a,timeout:n})=>{try{let r=tG(t,a),i=await window.api.viewer.sendQuery({query:`SELECT * FROM \`${r}\` LIMIT 0`,database:e,action:"execute-query",timeout:n,internal_call:!0},{withRetries:!0});if((0,tH.We)(i))return{error:i};return{data:i?.result?.[0]?.columns||[]}}catch(e){return{error:e}}},serializeQueryArgs:({queryArgs:e})=>{let{database:t,path:a}=e;return{database:t,path:a}},providesTags:["All","SchemaTree"]})}),overrideExisting:"throw"});var tV=a(80720),tJ=JSON.parse('{"column-title.id":"Id","column-title.name":"Name","column-title.type":"Type","column-title.notNull":"NotNull","column-title.autoIncrement":"AutoIncrement","column-title.defaultValue":"Default","column-title.family":"Family","column-title.media":"Media","column-title.compression":"Compression","primary-key.title":"Primary key:","partitioning-key.title":"Partitioning key:"}');let tK=(0,en.g4)("ydb-schema-viewer",{en:tJ}),tY=(0,d.cn)("schema-viewer"),tZ=({tableData:e,extended:t,type:a})=>{let r="primary"===a?e.filter(e=>!!(void 0!==e.keyColumnIndex&&-1!==e.keyColumnIndex&&e.name)).sort((e,t)=>e.keyColumnIndex-t.keyColumnIndex).map(e=>e.name):e.filter(e=>!!(void 0!==e.partitioningColumnIndex&&-1!==e.partitioningColumnIndex&&e.name)).sort((e,t)=>e.partitioningColumnIndex-t.partitioningColumnIndex).map(e=>e.name),i=t?3:r.length,s=r.slice(0,i),l=r.slice(i);return r.length>0?(0,n.jsxs)("div",{className:tY("keys",{summary:!t,type:a}),children:[(0,n.jsx)("div",{className:tY("keys-header"),children:"primary"===a?tK("primary-key.title"):tK("partitioning-key.title")}),(0,n.jsxs)("div",{className:tY("keys-values"),children:[" "+s.join(", "),l.length?(0,n.jsx)(tV.u,{className:tY("more-badge"),placement:["bottom"],hasArrow:!1,pinOnClick:!0,content:(0,n.jsx)("div",{className:tY("popup-content"),children:l.map(e=>(0,n.jsx)("div",{className:tY("popup-item"),children:e},e))}),children:(0,n.jsx)(k.J,{className:tY("keys-label"),children:`+${l.length}`})}):null]})]}):null};var tX=a(29581);function t0({data:e,name:t,header:a,sortable:n}){let r="string"==typeof a?a.length:t.length,i=n?r+2:r;if(e)for(let a of e){let e=0;if(a[t]&&(e=String(a[t]).length),10*(i=Math.max(i,e))+20>=600)return 600}return 10*i+20}var t1=a(73831);let t2={name:"id",get header(){return tK("column-title.id")},width:60,align:tX.Ay.RIGHT,render:({row:e})=>{let t=(0,n.jsx)(tI.I,{className:tY("key-icon"),size:12,data:t1.A});return(0,n.jsxs)("span",{className:tY("id-wrapper"),children:[e.id,void 0===e.keyColumnIndex||-1===e.keyColumnIndex?null:t]})}},t3={name:"name",get header(){return tK("column-title.name")},width:120,render:({row:e})=>e.name},t4={name:"type",get header(){return tK("column-title.type")},width:100,render:({row:e})=>e.type},t5={name:"notNull",get header(){return tK("column-title.notNull")},width:100,defaultOrder:tX.Ay.DESCENDING,render:({row:e})=>{if(e.notNull)return"✓"}},t6={name:"autoIncrement",get header(){return tK("column-title.autoIncrement")},width:100,defaultOrder:tX.Ay.DESCENDING,render:({row:e})=>{if(e.autoIncrement)return"✓"}},t7={name:"defaultValue",get header(){return tK("column-title.defaultValue")},width:100,render:({row:e})=>String(e.defaultValue)},t8={name:"familyName",get header(){return tK("column-title.family")},width:100,render:({row:e})=>e.familyName},t9={name:"prefferedPoolKind",get header(){return tK("column-title.media")},width:100,render:({row:e})=>e.prefferedPoolKind},ae={name:"columnCodec",get header(){return tK("column-title.compression")},width:130,render:({row:e})=>e.columnCodec};function at(e,t){if(!t)return e;let a=t.slice(0,100);return e.map(e=>({...e,width:t0({data:a,name:e.name,header:"string"==typeof e.header?e.header:void 0,sortable:e.sortable||void 0===e.sortable})}))}function aa(e,t){let{Table:a,ColumnTableDescription:n,ExternalTableDescription:r}=t?.PathDescription||{};return"EPathTypeTable"===e||"EPathTypeSysView"===e?function(e={}){let t=e?.PartitionConfig?.ColumnFamilies?.reduce((e,t)=>t.Id?{...e,[t.Id]:t}:e,{})??{},{Columns:a,KeyColumnNames:n}=e;return a?.map(e=>{let{Id:a,Name:r,NotNull:i,Type:s,Family:l,DefaultFromSequence:o,DefaultFromLiteral:c}=e,d=n?.findIndex(e=>e===r)??-1,u=l?t[l].Name:void 0,m=l?t[l].StorageConfig?.Data?.PreferredPoolKind:void 0,p=l?function(e){if(e)return"ColumnCodecPlain"===e?"None":e.replace("ColumnCodec","").toLocaleLowerCase()}(t[l].ColumnCodec):void 0;return{id:a,name:r,keyColumnIndex:d,type:s,notNull:i,autoIncrement:!!o,defaultValue:Object.values(c?.value||{})[0]??"-",familyName:u,prefferedPoolKind:m,columnCodec:p}})??[]}(a):Z(e)?function(e={}){let{Schema:t={},Sharding:a={}}=e,{Columns:n,KeyColumnNames:r}=t,{HashSharding:i={}}=a,{Columns:s=[]}=i,l=n?.map(e=>{let{Id:t,Name:a,Type:n,NotNull:i}=e,l=r?.findIndex(e=>e===a)??-1,o=s?.findIndex(e=>e===a)??-1;return{id:t,name:a,keyColumnIndex:l,partitioningColumnIndex:o,type:n,notNull:i}});return[...l?.filter(e=>-1!==e.keyColumnIndex)||[],...l?.filter(e=>-1===e.keyColumnIndex)||[]]}(n):"EPathTypeExternalTable"===e?function(e={}){let{Columns:t}=e;return t?.map(e=>{let{Id:t,Name:a,Type:n,NotNull:r}=e;return{id:t,name:a,type:n,notNull:r}})||[]}(r):[]}function an(e){return e?.map(e=>({type:e.type?.endsWith("?")?e.type.slice(0,-1):e.type,name:e.name}))||[]}let ar=({type:e,path:t,database:a,extended:i=!1,databaseFullPath:s})=>{let[l]=(0,_.Nt)(),o=(0,x.kK)(),c=i?l:void 0,{currentData:d,isFetching:u}=f.useGetOverviewQuery({path:t,database:a,databaseFullPath:s,useMetaProxy:o},{pollingInterval:c,skip:"EPathTypeView"===e}),{currentData:m,isFetching:p}=tW.useGetViewSchemaQuery({path:t,database:a,databaseFullPath:s},{pollingInterval:c,skip:"EPathTypeView"!==e}),h=p&&void 0===m||u&&void 0===d,g=r.useMemo(()=>"EPathTypeView"===e?an(m):aa(e,d),[d,e,m]),y=r.useMemo(()=>g.some(e=>e.autoIncrement),[g]),b=r.useMemo(()=>g.some(e=>e.defaultValue),[g]),v=r.useMemo(()=>{if("EPathTypeView"===e)return at([t3,t4],g);if("EPathTypeSysView"===e||"EPathTypeExternalTable"===e||Z(e))return at([t2,t3,t4,t5],g);if("EPathTypeTable"===e){let e;return e=[t2,t3,t4,t5],b&&e.push(t7),i&&e.push(t8,t9,ae),y&&e.push(t6),at(e,g)}return[]},[e,i,y,b,g]);return h?(0,n.jsx)(td.Q,{}):(0,n.jsxs)(r.Fragment,{children:[(0,n.jsxs)("div",{className:tY("keys-wrapper"),children:[(0,n.jsx)(tZ,{tableData:g,extended:i,type:"primary"}),(0,n.jsx)(tZ,{tableData:g,extended:i,type:"partitioning"})]}),(0,n.jsx)("div",{className:tY(),children:(0,n.jsx)(tc.l,{columnsWidthLSKey:"schemaTableColumnsWidth",data:g,columns:v,settings:S.N3})})]})};var ai=a(90076),as=a(24629),al=a(1459),ao=a(25508);let ac=b.F.injectEndpoints({endpoints:e=>({getSchemaAcl:e.query({queryFn:async({path:e,database:t,dialect:a,databaseFullPath:n,useMetaProxy:r},{signal:i})=>{try{let s=await window.api.viewer.getSchemaAcl({path:{path:e,databaseFullPath:n,useMetaProxy:r},database:t,dialect:a},{signal:i});return{data:{acl:s.Common.ACL,effectiveAcl:s.Common.EffectiveACL,owner:s.Common.Owner,interruptInheritance:s.Common.InterruptInheritance}}}catch(e){return{error:e}}},providesTags:["All","AccessRights"]}),getAvailablePermissions:e.query({queryFn:async({database:e,dialect:t,databaseFullPath:a,useMetaProxy:n},{signal:r})=>{try{return{data:(await window.api.viewer.getAvailablePermissions({path:{path:a,databaseFullPath:a,useMetaProxy:n},database:e,dialect:t},{signal:r})).AvailablePermissions}}catch(e){return{error:e}}}}),updateAccess:e.mutation({queryFn:async({database:e,databaseFullPath:t,path:a,rights:n,dialect:r,useMetaProxy:i})=>{try{return{data:await window.api.viewer.updateAccessRights({database:e,rights:n,dialect:r,path:{path:a,databaseFullPath:t,useMetaProxy:i}})}}catch(e){return{error:e}}},invalidatesTags:(e,t)=>t?[]:["AccessRights"]})}),overrideExisting:"throw"}),ad=(0,ao.Mz)(e=>e,(e,t)=>t,(e,t,a)=>a,(e,t,a,n)=>n,(e,t,a,n,r)=>r,(e,t,a,n,r)=>ac.endpoints.getSchemaAcl.select({path:e,database:t,databaseFullPath:a,dialect:n,useMetaProxy:r})),au=(0,ao.Mz)(e=>e,(e,t,a,n,r,i)=>ad(t,a,n,r,i),(e,t)=>t(e).data?.owner),am=(0,ao.Mz)(e=>e,(e,t,a,n,r,i)=>ad(t,a,n,r,i),(e,t)=>t(e).data),ap=(0,ao.Mz)((e,t,a,n,r,i)=>am(e,t,a,n,r,i),e=>{if(!e)return null;let{acl:t,effectiveAcl:a}=e,n={};return t?.length&&t.forEach(e=>{e.Subject&&(n[e.Subject]||(n[e.Subject]={explicit:new Set,effective:new Set}),e.AccessRules?.forEach(t=>{n[e.Subject].explicit.add(t)}),e.AccessRights?.forEach(t=>{n[e.Subject].explicit.add(t)}))}),a?.length&&a.forEach(e=>{e.Subject&&(n[e.Subject]||(n[e.Subject]={explicit:new Set,effective:new Set}),e.AccessRules?.forEach(t=>{n[e.Subject].effective.add(t)}),e.AccessRights?.forEach(t=>{n[e.Subject].effective.add(t)}))}),n}),ah=(0,ao.Mz)((e,t,a,n,r,i)=>ap(e,t,a,n,r,i),e=>e?Object.entries(e).map(([e,t])=>({subject:e,explicit:Array.from(t.explicit),effective:Array.from(t.effective)})):null),ag=(0,ao.Mz)([(e,t)=>t,(e,t,a,n,r,i,s)=>ap(e,a,n,r,i,s)],(e,t)=>e&&t?Array.from(t[e]?.explicit||new Set):[]),ax=(0,ao.Mz)([(e,t)=>t,(e,t,a,n,r,i,s)=>ap(e,a,n,r,i,s)],(e,t)=>{if(!e||!t)return new Set;let a=t[e]?.explicit||new Set;return new Set(Array.from(t[e]?.effective||new Set).filter(e=>!a.has(e)))}),ay=(0,ao.Mz)(e=>e,(e,t)=>t,(e,t,a)=>a,(e,t,a,n)=>n,(e,t,a,n)=>ac.endpoints.getAvailablePermissions.select({database:e,dialect:a,databaseFullPath:t,useMetaProxy:n})),ab=(0,ao.Mz)(e=>e,(e,t,a,n,r)=>ay(t,a,n,r),(e,t)=>t(e).data),af=r.createContext(void 0),av=({children:e,path:t,database:a,type:i,subType:s,databaseFullPath:l})=>{let o=r.useMemo(()=>({path:t,database:a,type:i,subType:s,databaseFullPath:l}),[t,a,i,s,l]);return(0,n.jsx)(af.Provider,{value:o,children:e})},aj=()=>{let e=r.useContext(af);if(void 0===e)throw Error("useCurrentSchema must be used within a TenantContextProvider");return e};function aT(){let[{showHealthcheck:e,database:t,schema:a,view:n,issuesFilter:i,showGrantAccess:s,aclSubject:l,name:o},c]=(0,tL.useQueryParams)({name:tL.StringParam,showHealthcheck:tL.BooleanParam,database:tL.StringParam,schema:tL.StringParam,view:tL.StringParam,issuesFilter:tL.StringParam,showGrantAccess:tL.BooleanParam,aclSubject:tL.StringParam}),d=r.useCallback(e=>{c({showHealthcheck:e||void 0},"replaceIn")},[c]),u=r.useCallback(e=>{c({aclSubject:e},"replaceIn")},[c]),m=r.useCallback(e=>{c({showGrantAccess:e||void 0},"replaceIn")},[c]),p=r.useCallback(e=>{c({database:e},"replaceIn")},[c]),h=r.useCallback(e=>{c({schema:e},"replaceIn")},[c]),g=r.useCallback(e=>{c({issuesFilter:e},"replaceIn")},[c]),x=r.useCallback(e=>{c({view:e},"replaceIn")},[c]);return r.useEffect(()=>{o&&!t&&c({database:o,name:void 0},"replaceIn")},[t,o,c]),{showHealthcheck:e,handleShowHealthcheckChange:d,database:t||o,handleDatabaseChange:p,showGrantAccess:s,handleShowGrantAccessChange:m,schema:a,handleSchemaChange:h,view:n,handleHealthcheckViewChange:x,issuesFilter:i,handleIssuesFilterChange:g,aclSubject:l,handleAclSubjectChange:u}}var aw=a(38360),aS=a(39688),a_=a(44444),aN=a(65066),aE=a(99802);let aC=(0,d.cn)("ydb-subject-with-avatar");function aA({subject:e,title:t,renderIcon:a}){return(0,n.jsxs)(tC.s,{gap:2,alignItems:"center",children:[(0,n.jsxs)("div",{className:aC("avatar-wrapper"),children:[(0,n.jsx)(aE.e,{theme:"brand",text:e,title:e}),a?.()]}),(0,n.jsxs)(tC.s,{direction:"column",overflow:"hidden",children:[(0,n.jsx)(tE.E,{variant:"body-2",className:aC("subject"),children:e}),t&&(0,n.jsx)(tE.E,{variant:"body-2",color:"secondary",children:t})]})]})}var aI=JSON.parse('{"title_owner":"owner","action_change-owner":"Change owner","description_owner":"The owner has complete management authority over the object and cannot acquire or lose any rights associated with it.","action_grant-access":"Grant Access","label_explicit-rights":"Explicit rights","label_effective-rights":"Effective rights","label_subject":"Subject","descrtiption_empty-rights":"No access rights","decription_enter-subject":"Enter subject","action_cancel":"Cancel","action_apply":"Apply","title_owner-changed":"Owner has been successfully changed","description_explicit-rights":"Direct granted permissions","description_effective-rights":"Total active permissions from inheritance and direct grants","action_revoke":"Revoke","label_revoke-all-rights":"Revoke all explicit rights","descripition_no-rights-to-revoke":"No rights to revoke","description_grant-explicit-rights":"Grant explicit rights","description_revoke-all-rights":"Are you sure you want to revoke all explicit rights for:","description_rights-revoked":"Explicit rights has been successfully revoked"}');let aP=(0,en.g4)("ydb-access-rights",{en:aI}),ak=(0,d.cn)("ydb-access-rights");var aD=a(99460),aR=a(74101),aM=a(33777),aO=a(58746);let aq="change-owner-dialog";async function aL({path:e,database:t,databaseFullPath:a}){return await aD.Ay.show(aq,{id:aq,path:e,database:t,databaseFullPath:a})}let az=aD.Ay.create(({path:e,database:t,databaseFullPath:a})=>{let r=aD.Ay.useModal();return(0,n.jsx)(aF,{onClose:()=>{r.resolve(!1),r.hide(),r.remove()},open:r.visible,path:e,database:t,databaseFullPath:a})});function aF({open:e,onClose:t,path:a,database:i,databaseFullPath:s}){let[l,o]=r.useState(""),[c,d]=r.useState(""),[u,m]=ac.useUpdateAccessMutation(),p=(0,_.XC)(),h=r.useRef(null),g=()=>{u({path:a,database:i,databaseFullPath:s,dialect:p,rights:{ChangeOwnership:{Subject:l}}}).unwrap().then(()=>{t(),(0,tR.A)({name:"updateOwner",content:aP("title_owner-changed"),autoHiding:3e3})}).catch(e=>{d((0,aO.$)(e))})};return(0,n.jsxs)(aR.l,{open:e,size:"s",onClose:t,onEnterKeyDown:g,initialFocus:h,children:[(0,n.jsx)(aR.l.Header,{caption:aP("action_change-owner")}),(0,n.jsx)(aR.l.Body,{children:(0,n.jsxs)("div",{className:ak("dialog-content-wrapper"),children:[(0,n.jsx)(aM.k,{controlRef:h,id:"queryName",placeholder:aP("decription_enter-subject"),value:l,onUpdate:e=>{o(e),d("")},hasClear:!0,autoFocus:!0,autoComplete:!1}),c&&(0,n.jsx)(tE.E,{color:"danger",className:ak("dialog-error"),title:c,children:c})]})}),(0,n.jsx)(aR.l.Footer,{onClickButtonApply:g,textButtonCancel:aP("action_cancel"),textButtonApply:aP("action_apply"),onClickButtonCancel:t,propsButtonApply:{loading:m.isLoading,disabled:!l.length}})]})}function aQ(){let e=(0,al.nz)(),{path:t,database:a,databaseFullPath:r}=aj(),i=(0,x.kK)(),s=(0,_.XC)(),l=(0,_.N4)(e=>au(e,t,a,r,s,i));return l?(0,n.jsxs)(tC.s,{gap:4,alignItems:"center",children:[(0,n.jsx)(a_.Z,{view:"filled",className:ak("owner-card"),children:(0,n.jsxs)(tC.s,{alignItems:"center",justifyContent:"space-between",gap:9,children:[(0,n.jsx)(aA,{subject:l,renderIcon:()=>(0,n.jsx)(tC.s,{alignItems:"center",justifyContent:"center",className:ak("icon-wrapper"),children:(0,n.jsx)(tI.I,{data:aw.A,size:14,className:ak("avatar-icon")})}),title:aP("title_owner")}),e&&(0,n.jsxs)(tC.s,{gap:1,alignItems:"center",children:[(0,n.jsx)(aN.c,{className:ak("owner-divider"),orientation:"vertical"}),(0,n.jsx)(tA.m,{title:aP("action_change-owner"),children:(0,n.jsx)(as.$,{view:"flat-secondary",onClick:()=>aL({path:t,database:a,databaseFullPath:r}),children:(0,n.jsx)(tI.I,{data:aS.A})})})]})]})}),(0,n.jsx)(tE.E,{color:"secondary",className:ak("owner-description"),children:aP("description_owner")})]}):null}aD.Ay.register(aq,az);var aU=a(42880),a$=a(66840);let aG="revoke-all-rights-dialog";async function aB({path:e,database:t,subject:a,databaseFullPath:n}){return await aD.Ay.show(aG,{id:aG,path:e,database:t,subject:a,databaseFullPath:n})}let aH=aD.Ay.create(({path:e,database:t,subject:a,databaseFullPath:r})=>{let i=aD.Ay.useModal();return(0,n.jsx)(aW,{onClose:()=>{i.resolve(!1),i.hide(),i.remove()},open:i.visible,path:e,database:t,subject:a,databaseFullPath:r})});function aW({open:e,onClose:t,path:a,database:i,databaseFullPath:s,subject:l}){let o=(0,x.kK)(),c=(0,_.XC)(),d=(0,_.N4)(e=>ag(e,l,a,i,s,c,o)),[u,m]=r.useState(""),[p,h]=ac.useUpdateAccessMutation();return(0,n.jsxs)(aR.l,{open:e,size:"s",onClose:t,children:[(0,n.jsx)(aR.l.Header,{caption:aP("label_revoke-all-rights")}),(0,n.jsx)(aR.l.Body,{children:(0,n.jsxs)(tC.s,{direction:"column",gap:5,children:[(0,n.jsx)(tE.E,{variant:"body-2",children:aP("description_revoke-all-rights")}),(0,n.jsx)(aA,{subject:l})]})}),(0,n.jsx)(aR.l.Footer,{onClickButtonApply:()=>{p({path:a,database:i,databaseFullPath:s,dialect:c,rights:{RemoveAccess:[{Subject:l,AccessRights:Array.from(d),AccessType:"Allow"}]}}).unwrap().then(()=>{t(),(0,tR.A)({name:"revokeAllRights",content:aP("description_rights-revoked"),autoHiding:3e3})}).catch(e=>{m((0,aO.$)(e))})},textButtonCancel:aP("action_cancel"),textButtonApply:aP("action_revoke"),onClickButtonCancel:t,propsButtonApply:{loading:h.isLoading,view:"outlined-danger"},children:u&&(0,n.jsx)(tE.E,{color:"danger",title:u,children:u})})]})}function aV({subject:e,className:t}){return(0,al.nz)()?(0,n.jsxs)(tC.s,{gap:1,className:t,alignItems:"center",children:[(0,n.jsx)(aJ,{subject:e}),(0,n.jsx)(aK,{subject:e})]}):null}function aJ({subject:e}){let{handleShowGrantAccessChange:t,handleAclSubjectChange:a}=aT();return(0,n.jsx)(tA.m,{title:aP("description_grant-explicit-rights"),children:(0,n.jsx)(as.$,{view:"outlined",onClick:()=>{t(!0),a(e)},size:"s",children:(0,n.jsx)(tI.I,{data:aS.A})})})}function aK({subject:e}){let{path:t,database:a,databaseFullPath:r}=aj(),i=(0,x.kK)(),s=(0,_.XC)(),l=0===(0,_.N4)(n=>ag(n,e,t,a,r,s,i)).length,o=async()=>{await aB({path:t,database:a,databaseFullPath:r,subject:e})};return(0,n.jsx)(tA.m,{title:l?aP("descripition_no-rights-to-revoke"):aP("label_revoke-all-rights"),children:(0,n.jsx)("div",{className:ak("button-wrapper"),children:(0,n.jsx)(as.$,{onClick:o,disabled:l,view:"outlined",size:"s",children:(0,n.jsx)(tI.I,{data:a$.A})})})})}aD.Ay.register(aG,aH);let aY=[{name:"subject",width:210,get header(){return aP("label_subject")},render:({row:{subject:e}})=>(0,n.jsx)(aA,{subject:e})},{name:"explicit",width:400,get header(){return(0,n.jsx)(aU.$,{header:aP("label_explicit-rights"),note:aP("description_explicit-rights")})},render:({row:{subject:e,explicit:t}})=>(0,n.jsxs)(tC.s,{justifyContent:"space-between",alignItems:"center",className:ak("rights-wrapper"),children:[(0,n.jsx)(tC.s,{gap:2,wrap:"wrap",children:t.map(e=>(0,n.jsx)(k.J,{theme:"normal",size:"xs",children:e},e))}),(0,n.jsx)(aV,{subject:e,className:ak("rights-actions")})]}),sortable:!1},{name:"effective",width:400,get header(){return(0,n.jsx)(aU.$,{header:aP("label_effective-rights"),note:aP("description_effective-rights")})},render:({row:{effective:e}})=>(0,n.jsx)(tC.s,{gap:2,wrap:"wrap",children:e.map(e=>(0,n.jsx)(k.J,{theme:"unknown",size:"xs",children:e},e))}),sortable:!1}],aZ={...S.N3,dynamicRender:!1};function aX(){let{path:e,database:t,databaseFullPath:a}=aj(),r=(0,x.kK)(),i=(0,_.XC)(),s=(0,_.N4)(n=>ah(n,e,t,a,i,r));return(0,n.jsx)(tc.l,{columnsWidthLSKey:"right-table-columns-width",columns:aY,data:s??[],settings:aZ,emptyDataMessage:aP("descrtiption_empty-rights"),wrapperClassName:ak("rights-table")})}function a0(){let{path:e,database:t,databaseFullPath:a}=aj(),i=(0,x.kK)(),s=(0,al.nz)(),[o]=(0,_.Nt)(),c=(0,_.XC)(),{isFetching:d,currentData:u,error:m}=ac.useGetSchemaAclQuery({path:e,database:t,dialect:c,databaseFullPath:a,useMetaProxy:i},{pollingInterval:o}),{handleShowGrantAccessChange:p}=aT();return(0,n.jsx)(l.r,{loading:d&&!u,children:m?(0,n.jsx)(e$.o,{error:m}):(0,n.jsxs)(r.Fragment,{children:[(0,n.jsxs)(tC.s,{gap:10,justifyContent:"space-between",alignItems:"start",className:ak("header"),children:[(0,n.jsx)(aQ,{}),s&&(0,n.jsxs)(as.$,{view:"action",onClick:()=>{p(!0)},children:[(0,n.jsx)(tI.I,{data:ai.A}),aP("action_grant-access")]})]}),(0,n.jsx)(aX,{})]})})}var a1=a(60680),a2=a.n(a1),a3=a(9849);let a4=b.F.injectEndpoints({endpoints:e=>({getTopic:e.query({queryFn:async({path:e,database:t,databaseFullPath:a,useMetaProxy:n})=>{try{let r=await window.api.viewer.getTopic({path:{path:e,databaseFullPath:a,useMetaProxy:n},database:t});if("object"!=typeof r)return{error:{}};return{data:r}}catch(e){return{error:e}}},providesTags:["All"]}),getTopicData:e.query({queryFn:async e=>{try{return{data:await window.api.viewer.getTopicData({message_size_limit:100,...e})}}catch(e){return{error:e}}},keepUnusedDataFor:0})}),overrideExisting:"throw"}),a5=(0,ao.Mz)(e=>e,(e,t)=>t,(e,t,a)=>a,(e,t,a,n)=>n,(e,t,a,n)=>a4.endpoints.getTopic.select({path:e,database:t,databaseFullPath:a,useMetaProxy:n})),a6=(0,ao.Mz)(e=>e,(e,t,a,n,r)=>a5(t,a,n,r),(e,t)=>t(e).data?.topic_stats),a7=(0,ao.Mz)(e=>e,(e,t,a,n,r)=>a5(t,a,n,r),(e,t)=>t(e).data?.consumers),a8=(0,ao.Mz)(a7,e=>e?.map(e=>e?.name).filter(e=>void 0!==e)),a9=(0,ao.Mz)(a6,e=>{if(!e)return;let{store_size_bytes:t="0",min_last_write_time:a,max_write_time_lag:n,bytes_written:r}=e||{};return{storeSize:t,partitionsIdleTime:(0,tM.MC)(a),partitionsWriteLag:(0,tM.i6)(n),writeSpeed:(0,a3.ey)(r)}}),ne=(0,ao.Mz)(a7,e=>e?.map(e=>{let{name:t,consumer_stats:a}=e||{},{min_partitions_last_read_time:n,max_read_time_lag:r,max_write_time_lag:i,bytes_read:s}=a||{};return{name:t,readSpeed:(0,a3.ey)(s),writeLag:(0,tM.i6)(i),readLag:(0,tM.i6)(r),readIdleTime:(0,tM.MC)(n)}}));var nt=a(29901),na=JSON.parse('{"averageSpeed":"Average speed","perMinute":"per minute","perHour":"per hour","perDay":"per day"}'),nn=JSON.parse('{"averageSpeed":"Средняя скорость","perMinute":"за минуту","perHour":"за час","perDay":"за день"}');let nr=(0,en.g4)("ydb-components-speed-multimeter",{ru:nn,en:na}),ni=(0,d.cn)("speed-multimeter"),ns=({data:e,speedSize:t="kb",withValue:a=!0,withPopover:i=!0})=>{let s,{perMinute:l=0,perHour:o=0,perDay:c=0}=e||{},d=[l,o,c],u=e=>(0,a3.z3)({value:e,size:t,withSpeedLabel:!0}),m=[{value:u(l),label:nr("perMinute")},{value:u(o),label:nr("perHour")},{value:u(c),label:nr("perDay")}],[p,h]=r.useState(0),[g,x]=r.useState(a?0:void 0),[y,b]=r.useState();return(0,n.jsx)("div",{className:ni(),children:(0,n.jsxs)("div",{className:ni("content"),children:[a&&(0,n.jsx)("div",{className:ni("displayed-value"),children:u(d[p])}),(0,n.jsx)(nt.A,{content:(0,n.jsxs)("div",{className:ni("popover-content"),children:[(0,n.jsx)("span",{className:ni("popover-header"),children:nr("averageSpeed")}),m.map((e,t)=>(0,n.jsx)("span",{className:ni("popover-row",g===t?{color:"primary"}:{color:"secondary"}),children:`${e.label}: ${e.value}`},t))]}),className:ni("popover-container",S.zQ),placement:"bottom",disabled:!i,hasArrow:!0,children:(0,n.jsx)("div",{className:ni("bars"),onMouseLeave:()=>{h(0),x(a?0:void 0),b(void 0)},children:(s=Math.max(...d,0)||1,d.map((e,t)=>(0,n.jsx)("div",{className:ni("bar-container",{highlighted:y===t}),onMouseEnter:()=>{h(t),x(t),b(t)},children:(0,n.jsx)("div",{className:ni("bar",{color:g===t?"dark":"light"}),style:{width:`${100*e/s}%`}})},t)))})})]})})},nl=(0,d.cn)("ydb-diagnostics-consumers-topic-stats"),no=({data:e})=>{let{writeSpeed:t,partitionsWriteLag:a,partitionsIdleTime:r}=e||{},i=[{label:"Write speed",value:(0,n.jsx)(ns,{data:t})},{label:"Write lag",value:(0,eW.uH)(a||0)},{label:"Write idle time",value:(0,eW.uH)(r||0)}];return(0,n.jsx)("div",{className:nl("wrapper"),children:i.map((e,t)=>(0,n.jsxs)("div",{className:nl("item"),children:[(0,n.jsx)("div",{className:nl("label"),children:e.label}),(0,n.jsx)("div",{className:nl("value"),children:e.value})]},t))})};var nc=a(55373),nd=a.n(nc),nu=a(86149),nm=a(46086);let np=({text:e,popoverContent:t,popoverClassName:a,className:r})=>(0,n.jsxs)("div",{className:r,children:[e,"\xa0",(0,n.jsx)(nm.H,{className:a,children:t})]}),nh="#ADE8F5",ng="#f5be9d",nx=({width:e,height:t,transform:a})=>(0,n.jsx)("path",{d:`M-${e/2} 0 c0 -${t}, ${e} -${t}, ${e} 0`,fill:"none",strokeDasharray:"4,6",stroke:"#28f",strokeWidth:"1.6",transform:a}),ny=({width:e})=>(0,n.jsx)("path",{fill:"none",strokeWidth:"2",d:`M0 0 h${e} l-10 -5 m0 10 l10 -5`}),nb=()=>(0,n.jsxs)("g",{fill:"var(--g-color-text-primary)",fontSize:"12",children:[(0,n.jsx)("g",{transform:"translate(0, 27)",stroke:ng,children:(0,n.jsx)(ny,{width:203})}),(0,n.jsxs)("g",{transform:"translate(30, 0)",children:[(0,n.jsxs)("g",{transform:"translate(35, 27)",children:[(0,n.jsx)(nx,{width:70,height:15}),(0,n.jsx)("text",{x:"0",y:"-15",textAnchor:"middle",children:(0,n.jsx)("tspan",{x:"0",dy:"0",children:"write lag"})})]}),(0,n.jsxs)("g",{transform:"translate(119, 27)",children:[(0,n.jsx)(nx,{width:98,height:15}),(0,n.jsx)("text",{x:"0",y:"-15",textAnchor:"middle",children:(0,n.jsx)("tspan",{x:"0",dy:"0",children:"write idle time"})})]})]}),(0,n.jsxs)("g",{transform:"translate(30, 0)",children:[(0,n.jsxs)("g",{transform:"translate(0, 27)",children:[(0,n.jsx)("use",{y:"-10",xlinkHref:"#check",stroke:ng}),(0,n.jsx)("text",{x:"0",y:"20",textAnchor:"middle",children:(0,n.jsx)("tspan",{x:"0",dy:"0",children:"create time"})})]}),(0,n.jsxs)("g",{transform:"translate(70, 27)",children:[(0,n.jsx)("use",{y:"-10",xlinkHref:"#check",stroke:ng}),(0,n.jsx)("text",{x:"0",y:"20",textAnchor:"middle",children:(0,n.jsx)("tspan",{x:"0",dy:"0",children:"write time"})})]}),(0,n.jsx)("g",{transform:"translate(168, 27)",children:(0,n.jsx)("text",{x:"0",y:"20",textAnchor:"middle",children:(0,n.jsx)("tspan",{x:"0",dy:"0",children:"now"})})})]})]}),nf=()=>(0,n.jsxs)("g",{fill:"var(--g-color-text-primary)",fontSize:"12",children:[(0,n.jsx)("g",{transform:"translate(0, 27)",stroke:nh,children:(0,n.jsx)(ny,{width:268})}),(0,n.jsxs)("g",{transform:"translate(30, 0)",children:[(0,n.jsxs)("g",{transform:"translate(105, 27)",children:[(0,n.jsx)(nx,{width:70,height:15}),(0,n.jsx)("text",{x:"0",y:"-15",textAnchor:"middle",children:(0,n.jsx)("tspan",{x:"0",dy:"0",children:"read lag"})})]}),(0,n.jsxs)("g",{transform:"translate(35, 27)",children:[(0,n.jsx)(nx,{width:70,height:15}),(0,n.jsx)("text",{x:"0",y:"-15",textAnchor:"middle",children:(0,n.jsx)("tspan",{x:"0",dy:"0",children:"write lag"})})]}),(0,n.jsxs)("g",{transform:"translate(182, 27)",children:[(0,n.jsx)(nx,{width:91,height:15}),(0,n.jsx)("text",{x:"0",y:"-15",textAnchor:"middle",children:(0,n.jsx)("tspan",{x:"0",dy:"0",children:"read idle time"})})]})]}),(0,n.jsxs)("g",{transform:"translate(30, 27)",children:[(0,n.jsxs)("g",{transform:"translate(0, 0)",children:[(0,n.jsx)("use",{y:"-10",xlinkHref:"#check",stroke:nh}),(0,n.jsx)("text",{x:"0",y:"20",textAnchor:"middle",children:(0,n.jsx)("tspan",{x:"0",dy:"0",children:"create time"})})]}),(0,n.jsxs)("g",{transform:"translate(70, 0)",children:[(0,n.jsx)("use",{y:"-10",xlinkHref:"#check",stroke:nh}),(0,n.jsx)("text",{x:"0",y:"20",textAnchor:"middle",children:(0,n.jsx)("tspan",{x:"0",dy:"0",children:"write time"})})]}),(0,n.jsxs)("g",{transform:"translate(140, 0)",children:[(0,n.jsx)("use",{x:"-2",y:"-10",xlinkHref:"#check",stroke:nh}),(0,n.jsx)("text",{x:"0",y:"20",textAnchor:"middle",children:(0,n.jsx)("tspan",{x:"0",dy:"0",children:"read time"})})]}),(0,n.jsx)("g",{transform:"translate(224, 0)",children:(0,n.jsx)("text",{x:"0",y:"20",textAnchor:"middle",children:(0,n.jsx)("tspan",{x:"0",dy:"0",children:"now"})})})]})]}),nv=({id:e,fill:t})=>(0,n.jsx)("pattern",{id:e,x:"0",y:"0",width:"8",height:"8",patternUnits:"userSpaceOnUse",children:(0,n.jsx)("path",{d:"M0 5L5 0H8L0 8V5M5 8L8 5V8Z",fill:t})}),nj=()=>(0,n.jsxs)("svg",{className:"paint",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:"0 0 268 54",width:268,height:54,children:[(0,n.jsxs)("defs",{children:[(0,n.jsx)("g",{id:"check",children:(0,n.jsx)("path",{d:"M0 3 v14",strokeWidth:"2"})}),(0,n.jsx)(nv,{id:"latest-read",fill:nh}),(0,n.jsx)(nv,{id:"latest-write",fill:ng})]}),(0,n.jsx)(nb,{})]}),nT=()=>(0,n.jsxs)("svg",{className:"paint",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:"0 0 268 54",width:268,height:54,children:[(0,n.jsxs)("defs",{children:[(0,n.jsx)("g",{id:"check",children:(0,n.jsx)("path",{d:"M0 3 v14",strokeWidth:"2"})}),(0,n.jsx)(nv,{id:"latest-read",fill:nh}),(0,n.jsx)(nv,{id:"latest-write",fill:ng})]}),(0,n.jsx)(nf,{})]}),nw=(0,d.cn)("ydb-lag-popover-content"),nS=({text:e,type:t})=>(0,n.jsxs)("div",{className:nw({type:t}),children:[(0,n.jsx)("div",{className:nw("text"),children:e}),(0,n.jsx)("div",{children:"read"===t?(0,n.jsx)(nT,{}):(0,n.jsx)(nj,{})})]});var n_=JSON.parse('{"noConsumersMessage.topic":"This topic has no consumers","noConsumersMessage.stream":"This changefeed has no consumers","lagsPopover.readLags":"Read lags statistics, maximum among all consumer partitions (time format dd hh:mm:ss)","table.emptyDataMessage":"No consumers match the current search","controls.search":"Consumer"}'),nN=JSON.parse('{"noConsumersMessage.topic":"У этого топика нет читателей","noConsumersMessage.stream":"У этого стрима нет читателей","lagsPopover.readLags":"Статистика лагов чтения, максимальное значение среди всех партиций читателя (формат времени дд чч:мм:сс)","table.emptyDataMessage":"По заданному поиску нет читателей","controls.search":"Consumer"}');let nE=(0,en.g4)("ydb-diagnostics-consumers",{ru:nN,en:n_}),nC="consumer",nA="readSpeed",nI="readLags",nP={[nC]:"Consumer",[nA]:"Read speed",[nI]:"Read lags, duration"},nk="writeLag",nD="readLag",nR="readIdleTime",nM={[nk]:"write lag",[nD]:"read lag",[nR]:"read idle time"},nO=(0,d.cn)("ydb-diagnostics-consumers-columns-header"),nq=(0,d.cn)("ydb-diagnostics-consumers-columns"),nL=[{name:nC,header:nP[nC],align:tX.Ay.LEFT,render:({row:e})=>e.name?(0,n.jsx)(nz,{name:e.name}):nu.Pd},{name:nA,header:nP[nA],align:tX.Ay.RIGHT,resizeMinWidth:140,sortAccessor:e=>e.readSpeed.perMinute,render:({row:e})=>(0,n.jsx)(ns,{data:e.readSpeed})},{name:nI,header:(0,n.jsx)(()=>(0,n.jsx)(np,{className:nO("lags"),text:nP[nI],popoverContent:(0,n.jsx)(nS,{text:nE("lagsPopover.readLags"),type:"read"})}),{}),className:nq("lags-header"),sub:[{name:nk,header:nM[nk],align:tX.Ay.RIGHT,render:({row:e})=>(0,eW.uH)(e.writeLag)},{name:nD,header:nM[nD],align:tX.Ay.RIGHT,render:({row:e})=>(0,eW.uH)(e.readLag)},{name:nR,header:nM[nR],align:tX.Ay.RIGHT,render:({row:e})=>(0,eW.uH)(e.readIdleTime)}]}];function nz({name:e}){let t=nd().parse(location.search,{ignoreQueryPrefix:!0});return(0,n.jsx)(R.E,{to:(0,O.YL)({...t,[q.vh.diagnosticsTab]:j.iJ.partitions,selectedConsumer:e}),children:e})}let nF=(0,d.cn)("ydb-diagnostics-consumers"),nQ=({path:e,database:t,type:a,databaseFullPath:i})=>{let s=(0,x.kK)(),[l,o]=r.useState(""),[c]=(0,_.Nt)(),{currentData:d,isFetching:u,error:m}=a4.useGetTopicQuery({path:e,database:t,databaseFullPath:i,useMetaProxy:s},{pollingInterval:c}),p=(0,_.N4)(a=>ne(a,e,t,i,s)),h=(0,_.N4)(a=>a9(a,e,t,i,s)),g=r.useMemo(()=>{if(!p)return[];let e=RegExp(a2()(l),"i");return p.filter(t=>e.test(String(t.name)))},[p,l]);return u&&void 0===d?(0,n.jsx)(eG.a,{size:"m"}):m||p&&p.length?(0,n.jsxs)("div",{className:nF(),children:[(0,n.jsxs)("div",{className:nF("controls"),children:[(0,n.jsx)(tm.v,{onChange:e=>{o(e)},placeholder:nE("controls.search"),className:nF("search"),value:l}),h&&(0,n.jsx)(no,{data:h})]}),m?(0,n.jsx)(e$.o,{error:m}):null,p?(0,n.jsx)("div",{className:nF("table-wrapper"),children:(0,n.jsx)("div",{className:nF("table-content"),children:(0,n.jsx)(tc.l,{columnsWidthLSKey:"consumersColumnsWidth",wrapperClassName:nF("table"),data:g,columns:nL,settings:S.N3,emptyDataMessage:nE("table.emptyDataMessage")})})}):null]}):(0,n.jsx)("div",{children:nE(`noConsumersMessage.${"EPathTypeCdcStream"===a?"stream":"topic"}`)})};var nU=a(44468);let n$=(0,d.cn)("ydb-describe"),nG=({path:e,database:t,databaseFullPath:a,scrollContainerRef:r})=>{let[i]=(0,_.Nt)(),s=(0,x.kK)(),{currentData:l,isFetching:o,error:c}=f.useGetOverviewQuery({path:e,database:t,databaseFullPath:a,useMetaProxy:s},{pollingInterval:i});return o&&void 0===l?(0,n.jsx)(eG.a,{size:"m"}):l||c?(0,n.jsxs)("div",{className:n$(),children:[c?(0,n.jsx)(e$.o,{error:c}):null,l?(0,n.jsx)("div",{className:n$("result"),children:(0,n.jsx)(nU.p,{value:l,withClipboardButton:{withLabel:!1,copyText:JSON.stringify(l)},search:!0,collapsedInitially:!0,scrollContainerRef:r})}):null]}):(0,n.jsx)("div",{className:n$("message-container"),children:"Empty"})};var nB=a(3494),nH=a(83758);let nW=e=>{let{PathType:t,PathSubType:a}=e?.Self||{};if("EPathTypeTableIndex"===t){let t;return(t=e?.TableIndex?.Type)&&W[t]}return a&&B[a]||t&&H[t]};var nV=JSON.parse('{"title_index-settings":"Index Settings","field_clusters":"Clusters","field_levels":"Levels","field_vector_dimension":"Vector Dimension","field_vector_type":"Vector Type","field_metric":"Metric","field_columns":"Columns","field_includes":"Includes","field_data-size":"Data Size","field_layout":"Layout","field_tokenizer":"Tokenizer","field_language":"Language","field_use_filter_lowercase":"Filter Lowercase","field_use_filter_stopwords":"Filter Stopwords","field_use_filter_ngram":"Filter Ngram","field_use_filter_edge_ngram":"Filter Edge Ngram","field_filter_ngram_min_length":"Filter Ngram Min Length","field_filter_ngram_max_length":"Filter Ngram Max Length","field_use_filter_length":"Filter Length","field_filter_length_min":"Filter Length Min","field_filter_length_max":"Filter Length Max","filter_enabled":"Enabled","filter_disabled":"Disabled","alert_no-entity-data":"No {{entity}} data"}');let nJ=(0,en.g4)("info-viewer-schema-index-info",{en:nV});var nK=a(64349),nY=a(2275);let nZ=(0,nY.H)({values:{PathType:e=>e?.substring("EPathType".length),CreateStep:e=>(0,eW.r6)(e,{defaultValue:S.Pd})},labels:{PathType:(0,nK.A)("common.type"),CreateStep:(0,nK.A)("common.created")}}),nX=({value:e,withSpeedLabel:t,...a})=>{let r=(0,a3.z3)({value:e,withSpeedLabel:t,...a}),i=(0,a3.z3)({value:e,withSpeedLabel:t,size:"b"});return(0,n.jsx)("span",{title:i,children:r})},n0=(e,t)=>e?(0,n.jsx)(nX,{value:e,...t}):null,n1=(0,nY.H)({values:{Type:e=>e?.substring(10),State:e=>e?.substring(11),KeyColumnNames:e=>e?.join(", "),DataColumnNames:e=>e?.join(", "),DataSize:n0},labels:{KeyColumnNames:nJ("field_columns"),DataColumnNames:nJ("field_includes"),DataSize:nJ("field_data-size")}}),n2={METERING_MODE_REQUEST_UNITS:"request-units",METERING_MODE_RESERVED_CAPACITY:"reserved-capacity"},n3=(0,nY.H)({values:{Partitions:e=>(0,eW.ZV)(e?.length||0),PQTabletConfig:e=>{let t=Math.round(e.PartitionConfig.LifetimeSeconds/S.Jg*100)/100;return`${(0,eW.ZV)(t)} hours`}},labels:{Partitions:"Partitions count",PQTabletConfig:"Retention"}}),n4=(0,nY.H)({values:{Codecs:e=>e&&Object.values(e.Codecs||{}).join(", "),MeteringMode:e=>e&&n2[e]},labels:{MeteringMode:"Metering mode"}}),n5=(0,nY.H)({values:{StorageLimitBytes:eW.z3,WriteSpeedInBytesPerSecond:eW.tC},labels:{StorageLimitBytes:"Retention storage",WriteSpeedInBytesPerSecond:"Partitions write speed"}}),n6=(0,nY.H)({values:{Mode:e=>e?.substring("ECdcStreamMode".length),Format:e=>e?.substring("ECdcStreamFormat".length)}});(0,nY.H)({values:{CPU:eW.iM,Memory:n0,Storage:n0,Network:eW.tC,ReadThroughput:eW.tC,WriteThroughput:eW.tC},defaultValueFormatter:eW.ZV}),(0,nY.H)({values:{FollowerCount:eW.ZV},labels:{FollowerCountPerDataCenter:"FollowerCountPerDC"},defaultValueFormatter:e=>e&&String(e)}),(0,nY.H)({values:{FollowerCount:eW.ZV,CrossDataCenterFollowerCount:eW.ZV}}),(0,nY.H)({values:{DataSize:n0,IndexSize:n0,LastAccessTime:eW.r6,LastUpdateTime:eW.r6},defaultValueFormatter:eW.ZV});let n7=["Type","State","DataSize","KeyColumnNames","DataColumnNames"],n8=(0,d.cn)("ydb-diagnostics-table-info"),n9=({data:e})=>{let t,a=nW(e?.PathDescription);if(!e)return(0,n.jsx)("div",{className:"error",children:nJ("alert_no-entity-data",{entity:a})});let r=e.PathDescription?.TableIndex,i=(t=[],r&&new Set(n7).forEach(e=>{let a=r[e];void 0!==a&&t.push(n1(e,a))}),t),s=[];return r?.Type==="EIndexTypeGlobalVectorKmeansTree"&&(s=function(e){let t=[];if(!e)return t;let a=(0,nY.H)({values:{clusters:e=>"number"==typeof e?(0,eW.ZV)(e):e,levels:e=>"number"==typeof e?(0,eW.ZV)(e):e},labels:{clusters:nJ("field_clusters"),levels:nJ("field_levels")}}),{clusters:n,levels:r,settings:i}=e;void 0!==n&&t.push(a("clusters",n)),void 0!==r&&t.push(a("levels",r));let s=(0,nY.H)({values:{vector_dimension:e=>"number"==typeof e?(0,eW.ZV)(e):e,vector_type:e=>"string"==typeof e?e.replace(/^VECTOR_TYPE_/,""):e},labels:{vector_dimension:nJ("field_vector_dimension"),vector_type:nJ("field_vector_type"),metric:nJ("field_metric")}}),{metric:l,vector_type:o,vector_dimension:c}=i??{};return void 0!==l&&t.push(s("metric",l)),void 0!==o&&t.push(s("vector_type",o)),void 0!==c&&t.push(s("vector_dimension",c)),t}(r?.VectorIndexKmeansTreeDescription?.Settings)),r?.Type==="EIndexTypeGlobalFulltext"&&(s=function(e){let t=[];if(!e)return t;let a=(0,nY.H)({values:{layout:e=>e},labels:{layout:nJ("field_layout")}}),{layout:n}=e;void 0!==n&&t.push(a("layout",n));let r=(0,nY.H)({values:{tokenizer:e=>e,language:e=>e,use_filter_lowercase:e=>!0===e?nJ("filter_enabled"):nJ("filter_disabled"),use_filter_stopwords:e=>!0===e?nJ("filter_enabled"):nJ("filter_disabled"),use_filter_ngram:e=>!0===e?nJ("filter_enabled"):nJ("filter_disabled"),use_filter_edge_ngram:e=>!0===e?nJ("filter_enabled"):nJ("filter_disabled"),filter_ngram_min_length:e=>"number"==typeof e?(0,eW.ZV)(e):e,filter_ngram_max_length:e=>"number"==typeof e?(0,eW.ZV)(e):e,use_filter_length:e=>!0===e?nJ("filter_enabled"):nJ("filter_disabled"),filter_length_min:e=>"number"==typeof e?(0,eW.ZV)(e):e,filter_length_max:e=>"number"==typeof e?(0,eW.ZV)(e):e},labels:{tokenizer:nJ("field_tokenizer"),language:nJ("field_language"),use_filter_lowercase:nJ("field_use_filter_lowercase"),use_filter_stopwords:nJ("field_use_filter_stopwords"),use_filter_ngram:nJ("field_use_filter_ngram"),use_filter_edge_ngram:nJ("field_use_filter_edge_ngram"),filter_ngram_min_length:nJ("field_filter_ngram_min_length"),filter_ngram_max_length:nJ("field_filter_ngram_max_length"),use_filter_length:nJ("field_use_filter_length"),filter_length_min:nJ("field_filter_length_min"),filter_length_max:nJ("field_filter_length_max")}}),{tokenizer:i,language:s,use_filter_lowercase:l,use_filter_stopwords:o,use_filter_ngram:c,use_filter_edge_ngram:d,filter_ngram_min_length:u,filter_ngram_max_length:m,use_filter_length:p,filter_length_min:h,filter_length_max:g}=e.columns?.filter(e=>void 0!==e.analyzers)[0]?.analyzers??{};return void 0!==i&&t.push(r("tokenizer",i)),void 0!==s&&t.push(r("language",s)),void 0!==l&&t.push(r("use_filter_lowercase",l)),void 0!==o&&t.push(r("use_filter_stopwords",o)),void 0!==c&&t.push(r("use_filter_ngram",c)),void 0!==d&&t.push(r("use_filter_edge_ngram",d)),void 0!==u&&t.push(r("filter_ngram_min_length",u)),void 0!==m&&t.push(r("filter_ngram_max_length",m)),void 0!==p&&t.push(r("use_filter_length",p)),void 0!==h&&t.push(r("filter_length_min",h)),void 0!==g&&t.push(r("filter_length_max",g)),t}(r?.FulltextIndexDescription?.Settings)),(0,n.jsxs)("div",{className:n8(),children:[(0,n.jsx)(nH.z_,{info:i,title:a,className:n8("info-block"),renderEmptyState:()=>(0,n.jsx)("div",{className:n8("title"),children:a})}),s&&s.length?(0,n.jsx)(nH.z_,{info:s,title:nJ("title_index-settings"),className:n8("info-block")}):null]})};var re=a(70073),rt=JSON.parse('{"created":"Created","external-objects.source-type":"Source Type","external-objects.data-source":"Data Source","external-objects.location":"Location","external-objects.auth-method":"Auth Method","external-objects.auth-method.none":"None","external-objects.auth-method.service-account":"Service Account","external-objects.auth-method.aws":"AWS","external-objects.auth-method.token":"Token","external-objects.auth-method.basic":"Basic","external-objects.auth-method.mdb-basic":"MDB Basic","view.query-text":"Query Text","field_system-view-type":"System view type","no-entity-data":"No {{entityName}} data"}');let ra=(0,en.g4)("ydb-tenant-objects-info",{en:rt});function rn(e){return{name:ra("created"),content:(0,eW.r6)(e,{defaultValue:S.Pd})}}function rr(e){return(0,n.jsx)(tE.E,{variant:"body-2",color:"danger",children:ra("no-entity-data",{entityName:e??""})})}function ri(e){let t,a,{Location:n}=e.PathDescription?.ExternalDataSourceDescription||{};return[...(t=[{name:ra("external-objects.source-type"),content:e.PathDescription?.ExternalDataSourceDescription?.SourceType}],Number(a=e.PathDescription?.Self?.CreateStep)&&t.push(rn(a)),t),{name:ra("external-objects.location"),content:n,copyText:n},{name:ra("external-objects.auth-method"),content:function(e){let{Auth:t}=e.PathDescription?.ExternalDataSourceDescription||{};return t?.ServiceAccount?ra("external-objects.auth-method.service-account"):t?.Aws?ra("external-objects.auth-method.aws"):t?.Token?ra("external-objects.auth-method.token"):t?.Basic?ra("external-objects.auth-method.basic"):t?.MdbBasic?ra("external-objects.auth-method.mdb-basic"):ra("external-objects.auth-method.none")}(e)}]}let rs=({data:e,prepareData:t})=>{let a=nW(e?.PathDescription);return e?(0,n.jsx)(re.n,{title:a,items:t(e)}):rr(a)},rl=({data:e})=>(0,n.jsx)(rs,{data:e,prepareData:ri});var ro=a(60318);let rc=(e,t)=>{let a=e.PathDescription?.ExternalTableDescription?.Location;return[...((e,t)=>{let{CreateStep:a}=e.PathDescription?.Self||{},{SourceType:r,DataSourcePath:i}=e.PathDescription?.ExternalTableDescription||{},s=i?.split("/").pop(),l=[{name:ra("external-objects.source-type"),content:r}];return Number(a)&&l.push(rn(a)),l.push({name:ra("external-objects.data-source"),content:i&&(0,n.jsx)("span",{title:i,children:(0,n.jsx)(ro.K,{title:s||"",url:t})})}),l})(e,t),{name:ra("external-objects.location"),content:a,copyText:a}]},rd=({data:e,prepareData:t})=>{let a=(0,M.zy)(),r=(0,O.mA)(a),i=(0,O.Ow)({...r,schema:e?.PathDescription?.ExternalTableDescription?.DataSourcePath}),s=nW(e?.PathDescription);return e?(0,n.jsx)(re.n,{title:s,items:t(e,i)}):rr(s)},ru=({data:e})=>(0,n.jsx)(rd,{data:e,prepareData:rc});function rm(e){if(e)return e.startsWith("E")?e.slice(1):e}function rp({data:e}){let t,a=nW(e?.PathDescription);if(!e)return rr(a);let r=(t=e.PathDescription?.SysViewDescription?.Type,[{name:ra("field_system-view-type"),content:rm(t)}]);return(0,n.jsx)(re.n,{title:a,items:r})}var rh=a(60198);function rg({data:e}){let t,a=nW(e?.PathDescription);if(!e)return rr(a);let r=(t=e.PathDescription?.ViewDescription?.QueryText,[{name:ra("view.query-text"),copyText:t,content:t?(0,n.jsx)(rh.YDBSyntaxHighlighter,{language:"yql",text:t}):null}]);return(0,n.jsx)(re.n,{title:a,items:r})}function rx({state:e}){return e?"StandBy"in e?(0,n.jsx)(k.J,{theme:"info",children:"Standby"}):"Paused"in e?(0,n.jsx)(k.J,{theme:"info",children:"Paused"}):"Done"in e?(0,n.jsx)(k.J,{theme:"success",children:"Done"}):"Error"in e?(0,n.jsx)(k.J,{theme:"danger",children:"Error"}):(0,n.jsx)(k.J,{size:"s",children:"Unknown"}):null}var ry=JSON.parse('{"column.dstPath.name":"Dist","column.srcPath.name":"Source","everythingWithPrefix":"Everything with prefix:","noData":"No data.","title":"Replicated Paths"}');let rb=(0,en.g4)("ydb-diagnostics-async-replication-paths",{en:ry}),rf=(0,d.cn)("ydb-async-replication-paths"),rv=[{name:rb("column.srcPath.name"),render:({row:e})=>e.SrcPath,sortAccessor:e=>e.SrcPath},{name:rb("column.dstPath.name"),render:({row:e})=>e.DstPath,sortAccessor:e=>e.DstPath}];function rj({config:e}){if(!e)return null;let t=rb("noData");return e.Everything&&(t=(0,n.jsxs)("span",{children:[rb("everythingWithPrefix")," ",(0,n.jsx)(tE.E,{variant:"code-inline-2",children:e.Everything?.DstPrefix??"undefined"}),"."]})),e.Specific&&(t=(0,n.jsx)(tc.l,{data:e.Specific.Targets,settings:S.jp,columns:rv})),(0,n.jsxs)("div",{className:rf(),children:[(0,n.jsx)("div",{className:rf("title"),children:rb("title")}),t]})}function rT({connection:e}){return e?e.StaticCredentials?(0,n.jsx)(k.J,{value:e.StaticCredentials.User,theme:"normal",children:"user"}):"OAuthToken"in e?"OAuth":"unknown":null}var rw=JSON.parse('{"credentials.label":"Credentials","noData":"No data for entity:","srcConnection.database.label":"Source Database Path","srcConnection.endpoint.label":"Source Cluster Endpoint","state.label":"State"}');let rS=(0,en.g4)("ydb-diagnostics-async-replication-info",{en:rw});function r_({data:e}){let t=nW(e?.PathDescription);if(!e)return(0,n.jsxs)("div",{className:"error",children:[rS("noData")," ",t]});let a=function(e){let t=e.PathDescription?.ReplicationDescription||{},a=t.State,r=t.Config?.SrcConnectionParams||{},{Endpoint:i,Database:s}=r,l=[];return a&&l.push({name:rS("state.label"),content:(0,n.jsx)(rx,{state:a})}),i&&l.push({name:rS("srcConnection.endpoint.label"),copyText:i,content:(0,n.jsx)(tE.E,{variant:"code-inline-2",children:i})}),s&&l.push({name:rS("srcConnection.database.label"),copyText:s,content:(0,n.jsx)(tE.E,{variant:"code-inline-2",children:s})}),r&&l.push({name:rS("credentials.label"),content:(0,n.jsx)(rT,{connection:r})}),l}(e);return(0,n.jsxs)(tC.s,{direction:"column",gap:"4",children:[(0,n.jsx)(re.n,{title:t,items:a}),(0,n.jsx)(rj,{config:e.PathDescription?.ReplicationDescription?.Config})]})}var rN=JSON.parse('{"writeLagPopover":"Write lag, maximum among all topic partitions","writeIdleTimePopover":"Write idle time, maximum among all topic partitions"}'),rE=JSON.parse('{"writeLagPopover":"Лаг записи, максимальное значение среди всех партиций топика","writeIdleTimePopover":"Время без записи, максимальное значение среди всех партиций топика"}');let rC=(0,en.g4)("ydb-diagnostics-overview-topic-stats",{ru:rE,en:rN}),rA=(0,d.cn)("ydb-overview-topic-stats"),rI=({path:e,database:t,databaseFullPath:a})=>{let i,s=(0,x.kK)(),[l]=(0,_.Nt)(),{currentData:o,isFetching:c,error:d}=a4.useGetTopicQuery({path:e,database:t,databaseFullPath:a,useMetaProxy:s},{pollingInterval:l}),u=(0,_.N4)(n=>a9(n,e,t,a,s));if(c&&void 0===o)return(0,n.jsx)("div",{className:rA(),children:(0,n.jsx)(eG.a,{size:"s"})});let m=d||!u?(0,n.jsx)(e$.o,{error:d}):null;return(0,n.jsxs)("div",{className:rA(),children:[(0,n.jsx)("div",{className:rA("title"),children:"Stats"}),m,u?(0,n.jsxs)(r.Fragment,{children:[(0,n.jsx)("div",{className:rA("info"),children:(0,n.jsx)(nH.z_,{info:[{label:"Store size",value:(0,eW.z3)(u.storeSize)},{label:(0,n.jsx)(np,{text:"Write idle time",popoverContent:(0,n.jsx)(nS,{text:rC("writeIdleTimePopover"),type:"write"})}),value:(0,tM.Bi)(u.partitionsIdleTime)},{label:(0,n.jsx)(np,{text:"Write lag",popoverContent:(0,n.jsx)(nS,{text:rC("writeLagPopover"),type:"write"})}),value:(0,tM.Bi)(u.partitionsWriteLag)},{label:"Average write speed",value:(0,n.jsx)(ns,{data:u.writeSpeed,withValue:!1})}],multilineLabels:!0})}),(0,n.jsx)("div",{className:rA("bytes-written"),children:(0,n.jsx)(nH.z_,{info:(i=u.writeSpeed,[{label:"per minute",value:(0,eW.tC)(i.perMinute)},{label:"per hour",value:(0,eW.tC)(i.perHour)},{label:"per day",value:(0,eW.tC)(i.perDay)}])})})]}):null]})},rP=({path:e,database:t,data:a,databaseFullPath:r})=>{let i=nW(a?.PathDescription);return a?(0,n.jsxs)("div",{children:[(0,n.jsx)(nH.z_,{title:i,info:(e=>{if(!e)return[];let{Mode:t,Format:a}=e?.PathDescription?.CdcStreamDescription||{},n=(0,nH.jl)(n6,{Mode:t,Format:a}),r=e?.PathDescription?.Self?.CreateStep;return Number(r)&&n.unshift(nZ("CreateStep",r)),n})(a)}),(0,n.jsx)(rI,{path:e,databaseFullPath:r,database:t})]}):(0,n.jsxs)("div",{className:"error",children:["No ",i," data"]})};function rk({data:e}){let t=nW(e);return e?.UserAttributes?.some(({Key:e,Value:t})=>"__async_replica"===e&&"true"===t)?(0,n.jsxs)(tC.s,{gap:1,wrap:"nowrap",children:[t," ",(0,n.jsx)(k.J,{children:(0,L.A)("label.read-only")})]}):t}let rD=(0,d.cn)("default-entity-info");function rR({data:e}){return(0,n.jsx)("div",{className:rD("title"),children:(0,n.jsx)(rk,{data:e?.PathDescription})})}let rM=b.F.injectEndpoints({endpoints:e=>({getStreamingQueryInfo:e.query({queryFn:async({database:e,path:t},{signal:a})=>{try{let n,r=await window.api.viewer.sendQuery({query:(n=t.replace(/'/g,"''"),`${S.Zi}
SELECT
    Status AS State,
    Issues AS Error,
    Text
FROM \`.sys/streaming_queries\`
WHERE Path = '${n}'
LIMIT 1`),database:e,action:"execute-query",internal_call:!0},{signal:a,withRetries:!0});if((0,tH.We)(r))return{error:r};return{data:(0,tH.fW)(r)}}catch(e){return{error:e}}},providesTags:["All"]})}),overrideExisting:"throw"});var rO=a(69117),rq=JSON.parse('{"field_query-state":"State","field_query-error":"Error","field_query-text":"Text"}');let rL=(0,en.g4)("ydb-diagnostics-streaming-query-info",{en:rq});function rz({database:e,path:t}){let a=nW({Self:{PathType:"EPathTypeStreamingQuery"}}),{data:r,isFetching:i}=rM.useGetStreamingQueryInfoQuery({database:e,path:t},{skip:!e||!t}),s=function(e){if(!e)return[];let t=[],a=(0,eW.vN)(e.resultSets?.[0]?.result?.[0]?.State),r=(0,eW.vN)(e.resultSets?.[0]?.result?.[0]?.Text),i=(0,eW.qe)(r);i=(0,eW.YY)(i);let s=function(e){if("string"==typeof e)try{let t=JSON.parse(e);return(0,tH.CR)(t)?t:void 0}catch{return e}if((0,tH.CR)(e))return e}(e.resultSets?.[0]?.result?.[0]?.Error);return t.push({name:rL("field_query-state"),content:(0,n.jsx)(rQ,{state:a})}),s&&t.push({name:rL("field_query-error"),content:(0,n.jsx)(rO.vt,{data:s})}),t.push({name:rL("field_query-text"),copyText:i,content:i?(0,n.jsx)(rh.YDBSyntaxHighlighter,{language:"yql",text:i}):null}),t}(r);return(0,n.jsx)(l.r,{loading:i,children:(0,n.jsx)(re.n,{title:a,items:s})})}let rF={CREATING:"info",CREATED:"normal",STARTING:"info",RUNNING:"success",STOPPING:"info",STOPPED:"normal",COMPLETED:"success",SUSPENDED:"warning",FAILED:"danger"};function rQ({state:e}){if(!e)return null;let t=rF[e]??"normal";return(0,n.jsx)(k.J,{theme:t,children:e})}var rU=a(64482),r$=a(48171),rG=a(88786),rB=a(51655);let rH=b.F.injectEndpoints({endpoints:e=>({updateTablePartitioning:e.mutation({queryFn:async(e,{signal:t})=>{try{var a,n;let r,i,s=await window.api.viewer.sendQuery({query:(a=e.path,n=e.value,r=a.replace(/`/g,"``"),i=n.splitByLoad?"ENABLED":"DISABLED",`${S.Zi}
ALTER TABLE \`${r}\` SET (
    AUTO_PARTITIONING_BY_SIZE = ENABLED,
    AUTO_PARTITIONING_PARTITION_SIZE_MB = ${n.partitionSizeMb},
    AUTO_PARTITIONING_MIN_PARTITIONS_COUNT = ${n.minPartitions},
    AUTO_PARTITIONING_MAX_PARTITIONS_COUNT = ${n.maxPartitions},
    AUTO_PARTITIONING_BY_LOAD = ${i}
)`),database:e.database,action:"execute-query",internal_call:!0},{signal:t,withRetries:!0});if((0,tH.We)(s))return{error:s.error};return{data:void 0}}catch(e){return{error:e}}},invalidatesTags:["All"]})}),overrideExisting:"throw"}),rW=w.J.yaMetricaConfig?.yaMetricaMap;class rV{name;warnShown=!1;constructor(e){this.name=e}hit(){this.warnOnce()}params(){this.warnOnce()}userParams(){this.warnOnce()}reachGoal(){this.warnOnce()}warnOnce(){this.warnShown||(console.warn(`Yandex.Metrica counter "${this.name}" is not defined
`),this.warnShown=!0)}}function rJ(e,t){let a=function(e){if(!e)return;let t=rW?.[e];return(t?window[`yaCounter${t}`]:void 0)??new rV(e)}(w.J.yaMetricaConfig?.getMetricaName(e));if(!a)return void console.warn("Metrica is not defined");let n=w.J.yaMetricaConfig?.goals[e];n?a.reachGoal(n,t):console.warn("Metrica goal is not defined")}var rK=a(50626),rY=a(49785);let rZ=0x80000000;var rX=a(94866);let r0=(0,d.cn)("split-unit-select");function r1({value:e,options:t,width:a=55,size:i="s",onChange:s}){let[l,o]=r.useState(!1),c=r.useMemo(()=>t.find(t=>t.value===e),[t,e]),d=c?.content??e,u=r.useCallback(e=>{o(e)},[]),m=r.useCallback(()=>{o(e=>!e)},[]),p=r.useCallback(()=>(0,n.jsx)(as.$,{type:"button",className:r0("button"),size:i,onClick:m,children:(0,n.jsxs)(tC.s,{justifyContent:"space-between",alignItems:"center",gap:"1",className:r0("button-content"),children:[(0,n.jsx)(tE.E,{children:d}),(0,n.jsx)(rX.I,{direction:"bottom"})]})}),[m,d,i]);return(0,n.jsx)(eQ.l,{size:i,className:r0("select"),options:t,value:[e],open:l,width:a,onOpenChange:u,renderControl:p,onUpdate:t=>{s(t?.[0]??e),o(!1)}})}let r2=Object.keys(a3.LR).map(e=>({value:e,content:a3.LR[e].label})),r3=(0,a3.z3)({value:rZ,size:"gb",withSizeLabel:!1}),r4={splitSize:r3,splitUnit:"gb",loadEnabled:!0,minimum:"40",maximum:"1000"},r5="manage-partitioning-dialog";var r6=JSON.parse('{"title_manage-partitioning":"Manage partitioning","title_partitioning":"Partitioning","title_limits":"Limits","field_split-size":"Split Size","context_split-size-maximum":"{{maxGb}} GB maximum","field_load":"Load","field_minimum":"Minimum","field_maximum":"Maximum","action_cancel":"Cancel","action_apply":"Apply","error_invalid-unit":"Invalid unit","error_required":"The field is required","error_value-greater-maximum":"Value must not be greater than maximum","error_minimum-greater-maximum":"Minimum must not be greater than maximum","error_maximum-less-minimum":"Maximum must not be less than minimum","error_value-too-small":"Value must be at least 1 MB"}');let r7=(0,en.g4)("manage-partitioning-dialog",{en:r6});var r8=a(53285),r9=a(78403);function ie(e,t){let a=(0,a3.OG)(e,t),n=Math.round(a/a3.LR.mb.value);return{bytes:a,partitionSizeMb:n}}let it=tz.z.custom(e=>e in a3.LR,r7("error_invalid-unit")),ia=e=>(0,r9.m)(tz.z.coerce.number({required_error:e,invalid_type_error:e}).int().gt(0)),ir=(0,d.cn)(r5);function ii({onClose:e,open:t,renderButtons:a,initialValue:i,onApply:s}){let[l,o]=r.useState(null),[c,d]=r.useState(!1),{control:u,handleSubmit:m,trigger:p,formState:{errors:h,isValid:g}}=function(e){let{initialValue:t,maxSplitSizeBytes:a}=e,n=r.useMemo(()=>((e=rZ)=>{let t;return tz.z.object({splitSize:(t=r7("error_required"),(0,r9.m)(tz.z.coerce.number({required_error:t,invalid_type_error:t}).gt(0))),splitUnit:it,loadEnabled:tz.z.boolean(),minimum:ia(r7("error_required")),maximum:ia(r7("error_required"))}).superRefine((t,a)=>{let{bytes:n,partitionSizeMb:r}=ie(t.splitSize,t.splitUnit);n>e&&a.addIssue({code:tz.z.ZodIssueCode.custom,path:["splitSize"],message:r7("error_value-greater-maximum")}),r<1&&a.addIssue({code:tz.z.ZodIssueCode.custom,path:["splitSize"],message:r7("error_value-too-small")}),t.minimum>t.maximum&&(a.addIssue({code:tz.z.ZodIssueCode.custom,path:["minimum"],message:r7("error_minimum-greater-maximum")}),a.addIssue({code:tz.z.ZodIssueCode.custom,path:["maximum"],message:r7("error_maximum-less-minimum")}))})})(a),[a]);return(0,rY.mN)({defaultValues:function(e={}){return{...r4,...e}}(t),resolver:(0,r8.u)(n),mode:"onChange"})}({initialValue:i,maxSplitSizeBytes:rZ}),x=m(async e=>{o(null),d(!0);try{await s?.(e)}catch(e){o((0,aO.$)(e))}finally{d(!1)}});return(0,n.jsxs)(aR.l,{size:"s",onClose:e,open:t,children:[(0,n.jsx)(aR.l.Header,{caption:(0,n.jsx)(tE.E,{variant:"subheader-3",children:r7("title_manage-partitioning")})}),(0,n.jsxs)("form",{onSubmit:x,children:[(0,n.jsx)(aR.l.Body,{className:ir("body"),children:(0,n.jsxs)(tC.s,{direction:"column",gap:"3",alignItems:"flex-start",children:[(0,n.jsx)(tE.E,{variant:"subheader-1",children:r7("title_partitioning")}),(0,n.jsxs)(tC.s,{className:ir("row"),gap:"3",alignItems:"center",children:[(0,n.jsx)("label",{htmlFor:"splitSize",className:ir("label"),children:r7("field_split-size")}),(0,n.jsx)(rY.xI,{name:"splitSize",control:u,render:({field:e})=>(0,n.jsx)(aM.k,{id:"splitSize",type:"number",value:e.value,onUpdate:e.onChange,className:ir("input"),errorMessage:h.splitSize?.message,validationState:h.splitSize?"invalid":void 0,endContent:(0,n.jsx)(rY.xI,{name:"splitUnit",control:u,render:({field:e})=>(0,n.jsx)(r1,{value:e.value,options:r2,onChange:t=>{e.onChange(t),p("splitSize")}})})})}),(0,n.jsx)(tE.E,{variant:"body-1",className:ir("hint"),children:r7("context_split-size-maximum",{maxGb:r3})})]}),(0,n.jsxs)(tC.s,{className:ir("row"),gap:"3",alignItems:"center",children:[(0,n.jsx)("label",{htmlFor:"loadEnabled",className:ir("label"),children:r7("field_load")}),(0,n.jsx)(rY.xI,{name:"loadEnabled",control:u,render:({field:e})=>(0,n.jsx)(rK.d,{id:"loadEnabled",checked:e.value,onUpdate:e.onChange})})]}),(0,n.jsx)(tE.E,{variant:"subheader-1",children:r7("title_limits")}),(0,n.jsxs)(tC.s,{className:ir("row"),gap:"3",alignItems:"center",children:[(0,n.jsx)("label",{htmlFor:"minimum",className:ir("label"),children:r7("field_minimum")}),(0,n.jsx)(rY.xI,{name:"minimum",control:u,render:({field:e})=>(0,n.jsx)(aM.k,{id:"minimum",type:"number",value:e.value,onUpdate:t=>{e.onChange(t),p("maximum")},className:ir("input"),errorMessage:h.minimum?.message,validationState:h.minimum?"invalid":void 0})})]}),(0,n.jsxs)(tC.s,{className:ir("row"),gap:"3",alignItems:"center",children:[(0,n.jsx)("label",{htmlFor:"maximum",className:ir("label"),children:r7("field_maximum")}),(0,n.jsx)(rY.xI,{name:"maximum",control:u,render:({field:e})=>(0,n.jsx)(aM.k,{id:"maximum",type:"number",value:e.value,onUpdate:t=>{e.onChange(t),p("minimum")},className:ir("input"),errorMessage:h.maximum?.message,validationState:h.maximum?"invalid":void 0})})]}),l&&(0,n.jsx)(tE.E,{color:"danger",title:l,children:(0,n.jsx)("div",{children:l})})]})}),(0,n.jsx)(aR.l.Footer,{textButtonApply:r7("action_apply"),textButtonCancel:r7("action_cancel"),onClickButtonCancel:e,loading:c,renderButtons:a,propsButtonApply:{type:"submit",disabled:c||!g}})]})]})}let is=aD.vt(e=>{let t=aD.hS(),a=()=>{t.hide(),t.remove()};return(0,n.jsx)(ii,{...e,onApply:async n=>{await e.onApply?.(n),t.resolve(n),a()},onClose:()=>{e.onClose?.(),t.resolve(null),a()},open:t.visible})});aD.kz(r5,is);var il=JSON.parse('{"tooltip_partitions-current":"{{count}} {{partitions}}","tooltip_partitions-below-limit":"{{count}} {{partitions}}. {{diff}} less than the limit","tooltip_partitions-above-limit":"{{count}} {{partitions}}. {{diff}} over the limit","value_partition-one":"partition","value_partition-many":"partitions","value_no-limit":"No limit"}');let io=(0,en.g4)("partitions-progress",{en:il}),ic=(0,d.cn)("ydb-partitions-progress"),id={additional:{additional:!0},main:{main:!0}},iu=({position:e,value:t,withMinFill:a})=>{let r=`${t}%`;return(0,n.jsx)("div",{className:ic("segment-bar",id[e]),role:"progressbar","aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":t,children:(0,n.jsx)("div",{className:ic("segment-fill",{"min-fill":a}),style:{width:r}})})},im=({minPartitions:e,maxPartitions:t,partitionsCount:a,className:r})=>{var i,s,l,c,d,u,m,p,h,g;let x,y,b,f,v,j,T,w,S,_,N,E,C,A,{min:I,max:P,partitionsBelowMin:k,partitionsAboveMax:D,isBelowMin:R,isAboveMax:M,leftSegmentUnits:O,mainSegmentUnits:q,rightSegmentUnits:L,mainProgressValue:z}=(A=Math.max(1,e),(0,o.isNil)(t)?(y=(x=Math.max(0,(i=A)-(s=a)))>0,{min:i,max:void 0,partitionsBelowMin:x,partitionsAboveMax:0,isBelowMin:y,isAboveMax:!1,leftSegmentUnits:+!!y,mainSegmentUnits:y?4:1,rightSegmentUnits:0,mainProgressValue:s<i?0:100}):(l=A,c=t,d=a,f=Math.max(0,(b=Math.max(c,l))-l),v=Math.max(0,l-d),j=Math.max(0,d-b),T=v>0,w=j>0,S=(u=l,m=b,p=f,h=d,0===p?100*(h>=u):h<=u?0:h>=m?100:(h-u)/p*100),{min:l,max:b,partitionsBelowMin:v,partitionsAboveMax:j,isBelowMin:T,isAboveMax:w,leftSegmentUnits:T?v:0,mainSegmentUnits:f||1,rightSegmentUnits:w?j:0,mainProgressValue:S})),F=(_=1===(g={count:a,belowMin:k,aboveMax:D,isBelowMin:R,isAboveMax:M}).count?io("value_partition-one"):io("value_partition-many"),N=(0,eW.ZV)(g.count),E=(0,eW.ZV)(g.belowMin),C=(0,eW.ZV)(g.aboveMax),g.isBelowMin?io("tooltip_partitions-below-limit",{count:N,diff:E,partitions:_}):g.isAboveMax?io("tooltip_partitions-above-limit",{count:N,diff:C,partitions:_}):io("tooltip_partitions-current",{count:N,partitions:_})),Q=(0,eW.ZV)(I),U=(0,o.isNil)(P)?io("value_no-limit"):(0,eW.ZV)(P),$=(0,eW.ZV)(a),G=R||M;return(0,n.jsx)(nt.A,{hasArrow:!0,placement:"top",content:F,className:ic("segment-touched"),children:(0,n.jsxs)(tC.s,{alignItems:"center",gap:"0.5",className:ic(null,r),children:[R&&(0,n.jsxs)(tC.s,{style:{flexGrow:O},direction:"column",gap:"2",className:ic("segment",id.additional),children:[(0,n.jsx)(iu,{position:"additional",value:100}),(0,n.jsx)(tC.s,{justifyContent:"flex-start",children:(0,n.jsx)(tE.E,{variant:"body-2",color:"secondary",children:$})})]}),(0,n.jsxs)(tC.s,{direction:"column",className:ic("segment",id.main),style:{flexGrow:q},gap:"2",children:[(0,n.jsx)(iu,{position:"main",value:z,withMinFill:!G}),(0,n.jsxs)(tC.s,{justifyContent:"space-between",gap:"2",children:[(0,n.jsx)(tE.E,{variant:"body-2",color:"secondary",children:Q}),(0,n.jsx)(tE.E,{variant:"body-2",color:"secondary",children:U})]})]}),M&&(0,n.jsxs)(tC.s,{direction:"column",gap:"2",className:ic("segment",id.additional),style:{flexGrow:L},children:[(0,n.jsx)(iu,{position:"additional",value:100}),(0,n.jsx)(tC.s,{justifyContent:"flex-end",children:(0,n.jsx)(tE.E,{variant:"body-2",color:"secondary",children:$})})]})]})})};var ip=JSON.parse('{"title_partitioning":"Partitioning","title_table-stats":"Stats","title_tablet-metrics":"Metrics","title_partition-config":"Partition config","button_show-more":"Show more","button_show-less":"Show less","field_current-partitions":"Current partitions","field_ttl-for-rows":"TTL for rows","field_standalone":"Standalone","field_partitioning":"Partitioning","field_partitioning-by-size":"Partitioning by size","field_partitioning-by-load":"Partitioning by load","field_min-partitions-count":"Min number of partitions","field_max-partitions-count":"Max number of partitions","field_read-replicas":"Read replicas (followers)","field_bloom-filter":"Bloom filter","field_compression-groups":"Compression & families","value_ttl-config":"column: \'{{columnName}}\', expire after: {{expireTime}}","value_partitioning-by-size-enabled":"Enabled, split size: {{size}}","value_enabled":"Enabled","value_disabled":"Disabled","value_no":"No","value_some-groups":"some groups","value_default":"default","hint_current-partitions-below-limits":"The current partition size is below the limits. To prevent automatic splits and maintain performance, adjust the partition limits","hint_current-partitions-exceeds-limits":"The current partition size exceeds the limits. To prevent automatic splits and maintain performance, adjust the partition limits","toast_partitioning-updated":"Partitioning settings applied"}');let ih=(0,en.g4)("ydb-diagnostics-overview-table-info",{en:ip});var ig=a(11545),ix=a(83544),iy=a(17453),ib=a(90179),iv=a.n(ib),ij=a(44383),iT=a.n(ij);function iw({contents:e,names:t,defaultContentFormatter:a}){return(n,r)=>{let i;return{name:(t||{})[n]??String(n),content:(i=(e||{})[n]||a)?i(r):r}}}let iS=(e,t)=>t?Object.entries(t).map(([t,a])=>e(t,a)).filter(({content:e})=>!!e):[],i_=iw({contents:{CPU:eW.iM,Memory:n0,Storage:n0,Network:eW.tC,ReadThroughput:eW.tC,WriteThroughput:eW.tC},defaultContentFormatter:eW.ZV}),iN=iw({contents:{FollowerCount:eW.ZV},names:{FollowerCountPerDataCenter:"FollowerCountPerDC"},defaultContentFormatter:e=>e&&String(e)}),iE=iw({contents:{FollowerCount:eW.ZV,CrossDataCenterFollowerCount:eW.ZV}}),iC=iw({contents:{DataSize:n0,IndexSize:n0,LastAccessTime:eW.r6,LastUpdateTime:eW.r6},defaultContentFormatter:eW.ZV});var iA=a(28241);let iI=["CPU","Memory","ReadThroughput","Network"],iP=e=>{if(e.Enabled&&e.Enabled.ColumnName&&void 0!==e.Enabled.ExpireAfterSeconds){let t=ih("value_ttl-config",{columnName:e.Enabled.ColumnName,expireTime:(0,tM.Bi)(1e3*e.Enabled.ExpireAfterSeconds,1)});return{name:ih("field_ttl-for-rows"),content:t}}},ik=(0,d.cn)("ydb-diagnostics-table-info"),iD=({data:e})=>{let t="EPathTypeTable"===e?.PathDescription?.Self?.PathType?ih("title_partitioning"):(0,n.jsx)(rk,{data:e?.PathDescription});return(0,n.jsx)("div",{className:ik("title"),children:t})},iR=({data:e,type:t,database:a,path:i})=>{let{generalInfoLeft:s=[],generalInfoRight:l=[],generalStats:o=[],tableStatsInfo:c=[],generalMetrics:d=[],tabletMetricsInfo:u=[],partitionConfigInfo:m=[],partitionProgressConfig:p,managePartitioningDialogConfig:h}=r.useMemo(()=>((e,t)=>{let a,r;if(!e)return{};let{PathDescription:i={}}=e,{TablePartitions:s,TableStats:l={},TabletMetrics:o={},Table:{PartitionConfig:c={},TTLSettings:d}={},ColumnTableDescription:u={}}=i,{PartCount:m,RowCount:p,DataSize:h,IndexSize:g,ByKeyFilterSize:x,LastAccessTime:y,LastUpdateTime:b,ImmediateTxCompleted:f,PlannedTxCompleted:v,TxRejectedByOverload:j,TxRejectedBySpace:T,TxCompleteLagMsec:w,InFlightTxCount:S,RowUpdates:_,RowDeletes:N,RowReads:E,RangeReads:C,RangeReadRows:A}=l,{FollowerGroups:I,FollowerCount:P,CrossDataCenterFollowerCount:D}=c,R=[],M=[];switch(t){case"EPathTypeTable":{var O;let e,t,i;O=a=((e,t)=>{let{PartitioningPolicy:a}=e,n=Math.max(1,a?.MinPartitionsCount??1);return{minPartitions:n,maxPartitions:a?.MaxPartitionsCount,partitionsCount:t?.length??1}})(c,s),e=c?.PartitioningPolicy,t=!!e?.SplitByLoadSettings?.Enabled,i=Number(e?.SizeToSplit??rZ),r={splitSize:(0,a3.z3)({value:i,withSizeLabel:!1}),splitUnit:(0,a3.fn)(i),loadEnabled:t,minimum:String(O?.minPartitions),maximum:String(O?.maxPartitions??r4.maximum)};let{left:l,right:o}=((e,t,a)=>{let r,i,s,{PartitioningPolicy:l={},FollowerGroups:o,EnableFilterByKey:c}=e,d=[],u=[],m=l?.SplitByLoadSettings?.Enabled?(0,n.jsx)(k.J,{children:ih("value_enabled")}):(0,n.jsx)(k.J,{theme:"unknown",children:ih("value_disabled")}),p=l.SizeToSplit??rZ;if(d.push({name:ih("field_current-partitions"),content:(e=>{let{minPartitions:t,maxPartitions:a,partitionsCount:r}=e,i=r<t,s=i||void 0!==a&&r>a,l=i?ih("hint_current-partitions-below-limits"):ih("hint_current-partitions-exceeds-limits");return(0,n.jsx)(k.J,{theme:s?"danger":void 0,children:(0,n.jsxs)(tC.s,{gap:"2",alignItems:"center",children:[(0,eW.ZV)(r),s&&(0,n.jsx)(nt.A,{placement:"auto-start",content:l,className:ik("partitions-popover"),children:(0,n.jsx)(tI.I,{data:ig.A})})]})})})(t)},{name:ih("field_partitioning-by-size"),content:(0,n.jsx)(k.J,{children:(0,a3.z3)({value:p})})},{name:ih("field_partitioning-by-load"),content:m}),a){let e=iP(a);e&&d.push(e)}if(o&&o.length){let{RequireAllDataCenters:e,FollowerCountPerDataCenter:t,FollowerCount:a}=o[0];r=e&&t?`PER_AZ: ${a}`:`ANY_AZ: ${a}`}else r=ih("value_no");return u.push({name:ih("field_read-replicas"),content:r},{name:ih("field_bloom-filter"),content:(i=!!c,(0,n.jsx)("span",{"aria-label":i?ih("value_enabled"):ih("value_disabled"),className:ik("status-icon",{state:i?"enabled":"disabled"}),children:(0,n.jsx)(tI.I,{data:i?ix.A:iy.A,size:16})}))},{name:ih("field_compression-groups"),content:Array.isArray(s=e.ColumnFamilies)&&0!==s.length?(0,n.jsx)(tC.s,{direction:"column",gap:1,children:s.map((e,t)=>{let a=e?.Name?String(e.Name):ih("value_default"),r=e.Id??`${a}-${t}`;return(0,n.jsx)("span",{children:a},r)})}):(0,n.jsx)("span",{children:ih("value_some-groups")})}),{left:d,right:u}})(c,a,d);R=l,M=o;break}case"EPathTypeColumnTable":R=function(e){let t=[];if(t.push({name:ih("field_standalone"),content:String(!(e.SchemaPresetName&&void 0!==e.SchemaPresetId))}),e.Sharding?.HashSharding?.Columns){let a=e.Sharding.HashSharding.Columns.join(", "),r=`PARTITION BY HASH(${a})`;t.push({name:ih("field_partitioning"),content:(0,n.jsx)(tE.E,{variant:"code-2",wordBreak:"break-word",children:r})})}if(e.TtlSettings){let a=iP(e?.TtlSettings);a&&t.push(a)}return t}(u)}let q=iS(iC,{PartCount:m,RowCount:p,DataSize:h,IndexSize:g}),L=[];(0,iA.kf)(x)&&(c.EnableFilterByKey||Number(x)>0)&&L.push({name:"BloomFilterSize",content:n0(x)});let z=[...L.length>0?[L]:[],iS(iC,{LastAccessTime:y,LastUpdateTime:b}),iS(iC,{ImmediateTxCompleted:f,PlannedTxCompleted:v,TxRejectedByOverload:j,TxRejectedBySpace:T,TxCompleteLagMsec:w,InFlightTxCount:S}),iS(iC,{RowUpdates:_,RowDeletes:N,RowReads:E,RangeReads:C,RangeReadRows:A})],F=iS(i_,iT()(o,iI)),Q=iS(i_,iv()(o,[...iI,"GroupReadIops","GroupReadThroughput","GroupWriteIops","GroupWriteThroughput"])),U=[];return Array.isArray(I)&&I.length>0?U=iS(iN,I[0]):void 0!==P?U.push(iE("FollowerCount",P)):void 0!==D&&U.push(iE("CrossDataCenterFollowerCount",D)),{generalInfoRight:M,generalInfoLeft:R,generalStats:q,tableStatsInfo:z,generalMetrics:F,tabletMetricsInfo:Q,partitionConfigInfo:U,partitionProgressConfig:a,managePartitioningDialogConfig:r}})(e,t),[e,t]),[g,x]=r.useState(!1),y=r.useCallback(e=>x(e),[]),b=c.some(e=>e.length>0),f=u.length>0||m.length>0,[v]=rH.useUpdateTablePartitioningMutation(),j=r.useCallback(()=>{rJ("openManagePartitioning"),aD.WU(r5,{id:r5,initialValue:h,onApply:async e=>{rJ("applyManagePartitioning"),await v(function(e,t,a){let{partitionSizeMb:n}=ie(Number(e.splitSize),e.splitUnit);return{value:{partitionSizeMb:n,minPartitions:Number(e.minimum),maxPartitions:Number(e.maximum),splitByLoad:e.loadEnabled},database:t,path:a}}(e,a,i)).unwrap(),(0,tR.A)({name:"updateTablePartitioning",content:ih("toast_partitioning-updated"),autoHiding:3e3,isClosable:!0})}})},[h,a,i,v]);return(0,n.jsxs)("div",{className:ik(),children:[(0,n.jsxs)(tC.s,{className:ik("header"),justifyContent:"space-between",alignItems:"center",gap:"2",children:[(0,n.jsx)(iD,{data:e}),h&&(0,n.jsx)(as.$,{view:"normal",size:"s",onClick:j,children:(0,n.jsx)(tI.I,{data:rU.A,size:16})})]}),p&&(0,n.jsx)("div",{className:ik("progress-bar"),children:(0,n.jsx)(im,{minPartitions:p.minPartitions,partitionsCount:p.partitionsCount,maxPartitions:p.maxPartitions})}),(0,n.jsxs)("div",{className:ik("row",{"general-info":!0}),children:[(0,n.jsx)("div",{className:ik("col"),children:s.length>0?(0,n.jsx)(re.n,{nameMaxWidth:"auto",responsive:!0,className:ik("info-block"),items:s,titleClassname:ik("info-title")}):null}),(0,n.jsx)("div",{className:ik("col"),children:l.length>0?(0,n.jsx)(re.n,{nameMaxWidth:"auto",responsive:!0,className:ik("info-block"),items:l,titleClassname:ik("info-title")}):null})]}),(0,n.jsxs)("div",{className:ik("row"),children:[(0,n.jsx)("div",{className:ik("col"),children:o.length>0?(0,n.jsx)(re.n,{items:o,title:ih("title_table-stats"),className:ik("info-block"),nameMaxWidth:"auto",responsive:!0,titleClassname:ik("info-title")}):null}),(0,n.jsx)("div",{className:ik("col"),children:d.length>0?(0,n.jsx)(re.n,{items:d,title:ih("title_tablet-metrics"),className:ik("info-block"),nameMaxWidth:"auto",responsive:!0,titleClassname:ik("info-title")}):null})]}),b||f?(0,n.jsxs)(rB.E,{className:ik("show-more-disclosure"),expanded:g,onUpdate:y,children:[(0,n.jsx)(rB.E.Summary,{children:e=>(0,n.jsxs)(as.$,{onClick:e.onClick,view:"normal",size:"s",children:[g?ih("button_show-less"):ih("button_show-more"),(0,n.jsx)(tI.I,{data:g?r$.A:rG.A,size:16})]})}),(0,n.jsx)(rB.E.Details,{children:(0,n.jsxs)("div",{className:ik("row"),children:[(0,n.jsx)("div",{className:ik("col"),children:c.filter(e=>e.length>0).map((e,t)=>(0,n.jsx)(re.n,{items:e,className:ik("info-block"),nameMaxWidth:"auto",responsive:!0},t))}),(0,n.jsxs)("div",{className:ik("col"),children:[u.length>0?(0,n.jsx)(re.n,{items:u,className:ik("info-block"),nameMaxWidth:"auto",responsive:!0}):null,m.length>0?(0,n.jsx)(re.n,{items:m,title:ih("title_partition-config"),className:ik("info-block"),nameMaxWidth:"auto",responsive:!0,titleClassname:ik("info-title")}):null]})]})})]}):null]})},iM=({data:e,path:t,database:a,databaseFullPath:r})=>{let i=nW(e?.PathDescription);return e?(0,n.jsxs)("div",{children:[(0,n.jsx)(nH.z_,{title:i,info:(e=>{let t=e?.PathDescription?.PersQueueGroup;if(!t)return[];let{Partitions:a=[],PQTabletConfig:n={PartitionConfig:{LifetimeSeconds:0}}}=t,{Codecs:r,MeteringMode:i}=n,{WriteSpeedInBytesPerSecond:s,StorageLimitBytes:l}=n.PartitionConfig;return[...(0,nH.jl)(n3,{Partitions:a,PQTabletConfig:n}),...(0,nH.jl)(n5,{StorageLimitBytes:l,WriteSpeedInBytesPerSecond:s}),...(0,nH.jl)(n4,{Codecs:r,MeteringMode:i})]})(e)}),e.PathDescription?.Self?.PathSubType==="EPathSubTypeStreamImpl"?null:(0,n.jsx)(rI,{path:t,database:a,databaseFullPath:r})]}):(0,n.jsxs)("div",{className:"error",children:["No ",i," data"]})},iO=b.F.injectEndpoints({endpoints:e=>({getReplication:e.query({queryFn:async({path:e,database:t,databaseFullPath:a,useMetaProxy:n})=>{try{let r=await window.api.viewer.getReplication({path:{path:e,databaseFullPath:a,useMetaProxy:n},database:t});if("object"!=typeof r)return{error:{}};return{data:r}}catch(e){return{error:e}}},providesTags:["All"]})}),overrideExisting:"throw"});function iq({connection:e}){return e?e.StaticCredentials?(0,n.jsx)(k.J,{value:e.StaticCredentials.User,theme:"normal",children:"user"}):"OAuthToken"in e?void 0!==e.OAuthToken&&("Token"in e.OAuthToken||"TokenSecretName"in e.OAuthToken)?"OAuth":"":"unknown":null}var iL=JSON.parse('{"credentials.label":"Credentials","noData":"No data for entity:","srcConnection.database.label":"Source Database Path","srcConnection.endpoint.label":"Source Cluster Endpoint","state.label":"State","state.error":"Error","srcPath.label":"Source Topic","dstPath.label":"Destination Table","transformLambda.label":"Transformation Lambda"}');let iz=(0,en.g4)("ydb-diagnostics-transfer-info",{en:iL});function iF({path:e,database:t,data:a,databaseFullPath:r}){let i=nW(a?.PathDescription),s=(0,x.kK)();if(!a)return(0,n.jsxs)("div",{className:"error",children:[iz("noData")," ",i]});let{data:l}=iO.useGetReplicationQuery({path:e,database:t,databaseFullPath:r,useMetaProxy:s},{}),o=function(e,t){let a=e.PathDescription?.ReplicationDescription||{},r=a.Config?.SrcConnectionParams||{},{Endpoint:i,Database:s}=r,l=a.Config?.TransferSpecific?.Target,o=l?.SrcPath,c=l?.DstPath,d=l?.TransformLambda,u=[];return t&&u.push({name:iz("state.label"),content:t?"running"in t?(0,n.jsx)(k.J,{theme:"info",children:"Running"}):"paused"in t?(0,n.jsx)(k.J,{theme:"info",children:"Paused"}):"done"in t?(0,n.jsx)(k.J,{theme:"success",children:"Done"}):"error"in t?(0,n.jsx)(k.J,{theme:"danger",children:"Error"}):(0,n.jsx)(k.J,{size:"s",children:"Unknown"}):null}),t?.error?.issues&&t.error.issues[0]?.message&&u.push({name:iz("state.error"),copyText:t.error.issues[0].message,content:(0,n.jsx)(tE.E,{variant:"code-inline-2",color:"danger",children:t.error.issues[0].message})}),i&&u.push({name:iz("srcConnection.endpoint.label"),copyText:i,content:(0,n.jsx)(tE.E,{variant:"code-inline-2",children:i})}),s&&u.push({name:iz("srcConnection.database.label"),copyText:s,content:(0,n.jsx)(tE.E,{variant:"code-inline-2",children:s})}),r&&u.push({name:iz("credentials.label"),content:(0,n.jsx)(iq,{connection:r})}),u.push({name:iz("srcPath.label"),copyText:o,content:(0,n.jsx)(tE.E,{variant:"code-inline-2",children:o})}),u.push({name:iz("dstPath.label"),copyText:c,content:(0,n.jsx)(tE.E,{variant:"code-inline-2",children:c})}),u.push({name:iz("transformLambda.label"),copyText:d,content:d?(0,n.jsx)(rh.YDBSyntaxHighlighter,{language:"yql",text:d}):null}),u}(a,l);return(0,n.jsx)(tC.s,{direction:"column",gap:"4",children:(0,n.jsx)(re.n,{title:i,items:o})})}let iQ=function({type:e,path:t,database:a,databaseFullPath:i}){let s,l,[o]=(0,_.Nt)(),c=(0,x.kK)(),{currentData:d,isFetching:u,error:m}=f.useGetOverviewQuery({path:t,database:a,databaseFullPath:i,useMetaProxy:c},{pollingInterval:o,skip:"EPathTypeStreamingQuery"===e});return u&&void 0===d?(0,n.jsx)(eG.a,{size:"m"}):(0,n.jsxs)(r.Fragment,{children:[m?(0,n.jsx)(e$.o,{error:m}):null,m&&!d?null:(s=d??void 0,l=()=>(0,n.jsx)(iR,{path:t,data:s,type:e,database:a}),e&&({EPathTypeInvalid:void 0,EPathTypeDir:void 0,EPathTypeResourcePool:void 0,EPathTypeTable:l,EPathTypeSysView:()=>(0,n.jsx)(rp,{data:s}),EPathTypeSubDomain:void 0,EPathTypeTableIndex:()=>(0,n.jsx)(n9,{data:s}),EPathTypeExtSubDomain:void 0,EPathTypeColumnStore:l,EPathTypeColumnTable:l,EPathTypeCdcStream:()=>(0,n.jsx)(rP,{path:t,database:a,databaseFullPath:i,data:s}),EPathTypePersQueueGroup:()=>(0,n.jsx)(iM,{data:s,path:t,databaseFullPath:i,database:a}),EPathTypeExternalTable:()=>(0,n.jsx)(ru,{data:s}),EPathTypeExternalDataSource:()=>(0,n.jsx)(rl,{data:s}),EPathTypeView:()=>(0,n.jsx)(rg,{data:s}),EPathTypeReplication:()=>(0,n.jsx)(r_,{data:s}),EPathTypeTransfer:()=>(0,n.jsx)(iF,{path:t,databaseFullPath:i,database:a,data:s}),EPathTypeStreamingQuery:()=>(0,n.jsx)(rz,{path:t,database:a})})[e]?.()||(0,n.jsx)(rR,{data:s}))]})};var iU=a(50247),i$=a(93397),iG=a(25711),iB=a(33691),iH=a(27088),iW=JSON.parse('{"title_queries-activity":"Queries Activity","context_monitor-changes-realtime":"Monitor changes in real time","value_per-sec":"{{count}} per sec","value_ms":"{{time}} ms","field_running-queries":"Running Queries","field_applications":"Applications","field_users":"Users","action_open-running-queries":"Open Running Queries"}');let iV="ydb-queries-activity-bar";en.Ru.registerKeyset(en.JA.En,iV,iW);let iJ=en.Ru.keyset(iV),iK=(0,d.cn)("queries-activity-alert");function iY({runningQueriesCount:e,uniqueApplications:t,uniqueUsers:a}){let r=(0,M.W6)(),i=(0,M.zy)();return(0,n.jsx)("div",{className:iK(),children:(0,n.jsx)(a_.Z,{className:iK("card"),type:"container",view:"outlined",children:(0,n.jsxs)(tC.s,{direction:"row",justifyContent:"space-between",alignItems:"center",gap:4,className:iK("content"),children:[(0,n.jsx)(tC.s,{children:(0,n.jsx)(tE.E,{variant:"subheader-2",className:iK("title"),children:iJ("title_queries-activity")})}),(0,n.jsxs)(tC.s,{wrap:!0,alignItems:"center",gap:1,className:iK("stats"),children:[(0,n.jsx)(k.J,{theme:e>0?"success":"unknown",icon:(0,n.jsx)(tI.I,{data:iG.A}),size:"s",value:String(e),children:iJ("field_running-queries")}),(0,n.jsx)(k.J,{theme:"unknown",icon:(0,n.jsx)(tI.I,{data:iB.A}),size:"s",value:String(t),children:iJ("field_applications")}),(0,n.jsx)(k.J,{theme:"unknown",icon:(0,n.jsx)(tI.I,{data:iH.A}),size:"s",value:String(a),children:iJ("field_users")}),e>0&&(0,n.jsx)(as.$,{view:"outlined",size:"s",onClick:()=>{let e=(0,O.mA)(i),t=(0,O.YL)({...e,[q.vh.diagnosticsTab]:j.iJ.topQueries,queryMode:"running"});r.push(t)},className:iK("open-queries-button"),children:iJ("action_open-running-queries")})]})]})})})}var iZ=a(86889),iX=a(66247),i0=JSON.parse('{"action_open-monitoring":"Monitoring","top-nodes.empty-data":"No such nodes","title_top-nodes-load":"Top nodes by load","title_top-nodes-pool":"Top nodes by pools usage","cards.cpu-label":"CPU load","cards.storage-label":"Storage","cards.memory-label":"Memory used","cards.network-label":"Network","cards.network-note":"Network throughput is the average outgoing bandwidth usage across all nodes in the database","context_cpu-load":"CPU load","context_storage-groups":"Storage: {{count}} groups","context_memory-used":"Memory used","context_network-usage":"Network usage","context_cpu-description":"CPU load is calculated as the cumulative usage across all actor system pools in the database","context_memory-description":"Memory usage is the total memory consumed by all processes in the database","context_storage-description":"Storage usage shows how much data is stored in the database including user data and indexes","context_network-description":"Network throughput is the average outgoing bandwidth usage across all nodes in the database","charts.queries-per-second":"Queries per second","charts.queries-latency":"Queries latencies {{percentile}}","charts.cpu-usage":"CPU usage by pool","charts.storage-usage":"Tablet storage usage","charts.memory-usage":"Memory usage","charts.network-utilization":"Network utilization","title_storage-details":"Storage Details","storage.tablet-storage-title":"Tablet storage","storage.tablet-storage-description":"Size of user data and indexes stored in schema objects (tables, topics, etc.)","storage.db-storage-title":"Database storage","storage.db-storage-description":"Size of data stored in distributed storage with all overheads for redundancy","title_top-shards":"Top shards by CPU usage","title_top-queries":"Top queries by CPU usage","title_top-tables-by-size":"Top tables by size","title_top-groups-by-usage":"Top groups by usage","title_top-nodes-by-memory":"Top nodes by memory","title_nodes-by-ping":"Top nodes by ping time","title_nodes-by-skew":"Top nodes by clock skew","title_memory-details":"Memory Details","field_memory-usage":"Memory usage","context_capacity-usage":"{{value}} of {{capacity}}","title_network-stats-unavailable":"Network Statistics Unavailable","context_network-stats-unavailable":"Network ping and clock skew statistics require a newer backend version. Please upgrade your YDB installation to access these features.","value_serverless":"Serverless","context_serverless-tooltip":"Some metrics are hidden in Serverless mode — resources scale automatically based on workload","context_serverless-autoscaled":"Auto-Scaled Resources","context_serverless-storage-subtitle":"{{legend}} | {{groups}} groups"}');let i1=(0,en.g4)("ydb-diagnostics-tenant-overview",{en:i0}),i2=[{title:i1("charts.queries-per-second"),metrics:[{target:"queries.requests",title:i1("charts.queries-per-second")}]},{title:i1("charts.queries-latency",{percentile:""}),metrics:[{target:"queries.latencies.p50",title:"p50"},{target:"queries.latencies.p75",title:"p75"},{target:"queries.latencies.p90",title:"p90"},{target:"queries.latencies.p99",title:"p99"}],options:{dataType:"ms",showLegend:!0}}];var i3=a(41388),i4=a(76056),i5=a(73493),i6=a(97547);let i7={"30m":30*S.r0,"1h":S.Jg,"1d":S.tt,"1w":7*S.tt};var i8=JSON.parse('{"value_30m":"Last 30 min","value_1h":"Last hour","value_1d":"Last day","value_1w":"Last week"}');let i9=(0,en.g4)("ydb-timeframe-dropdown",{en:i8}),se=e=>{switch(e){case"30m":return i9("value_30m");case"1h":return i9("value_1h");case"1d":return i9("value_1d");case"1w":return i9("value_1w");default:return e}},st=(0,d.cn)("ydb-timeframe-dropdown"),sa=({value:e,onChange:t,className:a,size:i="s",view:s="flat-secondary"})=>{let l=r.useMemo(()=>Object.keys(i7).map(e=>({text:se(e),action:()=>t(e)})),[t]);return(0,n.jsx)(i6.r,{renderSwitcher:t=>(0,n.jsxs)(as.$,{...t,size:i,view:s,className:st(null,a),children:[se(e),(0,n.jsx)(tI.I,{data:rG.A,size:12})]}),items:l,popupProps:{placement:"bottom-start"}})};var sn=a(83640);let sr=["#7EB26D","#EAB839","#6ED0E0","#EF843C","#E24D42","#1F78C1","#BA43A9","#705DA0","#508642","#CCA300"];function si(e){return null===e?S.Pd:(0,tM.Xo)((0,eW.CR)((0,iA.y3)(e),2))}function ss(e){return null===e?S.Pd:(0,a3.z3)({value:(0,iA.y3)(e),precision:3})}function sl(e){return null===e?S.Pd:Math.round(100*(0,iA.y3)(e))+"%"}let so=async({database:e,metrics:t,timeFrame:a,maxDataPoints:n},{signal:r}={})=>{let i=t.map(e=>`target=${e.target}`).join("&"),s=Math.round(Date.now()/1e3),l=s-i7[a];return window.api.viewer.getChartData({target:i,from:l,until:s,maxDataPoints:n,database:e},{signal:r})};var sc=JSON.parse('{"not-supported":"Charts are not supported on current ydb version"}');let sd=(0,en.g4)("ydb-metric-chart",{en:sc}),su=b.F.injectEndpoints({endpoints:e=>({getChartData:e.query({queryFn:async(e,{signal:t})=>{try{let a=await so(e,{signal:t});if(Array.isArray(a))return{data:((e=[],t)=>{let a=e.map(({datapoints:e,target:a})=>{let n=t.find(e=>e.target===a);if(!n)return;let r=e.map(e=>e[0]);return{...n,data:r}}).filter(e=>void 0!==e);return{timeline:e[0].datapoints.map(e=>1e3*e[1]),metrics:a}})(a,e.metrics)};return{error:Error("string"==typeof a?sd("not-supported"):a.error)}}catch(e){return{error:e}}},providesTags:["All"],keepUnusedDataFor:0})}),overrideExisting:"throw"}),sm=(0,d.cn)("ydb-metric-chart");i3.W.set({plugins:[i5.z]});let sp={timeline:[],metrics:[]},sh=({database:e,metrics:t,defaultTimeFrame:a="1h",autorefresh:i,width:s=400,height:l=s/1.5,chartOptions:o,onChartDataStatusChange:c,isChartVisible:d,title:u})=>{let[m,p]=r.useState(a),{currentData:h,error:g,isFetching:x,status:y}=su.useGetChartDataQuery({database:e,metrics:t,timeFrame:m,maxDataPoints:300},{pollingInterval:i}),b=x&&!h;r.useEffect(()=>c?.("fulfilled"===y?"success":"loading"),[y,c]);let f=((e,t={})=>{let{dataType:a,scaleRange:n,showLegend:r}=t,i=(e=>{switch(e){case"ms":return si;case"size":return ss;case"percent":return sl;default:return}})(a),s=!e.metrics.length,l=e.metrics.map((e,t)=>{let a=e.color||sr[t],n=function(e,t){let a=(0,sn.Mj)(e);if(!a.isValid())throw Error("Invalid color is passed");return a.alpha(.1).toRgbString()}(a,0);return{id:e.target,name:e.title||e.target,data:e.data,formatter:i,lineColor:a,color:n,legendColorKey:"lineColor"}});return{data:{timeline:e.timeline,graphs:l},libraryConfig:{chart:{size:{padding:s?[10,0,10,0]:void 0},series:{type:"area",spanGaps:!0,lineWidth:1.5},select:{zoom:!1}},scales:{y:{type:"linear",range:"nice",min:n?.min||0,max:n?.max}},axes:{y:{values:i?(e,t)=>t.map(i):void 0}},tooltip:{show:!0,tracking:"sticky"},legend:{show:r}}}})(h||sp,o);return(0,n.jsxs)("div",{className:sm(),style:{height:l},children:[(0,n.jsxs)(tC.s,{className:sm("toolbar"),justifyContent:"space-between",alignItems:"center",children:[(0,n.jsx)("div",{children:u}),(0,n.jsx)(sa,{value:m,onChange:p})]}),b?(0,n.jsx)(eG.a,{}):d?(0,n.jsxs)("div",{className:sm("chart"),children:[(0,n.jsx)(i4.Ay,{type:"yagr",data:f}),g?(0,n.jsx)(e$.o,{className:sm("error"),error:g}):null]}):null]})},sg=(0,d.cn)("queries-activity-bar");function sx({database:e,expanded:t,onChartDataStatusChange:a}){let[i]=(0,_.Nt)(),[s,l]=r.useState(!1),o=e=>i2.find(t=>t.metrics.some(t=>t.target===e)),c=o("queries.requests"),d=o("queries.latencies.p99"),u=s?i:0,m=r.useCallback(e=>{"success"===e&&l(!0),a?.(e)},[a]);return c&&d?(0,n.jsxs)(tC.s,{className:sg("charts"),gap:4,direction:"row",style:{display:t?void 0:"none"},children:[(0,n.jsx)(tC.s,{direction:"column",gap:3,grow:!0,basis:0,minWidth:0,children:(0,n.jsx)(sh,{database:e,metrics:c.metrics,autorefresh:u,height:292,chartOptions:c.options,onChartDataStatusChange:m,isChartVisible:s&&t,title:c.title})}),(0,n.jsx)(tC.s,{direction:"column",gap:3,grow:!0,basis:0,minWidth:0,children:(0,n.jsx)(sh,{database:e,metrics:d.metrics,autorefresh:u,height:326.5,chartOptions:d.options,onChartDataStatusChange:m,isChartVisible:s&&t,title:d.title})})]}):(console.warn("Required chart configurations not found in defaultDashboardConfig"),null)}let sy=e=>e>=1?`+${e.toFixed(0)}`:e>0?`+${e.toFixed(1)}`:e.toFixed(1),sb=(0,d.cn)("queries-activity-bar");function sf({database:e,runningQueriesCount:t,uniqueApplications:a,uniqueUsers:i,qps:s,latency:l}){let o=(0,M.W6)(),c=(0,M.zy)(),[d,u]=r.useState(!1);return(0,n.jsx)("div",{className:sb({expanded:d}),children:(0,n.jsxs)(a_.Z,{className:sb("card"),type:"container",view:d?"outlined":"raised",children:[(0,n.jsxs)(tC.s,{className:sb("header"),onClick:()=>{u(!d)},justifyContent:"space-between",alignItems:"center",gap:3,children:[(0,n.jsxs)(tC.s,{direction:"column",children:[(0,n.jsx)(tE.E,{variant:"subheader-2",className:sb("title"),children:iJ("title_queries-activity")}),(0,n.jsx)(tE.E,{color:"secondary",variant:"caption-2",className:sb("subtitle"),children:iJ("context_monitor-changes-realtime")})]}),(0,n.jsxs)(tC.s,{alignItems:"center",gap:4,children:[(0,n.jsxs)(tC.s,{alignItems:"center",gap:1,children:[(0,n.jsx)(k.J,{theme:t>0?"success":"unknown",size:"s",icon:(0,n.jsx)(tI.I,{data:iG.A,size:14}),children:t}),(0,n.jsx)(k.J,{theme:"unknown",icon:(0,n.jsx)(tI.I,{data:iZ.A}),size:"s",value:sy(s?.trend?.value??0),children:iJ("value_per-sec",{count:s?.value??"0"})}),(0,n.jsx)(k.J,{theme:"unknown",icon:(0,n.jsx)(tI.I,{data:iX.A}),size:"s",value:sy(l?.trend?.value??0),children:iJ("value_ms",{time:l?.value??"0"})})]}),(0,n.jsx)(rX.I,{direction:d?"top":"bottom",size:16})]})]}),d&&(0,n.jsx)(tC.s,{direction:"column",gap:4,className:sb("content"),children:(0,n.jsxs)(tC.s,{wrap:!0,alignItems:"center",gap:1,className:sb("stats"),children:[(0,n.jsx)(k.J,{theme:"unknown",icon:(0,n.jsx)(tI.I,{data:iG.A}),size:"s",value:String(t),children:iJ("field_running-queries")}),(0,n.jsx)(k.J,{theme:"unknown",icon:(0,n.jsx)(tI.I,{data:iB.A}),size:"s",value:String(a),children:iJ("field_applications")}),(0,n.jsx)(k.J,{theme:"unknown",icon:(0,n.jsx)(tI.I,{data:iH.A}),size:"s",value:String(i),children:iJ("field_users")}),t>0&&(0,n.jsx)(as.$,{view:"outlined",size:"s",onClick:()=>{let e=(0,O.mA)(c),t=(0,O.YL)({...e,[q.vh.diagnosticsTab]:j.iJ.topQueries,queryMode:"running"});o.push(t)},className:sb("open-queries-button"),children:iJ("action_open-running-queries")})]})}),(0,n.jsx)(sx,{database:e,expanded:d})]})})}var sv=a(86268);let sj=(0,d.cn)("queries-activity-skeleton");function sT(){return(0,n.jsx)(sv.E,{className:sj("skeleton")})}var sw=a(87693),sS=a(39212),s_=a(3715);function sN({database:e}){let{runningQueriesCount:t,uniqueApplications:a,uniqueUsers:i,qps:s,latency:l,areChartsAvailable:o}=function(e){let[t]=(0,_.Nt)(),a=!1===(0,s_.N)(t=>(0,sw.TH)(t,e)),{data:n}=sS.Ke.useGetRunningQueriesQuery({database:e,filters:{}},{pollingInterval:t}),{data:i,isSuccess:s,isError:l}=su.useGetChartDataQuery({database:e,metrics:[{target:"queries.requests"}],timeFrame:"1h",maxDataPoints:30},{pollingInterval:t,skip:a}),{data:o}=su.useGetChartDataQuery({database:e,metrics:[{target:"queries.latencies.p99"}],timeFrame:"1h",maxDataPoints:30},{pollingInterval:t,skip:a}),c=n?.resultSets?.[0]?.result?.length||0,d=r.useMemo(()=>!a&&(!!s||!l&&null),[s,l,a]),u=r.useMemo(()=>(e=>{let t;if(!e||0===e.length)return{value:"0",trend:{value:1e-6,direction:"up"}};let a=e[e.length-1]??1e-6,n=e.length>=2?e[e.length-2]??1e-6:1e-6;if(n>0){let e=a-n;t={value:Math.abs(e),direction:e>=0?"up":"down"}}else t={value:1e-6,direction:"up"};return{value:a.toFixed(0),trend:t}})(i?.metrics?.[0]?.data),[i?.metrics?.[0]?.data]),m=r.useMemo(()=>(e=>{let t;if(!e||0===e.length)return{value:"0.0",trend:{value:1e-6,direction:"up"}};let a=e[e.length-1]??1e-6,n=e.length>=2?e[e.length-2]??1e-6:1e-6;if(n>0){let e=a-n;t={value:Math.abs(e),direction:e>=0?"up":"down"}}else t={value:1e-6,direction:"up"};return{value:a.toFixed(1),trend:t}})(o?.metrics?.[0]?.data),[o?.metrics?.[0]?.data]);return{runningQueriesCount:c,uniqueApplications:r.useMemo(()=>{let e=new Set;return n?.resultSets?.[0]?.result?.forEach(t=>{t.ApplicationName&&e.add(String(t.ApplicationName))}),e.size},[n]),uniqueUsers:r.useMemo(()=>{let e=new Set;return n?.resultSets?.[0]?.result?.forEach(t=>{t.UserSID&&e.add(String(t.UserSID))}),e.size},[n]),qps:u,latency:m,areChartsAvailable:d}}(e);return null===o?(0,n.jsx)(sT,{}):!1===o?(0,n.jsx)(iY,{runningQueriesCount:t,uniqueApplications:a,uniqueUsers:i}):(0,n.jsx)(sf,{database:e,runningQueriesCount:t,uniqueApplications:a,uniqueUsers:i,qps:s,latency:l})}var sE=a(88367),sC=a(53263),sA=a(81709),sI=a(58492),sP=a(95200),sk=a(1191),sD=a(95146),sR=a(40897);let sM={UNSPECIFIED:sR.m.Grey,GREY:sR.m.Grey,GREEN:sR.m.Green,BLUE:sR.m.Blue,YELLOW:sR.m.Yellow,ORANGE:sR.m.Orange,RED:sR.m.Red};function sO(e){return e?.startsWith("STORAGE")||e?.startsWith("COMPUTE")?e:"unknown"}function sq(e,t,a){return{...e,rootTypeForUI:t??sO(e.type),...a}}let sL=b.F.injectEndpoints({endpoints:e=>({getHealthcheckInfo:e.query({queryFn:async({database:e,maxLevel:t},{signal:a})=>{try{return{data:await window.api.viewer.getHealthcheckInfo({database:e,maxLevel:t},{signal:a})}}catch(e){return{error:e}}},providesTags:["All"]})}),overrideExisting:"throw"}),sz={RED:0,ORANGE:1,YELLOW:2,BLUE:3,GREEN:4},sF=e=>e.sort((e,t)=>(e.status&&sz[e.status]||0)-(t.status&&sz[t.status]||0)),sQ=(0,ao.Mz)(e=>e,e=>sL.endpoints.getHealthcheckInfo.select({database:e})),sU=(0,ao.Mz)(e=>e,(e,t)=>sQ(t),(e,t)=>t(e).data?.self_check_result),s$=(0,ao.Mz)(e=>e,(e,t)=>sQ(t),(e,t)=>t(e).data?.issue_log||[]),sG=(0,ao.Mz)(s$,(e=[])=>sF(e.filter(t=>!e.find(e=>e.reason&&-1!==e.reason.indexOf(t.id))))),sB=(0,ao.Mz)([s$,sG],(e=[],t=[])=>t.map(t=>sF(function(e,t){let a=[];if(!t.reason||0===t.reason.length)return[sq(t)];for(let n of t.reason){let t=e.find(e=>e.id===n);if(!t)continue;let r=[t],i=sO(t.type);for(;r.length>0;){let t=r.pop();if(!t.reason||0===t.reason.length){a.push(sq(t,i));continue}for(let a of t.reason){let n=e.find(e=>e.id===a);n&&r.push(sq(n,i,{parent:t}))}}}return a}(e,t))).flat()),sH=(0,ao.Mz)(e=>e,(e,t)=>sQ(t),(e,t)=>t(e).data);var sW=a(30240),sV=a(63584),sJ=a(75561);let sK={UNSPECIFIED:"",GOOD:(0,L.A)("description_ok"),DEGRADED:(0,L.A)("description_degraded"),MAINTENANCE_REQUIRED:(0,L.A)("description_maintenance"),EMERGENCY:(0,L.A)("description_emergency")},sY={UNSPECIFIED:sW.A,GOOD:ix.A,DEGRADED:sV.A,MAINTENANCE_REQUIRED:iy.A,EMERGENCY:sJ.A};var sZ=JSON.parse('{"description_problems":["There is {{count}} issue.","There are {{count}} issues.","There are {{count}} issues.","There are {{count}} issues."],"action_review-issues":"Review issues","description_no-data":"No healthcheck data"}');let sX=(0,en.g4)("ydb-diagnostics-healthcheck",{en:sZ}),s0=(0,d.cn)("ydb-healthcheck-preview"),s1={UNSPECIFIED:"normal",GOOD:"success",DEGRADED:"info",MAINTENANCE_REQUIRED:"warning",EMERGENCY:"danger"};function s2(e){let{database:t}=e,[a]=(0,_.Nt)(),{handleShowHealthcheckChange:r}=aT(),{currentData:i,isFetching:s,error:l}=sL.useGetHealthcheckInfoQuery({database:t},{pollingInterval:a}),o=s&&void 0===i,c=i?.self_check_result||"UNSPECIFIED",d=c.toLowerCase();if(o)return(0,n.jsx)(sv.E,{className:s0("skeleton")});let u=i?.issue_log?.filter(e=>!e.reason).length,m=u?sX("description_problems",{count:u}):"";return"GOOD"!==c||u||o?(0,n.jsx)(sD.F,{className:s0(),theme:s1[c],view:l?"outlined":"filled",message:l?(0,n.jsx)(e$.o,{error:l,defaultMessage:sX("description_no-data")}):(0,n.jsxs)(tC.s,{gap:1,alignItems:"center",justifyContent:"space-between",className:s0("alert-message"),children:[(0,n.jsxs)(tC.s,{gap:1,alignItems:"center",children:[sK[c],m?` ${m}`:""]}),u&&(0,n.jsx)(as.$,{onClick:()=>{r(!0)},children:sX("action_review-issues")})]}),icon:(0,n.jsx)(tI.I,{size:18,data:sY[c],className:s0("icon",{[d]:!0})})}):null}var s3=a(2837);a(36966);var s4=a(5577);let s5=(e=[])=>{let t=Number(e.reduce((e,t)=>e+(t.used||0),0).toFixed(2)),a=Number(e.reduce((e,t)=>e+(t.limit||0),0).toFixed(2)),n=a>0?t/a*100:0,r=(0,s4.w)({fillWidth:n,colorizeProgress:!0});return{totalUsed:t,totalLimit:a,usagePercent:n,status:r}};var s6=a(54625),s7=a(9471),s8=a(96945);let s9=(0,d.cn)("tenant-tab-card");function le({text:e,active:t,helpText:a,subtitle:r}){return(0,n.jsx)("div",{className:s9({active:t}),children:(0,n.jsx)(a_.Z,{className:s9("card-container",{active:t}),type:"container",view:t?"outlined":"raised",children:(0,n.jsxs)("div",{className:s9("legend-wrapper"),children:[(0,n.jsx)(s8.e.Legend,{variant:"subheader-2",note:a,noteIconSize:"s",children:e}),r?(0,n.jsx)(s8.e.Legend,{variant:"body-1",color:"secondary",children:r}):null]})})})}var lt=a(47635);let la=(0,d.cn)("tenant-tab-card");function ln({active:e,children:t}){return(0,n.jsx)("div",{className:la({active:e}),children:(0,n.jsx)(a_.Z,{className:la("card-container",{active:e}),type:"container",view:e?"outlined":"raised",children:t})})}function lr({text:e,value:t,limit:a,helpText:i,legendFormatter:s,active:l}){let{status:o,percents:c,legend:d,fill:u}=r.useMemo(()=>(0,lt.s)({value:t,capacity:a,legendFormatter:s,percentPrecision:1}),[t,a,s]);return(0,n.jsx)(ln,{active:l,children:(0,n.jsxs)(tC.s,{gap:3,alignItems:"center",children:[(0,n.jsx)(s8.e,{size:"small",status:o,fillWidth:u,className:la("doughnut"),children:(0,n.jsx)(s8.e.Value,{variant:"subheader-1",children:c})}),(0,n.jsxs)("div",{className:la("legend-wrapper"),children:[(0,n.jsx)(s8.e.Legend,{variant:"subheader-2",children:d}),(0,n.jsx)(s8.e.Legend,{variant:"body-1",color:"secondary",note:i,noteIconSize:"s",children:e})]})]})})}let li=(0,d.cn)("tenant-metrics-tabs");function ls({to:e,active:t,isServerless:a,cpu:r}){return(0,n.jsx)("div",{className:li("link-container",{active:t}),children:(0,n.jsx)(s6.N_,{to:e,className:li("link"),children:a?(0,n.jsx)(le,{text:i1("context_cpu-load"),active:t,helpText:i1("context_cpu-description"),subtitle:i1("context_serverless-autoscaled")}):(0,n.jsx)(lr,{text:i1("context_cpu-load"),value:r.totalUsed,limit:r.totalLimit,legendFormatter:s7.vs,active:t,helpText:i1("context_cpu-description")})})})}let ll=(0,d.cn)("tenant-metrics-tabs");function lo({to:e,active:t,memory:a}){return(0,n.jsx)("div",{className:ll("link-container",{active:t}),children:(0,n.jsx)(s6.N_,{to:e,className:ll("link"),children:(0,n.jsx)(lr,{text:i1("context_memory-used"),value:a.totalUsed,limit:a.totalLimit,legendFormatter:s7.cO,active:t,helpText:i1("context_memory-description")})})})}var lc=a(89250);let ld=(0,d.cn)("tenant-tab-card");function lu({active:e,children:t}){return(0,n.jsx)("div",{className:ld({active:e}),children:(0,n.jsx)(a_.Z,{className:ld("card-container",{active:e}),type:"container",view:e?"outlined":"raised",children:t})})}function lm({text:e,fillPercent:t,helpText:a,legendText:i,active:s}){let{status:l,percents:o,fill:c}=r.useMemo(()=>(0,lt.v)({fillWidth:t,percentPrecision:1}),[t]);return(0,n.jsx)(lu,{active:s,children:(0,n.jsxs)(tC.s,{gap:3,alignItems:"center",children:[(0,n.jsx)(s8.e,{size:"small",status:l,fillWidth:c,className:ld("doughnut"),children:(0,n.jsx)(s8.e.Value,{variant:"subheader-1",children:o})}),(0,n.jsxs)("div",{className:ld("legend-wrapper"),children:[(0,n.jsx)(s8.e.Legend,{variant:"subheader-2",children:i}),(0,n.jsx)(s8.e.Legend,{variant:"body-1",color:"secondary",note:a,noteIconSize:"s",children:e})]})]})})}let lp=(0,d.cn)("tenant-metrics-tabs");function lh({to:e,active:t,networkUtilization:a,networkThroughput:r}){let i=(0,lc.z3)({value:r,withSpeedLabel:!0});return(0,n.jsx)("div",{className:lp("link-container",{active:t}),children:(0,n.jsx)(s6.N_,{to:e,className:lp("link"),children:(0,n.jsx)(lm,{text:i1("context_network-usage"),fillPercent:100*a,legendText:i,active:t,helpText:i1("context_network-description")})})})}let lg=(0,d.cn)("tenant-metrics-tabs");function lx(){return(0,n.jsx)("div",{className:lg("link-container",{placeholder:!0}),children:(0,n.jsx)("div",{className:lg("link"),children:(0,n.jsx)(le,{text:S.en,active:!1,helpText:void 0,subtitle:S.en})})})}let ly=(0,d.cn)("tenant-metrics-tabs");function lb({to:e,active:t,isServerless:a,storage:r,storageGroupsCount:i}){let s=void 0===i||a?i1("cards.storage-label"):i1("context_storage-groups",{count:i});return(0,n.jsx)("div",{className:ly("link-container",{active:t}),children:(0,n.jsx)(s6.N_,{to:e,className:ly("link"),children:a?(0,n.jsx)(le,{text:s,active:t,helpText:i1("context_storage-description"),subtitle:r.totalLimit?i1("context_serverless-storage-subtitle",{groups:String(i??0),legend:(0,s7.cO)({value:r.totalUsed,capacity:r.totalLimit})}):void 0}):(0,n.jsx)(lr,{text:s,value:r.totalUsed,limit:r.totalLimit,legendFormatter:s7.cO,active:t,helpText:i1("context_storage-description")})})})}let lf=(0,d.cn)("tenant-metrics-tabs");function lv({poolsCpuStats:e,memoryStats:t,blobStorageStats:a,tabletStorageStats:i,networkUtilization:s,networkThroughput:l,storageGroupsCount:o,databaseType:c,activeTab:d}){let u=(0,M.zy)(),m=(0,O.mA)(u),p={[j.pA.cpu]:(0,O.YL)({...m,[q.vh.metricsTab]:j.pA.cpu}),[j.pA.storage]:(0,O.YL)({...m,[q.vh.metricsTab]:j.pA.storage}),[j.pA.memory]:(0,O.YL)({...m,[q.vh.metricsTab]:j.pA.memory}),[j.pA.network]:(0,O.YL)({...m,[q.vh.metricsTab]:j.pA.network})},h=r.useMemo(()=>(e||[]).filter(e=>"Batch"!==e.name&&"IO"!==e.name),[e]),g=r.useMemo(()=>s5(h),[h]),x=r.useMemo(()=>i||a||[],[i,a]),y=r.useMemo(()=>s5(x),[x]),b=r.useMemo(()=>s5(t),[t]),[f]=(0,_.iK)(s3.GS.SHOW_NETWORK_UTILIZATION),v="Serverless"===c;return(0,n.jsxs)(tC.s,{className:lf({serverless:!!v}),alignItems:"center",children:[(0,n.jsx)(ls,{to:p[j.pA.cpu],active:d===j.pA.cpu,isServerless:!!v,cpu:{totalUsed:g.totalUsed,totalLimit:g.totalLimit}}),(0,n.jsx)(lb,{to:p[j.pA.storage],active:d===j.pA.storage,isServerless:!!v,storage:{totalUsed:y.totalUsed,totalLimit:y.totalLimit},storageGroupsCount:o}),v?(0,n.jsx)(lx,{}):(0,n.jsx)(lo,{to:p[j.pA.memory],active:d===j.pA.memory,memory:{totalUsed:b.totalUsed,totalLimit:b.totalLimit}}),f&&void 0!==s&&void 0!==l&&isFinite(s)&&isFinite(l)?v?(0,n.jsx)(lx,{}):(0,n.jsx)(lh,{to:p[j.pA.network],active:d===j.pA.network,networkUtilization:s,networkThroughput:l}):null]})}var lj=a(94084),lT=JSON.parse('{"action_see-all":"See all"}');let lw=(0,en.g4)("ydb-see-all-button",{en:lT});function lS({to:e,className:t,onClick:a}){return(0,n.jsx)(R.E,{className:t,to:e,onClick:a,children:(0,n.jsxs)(tC.s,{alignItems:"center",gap:1,children:[(0,n.jsx)(tE.E,{children:lw("action_see-all")}),(0,n.jsx)(tI.I,{data:lj.A,size:16})]})})}let l_=(0,d.cn)("ydb-stats-wrapper");function lN({children:e,className:t,title:a,description:r,allEntitiesLink:i,onAllEntitiesClick:s}){return(0,n.jsxs)(tC.s,{className:l_(null,t),gap:2,direction:"column",children:[(0,n.jsxs)(tC.s,{justifyContent:"space-between",wrap:"nowrap",className:l_("header"),children:[(0,n.jsxs)(tC.s,{direction:"column",children:[(0,n.jsx)(tE.E,{variant:"subheader-2",children:a}),r&&(0,n.jsx)(tE.E,{color:"secondary",children:r})]}),i&&(0,n.jsx)(lS,{to:i,onClick:s})]}),e]})}let lE=(0,d.cn)("ydb-tenant-dashboard"),lC=({database:e,charts:t})=>{let a=(0,al.iC)(),[i,s]=r.useState(!1),l=r.useMemo(()=>!a&&!i,[a,i]),[o]=(0,_.Nt)(),c=l?0:o;if(!1===a)return null;let d=e=>{"success"===e&&s(!0)},u=1===t.length?872:428,m=428/1.5;return(0,n.jsx)("div",{className:lE(null),style:{display:l?"none":void 0},children:(0,n.jsx)("div",{className:lE("charts"),children:t.map((t,a)=>(0,n.jsx)(sh,{database:e,metrics:t.metrics,chartOptions:t.options,autorefresh:c,width:u,height:m,onChartDataStatusChange:d,isChartVisible:!l,title:t.title},a))})})};var lA=a(65943),lI=a(87669),lP=a(75043),lk=a(36712);let lD=(0,d.cn)("tenant-overview");function lR({title:e,error:t,loading:a,tableClassNameModifiers:i={},withData:s,children:l}){return(0,n.jsxs)(r.Fragment,{children:[e&&(0,n.jsx)("div",{className:lD("title"),children:e}),t?(0,n.jsx)(e$.o,{error:t}):null,(0,n.jsx)("div",{className:lD("table",i),children:t&&!s?null:a?(0,n.jsx)(td.Q,{rows:S.Nz}):l})]})}function lM({database:e}){var t;let a,r,i,[s]=(0,_.Nt)(),[l,o]=(t={database:e},a={...(0,lA.Nh)(t),width:void 0},i=(r=[(0,lA.kv)(),(0,lA._E)(),a]).map(e=>e.name),[r,(0,lk.R)(i,lI.fN)]),{currentData:c,isFetching:d,error:u}=lP.s.useGetNodesQuery({tenant:e,type:"any",sort:"-CPU",limit:S.Nz,tablets:!1,fieldsRequired:o},{pollingInterval:s}),m=d&&void 0===c,p=c?.nodes||[];return(0,n.jsx)(lR,{loading:m,error:u,withData:!!c,children:(0,n.jsx)(tc.l,{columnsWidthLSKey:lI.zO,data:p,columns:l,emptyDataMessage:i1("top-nodes.empty-data"),settings:S.jp})})}function lO({database:e}){var t;let a,r,i,[s]=(0,_.Nt)(),[l,o]=(t={database:e},a={...(0,lA.Nh)(t),width:void 0},i=(r=[(0,lA.fR)(),(0,lA._E)(),a,(0,lA.Rn)()]).map(e=>e.name),[r,(0,lk.R)(i,lI.fN)]),{currentData:c,isFetching:d,error:u}=lP.s.useGetNodesQuery({tenant:e,type:"any",sort:"-LoadAverage",limit:S.Nz,tablets:!1,fieldsRequired:o},{pollingInterval:s}),m=d&&void 0===c,p=c?.nodes||[];return(0,n.jsx)(lR,{loading:m,error:u,withData:!!c,children:(0,n.jsx)(tc.l,{columnsWidthLSKey:lI.zO,data:p,columns:l,emptyDataMessage:i1("top-nodes.empty-data"),settings:S.jp})})}var lq=a(43168),lL=a(2422),lz=a(85889),lF=a(90132),lQ=JSON.parse('{"description_copy":"Copy link to clipboard","description_copied":"Copied to clipboard"}');let lU=(0,en.g4)("ydb-copy-link-button",{en:lQ}),l$=(0,d.cn)("ydb-copy-link-button"),lG=e=>{let{size:t="m",hasTooltip:a=!0,status:r,closeDelay:i,title:s,...l}=e,o=s??lU("description_copy");return(0,n.jsx)(tA.m,{title:"success"===r?lU("description_copied"):o,disabled:!a,closeDelay:i,children:(0,n.jsx)(as.$,{view:"flat",size:t,...l,children:(0,n.jsx)(as.$.Icon,{className:l$("icon"),children:(0,n.jsx)(tI.I,{data:lz.A,size:16})})})})};function lB(e){let{text:t,...a}=e,i=r.useRef(),[s,l]=r.useState(void 0),[o,c]=r.useState(!1);r.useEffect(()=>window.clearTimeout(i.current),[]);let d=r.useCallback(()=>{c(!1),l(1200),window.clearTimeout(i.current),i.current=window.setTimeout(()=>{c(!0)},1e3)},[1200]);return(0,n.jsx)(lF.$,{text:t,timeout:1200,onCopy:d,children:e=>(0,n.jsx)(lG,{...a,closeDelay:s,hasTooltip:!o,status:e})})}var lH=a(40961);function lW({container:e,children:t,disablePortal:a}){return a?(0,n.jsx)(r.Fragment,{children:t}):e?lH.createPortal(t,e):null}function lV(e,t,a){return Math.min(a,Math.max(t,e))}a(4467);let lJ="drawer-width",lK=(0,d.cn)("ydb-drawer"),lY=({isVisible:e,onClose:t,children:a,drawerId:i="drawer",storageKey:s=lJ,defaultWidth:l,direction:c="right",className:d,detectClickOutside:m=!1,isPercentageWidth:p,hideVeil:h=!0})=>{let[g,x]=(0,u.i)(s),[y,b]=r.useState(void 0),f=r.useRef(null),{containerWidth:v,itemContainerRef:j}=(0,C.g)(),T=r.useMemo(()=>(function(e){let{savedWidthString:t,defaultWidth:a,isPercentageWidth:n,containerWidth:r,defaultPercents:i,defaultPx:s}=e,l=function(e){let{defaultWidth:t,isPercentageWidth:a,defaultPercents:n,defaultPx:r}=e;return void 0!==t?t:a?n:r}({defaultWidth:a,isPercentageWidth:n,defaultPercents:i,defaultPx:s});if(!(0,iA.kf)(t))return l;let o=Number(t);return Number.isFinite(o)?n?lV(o,1,100):o<1?l:r>0?Math.min(o,r):o:l})({savedWidthString:g,defaultWidth:l,isPercentageWidth:p,containerWidth:v,defaultPercents:60,defaultPx:600}),[v,l,p,g]),w=y??T,S=r.useMemo(()=>p&&v>0?Math.round(v*(w||60)/100):w||600,[v,p,w]);r.useEffect(()=>{if(!m)return;let a=a=>{!a._capturedInsideDrawer&&a.isTrusted&&e&&f.current&&!f.current.contains(a.target)&&t()};return document.addEventListener("click",a),()=>{document.removeEventListener("click",a)}},[e,t,m]);let _=r.useMemo(()=>(0,o.debounce)(e=>x(e),200),[x]);r.useEffect(()=>()=>{_.cancel()},[_]);let N=j?.current;return N?(0,n.jsx)(lW,{container:N,children:(0,n.jsx)(lL.f,{onEscape:t,onVeilClick:t,hideVeil:h,className:lK("container",d),children:(0,n.jsx)(lL.D,{id:i,visible:e,resizable:!0,maxResizeWidth:v,width:S,onResize:e=>{let t=function(e){let{resizedWidthPx:t,isPercentageWidth:a,containerWidth:n}=e;if(a&&n>0){let e=lV(Math.round(t/n*100),1,100);return{drawerWidth:e,savedWidthString:e.toString()}}let r=Math.max(1,n>0?Math.min(t,n):t);return{drawerWidth:r,savedWidthString:r.toString()}}({resizedWidthPx:e,isPercentageWidth:p,containerWidth:v});b(t.drawerWidth),_(t.savedWidthString)},direction:c,className:lK("item"),ref:m?f:void 0,children:(0,n.jsx)("div",{className:lK("click-handler"),onClickCapture:e=>{e.nativeEvent._capturedInsideDrawer=!0},children:a})})})}):null},lZ=({children:e,renderDrawerContent:t,isDrawerVisible:a,onCloseDrawer:i,drawerId:s,storageKey:l,defaultWidth:o,direction:c,className:d,detectClickOutside:u,isPercentageWidth:m,drawerControls:p=[],title:h,headerClassName:g,hideVeil:x})=>(r.useEffect(()=>()=>{i()},[i]),(0,n.jsxs)(r.Fragment,{children:[e,(0,n.jsx)(lY,{hideVeil:x,isVisible:a,onClose:i,drawerId:s,storageKey:l,defaultWidth:o,direction:c,className:d,detectClickOutside:u,isPercentageWidth:m,children:a?(0,n.jsxs)("div",{className:lK("content-wrapper"),children:[(()=>{let e=[];for(let t of p)switch(t.type){case"close":e.push((0,n.jsx)(tA.m,{title:"Close",children:(0,n.jsx)(as.$,{view:"flat",onClick:i,children:(0,n.jsx)(tI.I,{data:lq.A,size:16})})},"close"));break;case"copyLink":e.push((0,n.jsx)(lB,{text:t.link},"copyLink"));break;case"custom":e.push((0,n.jsx)(r.Fragment,{children:t.node},t.key))}return(0,n.jsxs)(tC.s,{justifyContent:"space-between",alignItems:"center",className:lK("header-wrapper",g),children:[(0,n.jsx)(tE.E,{variant:"subheader-2",children:h}),(0,n.jsx)(tC.s,{className:lK("controls"),children:e})]})})(),t()]}):null})]}));var lX=a(58701),l0=a(52566),l1=a.n(l0);let l2=e=>(l1().str(e)>>>0).toString(16).toUpperCase().padStart(8,"0"),l3={...S.N3,dynamicRenderType:"simple"};var l4=JSON.parse('{"cpu-time":"CPU Time","read-rows":"Read Rows","read-bytes":"Read Bytes","query-hash":"Query Hash","user":"User","start-time":"Start time","end-time":"End time","duration":"Duration","query-text":"Query text","application":"Application","request-units":"Request Units"}');let l5=(0,en.g4)("ydb-top-queries-columns",{en:l4}),l6={...l3,disableSortReset:!0,externalSort:!0,dynamicRenderType:"uniform"};var l7=JSON.parse('{"no-data":"No data","filter.text.placeholder":"Search by query text or userSID...","mode_top":"Top","mode_running":"Running","timeframe_hour":"Per hour","timeframe_minute":"Per minute","query-details.title":"Query","query-details.open-in-editor":"Open in Editor","query-details.close":"Close","query-details.query.title":"Query Text","query-details.not-found.title":"Not found","query-details.not-found.description":"This query no longer exists"}');let l8=(0,en.g4)("ydb-diagnostics-top-queries",{en:l7}),l9=e=>(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:100,height:100,viewBox:"0 0 100 100",...e,children:(0,n.jsxs)("g",{fill:"none",fillRule:"evenodd",children:[(0,n.jsxs)("g",{fill:"currentColor",fillRule:"nonzero",children:[(0,n.jsx)("path",{d:"M72.844 36.587a1 1 0 0 1 1.414.017c2.607 2.67 4.53 5.866 5.672 9.573C84.845 62.124 74.557 73 50 73S15.155 62.124 20.07 46.177c1.122-3.641 2.998-6.79 5.535-9.432a1 1 0 0 1 1.442 1.386c-2.323 2.418-4.036 5.296-5.066 8.635C17.502 61.297 26.681 71 50 71s32.498-9.703 28.019-24.234c-1.048-3.4-2.805-6.32-5.192-8.765a1 1 0 0 1 .017-1.414"}),(0,n.jsx)("path",{d:"M84.876 52.008a1 1 0 0 1 .363 1.963l-.115.021-8 1a1 1 0 0 1-.363-1.963l.115-.021zm-8.838 5.717a1 1 0 0 1 1.123-.712l.114.025 7 2a1 1 0 0 1-.436 1.95l-.114-.026-7-2a1 1 0 0 1-.687-1.237M15.128 52.008a1 1 0 0 0-.37 1.962l.114.022 7.733 1a1 1 0 0 0 .371-1.962l-.115-.022zM23.425 57.715a1 1 0 0 0-1.13-.7l-.114.026-6.732 2a1 1 0 0 0 .455 1.944l.114-.026 6.733-2a1 1 0 0 0 .674-1.244M69.857 19.01a1 1 0 0 1 .951.401c3.511 4.821 4.55 11.746 3.18 20.74a1 1 0 1 1-1.977-.302c1.241-8.148.416-14.366-2.42-18.683l-.051-.075-.093.018c-4.025.803-7.448 3.451-10.29 8.011l-.243.396a1 1 0 0 1-1.074.46Q53.445 29 50 29q-3.444-.001-7.84.976a1 1 0 0 1-1.074-.46c-2.807-4.666-6.193-7.42-10.18-8.331l-.447-.094-.05.075c-2.771 4.219-3.623 10.253-2.502 18.13l.082.553a1 1 0 1 1-1.978.302c-1.37-8.994-.33-15.919 3.18-20.74a1 1 0 0 1 .952-.4c4.84.7 8.902 3.617 12.161 8.678l.117.184.6-.12q3.507-.69 6.449-.748L50 27q3.152 0 6.98.753l.598.12.118-.184c3.176-4.931 7.114-7.827 11.79-8.62z"})]}),(0,n.jsx)("path",{fill:"currentColor",fillRule:"nonzero",d:"m36.744 52.332.185.21q.214.248.47.56c.484.59.968 1.222 1.421 1.873.47.673.88 1.33 1.216 1.959.617 1.158.964 2.185.964 3.09C41 62.774 38.76 65 36 65s-5-2.226-5-4.976c0-.905.347-1.932.964-3.09.336-.63.746-1.286 1.216-1.959a30 30 0 0 1 2.076-2.643 1 1 0 0 1 1.488 0M36 54.552c-.404.5-.804 1.028-1.18 1.567a18 18 0 0 0-1.09 1.756c-.478.894-.73 1.641-.73 2.15C33 61.665 34.342 63 36 63s3-1.334 3-2.976c0-.508-.252-1.255-.73-2.15a18 18 0 0 0-1.09-1.755A28 28 0 0 0 36 54.552m10.769 10.087a1 1 0 1 1-1.538-1.278C46.473 61.868 48.172 61 50 61s3.527.868 4.769 2.36a1 1 0 1 1-1.538 1.28C52.355 63.585 51.208 63 50 63s-2.355.586-3.231 1.64m-15.114-14a1 1 0 0 1 .69-1.878c.724.266 1.587.413 2.495.413 1.456 0 2.775-.38 3.557-.972a1 1 0 1 1 1.206 1.596c-1.156.874-2.897 1.376-4.763 1.376-1.14 0-2.235-.186-3.185-.536m28.742-.841a1 1 0 1 1 1.206-1.596c.782.592 2.101.972 3.558.972.908 0 1.77-.147 2.494-.413a1 1 0 1 1 .69 1.877c-.95.35-2.045.536-3.184.536-1.867 0-3.608-.502-4.764-1.376"})]})}),oe=(0,d.cn)("kv-top-queries"),ot=({onClose:e})=>(0,n.jsxs)(tC.s,{justifyContent:"center",alignItems:"center",direction:"column",className:oe("not-found-container"),children:[(0,n.jsx)(tI.I,{data:l9,size:100}),(0,n.jsx)(tE.E,{variant:"subheader-2",className:oe("not-found-title"),children:l8("query-details.not-found.title")}),(0,n.jsx)(tE.E,{variant:"body-1",color:"complementary",className:oe("not-found-description"),children:l8("query-details.not-found.description")}),(0,n.jsx)(as.$,{size:"m",view:"normal",className:oe("not-found-close"),onClick:e,children:l8("query-details.close")})]});var oa=a(48448);let on=(0,d.cn)("ydb-query-details"),or=({queryText:e,infoItems:t,onOpenInEditor:a})=>(0,n.jsx)(tC.s,{direction:"column",className:on(),children:(0,n.jsxs)(tC.s,{direction:"column",className:on("content"),children:[(0,n.jsx)(nH.z_,{info:t}),(0,n.jsxs)("div",{className:on("query-content"),children:[(0,n.jsxs)("div",{className:on("query-header"),children:[(0,n.jsx)("div",{className:on("query-title"),children:l8("query-details.query.title")}),(0,n.jsxs)(as.$,{view:"flat-secondary",size:"m",onClick:a,className:on("editor-button"),children:[(0,n.jsx)(tI.I,{data:oa.A,size:16}),l8("query-details.open-in-editor")]})]}),(0,n.jsx)(rh.YDBSyntaxHighlighter,{language:"yql",text:e,withClipboardButton:{alwaysVisible:!0,withLabel:!1}})]})]})}),oi=({row:e,onClose:t})=>{let a=(0,_.YQ)(),i=(0,M.zy)(),s=(0,M.W6)(),l=r.useCallback(()=>{if(e){let t=e.QueryText;a((0,lX.iZ)({input:t})),a((0,lX.Xb)(!1));let n=(0,O.mA)(i),r=(0,O.YL)({...n,[j.Dt]:j.Dg.query,[q.vh.queryTab]:j.tQ.newQuery});s.push(r)}},[a,s,i,e]);if(e){let t;return(0,n.jsx)(or,{queryText:e.QueryText,infoItems:(t=[],e.QueryText&&t.push({label:l5("query-hash"),value:l2(String(e.QueryText))}),void 0!==e.CPUTimeUs&&t.push({label:l5("cpu-time"),value:(0,tM.Xo)((0,tM.Jc)(e.CPUTimeUs??void 0))}),void 0!==e.Duration&&t.push({label:l5("duration"),value:(0,tM.Xo)((0,tM.Jc)(e.Duration??void 0))}),void 0!==e.ReadBytes&&t.push({label:l5("read-bytes"),value:(0,eW.ZV)(e.ReadBytes)}),void 0!==e.RequestUnits&&t.push({label:l5("request-units"),value:(0,eW.ZV)(e.RequestUnits)}),e.EndTime&&t.push({label:l5("end-time"),value:(0,eW.r6)(new Date(e.EndTime).getTime())}),void 0!==e.ReadRows&&t.push({label:l5("read-rows"),value:(0,eW.ZV)(e.ReadRows)}),e.UserSID&&t.push({label:l5("user"),value:e.UserSID}),e.ApplicationName&&t.push({label:l5("application"),value:e.ApplicationName}),e.QueryStartAt&&t.push({label:l5("start-time"),value:(0,eW.r6)(new Date(e.QueryStartAt).getTime())}),t),onOpenInEditor:l})}return(0,n.jsx)(ot,{onClose:t})},os=(0,d.cn)("kv-top-queries");function ol({columns:e,data:t,isFetching:a,isLoading:i,onRowClick:s,columnsWidthLSKey:l,emptyDataMessage:c,sortOrder:d,onSort:u,selectedRow:m,onSelectedRowChange:p,drawerControls:h,drawerId:g="query-details",storageKey:x="kv-top-queries-drawer-width",tableSettings:y=l6}){let[b,f]=r.useState(void 0),v=void 0===m?b:m,j=p||f,T=r.useCallback(()=>{j(void 0)},[j]),w=void 0!==v,S=r.useCallback((e,t,a)=>{a?.stopPropagation(),j(e),s?.(e,t,a)},[s,j]),_=r.useCallback(()=>(0,n.jsx)(oi,{row:v,onClose:T}),[v,T]),N=r.useMemo(()=>[{type:"close"}],[]);return(0,n.jsx)(lZ,{isDrawerVisible:w,onCloseDrawer:T,renderDrawerContent:_,drawerId:g,storageKey:x,detectClickOutside:!0,isPercentageWidth:!0,title:l8("query-details.title"),drawerControls:h||N,children:(0,n.jsx)(tc.l,{emptyDataMessage:c||l8("no-data"),columnsWidthLSKey:l,columns:e,data:t,isFetching:a,isLoading:i,settings:y,onRowClick:S,rowClassName:e=>os("row",{active:(0,o.isEqual)(e,v)}),sortOrder:d,onSort:u})})}let oo=(0,d.cn)("ydb-fixed-height-query"),oc=({value:e="",lines:t=4,hasClipboardButton:a,clipboardButtonAlwaysVisible:r,mode:i="fixed"})=>{let s=`${20*t+0}px`,l=e.replace(/^(\s*\n)+/,"");return(0,n.jsx)("div",{className:oo(),style:{..."fixed"===i?{height:s}:{maxHeight:s},"--line-clamp":t},children:(0,n.jsx)(rh.YDBSyntaxHighlighter,{language:"yql",text:l,withClipboardButton:a?{alwaysVisible:r,copyText:e,withLabel:!1,size:"xs"}:void 0})})},od="topQueriesColumnsWidth",ou="CPUTime",om="QueryText",op="ReadRows",oh="ReadBytes",og="UserSID",ox="Duration",oy="QueryStartAt",ob="ApplicationName",of=["QueryHash","CPUTime","QueryText","EndTime","Duration","ReadRows","ReadBytes","RequestUnits","UserSID"],ov=["CPUTime","QueryText"],oj=["QueryHash","UserSID","QueryStartAt","QueryText","ApplicationName"],oT=["QueryStartAt","QueryText"],ow={get CPUTime(){return l5("cpu-time")},get QueryText(){return l5("query-text")},get EndTime(){return l5("end-time")},get ReadRows(){return l5("read-rows")},get ReadBytes(){return l5("read-bytes")},get UserSID(){return l5("user")},get OneLineQueryText(){return l5("query-text")},get QueryHash(){return l5("query-hash")},get Duration(){return l5("duration")},get QueryStartAt(){return l5("start-time")},get ApplicationName(){return l5("application")},get RequestUnits(){return l5("request-units")}},oS={CPUTime:"CPUTimeUs",QueryText:void 0,EndTime:void 0,ReadRows:void 0,ReadBytes:"ReadBytes",UserSID:void 0,OneLineQueryText:void 0,QueryHash:void 0,Duration:"Duration",QueryStartAt:void 0,ApplicationName:void 0,RequestUnits:"RequestUnits"},o_={CPUTime:void 0,QueryText:void 0,EndTime:void 0,ReadRows:void 0,ReadBytes:void 0,UserSID:"UserSID",OneLineQueryText:void 0,QueryHash:void 0,Duration:void 0,QueryStartAt:"QueryStartAt",ApplicationName:"ApplicationName",RequestUnits:void 0};function oN(e){return oS[e]}function oE(e){return o_[e]}let oC=(0,d.cn)("kv-top-queries"),oA={name:ou,header:ow.CPUTime,render:({row:e})=>(0,tM.Xo)((0,tM.Jc)(e.CPUTimeUs??void 0)),width:120,align:tX.Ay.RIGHT},oI={name:om,header:ow.QueryText,render:({row:e})=>(0,n.jsx)("div",{className:oC("query"),children:(0,n.jsx)(oc,{value:e.QueryText?.toString(),lines:3,hasClipboardButton:!0})}),width:500},oP={name:om,header:ow.QueryText,render:({row:e})=>(0,n.jsx)("div",{className:oC("query"),children:(0,n.jsx)(oc,{value:e.QueryText?.toString(),lines:6,hasClipboardButton:!0,mode:"max"})}),width:500},ok={name:"EndTime",header:ow.EndTime,render:({row:e})=>(0,eW.r6)(new Date(e.EndTime).getTime()),align:tX.Ay.RIGHT,width:200},oD={name:op,header:ow.ReadRows,render:({row:e})=>(0,eW.ZV)(e.ReadRows),align:tX.Ay.RIGHT,width:150},oR={name:oh,header:ow.ReadBytes,render:({row:e})=>(0,eW.ZV)(e.ReadBytes),align:tX.Ay.RIGHT,width:150},oM={name:og,header:ow.UserSID,render:({row:e})=>(0,n.jsx)("div",{className:oC("user-sid"),children:e.UserSID||nu.Pd}),align:tX.Ay.LEFT,width:120},oO={name:"QueryHash",header:ow.QueryHash,render:({row:e})=>l2(String(e.QueryText)),width:130},oq={name:ox,header:ow.Duration,render:({row:e})=>(0,tM.Xo)((0,tM.Jc)(e.Duration??void 0)),align:tX.Ay.RIGHT,width:150},oL={name:oy,header:ow.QueryStartAt,render:({row:e})=>(0,eW.r6)(new Date(e.QueryStartAt).getTime()),resizeable:!1,width:160},oz={name:"RequestUnits",header:ow.RequestUnits,render:({row:e})=>(0,eW.ZV)(e.RequestUnits),align:tX.Ay.RIGHT,width:150},oF={name:ob,header:ow.ApplicationName,render:({row:e})=>(0,n.jsx)("div",{className:oC("user-sid"),children:e.ApplicationName||nu.Pd})},oQ={encode:e=>{if(null!=e&&Array.isArray(e))return encodeURIComponent(JSON.stringify(e))},decode:e=>{if("string"!=typeof e||!e)return[];try{return JSON.parse(decodeURIComponent(e))}catch{return[]}}};function oU(e){let{paramName:t,schema:a,defaultSort:n}=e,[i,s]=(0,tL.useQueryParam)(t,oQ);return{sortParam:r.useMemo(()=>{if(!i||!Array.isArray(i)||0===i.length)return[n];let e=i.filter(e=>{try{return a.parse(e.columnId),!0}catch{return!1}});return e.length?e:[n]},[i,a,n]),updateSortParam:r.useCallback(e=>{s(e||[],"replaceIn")},[s])}}let o$=tz.z.enum([ou,ox,op,oh,om]).catch(ou),oG={columnId:ou,order:tX.Ay.DESCENDING};function oB(){let{sortParam:e,updateSortParam:t}=oU({paramName:"topSort",schema:o$,defaultSort:oG}),[a,n]=(0,_.GY)({initialSortColumn:e?.[0]?.columnId||oG.columnId,initialSortOrder:e?.[0]?.order||oG.order,multiple:!0,fixedOrderType:tX.Ay.DESCENDING,onSort:t});return{tableSort:a,handleTableSort:n,backendSort:r.useMemo(()=>(0,_.JN)(a,oN),[a])}}let oH=[oO,oP,oA];function oW({database:e}){let[t]=(0,_.Nt)(),{backendSort:a}=oB(),{currentData:r,isFetching:i,error:s}=sS.Ke.useGetTopQueriesQuery({database:e,timeFrame:"hour",limit:S.Nz,sortOrder:a},{pollingInterval:t}),l=i&&void 0===r,o=r?.resultSets?.[0]?.result||[];return(0,n.jsx)(lR,{loading:l,error:(0,tH.Cb)(s),withData:!!r,children:(0,n.jsx)(ol,{columnsWidthLSKey:od,data:o,columns:oH,tableSettings:S.jp,drawerId:"tenant-overview-query-details",storageKey:"tenant-overview-queries-drawer-width"})})}var oV=a(28904),oJ=a(8747);let oK=b.F.injectEndpoints({endpoints:e=>({getTopShards:e.query({queryFn:async({database:e,databaseFullPath:t},{signal:a})=>{try{let n=await window.api.viewer.sendQuery({query:(0,oJ.Q7)({databaseFullPath:t,path:t,selectFields:["Path","TabletId","CPUCores"],sortOrder:[{columnId:"CPUCores",order:-1}],limit:S.Nz}),database:e,action:"execute-query",internal_call:!0},{signal:a,withRetries:!0});if((0,tH.We)(n))return{error:n};return{data:(0,tH.fW)(n)}}catch(e){return{error:e||Error("Unauthorized")}}},providesTags:["All"]})}),overrideExisting:"throw"}),oY=["TabletId","Path","CPUCores"],oZ=({database:e,databaseFullPath:t})=>{let a=(0,oV.x)("ShardsTable"),[r]=(0,_.Nt)(),{currentData:i,isFetching:s,error:l}=oK.useGetTopShardsQuery({database:e,databaseFullPath:t},{pollingInterval:r}),o=s&&void 0===i,c=i?.resultSets?.[0]?.result||[];return(0,n.jsx)(lR,{loading:o,error:(0,tH.Cb)(l),withData:!!i,children:(0,n.jsx)(a,{data:c,databaseFullPath:t,columnsIds:oY,settings:S.jp})})},oX=[{title:i1("charts.cpu-usage"),metrics:["IC","IO","Batch","User","System"].map(e=>({target:`resources.cpu.${e}.usage`,title:e})),options:{dataType:"percent",scaleRange:{min:0,max:1},showLegend:!0}}];function o0({database:e,databaseType:t,databaseFullPath:a}){let i=(0,_.YQ)(),s=eM(),l=s(j.iJ.nodes),o=s(j.iJ.topShards),c=s(j.iJ.topQueries);return(0,n.jsxs)(tC.s,{direction:"column",gap:4,children:["Serverless"!==t&&(0,n.jsxs)(r.Fragment,{children:[(0,n.jsx)(lC,{database:e,charts:oX}),(0,n.jsx)(lN,{allEntitiesLink:l,title:i1("title_top-nodes-load"),children:(0,n.jsx)(lO,{database:e})}),(0,n.jsx)(lN,{title:i1("title_top-nodes-pool"),allEntitiesLink:l,children:(0,n.jsx)(lM,{database:e})})]}),(0,n.jsx)(lN,{title:i1("title_top-shards"),allEntitiesLink:o,children:(0,n.jsx)(oZ,{database:e,databaseFullPath:a})}),(0,n.jsx)(lN,{title:i1("title_top-queries"),allEntitiesLink:c,onAllEntitiesClick:()=>i((0,sS.TX)({from:void 0,to:void 0})),children:(0,n.jsx)(oW,{database:e})})]})}var o1=a(80865),o2=a(47037),o3=JSON.parse('{"alert_no-data":"No data","context_capacity-usage":"{{value}} of {{capacity}}"}');let o4=(0,en.g4)("progress-wrapper",{en:o3});function o5(e,t,a){return a<=0?String(e):o4("context_capacity-usage",{value:e,capacity:t})}function o6(e,t,a){if(a){let n=a(Number(e),Number(t));return[n[0],n[1]]}return[e,t]}function o7({children:e,displayText:t,withCapacityUsage:a=!1,className:r,width:i}){let s,l,o=(l=(s="full"===i)?0:Math.max(0,i||400),{width:s?"100%":`${l}px`,flex:s?"1":"none"});return(0,n.jsxs)(tC.s,{alignItems:"center",gap:"2",className:r,children:[(0,n.jsx)("div",{style:o,children:e}),a&&t&&(0,n.jsx)(tE.E,{variant:"body-1",color:"secondary",children:t})]})}function o8({value:e,capacity:t,formatValues:a=s4.g,className:i,width:s,size:l="s",withCapacityUsage:o=!1}){let c=(0,iA.y3)(e),d=(0,iA.y3)(t),u=Math.min(Math.max(0,d>0?Math.floor(c/d*100):100),100),[m,p]=r.useMemo(()=>o6(e,t,a),[a,e,t]),h=r.useMemo(()=>o5(m,p,d),[m,p,d]);return(0,iA.kf)(e)&&(0,iA.y3)(e)>=0?(0,n.jsx)(o7,{displayText:h,withCapacityUsage:o,className:i,width:s,children:(0,n.jsx)(o2.k,{value:u,theme:"success",size:l})}):(0,n.jsx)("div",{className:i,children:o4("alert_no-data")})}var o9=a(26552);function ce({stack:e,totalCapacity:t,formatValues:a=s4.g,className:i,width:s,size:l="s",withCapacityUsage:o=!1}){let c=r.useMemo(()=>e.filter(e=>!e.isInfo&&e.value>0),[e]),d=r.useMemo(()=>c.reduce((e,t)=>e+t.value,0),[c]),u=r.useMemo(()=>(0,iA.y3)(t),[t]),m=u||d,p=r.useMemo(()=>c.map(e=>({value:m>0?e.value/m*100:0,color:(0,o9.AB)(e.key),title:e.label})),[c,m]),[h,g]=r.useMemo(()=>o6(d,u||d,a),[a,d,u]),x=r.useMemo(()=>o5(h,g,u||0),[h,g,u]);return 0===c.length?(0,n.jsx)("div",{className:i,children:o4("alert_no-data")}):(0,n.jsx)(o7,{displayText:x,withCapacityUsage:o,className:i,width:s,children:(0,n.jsx)(o2.k,{value:100,stack:p,size:l})})}function ct(e){return"stack"in e&&e.stack?(0,n.jsx)(ce,{...e}):(0,n.jsx)(o8,{...e})}var ca=a(11342),cn=a(66918);let cr=(0,d.cn)("memory-details");function ci({segments:e,className:t}){return(0,n.jsx)(cn.u,{nameMaxWidth:200,responsive:!0,className:t,children:e.map(e=>{let t=(0,o9.AB)(e.key),[a,r]=(0,eW.vX)(e.value,e.capacity),i=e.capacity?o4("context_capacity-usage",{value:a,capacity:r}):a,s=e.capacity?e.value/e.capacity*100:100;return(0,n.jsx)(cn.u.Item,{name:(0,n.jsxs)(tC.s,{alignItems:"center",gap:"1",children:[(0,n.jsx)("div",{className:cr("segment-indicator"),style:{backgroundColor:t}}),(0,n.jsx)(tE.E,{variant:"body-1",color:"secondary",children:e.label})]}),children:(0,n.jsxs)(tC.s,{alignItems:"center",gap:"3",children:[(0,n.jsx)("div",{className:cr("segment-progress"),children:(0,n.jsx)("div",{style:{"--g-progress-filled-background-color":t},children:(0,n.jsx)(o2.k,{value:s,size:"s",className:cr("progress-bar")})})}),(0,n.jsx)(tE.E,{variant:"body-1",color:"secondary",children:i})]})},e.key)})})}let cs=(0,d.cn)("memory-details");function cl({memoryStats:e}){let t=r.useMemo(()=>void 0===e.AnonRss?(0,iA.y3)(e.AllocatedMemory)+(0,iA.y3)(e.AllocatorCachesMemory):(0,iA.y3)(e.AnonRss),[e.AnonRss,e.AllocatedMemory,e.AllocatorCachesMemory]),a=r.useMemo(()=>(0,o9.Sb)(e,t),[e,t]),i=r.useMemo(()=>a.filter(e=>!e.isInfo&&e.value>0),[a]),s=r.useCallback((e,t)=>(0,eW.vX)(e,t),[]);return(0,n.jsxs)(tC.s,{direction:"column",alignItems:"flex-start",gap:"3",children:[(0,n.jsx)("div",{className:cs("header"),children:(0,n.jsx)(tE.E,{variant:"body-1",className:cs("title"),children:(0,ca.A)("text_memory-details")})}),(0,n.jsxs)(tC.s,{direction:"column",alignItems:"flex-start",gap:"4",width:"100%",children:[(0,n.jsx)("div",{className:cs("main-progress"),children:(0,n.jsx)(ct,{stack:a,totalCapacity:e.HardLimit,formatValues:s,className:cs("main-progress-bar"),size:"m",width:"full"})}),(0,n.jsx)(ci,{segments:i,className:cs("memory-segments-list")})]})]})}function co({database:e}){var t;let a,r,[i]=(0,_.Nt)(),[s,l]=(t={database:e},r=(a=[(0,lA._E)(),(0,lA.Nh)(t),(0,lA.jl)(),(0,lA.fR)(),(0,lA.iX)(),(0,lA.oz)(),(0,lA.qp)(t)]).map(e=>e.name),[a,(0,lk.R)(r,lI.fN)]),{currentData:o,isFetching:c,error:d}=lP.s.useGetNodesQuery({tenant:e,type:"any",tablets:!0,sort:"-Memory",limit:S.Nz,fieldsRequired:l},{pollingInterval:i}),u=c&&void 0===o,m=o?.nodes||[];return(0,n.jsx)(lR,{loading:u,error:d,withData:!!o,children:(0,n.jsx)(tc.l,{columnsWidthLSKey:lI.zO,data:m,columns:s,emptyDataMessage:i1("top-nodes.empty-data"),settings:S.jp})})}let cc=[{title:i1("charts.memory-usage"),metrics:[{target:"resources.memory.used_bytes",title:i1("charts.memory-usage")}],options:{dataType:"size"}}],cd=(0,d.cn)("tenant-memory");function cu({database:e,memoryStats:t,memoryUsed:a,memoryLimit:r}){let i=(0,_.e4)();return(0,n.jsxs)("div",{className:cd(),children:[(0,n.jsx)(lC,{database:e,charts:cc}),t?(0,n.jsx)(cl,{memoryStats:t}):(0,n.jsx)(o1.z,{variant:"small",title:i1("title_memory-details"),info:[{label:i1("field_memory-usage"),value:(0,n.jsx)(ct,{value:a,capacity:r,formatValues:eW.vX,withCapacityUsage:!0,className:cd("fallback-progress-wrapper"),size:"m",width:400})}]}),(0,n.jsx)(lN,{title:i1("title_top-nodes-by-memory"),allEntitiesLink:(0,O.YL)({...i,[q.vh.diagnosticsTab]:j.iJ.nodes}),children:(0,n.jsx)(co,{database:e})})]})}function cm({database:e}){var t;let a,r,i,[s]=(0,_.Nt)(),[l,o]=(t={database:e},r=(a=[(0,lA._E)(),(0,lA.b8)(t),(0,lA.jl)(),(0,lA.wN)()]).map(e=>e.name),i=(0,lk.R)(r,lI.fN),[a.map(e=>({...e,sortable:!1})),i]),{currentData:c,isFetching:d,error:u}=lP.s.useGetNodesQuery({tenant:e,type:"any",sort:"-PingTime",limit:S.Nz,tablets:!1,fieldsRequired:o},{pollingInterval:s}),m=d&&void 0===c,p=c?.nodes||[];return(0,n.jsx)(lR,{loading:m,error:u,withData:!!c,children:(0,n.jsx)(tc.l,{columnsWidthLSKey:lI.zO,data:p,columns:l,emptyDataMessage:i1("top-nodes.empty-data"),settings:S.jp})})}function cp({database:e}){var t;let a,r,i,[s]=(0,_.Nt)(),[l,o]=(t={database:e},r=(a=[(0,lA._E)(),(0,lA.b8)(t),(0,lA.jl)(),(0,lA.pt)()]).map(e=>e.name),i=(0,lk.R)(r,lI.fN),[a.map(e=>({...e,sortable:!1})),i]),{currentData:c,isFetching:d,error:u}=lP.s.useGetNodesQuery({tenant:e,type:"any",sort:"-ClockSkew",limit:S.Nz,tablets:!1,fieldsRequired:o},{pollingInterval:s}),m=d&&void 0===c,p=c?.nodes||[];return(0,n.jsx)(lR,{loading:m,error:u,withData:!!c,children:(0,n.jsx)(tc.l,{columnsWidthLSKey:lI.zO,data:p,columns:l,emptyDataMessage:i1("top-nodes.empty-data"),settings:S.jp})})}let ch=(0,d.cn)("tenant-network");function cg({database:e}){let t=(0,_.e4)(),[a]=(0,_.iK)(s3.GS.ENABLE_NETWORK_TABLE),r=a?{[q.vh.diagnosticsTab]:j.iJ.network}:{[q.vh.diagnosticsTab]:j.iJ.nodes},i=(0,O.YL)({...t,...r});return(0,n.jsxs)(tC.s,{direction:"column",gap:4,className:ch(),children:[(0,n.jsx)(lN,{title:i1("title_nodes-by-ping"),allEntitiesLink:i,children:(0,n.jsx)(cm,{database:e})}),(0,n.jsx)(lN,{title:i1("title_nodes-by-skew"),allEntitiesLink:i,children:(0,n.jsx)(cp,{database:e})})]})}var cx=a(65615),cy=a(15491),cb=a(38512);function cf({tenant:e}){let t,a,r=(0,al.Pm)(),i=(0,al.YA)(),[s]=(0,_.Nt)(),[l,o]=(a=(t=(0,cy.k)()).map(e=>e.name),[t,(0,lk.R)(a,cb.YX)]),{currentData:c,isFetching:d,error:u}=cx.S.useGetStorageGroupsInfoQuery({database:e,sort:"-Usage",with:"all",limit:S.Nz,shouldUseGroupsHandler:i,fieldsRequired:o},{pollingInterval:s,skip:!r}),m=d&&void 0===c,p=c?.groups||[];return(0,n.jsx)(lR,{loading:m||!r,error:u,withData:!!c,children:(0,n.jsx)(tc.l,{columnsWidthLSKey:cb.qK,data:p,columns:l,settings:S.jp})})}var cv=a(60908);let cj=b.F.injectEndpoints({endpoints:e=>({getTopTables:e.query({queryFn:async({database:e},{signal:t})=>{try{let a=await window.api.viewer.sendQuery({query:`${S.Zi}
SELECT
    Path, SUM(DataSize) as Size
FROM \`.sys/partition_stats\`
GROUP BY Path
ORDER BY Size DESC
LIMIT ${S.Nz}
`,database:e,action:"execute-query",internal_call:!0},{signal:t,withRetries:!0});if((0,tH.We)(a))return{error:a};return{data:(0,tH.fW)(a)}}catch(e){return{error:e||"Unauthorized"}}},providesTags:["All"]})}),overrideExisting:"throw"});function cT({database:e}){let[t]=(0,_.Nt)(),{currentData:a,error:i,isFetching:s}=cj.useGetTopTablesQuery({database:e},{pollingInterval:t}),l=s&&void 0===a,o=a?.resultSets?.[0]?.result||[],c=(0,a3.fn)(o?.length?Number(o[0].Size):0),d=r.useMemo(()=>[{name:"Size",width:100,render:({row:e})=>(0,a3.z3)({value:Number(e.Size),size:c,precision:1}),align:tX.Ay.RIGHT},{name:"Path",width:700,render:({row:e})=>e.Path?(0,n.jsx)(tk.s,{content:e.Path,children:(0,n.jsx)(cv.I,{path:String(e.Path),children:e.Path})}):null}],[c]);return(0,n.jsx)(lR,{loading:l,error:(0,tH.Cb)(i),withData:!!a,children:(0,n.jsx)(tc.l,{columnsWidthLSKey:"topTablesTableColumnsWidth",data:o,columns:d,settings:S.jp})})}let cw=[{title:i1("charts.storage-usage"),metrics:[{target:"resources.storage.used_bytes",title:i1("charts.storage-usage")}],options:{dataType:"size"}}];function cS({database:e,metrics:t,databaseType:a}){let{blobStorageUsed:r,tabletStorageUsed:i,blobStorageLimit:s,tabletStorageLimit:l}=t,o=(0,_.e4)(),c=[{label:(0,n.jsx)(np,{text:i1("storage.tablet-storage-title"),popoverContent:i1("storage.tablet-storage-description")}),value:(0,n.jsx)(ct,{value:i,capacity:l,formatValues:eW.j9,withCapacityUsage:!0})},{label:(0,n.jsx)(np,{text:i1("storage.db-storage-title"),popoverContent:i1("storage.db-storage-description")}),value:(0,n.jsx)(ct,{value:r,capacity:s,formatValues:eW.j9,withCapacityUsage:!0})}];return"Serverless"===a?(0,n.jsx)(tC.s,{direction:"column",gap:4,children:(0,n.jsx)(lN,{title:i1("title_top-tables-by-size"),allEntitiesLink:(0,O.YL)({...o,[q.vh.diagnosticsTab]:j.iJ.storage}),children:(0,n.jsx)(cT,{database:e})})}):(0,n.jsxs)(tC.s,{direction:"column",gap:4,children:[(0,n.jsx)(lC,{database:e,charts:cw}),(0,n.jsx)(o1.z,{variant:"small",title:i1("title_storage-details"),info:c}),(0,n.jsx)(lN,{title:i1("title_top-tables-by-size"),children:(0,n.jsx)(cT,{database:e})}),(0,n.jsx)(lN,{title:i1("title_top-groups-by-usage"),allEntitiesLink:(0,O.YL)({...o,[q.vh.diagnosticsTab]:j.iJ.storage}),children:(0,n.jsx)(cf,{tenant:e})})]})}function c_({database:e,databaseFullPath:t,additionalTenantProps:a}){let{metricsTab:r}=(0,_.N4)(e=>e.tenant),[i]=(0,_.Nt)(),s=(0,sA.H)(),o=(0,x.kK)(),c=(0,_.YQ)(),{handleTenantPageChange:d}=(0,sk.H)(),u=(0,sI.e)(),{currentData:m,isFetching:p}=T.z6.useGetTenantInfoQuery({database:e,clusterName:s,isMetaDatabasesAvailable:u},{pollingInterval:i}),h=p&&void 0===m,{Name:g,Type:y,Overall:b}=m||{},v="Serverless"===y,w=v&&r!==j.pA.cpu&&r!==j.pA.storage?j.pA.cpu:r,N=y&&V[y],{currentData:E}=f.useGetOverviewQuery({path:t,database:e,databaseFullPath:t,useMetaProxy:o},{pollingInterval:i}),{Tables:C,Topics:A}=E?.PathDescription?.DomainDescription?.DiskSpaceUsage||{},I=[C?.TotalSize,A?.DataSize].reduce((e,t)=>t?e+Number(t):e,0),P={...m,Metrics:{...m?.Metrics,Storage:String(I)}},{blobStorage:D,tabletStorage:R,blobStorageLimit:M,tabletStorageLimit:O,poolsStats:q,memoryStats:L,blobStorageStats:z,tabletStorageStats:F,networkUtilization:Q,networkThroughput:U}=(0,sE.uI)(P),$={blobStorageUsed:D,blobStorageLimit:M,tabletStorageUsed:R,tabletStorageLimit:O},G=(0,sC.y)(a,g,y),{monitoring:B}=(0,x.Zd)(),H=(0,sP.P)(m?.ControlPlane,B);return(0,n.jsx)(l.r,{loading:h,children:(0,n.jsxs)("div",{className:lD(),children:[(0,n.jsxs)("div",{className:lD("info"),children:[(0,n.jsxs)(tC.s,{alignItems:"center",gap:"2",className:lD("top-label"),children:[N,H&&(0,n.jsxs)(as.$,{view:"normal",onClick:()=>{d(j.Dg.diagnostics),c((0,T.WO)(j.iJ.monitoring))},children:[(0,n.jsx)(tI.I,{data:iU.A,size:16}),i1("action_open-monitoring")]})]}),(0,n.jsxs)(tC.s,{alignItems:"center",gap:"1",className:lD("top"),children:[(0,n.jsxs)(tC.s,{alignItems:"center",style:{overflow:"hidden"},children:[(0,n.jsx)(i$.c,{status:b,name:g||S.oK,withLeftTrim:!0,hasClipboardButton:!!m,clipboardButtonAlwaysVisible:!0}),v?(0,n.jsx)("div",{className:lD("serverless-tag"),children:(0,n.jsx)(k.J,{theme:"clear",size:"s",className:lD("serverless-tag-label"),children:(0,n.jsxs)(tC.s,{alignItems:"center",gap:"2",children:[i1("value_serverless"),(0,n.jsx)(nm.H,{iconSize:"s",className:lD("serverless-tag-tooltip"),children:i1("context_serverless-tooltip")})]})})}):null]}),G.length>0&&(0,n.jsx)(tC.s,{gap:"2",children:G.map(({title:e,url:t,icon:a})=>(0,n.jsx)(as.$,{href:t,target:"_blank",size:"xs",title:e,children:(0,n.jsx)(tI.I,{data:a})},e))})]}),(0,n.jsxs)(tC.s,{direction:"column",gap:4,children:[!v&&(0,n.jsx)(s2,{database:e}),(0,n.jsx)(sN,{database:e}),(0,n.jsx)(lv,{poolsCpuStats:q,memoryStats:L,blobStorageStats:z,tabletStorageStats:F,networkUtilization:Q,networkThroughput:U,storageGroupsCount:P.StorageGroups?Number(P.StorageGroups):void 0,databaseType:y,activeTab:w})]})]}),(0,n.jsx)("div",{className:lD("tab-content"),children:(()=>{switch(w){case j.pA.cpu:return(0,n.jsx)(o0,{database:e,databaseType:y,databaseFullPath:t});case j.pA.storage:return(0,n.jsx)(cS,{database:e,metrics:$,databaseType:y});case j.pA.memory:return(0,n.jsx)(cu,{database:e,memoryUsed:P.MemoryUsed,memoryLimit:P.MemoryLimit,memoryStats:P.MemoryStats});case j.pA.network:return(0,n.jsx)(cg,{database:e});default:return null}})()})]})})}let cN=(0,d.cn)("kv-detailed-overview"),cE=function({type:e,database:t,databaseFullPath:a,path:r,additionalTenantProps:i}){let s=a===r,l=(0,nB.D)();return(0,n.jsx)("div",{className:cN(),children:s&&!l?(0,n.jsx)(c_,{database:t,databaseFullPath:a,additionalTenantProps:i}):(0,n.jsx)(iQ,{type:e,path:r,database:t,databaseFullPath:a})})},cC=b.F.injectEndpoints({endpoints:e=>({getHotKeys:e.query({queryFn:async({path:e,database:t,databaseFullPath:a,useMetaProxy:n},{signal:r})=>{try{let i=await window.api.viewer.getHotKeys({path:{path:e,databaseFullPath:a,useMetaProxy:n},database:t,enableSampling:!0},{signal:r});if(Array.isArray(i.hotkeys))return{data:i.hotkeys};return await Promise.race([new Promise(e=>{setTimeout(e,5e3)}),new Promise((e,t)=>{r.addEventListener("abort",t)})]),{data:(await window.api.viewer.getHotKeys({path:{path:e,databaseFullPath:a,useMetaProxy:n},database:t,enableSampling:!1},{signal:r})).hotkeys??null}}catch(e){return{error:e}}},providesTags:["All"]})}),overrideExisting:"throw"});var cA=JSON.parse('{"hot-keys-collecting":"Please wait a little while we are collecting hot keys samples...","no-data":"No information about hot keys","help":"Hot keys contains a list of table primary key values that are accessed most often. Sample is collected upon request to the tab during 5s time interval. Samples column indicates how many requests to the particular key value were registered during collection phase."}');let cI=(0,en.g4)("ydb-hot-keys",{en:cA}),cP=e=>(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 12 7",...e,children:(0,n.jsx)("path",{d:"M8 7h3V5h1V2H6.66C6.085.79 4.86 0 3.5 0 1.57 0 0 1.57 0 3.5S1.57 7 3.5 7c1.36 0 2.59-.79 3.16-2H8zm2-1H9V4H5.97l-.115.335a2.5 2.5 0 1 1 0-1.67L5.97 3H11v1h-1zM3.5 5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3M3 3.5a.5.5 0 1 1 1 0 .5.5 0 0 1-1 0"})}),ck=(0,d.cn)("ydb-hot-keys"),cD="accessSample";function cR({path:e,database:t,databaseFullPath:a}){let i=(0,x.kK)(),{currentData:s,isFetching:l,error:o}=cC.useGetHotKeysQuery({path:e,database:t,databaseFullPath:a,useMetaProxy:i}),c=l&&void 0===s,[d]=(0,_.Nt)(),{currentData:u,isLoading:m}=f.useGetOverviewQuery({path:e,database:t,databaseFullPath:a,useMetaProxy:i},{pollingInterval:d}),p=u?.PathDescription?.Table?.KeyColumnNames,h=r.useMemo(()=>((e=[])=>[...e.map((e,t)=>({name:e,header:(0,n.jsxs)("div",{className:ck("primary-key-column"),children:[(0,n.jsx)(tI.I,{data:cP,width:12,height:7}),e]}),render:({row:e})=>e.keyValues[t],align:tX.Ay.RIGHT,sortable:!1})),{name:cD,header:"Samples",render:({row:e})=>e.accessSample,align:tX.Ay.RIGHT,sortable:!1}])(p),[p]);return(0,n.jsxs)(r.Fragment,{children:[(0,n.jsx)(cM,{}),c||m?(0,n.jsx)("div",{children:cI("hot-keys-collecting")}):o?(0,n.jsx)(e$.o,{error:o}):s?(0,n.jsx)(tc.l,{wrapperClassName:ck("table"),columns:h,data:s,settings:S.N3,initialSortOrder:{columnId:cD,order:tX.Ay.DESCENDING}}):(0,n.jsx)("div",{children:cI("no-data")})]})}function cM(){let[e,t]=(0,_.iK)(s3.GS.IS_HOTKEYS_HELP_HIDDEN);return e?null:(0,n.jsxs)(a_.Z,{theme:"info",view:"filled",type:"container",className:ck("help-card"),children:[cI("help"),(0,n.jsx)(as.$,{className:ck("help-card__close-button"),view:"flat",onClick:()=>t(!0),children:(0,n.jsx)(tI.I,{data:lq.A,size:18})})]})}var cO=a(6390),cq=a(4858),cL=a(83129),cz=a(53808);let cF=b.F.injectEndpoints({endpoints:e=>({getNetworkInfo:e.query({queryFn:async({database:e,databaseFullPath:t,useMetaProxy:a},{signal:n})=>{try{return{data:await window.api.viewer.getNetwork({path:{path:t,databaseFullPath:t,useMetaProxy:a},database:e},{signal:n})}}catch(e){return{error:e}}},providesTags:["All"]})}),overrideExisting:"throw"});function cQ(){let[{withProblems:e},t]=(0,tL.useQueryParams)({withProblems:tL.BooleanParam});return{withProblems:!!e,handleWithProblemsChange:r.useCallback(e=>{t({withProblems:e||void 0},"replaceIn")},[t])}}var cU=JSON.parse('{"field_rack":"Rack","field_net":"Net","field_id":"ID","label_nodes":"{{type}} nodes","label_connectivity":"Connectivity of node","label_to-other-nodes":"to other nodes","label_racks":"Racks","description_placeholder":"Select node to see its connectivity to other nodes","description_no-nodes-data":"no nodes data"}');let c$=(0,en.g4)("ydb-tenant-diagnostics-network",{en:cU}),cG=e=>(0,n.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 221 204",...e,children:[(0,n.jsx)("path",{fill:"#EBF2FA",d:"M68.46 2.529v25.227c0 1.227.876 2.278 2.102 2.511 16.643 2.979 29.14 17.812 28.498 35.448-.642 18.045-15.359 32.703-33.345 33.403-17.636.643-32.41-11.854-35.448-28.44a2.56 2.56 0 0 0-2.51-2.102H2.528c-1.519 0-2.687 1.285-2.512 2.745 3.446 32.703 31.243 58.106 64.939 57.814 35.155-.292 63.829-29.024 64.121-64.18.292-33.695-25.17-61.492-57.873-64.938-1.46-.175-2.744.993-2.744 2.512"}),(0,n.jsx)("path",{fill:"#EBF2FA",d:"m22.736 18.354 17.811 17.812c.876.876 2.278.992 3.329.233 4.146-3.095 9.052-5.197 14.366-6.19 1.226-.233 2.102-1.226 2.102-2.511V2.528a2.502 2.502 0 0 0-2.803-2.51C44.46 1.418 32.488 6.674 22.91 14.674c-1.168.935-1.226 2.628-.175 3.68m-9.403 6.133C6.093 33.83 1.303 45.16.02 57.54c-.176 1.46 1.05 2.745 2.51 2.745H27.7a2.56 2.56 0 0 0 2.511-2.103c.818-4.672 2.628-9.051 5.14-12.847a2.64 2.64 0 0 0-.293-3.212L17.13 24.312c-1.05-1.11-2.861-.993-3.796.175m67.275 107.392h32.995c1.868 0 3.387 1.518 3.445 3.445v65.231a3.45 3.45 0 0 1-3.445 3.445H80.608a3.45 3.45 0 0 1-3.446-3.445v-65.231a3.45 3.45 0 0 1 3.446-3.445m77.844 27.097h-32.878a3.514 3.514 0 0 0-3.503 3.504v37.959a3.514 3.514 0 0 0 3.503 3.504h32.878a3.515 3.515 0 0 0 3.504-3.504V162.48a3.515 3.515 0 0 0-3.504-3.504m12.205 18.28h32.586a3.64 3.64 0 0 1 3.621 3.62v19.388a3.64 3.64 0 0 1-3.621 3.621h-32.586a3.64 3.64 0 0 1-3.62-3.621v-19.388a3.64 3.64 0 0 1 3.62-3.62"}),(0,n.jsx)("path",{stroke:"#2EE5C0",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:4,d:"M134.275 171.532h-113c-5.84 0-10.628-4.789-10.628-10.629v-73.23c0-5.84 4.788-10.629 10.628-10.629h112.941c5.84 0 10.629 4.789 10.629 10.629v73.23c.058 5.899-4.731 10.629-10.57 10.629"}),(0,n.jsx)("path",{fill:"#2EE5C0",d:"M21.625 90.769a3.037 3.037 0 1 0 0-6.074 3.037 3.037 0 0 0 0 6.074M31.494 90.769a3.037 3.037 0 1 0 0-6.074 3.037 3.037 0 0 0 0 6.074M41.363 90.769a3.037 3.037 0 1 0 0-6.074 3.037 3.037 0 0 0 0 6.074"}),(0,n.jsx)("path",{stroke:"#2EE5C0",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:4,d:"M10.822 98.592h133.673"}),(0,n.jsx)("path",{fill:"#027BF3",d:"M184.555 149.164 57.89 156.172c-4.263.234-7.767-3.037-7.767-7.3V51.114c0-4.263 3.504-7.533 7.767-7.3l126.665 7.008c3.27.176 5.898 3.33 5.898 7.008v84.327c0 3.679-2.628 6.832-5.898 7.007"}),(0,n.jsx)("path",{fill:"#fff",d:"M65.13 54.151c0 1.986-1.576 3.504-3.562 3.387-1.985-.058-3.562-1.752-3.562-3.737s1.635-3.504 3.562-3.387c1.927.058 3.562 1.752 3.562 3.737m11.506.466a3.38 3.38 0 0 1-3.504 3.388c-1.927-.059-3.504-1.753-3.504-3.68a3.38 3.38 0 0 1 3.504-3.387c1.927.117 3.504 1.752 3.504 3.68m7.825 3.855c1.869.117 3.387-1.402 3.387-3.329s-1.518-3.562-3.387-3.62c-1.927-.117-3.445 1.401-3.445 3.328s1.576 3.562 3.445 3.62"}),(0,n.jsx)("path",{fill:"#00236B",d:"M75.467 142.974V85.277c-3.971-.525-8.584-.409-13.899.7v57.64zM88.84 90.651v51.799l-11.096.467v-57.23c4.322.934 7.942 2.745 11.096 4.964m13.431 13.899a2 2 0 0 1-.146-.176 1.5 1.5 0 0 0-.146-.175q-.63-.765-1.265-1.546c-2.875-3.522-5.874-7.197-9.538-10.25v49.93l11.095-.467zm13.432 5.722c-3.913-.058-7.709-.701-11.096-3.445v34.922l11.096-.468zm13.431-.409c-2.764-.173-5.529.006-8.246.181-.957.062-1.907.123-2.849.169v30.951l11.095-.467zm24.002 29.841-8.234.35v-22.191c8.176 9.285 8.234 21.841 8.234 21.841M140.113 113.6a20 20 0 0 1 2.453 1.927v24.644l-11.096.467v-30.483c2.92.467 5.782 1.46 8.643 3.445"}),(0,n.jsx)("path",{fill:"#fff",d:"M55.745 76.436a2 2 0 1 0 3.123 2.499zm5.766-4.006 1.575-1.233a2 2 0 0 0-3.136-.017zm2.63 6.605a2 2 0 1 0 3.15-2.465zm107.94 53.502a2 2 0 0 0-2.499 3.123zm4.006 5.766 1.214 1.59a2 2 0 0 0 .036-3.151zm-6.644 2.557a1.999 1.999 0 1 0 2.427 3.179zM58.868 78.935l4.205-5.256-3.123-2.499-4.205 5.256zm1.068-5.273 4.205 5.373 3.15-2.465-4.205-5.373zm109.646 61.998 5.256 4.205 2.499-3.123-5.256-4.205zm5.292 1.054-5.431 4.146 2.427 3.179 5.431-4.146zM147.137 69.146a2 2 0 1 0-.149 3.998zm29.634 5.107a2 2 0 1 0 .149-3.997zm-29.657 5.404a2 2 0 0 0-.102 3.999zm29.681 4.758a2 2 0 0 0 .102-3.999zm-29.72 5.929a2 2 0 1 0-.023 4zm29.759 4.175a2 2 0 1 0 .024-4zm-29.846-21.375 29.783 1.11.149-3.998-29.783-1.11zm.024 10.512 29.783.76.102-4-29.783-.759zm.04 10.687 29.782.176.024-4-29.783-.175zM143.442 71.202a2.46 2.46 0 0 1-2.57 2.453c-1.401-.058-2.569-1.285-2.569-2.686s1.168-2.57 2.569-2.453c1.46.058 2.57 1.285 2.57 2.686m.001 10.396a2.46 2.46 0 0 1-2.57 2.453c-1.401-.059-2.569-1.285-2.569-2.686 0-1.46 1.168-2.57 2.569-2.453 1.46.058 2.57 1.284 2.57 2.686m-2.57 12.848a2.46 2.46 0 0 0 2.57-2.453c0-1.402-1.11-2.628-2.57-2.686-1.401-.117-2.569 1.05-2.569 2.452s1.168 2.628 2.569 2.687"}),(0,n.jsx)("path",{fill:"#00236B",d:"M190.452 91.875V57.771c0-3.68-2.628-6.833-5.899-7.008l-23.651-1.285a35.2 35.2 0 0 0-1.752 10.98c0 17.635 12.79 31.826 28.09 31.65 1.051.06 2.16-.058 3.212-.233",opacity:.2}),(0,n.jsx)("path",{fill:"#FF4645",d:"M220.645 58.883c0-16.585-11.621-30.775-26.454-31.651-15.3-.876-28.089 12.672-28.089 30.308s12.789 31.827 28.089 31.652c14.833-.117 26.454-13.724 26.454-30.309"}),(0,n.jsx)("path",{fill:"#FC0",d:"M215.329 40.372c-4.788-7.475-12.38-12.614-21.14-13.14v31.01z"}),(0,n.jsx)("path",{fill:"#00236B",d:"m215.329 40.372-21.14 17.87 26.455.642c0-6.89-1.986-13.315-5.315-18.512"}),(0,n.jsx)("path",{fill:"#FF4645",d:"M194.248 58.24V27.233c-15.301-.876-28.09 12.672-28.09 30.308z"}),(0,n.jsx)("path",{fill:"#2EE5C0",d:"M161.151 14.734a2 2 0 1 0-4 0zm-4 4.204a2 2 0 0 0 4 0zm4 8.876a2 2 0 1 0-4 0zm-4 4.555a2 2 0 0 0 4 0zm10.819-6.816a2 2 0 0 0 0-4zm-4.263-4a2 2 0 1 0 0 4zm-9.169 4a2 2 0 1 0 0-4zm-4.263-4a2 2 0 0 0 0 4zm6.876-6.82v4.205h4v-4.204zm0 13.08v4.556h4v-4.555zm10.819-6.26h-4.263v4h4.263zm-13.432 0h-4.263v4h4.263z"})]}),cB=(0,d.cn)("network");function cH(){return(0,n.jsxs)("div",{className:cB("placeholder"),children:[(0,n.jsx)("div",{className:cB("placeholder-img"),children:(0,n.jsx)(tI.I,{data:cG,width:221,height:204})}),(0,n.jsx)("div",{className:cB("placeholder-text"),children:c$("description_placeholder")})]})}let cW=(0,d.cn)("node-tooltip");function cV({nodeTooltip:e,onClose:t}){return e.anchor&&e.data?(0,n.jsx)(eF.z,{open:!0,hasArrow:!0,placement:["top","bottom","left","right"],anchorElement:e.anchor,onOutsideClick:t,children:(0,n.jsx)("div",{className:cW(),children:(0,n.jsx)("table",{children:(0,n.jsxs)("tbody",{children:[(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{className:cW("label"),children:c$("field_id")}),(0,n.jsx)("td",{className:cW("value"),children:e.data.nodeId||"?"})]}),(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{className:cW("label"),children:c$("field_rack")}),(0,n.jsx)("td",{className:cW("value"),children:e.data.rack||"?"})]}),e.data.connected&&e.data.capacity?(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{className:cW("label"),children:c$("field_net")}),(0,n.jsx)("td",{className:cW("value"),children:`${e.data.connected} / ${e.data.capacity}`})]}):null]})})})}):null}var cJ=a(78870);let cK=(0,d.cn)("node-network");function cY(){}function cZ({nodeId:e,connected:t,capacity:a,rack:i,status:s,onClick:l=cY,onMouseEnter:o=cY,onMouseLeave:c=cY,showID:d,isBlurred:u}){let m=r.useRef(null),p=s||function(e=0,t=0){let a=Math.floor(e/t*100);return 100===a?sR.m.Green:a>=70?sR.m.Yellow:a>=1?sR.m.Red:sR.m.Grey}(t,a);return(0,n.jsx)("div",{ref:m,className:cK({[p.toLowerCase()]:!0,id:d,blur:u}),onMouseEnter:()=>{m.current&&o(m.current,{nodeId:e,connected:t,capacity:a,rack:i})},onMouseLeave:()=>{c()},onClick:()=>l(e),children:d?e:null})}function cX(e,t){return e.reduce((e,a)=>(e[a[t]]?e[a[t]].push(a):e[a[t]]=[a],e),{})}let c0=(0,d.cn)("network");function c1({nodeInfo:e,index:t,isRight:a,showId:r,clickedNode:i,capacity:s,connected:l,onClickNode:o,onShowNodeTooltip:c,onHideNodeTooltip:d}){let u=a?void 0:()=>{o(i&&e.NodeId===i.NodeId?void 0:e)};return(0,n.jsx)(cZ,{nodeId:e.NodeId,showID:r,rack:e.Rack,status:"ConnectStatus"in e?e.ConnectStatus:void 0,capacity:s,connected:l,onMouseEnter:c,onMouseLeave:d,onClick:u,isBlurred:!a&&i&&i.NodeId!==e.NodeId},t)}function c2(e,t,a){let n,r;if(!t&&"Peers"in e&&e.Peers){let t;n=a?Object.keys(e.Peers).length:e.Peers.length,t=e.Peers,r=t?.reduce((e,t)=>t.Connected?e+1:e,0)}return{capacity:n,connected:r}}function c3(e,t,a,n){return e&&a!==n||!e||t}function c4({rackKey:e,rackIndex:t,nodes:a,isRight:r,showId:i,clickedNode:s,withProblems:l,onClickNode:o,onShowNodeTooltip:c,onHideNodeTooltip:d}){return(0,n.jsxs)("div",{className:c0("rack-column"),children:[(0,n.jsx)("div",{className:c0("rack-index"),children:"undefined"===e?"?":e}),a.map((e,t)=>{let{capacity:a,connected:u}=c2(e,r,!0);return c3(l,r,a,u)?(0,n.jsx)(c1,{nodeInfo:e,index:t,isRight:r,showId:i,clickedNode:s,capacity:a,connected:u,onClickNode:o,onShowNodeTooltip:c,onHideNodeTooltip:d},t):null})]},t)}function c5({nodes:e,isRight:t,showId:a,clickedNode:i,withProblems:s,onClickNode:l,onShowNodeTooltip:o,onHideNodeTooltip:c}){return(0,n.jsx)(r.Fragment,{children:e.map((e,r)=>{let d=e&&"Peers"in e?e.Peers:void 0,{capacity:u,connected:m}=c2(e,t,!1);return c3(s,t,u,m)?(0,n.jsx)(c1,{nodeInfo:e,index:r,isRight:t,showId:a,clickedNode:i,capacity:d?.length,connected:m,onClickNode:l,onShowNodeTooltip:o,onHideNodeTooltip:c},r):null})})}function c6({nodes:e,isRight:t,showId:a,showRacks:i,clickedNode:s,onClickNode:l,onShowNodeTooltip:o,onHideNodeTooltip:c}){let{withProblems:d}=cQ(),u=r.useMemo(()=>{let a;return a=0,Object.keys(e).forEach(n=>{if(i){let r=cX(e[n],"Rack");Object.keys(r).forEach(e=>{r[e].forEach(e=>{let{capacity:n,connected:r}=c2(e,t,!0);c3(d,t,n,r)&&a++})})}else e[n].forEach(e=>{let{capacity:n,connected:r}=c2(e,t,!1);c3(d,t,n,r)&&a++})}),a},[e,d,t,i]),m=Object.keys(e).map((r,u)=>{let m=cX(e[r],"Rack");return(0,n.jsxs)("div",{className:c0("nodes-container",{right:t}),children:[(0,n.jsx)("div",{className:c0("nodes-title"),children:c$("label_nodes",{type:r})}),(0,n.jsx)("div",{className:c0("nodes"),children:i?Object.keys(m).map((e,r)=>(0,n.jsx)(c4,{rackKey:e,rackIndex:r,nodes:m[e],isRight:t,showId:a,clickedNode:s,withProblems:d,onClickNode:l,onShowNodeTooltip:o,onHideNodeTooltip:c},r)):(0,n.jsx)(c5,{nodes:e[r],isRight:t,showId:a,clickedNode:s,withProblems:d,onClickNode:l,onShowNodeTooltip:o,onHideNodeTooltip:c})})]},u)});return d&&0===u?(0,n.jsx)(cJ.v,{name:"thumbsUp",width:200}):m}let c7=(0,d.cn)("network");function c8({database:e,databaseFullPath:t}){let a=(0,x.kK)(),[i]=(0,_.Nt)(),{withProblems:s,handleWithProblemsChange:l}=cQ(),[o,c]=r.useState(),[d,u]=r.useState(!1),[m,p]=r.useState(!1),[h,g]=r.useState({anchor:null,data:null}),{currentData:y,isFetching:b,error:f}=cF.useGetNetworkInfoQuery({database:e,databaseFullPath:t,useMetaProxy:a},{pollingInterval:i}),v=b&&void 0===y,j=r.useMemo(()=>(y?.Tenants&&y.Tenants[0].Nodes)??[],[y]),T=r.useCallback((e,t)=>{g({anchor:e,data:t})},[]),w=r.useCallback(()=>{g({anchor:null,data:null})},[]),S=r.useMemo(()=>cX(j,"NodeType"),[j]),N=r.useMemo(()=>o?cX(o.Peers??[],"NodeType"):{},[o]);return v?(0,n.jsx)("div",{className:"loader",children:(0,n.jsx)(cL.a,{size:"l"})}):f||0!==j.length?(0,n.jsxs)("div",{className:c7(),children:[(0,n.jsx)(cV,{nodeTooltip:h,onClose:w}),f?(0,n.jsx)(e$.o,{error:f}):null,j.length>0?(0,n.jsx)("div",{className:c7("inner"),children:(0,n.jsxs)("div",{className:c7("nodes-row"),children:[(0,n.jsxs)("div",{className:c7("left"),children:[(0,n.jsx)("div",{className:c7("controls-wrapper"),children:(0,n.jsxs)("div",{className:c7("controls"),children:[(0,n.jsx)(cz.k,{value:s,onChange:l,className:c7("problem-filter")}),(0,n.jsx)("div",{className:c7("checkbox-wrapper"),children:(0,n.jsx)(eU.S,{onUpdate:()=>{u(!d)},checked:d,children:c$("field_id")})}),(0,n.jsx)("div",{className:c7("checkbox-wrapper"),children:(0,n.jsx)(eU.S,{onUpdate:()=>{p(!m)},checked:m,children:c$("label_racks")})})]})}),(0,n.jsx)(c6,{nodes:S,showId:d,showRacks:m,clickedNode:o,onClickNode:c,onShowNodeTooltip:T,onHideNodeTooltip:w})]}),(0,n.jsx)("div",{className:c7("right"),children:o?(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:c7("label"),children:[c$("label_connectivity")," ",(0,n.jsx)(s6.N_,{className:c7("link"),to:(0,O.vI)({id:o.NodeId}),children:o.NodeId})," ",c$("label_to-other-nodes")]}),(0,n.jsx)("div",{className:c7("nodes-row"),children:(0,n.jsx)(c6,{nodes:N,isRight:!0,showId:d,showRacks:m,clickedNode:o,onClickNode:c,onShowNodeTooltip:T,onHideNodeTooltip:w})})]}):(0,n.jsx)(cH,{})})]})}):null]}):(0,n.jsx)("div",{className:"error",children:c$("description_no-nodes-data")})}function c9({database:e,path:t,databaseFullPath:a,scrollContainerRef:r}){let i=(0,al.Pm)(),s=(0,cq.b)();return(0,n.jsx)(l.r,{loading:!i,children:s?(0,n.jsx)(cO.x,{path:t,databaseFullPath:a,database:e,scrollContainerRef:r}):(0,n.jsx)(c8,{database:e,databaseFullPath:a})})}var de=a(18117),dt=a(31596),da=a(56321),dn=a(71350),dr=a(29472),di=JSON.parse('{"lagsPopover.writeLags":"Write lags statistics (time format dd hh:mm:ss)","lagsPopover.readLags":"Read lags statistics (time format dd hh:mm:ss)","headers.unread":"End offset - Last read offset","headers.uncommited":"End offset - Committed offset","controls.consumerSelector":"Consumer:","controls.consumerSelector.emptyOption":"No consumer","controls.partitionSearch":"Partition ID","controls.generalSearch":"Host, Host ID, Reader, Read Session ID","table.emptyDataMessage":"No partitions match the current search","noConsumersMessage.topic":"This topic has no consumers","noConsumersMessage.stream":"This changefeed has no consumers"}'),ds=JSON.parse('{"lagsPopover.writeLags":"Статистика лагов записи (формат времени дд чч:мм:сс)","lagsPopover.readLags":"Статистика лагов чтения (формат времени дд чч:мм:сс)","headers.unread":"End offset - Last read offset","headers.uncommited":"End offset - Committed offset","controls.consumerSelector":"Читатель:","controls.consumerSelector.emptyOption":"Нет читателя","controls.partitionSearch":"Partition ID","controls.generalSearch":"Host, Host ID, Reader, Read Session ID","table.emptyDataMessage":"По заданному поиску нет партиций","noConsumersMessage.topic":"У этого топика нет читателей","noConsumersMessage.stream":"У этого стрима нет читателей"}');let dl=(0,en.g4)("ydb-diagnostics-partitions",{ru:ds,en:di}),dc=({consumers:e,selectedConsumer:t,onSelectedConsumerChange:a,selectDisabled:i,partitions:s,onSearchChange:l})=>{let[o,c]=r.useState(""),[d,u]=r.useState("");r.useEffect(()=>{if(!s)return;let e=RegExp(a2()(d),"i"),t=RegExp(a2()(o),"i");l(s.filter(a=>{let{partitionId:n,readerName:r,readSessionId:i,partitionNodeId:s,connectionNodeId:l,partitionHost:o,connectionHost:c}=a,d=e.test(String(n)),u=[r,i,s,l,o,c].filter(Boolean).map(String),m=0===u.length||u.some(e=>t.test(e));return d&&m}))},[d,o,s,l]);let m=r.useMemo(()=>{let t=e&&e.length?e.map(e=>({value:e,content:e})):[];return[{value:"",content:dl("controls.consumerSelector.emptyOption")},...t]},[e]),p=e=>(0,n.jsx)("div",{className:dI("select-option",{empty:""===e.value}),children:e.content});return(0,n.jsxs)(r.Fragment,{children:[(0,n.jsx)(eQ.l,{className:dI("consumer-select"),label:dl("controls.consumerSelector"),options:m,value:[t||""],onUpdate:e=>{a(e[0]||void 0)},filterable:e&&e.length>5,disabled:i||!e||!e.length,renderOption:p,renderSelectedOption:p}),(0,n.jsx)(dr.v,{onChange:e=>{u(e)},placeholder:dl("controls.partitionSearch"),className:dI("search",{partition:!0}),value:d}),(0,n.jsx)(dr.v,{onChange:e=>{c(e)},placeholder:dl("controls.generalSearch"),className:dI("search",{general:!0}),value:o})]})},dd=(0,d.cn)("ydb-multiline-table-header");function du({title:e}){return e?(0,n.jsx)("div",{className:dd(),children:e}):null}let dm={PARTITION_ID:"partitionId",STORE_SIZE:"storeSize",WRITE_SPEED:"writeSpeed",READ_SPEED:"readSpeed",WRITE_LAGS:"writeLags",READ_LAGS:"readLags",UNCOMMITED_MESSAGES:"uncommitedMessages",UNREAD_MESSAGES:"unreadMessages",START_OFFSET:"startOffset",END_OFFSET:"endOffset",COMMITED_OFFSET:"commitedOffset",READ_SESSION_ID:"readSessionId",READER_NAME:"readerName",PARTITION_HOST:"partitionHost",CONNECTION_HOST:"connectionHost"},dp={[dm.PARTITION_ID]:"Partition ID",[dm.STORE_SIZE]:"Store size",[dm.WRITE_SPEED]:"Write speed",[dm.READ_SPEED]:"Read speed",[dm.WRITE_LAGS]:"Write lags, duration",[dm.READ_LAGS]:"Read lags, duration",[dm.UNCOMMITED_MESSAGES]:"Uncommited messages",[dm.UNREAD_MESSAGES]:"Unread messages",[dm.START_OFFSET]:"Start offset",[dm.END_OFFSET]:"End offset",[dm.COMMITED_OFFSET]:"Commited offset",[dm.READ_SESSION_ID]:"Read session ID",[dm.READER_NAME]:"Reader name",[dm.PARTITION_HOST]:"Partition host",[dm.CONNECTION_HOST]:"Connection host"},dh="partitionWriteLag",dg="partitionWriteIdleTime",dx={[dh]:"write lag",[dg]:"write idle time"},dy="consumerWriteLag",db="consumerReadLag",df="consumerReadIdleTime",dv={[dy]:"write lag",[db]:"read lag",[df]:"read idle time"},dj=[dm.PARTITION_ID,dm.STORE_SIZE,dm.WRITE_SPEED,dm.WRITE_LAGS,dm.START_OFFSET,dm.END_OFFSET,dm.PARTITION_HOST],dT=Object.values(dm),dw=(0,d.cn)("ydb-diagnostics-partitions-columns-header"),dS=(0,d.cn)("ydb-diagnostics-partitions-columns"),d_=[{name:dm.PARTITION_ID,header:(0,n.jsx)(du,{title:dp[dm.PARTITION_ID]}),sortAccessor:e=>(0,iA.kf)(e.partitionId)&&Number(e.partitionId),align:tX.Ay.LEFT,render:({row:e})=>(0,n.jsx)(dC,{id:String(e.partitionId)})},{name:dm.STORE_SIZE,header:(0,n.jsx)(du,{title:dp[dm.STORE_SIZE]}),sortAccessor:e=>(0,iA.kf)(e.storeSize)&&Number(e.storeSize),align:tX.Ay.RIGHT,render:({row:e})=>(0,eW.z3)(e.storeSize)},{name:dm.WRITE_SPEED,header:dp[dm.WRITE_SPEED],align:tX.Ay.LEFT,resizeMinWidth:140,sortAccessor:e=>e.writeSpeed.perMinute,render:({row:e})=>(0,n.jsx)(ns,{data:e.writeSpeed})},{name:dm.READ_SPEED,header:dp[dm.READ_SPEED],align:tX.Ay.LEFT,resizeMinWidth:140,sortAccessor:e=>e.readSpeed?.perMinute,render:({row:e})=>(0,n.jsx)(ns,{data:e.readSpeed})},{name:dm.WRITE_LAGS,header:(0,n.jsx)(()=>(0,n.jsx)(np,{className:dw("lags"),text:dp[dm.WRITE_LAGS],popoverContent:(0,n.jsx)(nS,{text:dl("lagsPopover.writeLags"),type:"write"})}),{}),className:dS("lags-header"),sub:[{name:dh,header:dx[dh],align:tX.Ay.RIGHT,render:({row:e})=>(0,eW.uH)(e.partitionWriteLag)},{name:dg,header:dx[dg],align:tX.Ay.RIGHT,render:({row:e})=>(0,eW.uH)(e.partitionWriteIdleTime)}]},{name:dm.READ_LAGS,header:(0,n.jsx)(()=>(0,n.jsx)(np,{className:dw("lags"),text:dp[dm.READ_LAGS],popoverContent:(0,n.jsx)(nS,{text:dl("lagsPopover.readLags"),type:"read"})}),{}),className:dS("lags-header"),sub:[{name:dy,header:dv[dy],align:tX.Ay.RIGHT,render:({row:e})=>(0,eW.uH)(e.consumerWriteLag)},{name:db,header:dv[db],align:tX.Ay.RIGHT,render:({row:e})=>(0,eW.uH)(e.consumerReadLag)},{name:df,header:dv[df],align:tX.Ay.RIGHT,render:({row:e})=>(0,eW.uH)(e.consumerReadIdleTime)}]},{name:dm.UNCOMMITED_MESSAGES,header:(0,n.jsx)(()=>(0,n.jsx)(np,{className:dw("messages"),text:dp[dm.UNCOMMITED_MESSAGES],popoverContent:(0,n.jsx)("div",{className:dw("messages-popover-content"),children:dl("headers.uncommited")})}),{}),align:tX.Ay.RIGHT,render:({row:e})=>e.uncommitedMessages},{name:dm.UNREAD_MESSAGES,header:(0,n.jsx)(()=>(0,n.jsx)(np,{className:dw("messages"),text:dp[dm.UNREAD_MESSAGES],popoverContent:(0,n.jsx)("div",{className:dw("messages-popover-content"),children:dl("headers.unread")})}),{}),align:tX.Ay.RIGHT,render:({row:e})=>e.unreadMessages},{name:dm.START_OFFSET,header:(0,n.jsx)(du,{title:dp[dm.START_OFFSET]}),sortAccessor:e=>(0,iA.kf)(e.startOffset)&&Number(e.startOffset),align:tX.Ay.RIGHT,render:({row:e})=>e.startOffset},{name:dm.END_OFFSET,header:(0,n.jsx)(du,{title:dp[dm.END_OFFSET]}),sortAccessor:e=>(0,iA.kf)(e.endOffset)&&Number(e.endOffset),align:tX.Ay.RIGHT,render:({row:e})=>e.endOffset},{name:dm.COMMITED_OFFSET,header:(0,n.jsx)(du,{title:dp[dm.COMMITED_OFFSET]}),sortAccessor:e=>(0,iA.kf)(e.commitedOffset)&&Number(e.commitedOffset),align:tX.Ay.RIGHT,render:({row:e})=>e.commitedOffset},{name:dm.READ_SESSION_ID,header:(0,n.jsx)(()=>(0,n.jsx)("div",{className:dw("read-session"),children:dp[dm.READ_SESSION_ID]}),{}),align:tX.Ay.LEFT,width:150,render:({row:e})=>e.readSessionId?(0,n.jsx)(i$.c,{name:e.readSessionId,showStatus:!1,hasClipboardButton:!0}):S.Pd},{name:dm.READER_NAME,header:(0,n.jsx)(du,{title:dp[dm.READER_NAME]}),align:tX.Ay.LEFT,width:150,render:({row:e})=>e.readerName?(0,n.jsx)(i$.c,{name:e.readerName,showStatus:!1,hasClipboardButton:!0}):S.Pd},{name:dm.PARTITION_HOST,header:(0,n.jsx)(du,{title:dp[dm.PARTITION_HOST]}),align:tX.Ay.LEFT,width:200,render:({row:e})=>e.partitionNodeId&&e.partitionHost?(0,n.jsx)(dN,{host:e.partitionHost,id:e.partitionNodeId}):S.Pd},{name:dm.CONNECTION_HOST,header:(0,n.jsx)(du,{title:dp[dm.CONNECTION_HOST]}),align:tX.Ay.LEFT,width:200,render:({row:e})=>e.connectionNodeId&&e.connectionHost?(0,n.jsx)(dN,{host:e.connectionHost,id:e.connectionNodeId}):S.Pd}];function dN({host:e,id:t}){return(0,n.jsx)(i$.c,{name:e,path:(0,O.vI)({id:t}),showStatus:!1,hasClipboardButton:!0})}let dE=d_.filter(e=>dj.includes(e.name));function dC({id:e}){let t=eM(),a=(0,al._p)();return(0,n.jsx)(i$.c,{name:e,path:a?t(j.iJ.topicData,{selectedPartition:e}):void 0,showStatus:!1})}var dA=a(33702);let dI=(0,d.cn)("ydb-diagnostics-partitions"),dP=({path:e,database:t,databaseFullPath:a})=>{let i=(0,_.YQ)(),s=(0,x.kK)(),[l,o]=r.useState([]),c=(0,_.N4)(n=>a8(n,e,t,a,s)),[d]=(0,_.Nt)(),{selectedConsumer:u}=(0,_.N4)(e=>e.partitions),{currentData:m,isFetching:p,error:h}=a4.useGetTopicQuery({path:e,database:t,databaseFullPath:a,useMetaProxy:s}),g=p&&void 0===m,{currentData:y,isFetching:b,error:f}=da.m.useGetNodesListQuery({database:t},void 0),v=(0,_.N4)(e=>(0,da.K)(e,t)),{columnsToShow:j,columnsToSelect:T,setColumns:w}=(e=>{let{columnsToShow:t,columnsToSelect:a,setColumns:n}=(0,dA.K)(d_,"partitionsSelectedColumns",dp,dT,[dm.PARTITION_ID]),{columnsToShow:i,columnsToSelect:s,setColumns:l}=(0,dA.K)(dE,"generalPartitionsSelectedColumns",dp,dj,[dm.PARTITION_ID]);return r.useMemo(()=>e?{columnsToShow:t,columnsToSelect:a,setColumns:n}:{columnsToShow:i,columnsToSelect:s,setColumns:l},[a,t,s,i,e,n,l])})(u),N=g?de.hT:{path:e,database:t,consumerName:u,databaseFullPath:a,useMetaProxy:s},{currentData:E,isFetching:C,error:A}=dn.aD.useGetPartitionsQuery(N,{pollingInterval:d}),I=C&&void 0===E,P=r.useMemo(()=>((e=[],t)=>e?.map(e=>{let a=e.partitionNodeId&&t?t.get(e.partitionNodeId)?.Host:void 0,n=e.connectionNodeId&&t?t.get(e.connectionNodeId)?.Host:void 0;return{...e,partitionHost:a,connectionHost:n}}))(E,v),[E,v]);r.useEffect(()=>{let e=!g&&!c,t=u&&c&&!c.includes(u);(e||t)&&i((0,dn.WD)(void 0))},[i,g,u,c]);let k=g||b&&void 0===y||I,D=f||h||A;return(0,n.jsxs)(tu.L,{className:dI(),children:[(0,n.jsx)(tu.L.Controls,{renderExtraControls:()=>(0,n.jsx)(dt.O,{items:T,showStatus:!0,onUpdate:w}),children:(0,n.jsx)(dc,{consumers:c,selectedConsumer:u,onSelectedConsumerChange:e=>{i((0,dn.WD)(e))},selectDisabled:!!D||k,partitions:P,onSearchChange:o})}),(0,n.jsxs)(tu.L.Table,{children:[D?(0,n.jsx)(e$.o,{error:D}):null,E?(0,n.jsx)(tc.l,{columnsWidthLSKey:"partitionsColumnsWidth",wrapperClassName:dI("table"),data:l,columns:j,isLoading:k,settings:S.N3,emptyDataMessage:dl("table.emptyDataMessage")}):null]})]})};var dk=a(81392);let dD=tz.z.enum([oy,og,ob]).catch(oy),dR={columnId:oy,order:tX.Ay.DESCENDING},dM=(0,d.cn)("kv-top-queries"),dO=({database:e,renderQueryModeControl:t,handleTextSearchUpdate:a})=>{let[i]=(0,_.Nt)(),s=(0,_.N4)(e=>e.executeTopQueries),l=r.useMemo(()=>[oO,oM,oL,oI,oF].map(e=>({...e,sortable:!!oE(e.name)})),[]),{columnsToShow:o,columnsToSelect:c,setColumns:d}=(0,dA.K)(l,"runningQueriesSelectedColumns",ow,oj,oT),{tableSort:u,handleTableSort:m,backendSort:p}=function(){let{sortParam:e,updateSortParam:t}=oU({paramName:"runningSort",schema:dD,defaultSort:dR}),[a,n]=(0,_.GY)({initialSortColumn:e?.[0]?.columnId||dR.columnId,initialSortOrder:e?.[0]?.order||dR.order,multiple:!0,onSort:t});return{tableSort:a,handleTableSort:n,backendSort:r.useMemo(()=>(0,_.JN)(a,oE),[a])}}(),{currentData:h,isFetching:g,isLoading:x,error:y}=sS.Ke.useGetRunningQueriesQuery({database:e,filters:s,sortOrder:p},{pollingInterval:i}),b=h?.resultSets?.[0]?.result,f=r.useRef(null);return(0,n.jsxs)(tu.L,{children:[(0,n.jsxs)(tu.L.Controls,{renderExtraControls:()=>(0,n.jsx)(dt.O,{popupWidth:200,items:c,showStatus:!0,onUpdate:d}),children:[t(),(0,n.jsx)(tm.v,{value:s.text,onChange:a,placeholder:l8("filter.text.placeholder"),className:dM("search"),inputRef:f})]}),y?(0,n.jsx)(e$.o,{error:(0,tH.Cb)(y)}):null,(0,n.jsx)(tu.L.Table,{children:(0,n.jsx)(ol,{columns:o,data:b||[],isFetching:g&&void 0===h,isLoading:x,columnsWidthLSKey:"runningQueriesColumnsWidth",emptyDataMessage:l8("no-data"),sortOrder:u,onSort:m,drawerId:"running-query-details",storageKey:"running-queries-drawer-width",tableSettings:l6})})]})};var dq=a(77893),dL=a(82586),dz=JSON.parse('{"date-format":"MM/DD/YYYY","date-time-format":"MM/DD/YYYY HH:mm"}'),dF=JSON.parse('{"date-format":"DD.MM.YYYY","date-time-format":"DD.MM.YYYY HH:mm"}');let dQ=(0,en.g4)("ydb-date-range",{ru:dF,en:dz});var dU=a(54694);let d$=(0,d.cn)("date-range"),dG=({from:e,to:t,className:a,defaultValue:i,onChange:s})=>{let l=r.useCallback(e=>s?.({from:e?.start?.type==="relative"?e.start.value.toString():String((0,dU.dateTimeParse)(e?.start?.value)?.valueOf()),to:e?.end?.type==="relative"?e.end.value.toString():String((0,dU.dateTimeParse)(e?.end?.value)?.valueOf())}),[s]),o=r.useMemo(()=>{if(e||t){var a;let n,r;return a={from:e,to:t},n=(0,dU.isLikeRelative)(a.from??""),r=(0,dU.isLikeRelative)(a.to??""),{start:a.from?{type:n?"relative":"absolute",value:n?a.from:(0,dU.dateTimeParse)(Number(a.from))}:null,end:a.to?{type:r?"relative":"absolute",value:r?a.to:(0,dU.dateTimeParse)(Number(a.to))}:null}}},[e,t]),c=Intl.DateTimeFormat().resolvedOptions().timeZone,d=o||i;return(0,n.jsx)("div",{className:d$(null,a),children:(0,n.jsx)(dq.k,{withPresets:!0,className:d$("range-input",{[d?.start?.type==="relative"&&d?.end?.type==="relative"?"s":d?.start?.type==="relative"||d?.end?.type==="relative"?"m":"l"]:!0}),timeZone:c,value:d,allowNullableValues:!0,size:"m",format:dQ("date-time-format"),onUpdate:l,placeholder:`${dQ("date-time-format")} - ${dQ("date-time-format")}`,withApplyButton:!0,docs:dL.p2,withHeader:!0})})},dB={hour:"hour",minute:"minute"},dH=[{value:dB.hour,content:l8("timeframe_hour")},{value:dB.minute,content:l8("timeframe_minute")}],dW={start:{value:"now-6h",type:"relative"},end:{value:"now",type:"relative"}};function dV(e){let t=l2(String(e.QueryText));return{rank:String(e.Rank),intervalEnd:String(e.IntervalEnd),endTime:String(e.EndTime),queryHash:t}}let dJ=(0,d.cn)("kv-top-queries"),dK=({database:e,timeFrame:t,renderQueryModeControl:a,handleTimeFrameChange:i,handleDateRangeChange:s,handleTextSearchUpdate:l})=>{let[c]=(0,_.Nt)(),d=(0,_.N4)(e=>e.executeTopQueries),[u,m]=r.useState(void 0),p=r.useRef(null),h=r.useMemo(()=>[oO,oA,oq,oR,oz,oI,ok,oD,oM].map(e=>({...e,sortable:!!oN(e.name),defaultOrder:tX.Ay.DESCENDING})),[]),{columnsToShow:g,columnsToSelect:x,setColumns:y}=(0,dA.K)(h,"topQueriesSelectedColumns",ow,of,ov),{tableSort:b,handleTableSort:f,backendSort:v}=oB(),{currentData:j,isFetching:T,isLoading:w,error:S}=sS.Ke.useGetTopQueriesQuery({database:e,filters:d,sortOrder:v,timeFrame:t},{pollingInterval:c}),N=j?.resultSets?.[0]?.result;!function(e,t){let[a,n]=(0,tL.useQueryParams)({selectedRow:tL.StringParam});r.useEffect(()=>{if(t&&a.selectedRow){let r=JSON.parse(decodeURIComponent(a.selectedRow)),i=t.find(e=>{let t=dV(e);return t.rank===r.rank&&t.intervalEnd===r.intervalEnd&&t.endTime===r.endTime&&r.queryHash===t.queryHash});i?e(i):e(null),n({selectedRow:void 0})}},[a.selectedRow,n,t,e])}(m,N);let E=r.useMemo(()=>({...l6,dynamicInnerRef:p}),[]);!function({selectedRow:e,rows:t,reactListRef:a}){r.useEffect(()=>{if(e&&t&&a.current){let n=t.findIndex(t=>(0,o.isEqual)(t,e));if(-1!==n){let e=a.current;try{let[t,a]=e.getVisibleRange();n>=t&&n<=a||e.scrollTo(n-1)}catch{e.scrollAround(n)}}}},[e,t,a])}({selectedRow:u,rows:N,reactListRef:p});let C=void 0!==u,A=r.useCallback(()=>{if(u){let e,t,a;return e=dV(u),(a=new URLSearchParams((t=new URL(window.location.href)).search)).set("selectedRow",encodeURIComponent(JSON.stringify({rank:e.rank||void 0,intervalEnd:e.intervalEnd||void 0,endTime:e.endTime||void 0,queryHash:e.queryHash||void 0}))),t.search=a.toString(),t.toString()}return""},[u]),I=r.useRef(null);r.useEffect(()=>{C&&I.current?.blur()},[C]);let P=r.useMemo(()=>[{type:"copyLink",link:A()},{type:"close"}],[A]);return(0,n.jsxs)(tu.L,{children:[(0,n.jsxs)(tu.L.Controls,{renderExtraControls:()=>(0,n.jsx)(dt.O,{popupWidth:200,items:x,showStatus:!0,onUpdate:y}),children:[a(),(0,n.jsx)(eQ.l,{options:dH,value:[t],onUpdate:i}),(0,n.jsx)(dG,{from:d.from,to:d.to,onChange:s,defaultValue:dW}),(0,n.jsx)(tm.v,{value:d.text,inputRef:I,onChange:l,placeholder:l8("filter.text.placeholder"),className:dJ("search")})]}),S?(0,n.jsx)(e$.o,{error:(0,tH.Cb)(S)}):null,(0,n.jsx)(tu.L.Table,{children:(0,n.jsx)(ol,{columns:g,data:N||[],isFetching:T&&void 0===j,isLoading:w,columnsWidthLSKey:od,emptyDataMessage:l8("no-data"),sortOrder:b,onSort:f,selectedRow:u,onSelectedRowChange:m,drawerControls:P,drawerId:"query-details",storageKey:"kv-top-queries-drawer-width",tableSettings:E})})]})},dY={top:"top",running:"running"},dZ=tz.z.nativeEnum(dY).catch(dY.top),dX=tz.z.nativeEnum(dB).catch(dB.hour),d0=({database:e})=>{let t=(0,_.YQ)(),[a=dY.top,i]=(0,tL.useQueryParam)("queryMode",tL.StringParam),[s=dB.hour,l]=(0,tL.useQueryParam)("timeFrame",tL.StringParam),o=dZ.parse(a),c=dX.parse(s),d=o===dY.top,u=e=>{t((0,sS.TX)({text:e}))},m=r.useCallback(()=>(0,n.jsxs)(dk.x,{value:o,onUpdate:i,children:[(0,n.jsx)(dk.x.Option,{value:dY.top,children:l8("mode_top")}),(0,n.jsx)(dk.x.Option,{value:dY.running,children:l8("mode_running")})]}),[o,i]);return d?(0,n.jsx)(dK,{database:e,timeFrame:c,renderQueryModeControl:m,handleTimeFrameChange:e=>{l(e[0],"replaceIn")},handleDateRangeChange:e=>{t((0,sS.TX)(e))},handleTextSearchUpdate:u}):(0,n.jsx)(dO,{database:e,renderQueryModeControl:m,handleTextSearchUpdate:u})};var d1=a(43409),d2=a(46216),d3=JSON.parse('{"no-data":"No data","filters.mode.immediate":"Immediate","filters.mode.history":"Historical","description":"Historical data only tracks shards with CPU load over 70%"}'),d4=JSON.parse('{"no-data":"Нет данных","filters.mode.immediate":"Мгновенные","filters.mode.history":"Исторические","description":"Исторические данные хранятся только о шардах с загрузкой CPU выше 70%"}');let d5=(0,en.g4)("ydb-diagnostics-top-shards",{ru:d4,en:d3}),d6={start:{value:"now-1h",type:"relative"},end:{value:"now",type:"relative"}},d7=({value:e,onChange:t})=>{let a=e.mode===d2.h.Immediate?void 0:e.from,i=e.mode===d2.h.Immediate?void 0:e.to;return(0,n.jsxs)(r.Fragment,{children:[(0,n.jsxs)(dk.x,{value:e.mode,onUpdate:e=>{let a;if(a=d2.h,!Object.values(a).includes(e)){let t=Object.values(d2.h).join(", ");throw Error(`Unexpected TopShards mode "${e}". Should be one of: ${t}`)}t({mode:e})},children:[(0,n.jsx)(dk.x.Option,{value:d2.h.Immediate,children:d5("filters.mode.immediate")}),(0,n.jsx)(dk.x.Option,{value:d2.h.History,children:d5("filters.mode.history")})]}),(0,n.jsx)(dG,{from:a,to:i,onChange:e=>{t({mode:d2.h.History,...e})},defaultValue:d6})]})};var d8=a(83624);let d9=(0,d.cn)("top-shards"),ue={...S.N3,dynamicRender:!1,externalSort:!0,disableSortReset:!0,defaultOrder:-1};function ut(e){return e.to="now",e.from="now-1h",e}let ua=({database:e,path:t,databaseFullPath:a})=>{let i=(0,oV.x)("ShardsTable"),s=(0,_.YQ)(),[l]=(0,_.Nt)(),o=(0,_.N4)(e=>e.shardsWorkload),[c,d]=r.useState(()=>{let e={...o};return e.mode||(e.mode=d2.h.Immediate),e.from||e.to||ut(e),e}),{tableSort:u,handleTableSort:m,backendSort:p}=function(){let[e,t]=(0,_.GY)({initialSortColumn:d8.Fk.CPUCores,fixedOrderType:-1,multiple:!0}),a=r.useMemo(()=>(0,_.JN)(e,d8.LK),[e]);return{tableSort:e,handleTableSort:t,backendSort:a}}(),{currentData:h,isFetching:g,error:x}=d1.Xx.useSendShardQueryQuery({database:e,path:t,sortOrder:p,filters:c,databaseFullPath:a},{pollingInterval:l}),y=g&&void 0===h,b=h?.resultSets?.[0]?.result||[],f=r.useMemo(()=>c.mode===d2.h.History?["Path","CPUCores","DataSize","TabletId","NodeId","PeakTime","InFlightTxCount","IntervalEnd"]:["Path","CPUCores","DataSize","TabletId","NodeId","InFlightTxCount"],[c.mode]);return(0,n.jsxs)(tu.L,{children:[(0,n.jsx)(tu.L.Controls,{children:(0,n.jsx)(d7,{value:c,onChange:e=>{let t={...e};if(!o.from&&!o.to&&!e.from&&!e.to)switch(e.mode){case d2.h.Immediate:t.from=t.to=void 0;break;case d2.h.History:ut(t)}s((0,d1.rF)(e)),d(e=>({...e,...t}))}})}),c.mode===d2.h.History&&(0,n.jsx)("div",{className:d9("hint"),children:d5("description")}),x?(0,n.jsx)(e$.o,{error:(0,tH.Cb)(x)}):null,(0,n.jsx)(tu.L.Table,{loading:y,children:x&&!b?null:(0,n.jsx)(i,{databaseFullPath:a,columnsIds:f,data:b,settings:ue,onSort:m,sortOrder:u})})]})};var un=a(34426),ur=a(78799),ui=a(51011),us=a(58419),ul=JSON.parse('{"title_fullscreen":"Fullscreen"}');let uo=(0,en.g4)("ydb-fullscreen-button",{en:ul});function uc({disabled:e,view:t="flat-secondary"}){let a=(0,_.YQ)();return(0,n.jsx)(tA.m,{title:uo("title_fullscreen"),children:(0,n.jsx)(as.$,{onClick:()=>{a((0,us.Jf)())},view:t,disabled:e,children:(0,n.jsx)(tI.I,{data:ui.A})})})}var ud=a(77252),uu=a(73439);let um=e=>(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",...e,children:(0,n.jsx)("path",{fill:"currentColor",d:"M13.383 6.5a.31.31 0 0 0 .305-.305V5.18a.33.33 0 0 0-.305-.305H11.25V2.742a.33.33 0 0 0-.305-.304H9.93a.31.31 0 0 0-.305.304v3.149c0 .355.254.609.61.609zm-7.008-.61V2.743a.33.33 0 0 0-.305-.304H5.055a.31.31 0 0 0-.305.304v2.133H2.617a.31.31 0 0 0-.304.305v1.015c0 .178.126.305.304.305h3.149c.33 0 .609-.254.609-.61m0 7.618v-3.149c0-.33-.28-.609-.61-.609H2.618a.31.31 0 0 0-.304.305v1.015c0 .178.126.305.304.305H4.75v2.133c0 .178.127.305.305.305H6.07a.31.31 0 0 0 .305-.305m4.875 0v-2.133h2.133a.31.31 0 0 0 .305-.305v-1.015a.33.33 0 0 0-.305-.305h-3.149c-.355 0-.609.28-.609.61v3.148c0 .178.127.305.305.305h1.015a.31.31 0 0 0 .305-.305"})}),up=(0,d.cn)("ydb-fullscreen");function uh({children:e,className:t}){let a=(0,_.N4)(e=>e.fullscreen),i=(0,_.YQ)(),s=(0,uu.g)(),l=r.useCallback(()=>{i((0,us.sM)())},[i]);r.useEffect(()=>{let e=e=>{"Escape"===e.key&&l()};return document.addEventListener("keydown",e,!1),()=>{document.removeEventListener("keydown",e,!1)}},[l]);let[o,c]=r.useState(null);r.useEffect(()=>{let e=document.createElement("div");return s.current?.appendChild(e),e.style.display="contents",c(e),()=>{c(null),e.remove()}},[s]);let d=r.useRef(null);return(r.useLayoutEffect(()=>{o&&(a?s.current?.appendChild(o):d.current?.appendChild(o))},[o,s,a]),(0,ud.u)([a]),o)?(0,n.jsx)("div",{ref:d,style:{display:"contents"},children:(0,n.jsx)(lW,{container:o,children:(0,n.jsxs)("div",{className:up({fullscreen:a},t),children:[(0,n.jsx)(as.$,{onClick:l,view:"raised",className:up("close-button"),children:(0,n.jsx)(tI.I,{data:um})}),(0,n.jsx)("div",{className:up("content"),children:e})]})})}):null}var ug=a(74104),ux=a(41254),uy=a(282),ub=a(50726),uf=a(45835),uv=a(18159),uj=a(36354);let uT=({onUpdate:e,value:t=null,debounce:a=200,...r})=>{let[i,s]=(0,uj.o)({value:t,onUpdate:e,debounce:a});return(0,n.jsx)(uv.Q,{value:i,onUpdate:s,...r})};var uw=JSON.parse('{"label_offset":"Offset","label_partition":"Partition ID","label_timestamp-create":"Timestamp Create","label_timestamp-write":"Timestamp Write","label_ts_diff":"Write Lag","label_key":"Key","label_metadata":"Metadata","label_message":"Message","label_size":"Size","label_original-size":"Original Size","label_codec":"Codec","label_producerid":"ProducerID","label_seqno":"SeqNo","label_partition-id":"Partition ID: ","context_ts-diff":"Timestamp Write - Timestamp Create, ms","label_full-value":"Full value","label_from":"From: ","label_nothing-found":"Nothing found","description_nothing-found":"Make the filter less strict or start over","action_show-all":"Reset filter","label_by-offset":"By offset","label_by-timestamp":"By timestamp","action_scroll-down":"Scroll to the end","action_scroll-selected":"Scroll to selected offset","action_scroll-up":"Scroll to the start","description_failed-decode":"Failed to decode message","description_truncated":"[truncated]","context_message-not-found":"Message with offset {{offset}} not found","context_get-data-error":"Failed to get message","label_download":"Save message to file","label_truncated":"Truncated {{size}}","description_not-loaded-message":"Message was not fetched in table due to problems with big messages.\\nYou can view it in side panel by clicking on Offset","description_removed-message":"Message was deleted due to retention","description_last-messages":"Only last 50 000 messages from any partition are displayed"}');let uS=(0,en.g4)("ydb-diagnostics-topic-data",{en:uw}),u_="partition",uN="offset",uE="timestampCreate",uC="timestampWrite",uA="tsDiff",uI="metadata",uP="message",uk="size",uD="originalSize",uR="codec",uM="producerID",uO="seqNo",uq={get TIMESTAMP(){return uS("label_by-timestamp")},get OFFSET(){return uS("label_by-offset")}},uL=(0,tL.createEnumParam)(["TIMESTAMP","OFFSET"]),uz=(0,tL.withDefault)(uL,"TIMESTAMP");function uF(){let[{selectedPartition:e,selectedOffset:t,startTimestamp:a,topicDataFilter:n,activeOffset:i},s]=(0,tL.useQueryParams)({selectedPartition:tL.StringParam,selectedOffset:tL.NumberParam,startTimestamp:tL.NumberParam,topicDataFilter:uz,activeOffset:tL.StringParam}),l=r.useCallback(e=>{s({selectedPartition:e},"replaceIn")},[s]),o=r.useCallback(e=>{s({selectedOffset:e||void 0},"replaceIn")},[s]),c=r.useCallback(e=>{s({activeOffset:e},"replaceIn")},[s]);return{selectedPartition:e,selectedOffset:t,startTimestamp:a,topicDataFilter:n,activeOffset:i,handleSelectedPartitionChange:l,handleSelectedOffsetChange:o,handleStartTimestampChange:r.useCallback(e=>{s({startTimestamp:e},"replaceIn")},[s]),handleTopicDataFilterChange:r.useCallback(e=>{s({topicDataFilter:e},"replaceIn")},[s]),handleActiveOffsetChange:c}}let uQ=(0,d.cn)("ydb-diagnostics-topic-data"),uU={get offset(){return uS("label_offset")},get partition(){return uS("label_partition")},get timestampCreate(){return uS("label_timestamp-create")},get timestampWrite(){return uS("label_timestamp-write")},get tsDiff(){return uS("label_ts_diff")},get key(){return uS("label_key")},get metadata(){return uS("label_metadata")},get message(){return uS("label_message")},get size(){return uS("label_size")},get originalSize(){return uS("label_original-size")},get codec(){return uS("label_codec")},get producerID(){return uS("label_producerid")},get seqNo(){return uS("label_seqno")}},u$={0:"RAW",1:"GZIP",2:"LZOP",3:"ZSTD"};function uG({handlePartitionChange:e,startOffset:t,endOffset:a,partitions:i,partitionsLoading:s,partitionsError:l,scrollToOffset:c,truncatedData:d}){let{selectedPartition:u}=uF(),m=i?.map(({partitionId:e})=>({content:String(e),value:String(e)}));return(0,n.jsxs)(r.Fragment,{children:[(0,n.jsx)(eQ.l,{className:uQ("partition-select"),label:uS("label_partition-id"),options:m,value:u?[u]:void 0,onUpdate:e,filterable:i&&i.length>5,disabled:!i||!i.length,errorPlacement:"inside",errorMessage:(0,aO.$)(l),error:!!l,loading:s}),(0,n.jsx)(uB,{scrollToOffset:c}),!(0,o.isNil)(t)&&!(0,o.isNil)(a)&&a>t&&(0,n.jsxs)(tC.s,{gap:1,children:[(0,n.jsxs)(tE.E,{color:"secondary",whiteSpace:"nowrap",children:[(0,eW.ZV)(t),"—",(0,eW.ZV)(a-1)]}),d&&(0,n.jsx)(nm.H,{children:uS("description_last-messages")})]})]})}function uB({scrollToOffset:e}){let{selectedOffset:t,startTimestamp:a,topicDataFilter:i,activeOffset:s,handleSelectedOffsetChange:l,handleStartTimestampChange:c,handleTopicDataFilterChange:d}=uF(),u=r.useRef(null),m=!(0,o.isNil)(s);r.useEffect(()=>{m&&u.current?.blur()},[m]);let p=r.useCallback(e=>{"TIMESTAMP"===e?l(void 0):c(void 0),d(e)},[d,l,c]),h=r.useCallback(e=>{l(e)},[l]),g=r.useCallback(e=>{let t;if(e){let{value:a,type:n}=e;if("absolute"===n)t=a.valueOf();else if("relative"===n){let e=(0,dU.dateTimeParse)(a);t=e?e.valueOf():void 0}}c(t)},[c]),x=(0,dU.dateTimeParse)(Number(a));return(0,n.jsxs)(r.Fragment,{children:[(0,n.jsxs)(dk.x,{value:i,onUpdate:p,children:[(0,n.jsx)(dk.x.Option,{value:"TIMESTAMP",children:uq.TIMESTAMP}),(0,n.jsx)(dk.x.Option,{value:"OFFSET",children:uq.OFFSET})]}),"OFFSET"===i&&(0,n.jsx)(uT,{controlRef:u,className:uQ("offset-input"),max:Number.MAX_SAFE_INTEGER,min:0,value:(0,o.isNil)(t)?null:(0,iA.y3)(t),onUpdate:h,label:uS("label_from"),placeholder:uS("label_offset"),debounce:600,endContent:(0,n.jsx)(tA.m,{title:uS("action_scroll-selected"),children:(0,n.jsx)(as.$,{disabled:(0,o.isNil)(t),className:uQ("scroll-button"),view:"flat-action",size:"xs",onClick:()=>{t&&e((0,iA.y3)(t))},children:(0,n.jsx)(tI.I,{size:14,data:uf.A})})}),autoFocus:!0}),"TIMESTAMP"===i&&(0,n.jsx)(ub.x,{format:"YYYY-MM-DD HH:mm:ss",placeholder:"YYYY-MM-DD HH:mm:ss",hasClear:!0,isDateUnavailable:e=>e.isAfter((0,dU.dateTimeParse)()),label:uS("label_from"),onUpdate:g,defaultValue:x?{type:"absolute",value:x}:null,className:uQ("date-picker")})]})}var uH=a(97383),uW=a(66111),uV=a(58634);function uJ(e,t){let a=document.createElement("a");a.href=e,a.download=t,document.body.appendChild(a),a.click(),document.body.removeChild(a)}let uK=(e,t,a)=>{let n=new Blob([e],{type:a}),r=URL.createObjectURL(n);uJ(r,t),URL.revokeObjectURL(r)},uY=(e,t)=>{uK(JSON.stringify(e,null,2),`${t}.json`,"application/json")},uZ=(0,d.cn)("ydb-diagnostics-message-details");function uX({children:e,title:t,className:a,renderToolbar:r,scrollContainerRef:i}){return(0,n.jsxs)(tC.s,{direction:"column",className:uZ("section",a),children:[(0,n.jsxs)(tC.s,{className:uZ("section-title-wrapper"),justifyContent:"space-between",alignItems:"center",children:[t,r?.()]}),(0,n.jsx)("div",{className:uZ("section-content"),children:(0,n.jsx)("div",{className:uZ("section-scroll-container"),ref:i,children:e})})]})}function u0({offset:e,size:t,message:a,scrollContainerRef:i}){let s=(0,_.N4)(e=>e.fullscreen),{preparedMessage:l,decodedMessage:o,isJson:c}=r.useMemo(()=>{let e=a,n=a;try{n=atob(a)}catch(e){console.warn(e)}try{let t=JSON.parse(n);e=t&&"object"==typeof t?t:n}catch(t){e=n,console.warn(t)}let r=!1;return"object"==typeof e&&1e6>=(0,iA.y3)(t)?r=!0:e&&"object"==typeof e&&(e=JSON.stringify(e,null,2)),{preparedMessage:e,decodedMessage:n,isJson:r}},[a,t]),d=c?(0,n.jsx)(nU.p,{collapsedInitially:!0,value:l,toolbarClassName:uZ("json-viewer-toolbar"),scrollContainerRef:i},String(s)):(0,n.jsx)("div",{className:uZ("string-message"),children:(0,n.jsx)(uV.A,{value:l,limit:2e3},String(s))}),u=(0,iA.y3)(t)>1e7;return(0,n.jsx)(uX,{title:(0,n.jsx)(u1,{truncated:u}),renderToolbar:()=>(0,n.jsxs)(tC.s,{gap:1,children:[(0,n.jsx)(tA.m,{title:uS("label_download"),children:(0,n.jsx)(as.$,{view:"flat-secondary",onClick:t=>{t.stopPropagation(),uK(o,`topic-message-${e??"unknown-offset"}`)},children:(0,n.jsx)(tI.I,{data:uH.A})})}),(0,n.jsx)(uW.b,{view:"flat-secondary",text:o})]}),className:uZ("message"),scrollContainerRef:i,children:d})}function u1({truncated:e}){return(0,n.jsxs)("span",{children:[uS("label_message"),e&&(0,n.jsxs)(r.Fragment,{children:[" ",(0,n.jsxs)(tE.E,{color:"secondary",children:["[",uS("label_truncated",{size:(0,iA.IG)(1e7)}),"]"]})]})]})}var u2=a(14204);let u3=(0,d.cn)("ydb-diagnostics-topic-data-columns"),u4={name:uN,header:uU[uN],align:tX.Ay.LEFT,render:({row:e})=>{let{Offset:t,removed:a,notLoaded:r}=e;return(0,n.jsx)(mo,{offset:t,removed:a,notLoaded:r})},width:100},u5={name:uE,header:(0,n.jsx)(du,{title:uU[uE]}),align:tX.Ay.LEFT,render:({row:{CreateTimestamp:e}})=>e?(0,n.jsx)(i$.c,{showStatus:!1,renderName:()=>(0,n.jsx)(ml,{timestamp:e}),name:(0,eW.Ey)(e),hasClipboardButton:!0}):S.Pd,width:220},u6={name:uC,header:(0,n.jsx)(du,{title:uU[uC]}),align:tX.Ay.LEFT,render:({row:{WriteTimestamp:e}})=>e?(0,n.jsx)(i$.c,{showStatus:!1,renderName:()=>(0,n.jsx)(ml,{timestamp:e}),name:(0,eW.Ey)(e),hasClipboardButton:!0}):S.Pd,width:220},u7={name:uA,header:uU[uA],align:tX.Ay.RIGHT,render:({row:{TimestampDiff:e}})=>(0,n.jsx)(mc,{value:e}),width:110,note:uS("context_ts-diff")},u8={name:uI,header:uU[uI],align:tX.Ay.LEFT,render:({row:{MessageMetadata:e}})=>e?e.map(({Key:e="",Value:t=""})=>`${e}: ${t}`).join(", "):S.Pd,width:200},u9={name:uP,header:uU[uP],align:tX.Ay.LEFT,render:({row:{Message:e,OriginalSize:t}})=>(0,n.jsx)(md,{message:e,size:t}),width:500},me={name:uk,header:uU[uk],align:tX.Ay.RIGHT,render:({row:{StorageSize:e}})=>(0,n.jsx)(mu,{size:e}),width:100},mt={name:uD,header:(0,n.jsx)(du,{title:uU[uD]}),align:tX.Ay.RIGHT,render:({row:e})=>(0,eW.z3)(e.OriginalSize),width:100},ma={name:uR,header:uU[uR],align:tX.Ay.RIGHT,render:({row:{Codec:e}})=>(0,o.isNil)(e)?S.Pd:u$[e]??e,width:70},mn={name:uM,header:uU[uM],align:tX.Ay.LEFT,render:({row:e})=>e.ProducerId?(0,n.jsx)(i$.c,{showStatus:!1,name:e.ProducerId,hasClipboardButton:!0}):S.Pd,width:100},mr={name:uO,header:uU[uO],align:tX.Ay.RIGHT,render:({row:e})=>e.SeqNo?(0,n.jsx)(i$.c,{showStatus:!1,name:e.SeqNo,hasClipboardButton:!0}):S.Pd,width:100},mi=["offset","timestampCreate","tsDiff","message"],ms=["offset"];function ml({timestamp:e}){if(!e)return S.Pd;let t=(0,eW.Ey)(e).split("."),a=t.pop();return(0,n.jsxs)(tE.E,{variant:"body-2",children:[t.join("."),(0,n.jsxs)(tE.E,{color:"secondary",variant:"body-2",children:[".",a]})]})}function mo({offset:e,removed:t,notLoaded:a}){let r=eM(),{handleActiveOffsetChange:i}=uF();if((0,o.isNil)(e))return S.Pd;if(t)return(0,n.jsx)(tA.m,{title:uS("description_removed-message"),placement:"right",children:(0,n.jsx)(tE.E,{className:u3("offset",{removed:!0}),variant:"body-2",children:e})});let s=r(j.iJ.topicData,{activeOffset:String(e)});return(0,n.jsxs)(s6.N_,{to:s,onClick:t=>{t.stopPropagation(),t.preventDefault(),i(String(e))},className:u3("offset",{link:!0}),children:[(0,n.jsx)(tE.E,{variant:"body-2",color:"info",children:e}),a&&(0,n.jsx)(nt.A,{content:(0,n.jsx)(tE.E,{className:u3("help"),children:uS("description_not-loaded-message")}),className:u3("help-popover"),children:(0,n.jsx)(tE.E,{color:"secondary",className:u3("help-popover"),children:(0,n.jsx)(tI.I,{data:u2.A})})})]})}function mc({value:e,baseColor:t="primary",variant:a="body-2"}){if((0,o.isNil)(e))return S.Pd;let r=(0,iA.y3)(e);return(0,n.jsx)(tE.E,{variant:a,color:r>=1e5?"danger":t,children:(0,tM.Xo)(r)})}function md({message:e,size:t}){let a;if((0,o.isNil)(e))return S.Pd;let r=!1;try{a=atob(e)}catch{a=uS("description_failed-decode"),r=!0}let i=(0,iA.y3)(t)>100;return(0,n.jsxs)(tE.E,{variant:"body-2",color:r?"secondary":"primary",className:u3("message",{invalid:r}),children:[a,i&&(0,n.jsxs)(tE.E,{color:"secondary",className:u3("truncated"),children:[" ",uS("description_truncated")]})]})}function mu({size:e}){return(0,eW.z3)(e)}function mm(e,t=S.Pd){return(0,o.isNil)(e)?t:e}function mp(){let{selectedPartition:e}=uF();return e}let mh=[{name:u_,header:uU[u_],render:()=>(0,n.jsx)(mp,{})},{name:uN,header:uU[uN],render:({row:e})=>mm(e.Offset)},{name:uE,header:uU[uE],render:({row:e})=>(0,n.jsx)(ml,{timestamp:e.CreateTimestamp})},{name:uC,header:uU[uC],render:({row:e})=>(0,n.jsx)(ml,{timestamp:e.WriteTimestamp})},u7,u8,u9,me,mt,ma,{name:uM,header:uU[uM],render:({row:e})=>mm(e.ProducerId)},{name:uO,header:uU[uO],render:({row:e})=>mm(e.SeqNo)}],mg=[[{name:u_},{name:uN},{name:uk}],[{name:uE,copy:e=>(0,eW.Ey)(e.CreateTimestamp)},{name:uC,copy:e=>(0,eW.Ey)(e.WriteTimestamp)},{name:uA}],[{name:uD},{name:uR},{name:uM,copy:e=>e.ProducerId},{name:uO,copy:e=>e.SeqNo}]];function mx({messageData:e}){return(0,n.jsx)(tC.s,{direction:"column",gap:3,className:uZ("details"),children:mg.map((t,a)=>(0,n.jsx)(cn.u,{className:uZ("list"),nameMaxWidth:200,children:t.map(t=>{let a=mh.find(e=>e.name===t.name),r=t.copy?.(e);return(0,n.jsx)(cn.u.Item,{name:a?.header,copyText:r,children:a?.render?.({row:e})},t.name)})},a))})}function my({data:e}){return(0,n.jsx)(uX,{title:uS("label_metadata"),children:(0,n.jsx)(cn.u,{nameMaxWidth:200,className:uZ("message-meta"),children:e.map(e=>(0,n.jsx)(cn.u.Item,{name:e.Key,copyText:e.Value,children:e.Value},e.Key))})})}function mb({database:e,path:t,scrollContainerRef:a}){let{selectedPartition:i,activeOffset:s}=uF(),c=r.useMemo(()=>{if((0,o.isNil)(i)||(0,o.isNil)(s))return de.hT;let a={database:e,path:t,partition:i,limit:1,message_size_limit:1e7},n=(0,iA.y3)(s);return a.offset=n,a.last_offset=n+1,a},[i,s,e,t]),{currentData:d,error:u,isFetching:m}=a4.useGetTopicDataQuery(c),p=d?.Messages?.[0];return(0,n.jsx)(l.r,{loading:m,children:(0,n.jsx)("div",{className:uZ(),children:(()=>{let e,t,r=(0,N.cH)(u),i=r&&404===u.status;if(d&&!d.Messages?.length||i)return(0,n.jsxs)(tC.s,{direction:"column",grow:"grow",alignItems:"center",justifyContent:"center",height:"100%",children:[(0,n.jsx)(tE.E,{variant:"subheader-2",children:uS("context_message-not-found",{offset:s})}),(0,n.jsx)(tI.I,{data:l9,size:100})]});if(u){let e=uS("context_get-data-error");return r&&"string"==typeof u.data?e=u.data:r&&u.statusText&&(e=u.statusText),(0,n.jsx)(tE.E,{color:"danger",variant:"body-2",children:e})}return(0,n.jsxs)(tC.s,{direction:"column",gap:4,height:"100%",children:[p?(0,n.jsx)(mx,{messageData:p}):null,(e=p?.MessageMetadata)?(0,n.jsx)(my,{data:e}):null,(t=p?.Message)?(0,n.jsx)(u0,{message:t,offset:p.Offset,size:p.OriginalSize,scrollContainerRef:a}):null]})})()})})}let mf={data:[],total:0,found:0},mv=[u4,u5,u6,u7,u8,u9,me,mt,ma,mn,mr];function mj({scrollContainerRef:e,path:t,database:a,databaseFullPath:i}){let[l]=(0,_.Nt)(),c=(0,x.kK)(),[d,u]=r.useState(),[m,p]=r.useState(),[h,g]=r.useState(0),[y,b]=r.useState(!1),[f,v]=r.useState(),[j,T]=r.useState(!1),[w,S]=r.useState(),{selectedPartition:N,selectedOffset:E,startTimestamp:C,topicDataFilter:A,activeOffset:I,handleSelectedOffsetChange:P,handleStartTimestampChange:k,handleSelectedPartitionChange:D,handleActiveOffsetChange:R}=uF();r.useEffect(()=>()=>{D(void 0),P(void 0),k(void 0)},[D,P,k]);let M=r.useMemo(()=>{if((0,o.isNil)(N))return de.hT;let e={database:a,path:t,partition:N,limit:1};return C?e.read_timestamp=C:e.offset=(0,iA.y3)(E),e},[N,E,C,a,t]),{currentData:O,error:q,isFetching:L}=a4.useGetTopicDataQuery(M),{data:z,isLoading:F,error:Q}=dn.aD.useGetPartitionsQuery({path:t,database:a,databaseFullPath:i,useMetaProxy:c},{pollingInterval:l}),U=r.useRef(N);r.useEffect(()=>{let e=N!==U.current,t=z?.find(({partitionId:e})=>e===N);if(t){let a=w;if((!w||e)&&S(a=(0,iA.y3)(t.endOffset)),!f||e){let e=(0,iA.y3)(t.startOffset),n=Math.max((a??0)-5e4,e);T(n!==e),v(n)}}e&&(U.current=N)},[N,z,w,f]),r.useEffect(()=>{if(z&&z.length&&(0,o.isNil)(N)){let e=z[0].partitionId;D((0,o.isNil)(e)?void 0:String(e))}},[z,N,D]);let{columnsToShow:$,columnsToSelect:G,setColumns:B}=(0,dA.K)(mv,"topicDataSelectedColumns",uU,mi,ms),H=r.useCallback(({startOffset:e,endOffset:t})=>{u(e),p(t)},[]);r.useEffect(()=>{!L&&(O||q)&&(!O?.Messages?.length&&(O||q)?(!(O&&O.Messages?.length)||q)&&b(!0):b(!1),O&&H({startOffset:(0,iA.y3)(O.StartOffset),endOffset:(0,iA.y3)(O.EndOffset)}))},[L,O,q,H]);let W=r.useMemo(()=>({path:t,database:a,partition:N??"",isEmpty:y}),[t,a,N,y]),V=r.useCallback(()=>{P(void 0),k(void 0),"TIMESTAMP"===A&&g(e=>e+1)},[P,k,A]),J=r.useCallback(e=>{D(e[0]),V()},[D,V]),K=r.useCallback(t=>{let a=Math.max(0,(t-(f??0))*ug.U3);requestAnimationFrame(()=>{e.current?.scrollTo({top:a,behavior:"instant"})})},[f,e]),Y=r.useRef(E??I);r.useEffect(()=>{let e;if(!(L||(0,o.isNil)(f))){if((0,o.isNil)(Y.current)){let t=O?.Messages;t?.length&&(e=(0,iA.y3)(t[0].Offset))}else e=(0,iA.y3)(Y.current),Y.current=void 0;(0,o.isNil)(e)||K(e)}},[O,L,K,f]);let Z=r.useCallback(()=>(0,n.jsx)(uG,{handlePartitionChange:J,partitions:z,partitionsLoading:F,partitionsError:Q,startOffset:d,endOffset:m,truncatedData:j,scrollToOffset:K},h),[h,m,z,Q,F,K,d,j,J]),X=r.useCallback(()=>(0,n.jsx)(dt.O,{popupWidth:242,items:G,showStatus:!0,onUpdate:B}),[G,B]),ee=r.useMemo(()=>(({setBoundOffsets:e,baseOffset:t=0})=>async({limit:a,offset:n,filters:r})=>{if(!r)return mf;let{partition:i,isEmpty:s,...l}=r;if((0,o.isNil)(i)||""===i||s)return mf;let c=t+n,d={...l,partition:i,limit:a,last_offset:c+a,message_size_limit:100};d.offset=c;let{start:u,end:m,messages:p}=function(e,t){let{StartOffset:a,EndOffset:n,Messages:r=[]}=e,i=(0,iA.y3)(a),s=(0,iA.y3)(n),l=[],c=Math.min(20,Math.max(s-t,0)),d=0,u=0;for(;u<c;){let e=t+u,a=r[d];e<i?l.push({Offset:e,removed:!0}):(0,o.isNil)(a?.Offset)||String(a.Offset)!==String(e)?l.push({Offset:e,notLoaded:!0}):(l.push(a),d++),u++}return{start:i,end:s,messages:l}}(await window.api.viewer.getTopicData(d),c);e({startOffset:u,endOffset:m});let h=m-t;return{data:p,total:h,found:h}})({setBoundOffsets:H,baseOffset:f}),[f,H]),et=r.useCallback(()=>{R(void 0)},[R]),ea=r.useCallback(()=>(0,n.jsx)(uh,{children:(0,n.jsx)(mb,{database:a,path:t,scrollContainerRef:e})}),[a,t,e]);return q?(0,n.jsx)(s.A,{error:q,position:"left"}):!(0,o.isNil)(f)&&!(0,o.isNil)(w)&&(0,n.jsx)(lZ,{isDrawerVisible:!(0,o.isNil)(I),onCloseDrawer:et,renderDrawerContent:ea,drawerId:"topic-data-details",storageKey:"topic-data-details-drawer-width",detectClickOutside:!0,isPercentageWidth:!0,drawerControls:[{type:"copyLink",link:window.location.href},{type:"custom",node:(0,n.jsx)(uc,{disabled:!!q,view:"flat"}),key:"fullscreen"},{type:"close"}],title:uS("label_message"),headerClassName:uQ("drawer-header"),children:(0,n.jsx)(ux.o,{controls:Z(),extraControls:X(),table:(0,n.jsx)(ug.k5,{columnsWidthLSKey:"topicDataColumnsWidth",scrollContainerRef:e,columns:$,fetchData:ee,initialEntitiesCount:w-f,limit:20,renderErrorMessage:uy.$,renderEmptyDataMessage:()=>{let e=E||C;return(0,n.jsx)(ur.U,{title:uS("label_nothing-found"),message:uS("description_nothing-found"),onShowAll:e?V:void 0,showAll:uS("action_show-all"),image:(0,n.jsx)(un.oN,{width:230,height:230})})},filters:W,tableName:ug.qr.TOPIC_DATA,rowHeight:ug.U3,keepCache:!1,getRowClassName:e=>uQ("row",{active:(0,iA.y3)(e.Offset)===E||String(e.Offset)===I,removed:e.removed})}),tableWrapperProps:{scrollContainerRef:e,scrollDependencies:[f,w,W]},noBatching:!0})})}var mT=a(88831);let mw=(0,d.cn)("kv-tenant-diagnostics"),mS=function({path:e,database:t,databaseFullPath:a,type:s,subType:l,databasePagesDisplay:o,additionalTenantProps:c}){let d=r.useRef(null),u=(0,_.YQ)(),{diagnosticsTab:m=j.iJ.overview}=(0,_.N4)(e=>e.tenant),p=function({path:e,database:t,databaseFullPath:a,type:n,subType:i,databasePagesDisplay:s}){let{controlPlane:l,databaseType:o}=(0,T.Ry)(ee(n)?t:""),{monitoring:c}=(0,x.Zd)(),d=(0,al.RK)(),u=(0,al._p)(),m=(0,mT.b)();return r.useMemo(()=>{var t,r,p;let h,g,x;return t={hasTopicData:u,isTopLevel:e===a,hasBackups:"function"==typeof w.J.renderBackups&&!!l,hasConfigs:m&&d,hasAccess:w.J.hasAccess,hasMonitoring:(0,sP.P)(l,c),databaseType:o,databasePagesDisplay:s},h=i?eR[i]:void 0,g=n?eD[n]:void 0,x=h||g||ek,function(e,t={}){let a=[];return t.hasTopicData||a.push(j.iJ.topicData),t.hasBackups||a.push(j.iJ.backups),t.hasConfigs||a.push(j.iJ.configs),t.hasAccess||a.push(j.iJ.access),t.hasMonitoring||a.push(j.iJ.monitoring),e.filter(e=>!a.includes(e.id))}(ee(n)||t?.isTopLevel?(r=t?.databaseType,p=t?.databasePagesDisplay,"Serverless"===r?"diagnostics"===p?eP:"schema"===p?eI:eA:"diagnostics"===p?eC:"schema"===p?eE:eN):x,t)},[s,n,i,e,a,l,o,c,d,u,m])}({path:e,database:t,databaseFullPath:a,type:s,subType:l,databasePagesDisplay:o}),h=r.useMemo(()=>{let e=p.find(e=>e.id===m);return e||(e=p[0]),e},[m,p]);return r.useEffect(()=>{h&&h.id!==m&&u((0,T.WO)(h.id))},[h,m,u]),(0,_.Mq)(d,`tenant-diagnostics-${t}-${h?.id}`,h?.id===j.iJ.overview),(0,n.jsxs)("div",{className:mw(),children:[h?(0,n.jsx)(i.mg,{children:(0,n.jsx)("title",{children:h.title})}):null,(0,n.jsx)(eq,{activeTab:h,tabs:p}),(0,n.jsx)(C.e,{children:(0,n.jsx)("div",{className:mw("page-wrapper"),ref:d,children:function({activeTabId:e,type:t,subType:a,database:r,path:i,databaseFullPath:s,additionalTenantProps:l,scrollContainerRef:o}){switch(e){case j.iJ.database:return(0,n.jsx)(c_,{database:r,databaseFullPath:s,additionalTenantProps:l});case j.iJ.overview:return(0,n.jsx)(cE,{type:t,database:r,path:i,databaseFullPath:s,additionalTenantProps:l});case j.iJ.schema:return(0,n.jsx)(ar,{path:i,database:r,databaseFullPath:s,type:t,extended:!0});case j.iJ.topQueries:return(0,n.jsx)(d0,{database:r});case j.iJ.topShards:return(0,n.jsx)(ua,{database:r,path:i,databaseFullPath:s});case j.iJ.nodes:return(0,n.jsx)(to.G,{path:i,databaseFullPath:s,database:r,scrollContainerRef:o});case j.iJ.access:return(0,n.jsx)(a0,{});case j.iJ.tablets:return(0,n.jsx)(t$.C,{scrollContainerRef:o,path:i,databaseFullPath:s,database:r});case j.iJ.storage:return(0,n.jsx)(tU.z,{database:r,scrollContainerRef:o});case j.iJ.network:return(0,n.jsx)(c9,{path:i,databaseFullPath:s,database:r,scrollContainerRef:o});case j.iJ.describe:return(0,n.jsx)(nG,{path:i,databaseFullPath:s,database:r,scrollContainerRef:o});case j.iJ.hotKeys:return(0,n.jsx)(cR,{path:i,databaseFullPath:s,database:r});case j.iJ.graph:return(0,n.jsx)(tl,{path:i,databaseFullPath:s,database:r});case j.iJ.consumers:return(0,n.jsx)(nQ,{path:i,databaseFullPath:s,database:r,type:t});case j.iJ.partitions:return(0,n.jsx)(dP,{path:i,databaseFullPath:s,database:r});case j.iJ.topicData:return(0,n.jsx)(mj,{path:i,databaseFullPath:s,database:r,scrollContainerRef:o},i);case j.iJ.configs:return(0,n.jsx)(ez.U,{database:r,scrollContainerRef:o});case j.iJ.operations:return(0,n.jsx)(tQ,{database:r,scrollContainerRef:o});case j.iJ.backups:return w.J.renderBackups?.({database:r,scrollContainerRef:o});case j.iJ.monitoring:return w.J.renderMonitoring?.({type:t,subType:a,database:r,path:i,databaseFullPath:s,additionalTenantProps:l,scrollContainerRef:o});default:return(0,n.jsx)("div",{children:ei("no-data")})}}({activeTabId:h.id,type:s,subType:l,database:t,path:e,databaseFullPath:a,additionalTenantProps:c,scrollContainerRef:d})})})]})};var m_=a(94169),mN=a(47734);let mE=(0,d.cn)("kv-truncated-query"),mC=({value:e="",maxQueryHeight:t=6,hasClipboardButton:a,clipboardButtonAlwaysVisible:i})=>{let s=e.split("\n");if(s.length>t){let l=s.slice(0,t).join("\n");return(0,n.jsxs)(r.Fragment,{children:[(0,n.jsx)(rh.YDBSyntaxHighlighter,{language:"yql",className:mE(),text:l,withClipboardButton:a?{alwaysVisible:i,copyText:e,withLabel:!1}:void 0}),(0,n.jsx)("span",{className:mE("message",{color:"secondary"}),children:"\n...\nThe request was truncated. Click on the line to show the full query on the query tab"})]})}return(0,n.jsx)(rh.YDBSyntaxHighlighter,{language:"yql",className:mE(),text:e,withClipboardButton:a?{alwaysVisible:i,copyText:e,withLabel:!1}:void 0})};var mA=JSON.parse('{"action_cancel":"Cancel"}');let mI=(0,en.g4)("ydb-confirmation-dialog",{en:mA}),mP=(0,d.cn)("confirmation-dialog"),mk="confirmation-dialog";function mD({caption:e="",children:t,onConfirm:a,onClose:r,progress:i,textButtonApply:s,textButtonCancel:l,buttonApplyView:o="normal",className:c,renderButtons:d,open:u}){return(0,n.jsxs)(aR.l,{className:mP(null,c),size:"s",onClose:r,disableOutsideClick:!0,open:u,children:[(0,n.jsx)(aR.l.Header,{caption:(0,n.jsx)("span",{className:mP("caption"),children:e})}),(0,n.jsx)(aR.l.Body,{children:t}),(0,n.jsx)(aR.l.Footer,{onClickButtonApply:a,propsButtonApply:{view:o},textButtonApply:s,textButtonCancel:l??mI("action_cancel"),onClickButtonCancel:r,loading:i,renderButtons:d})]})}let mR=aD.vt(e=>{let t=aD.hS(),a=()=>{t.hide(),t.remove()};return(0,n.jsx)(mD,{...e,onConfirm:async()=>{await e.onConfirm?.(),t.resolve(!0),a()},onClose:()=>{e.onClose?.(),t.resolve(!1),a()},open:t.visible})});aD.kz(mk,mR);var mM=a(33039);function mO(){let[e,t]=(0,_.iK)(s3.GS.SAVED_QUERIES),a=(0,_.N4)(mM.cu).trim().toLowerCase(),n=(0,_.N4)(lX.Wp),i=r.useMemo(()=>{let t=e??[];return a?t.filter(e=>e.body.toLowerCase().includes(a)):t},[e,a]),s=r.useCallback(a=>{t((e??[]).filter(e=>!mq(e,a)))},[e,t]),l=r.useCallback(a=>{if(!a)return;let r=e??[],i=[...r],s=r.findIndex(e=>mq(e,a));s>=0?i[s]={...r[s],body:n}:i.push({name:a,body:n}),t(i)},[e,t,n]);return{savedQueries:e,filteredSavedQueries:i,deleteSavedQuery:s,saveQuery:l}}function mq(e,t){return e.name.toLowerCase()===t.toLowerCase()}var mL=JSON.parse('{"action.save":"Save query","action.edit":"Edit query","action.save-as-new":"Save as new","action.edit-existing":"Edit existing","description":"The query will be saved in your browser","input-label":"Query name","input-placeholder":"Enter query name","button-apply":"Save","button-cancel":"Cancel","error.name-exists":"This name already exists","error.name-not-empty":"Name should not be empty"}');let mz=(0,en.g4)("ydb-save-query-dialog",{en:mL}),mF=(0,d.cn)("ydb-save-query"),mQ="save-query-dialog";function mU(e){let t=(0,_.YQ)(),{savedQueries:a,saveQuery:n}=mO(),i=(0,_.N4)(lX.gU);return r.useCallback(()=>{let r=i?.isTitleUserDefined?i.title:void 0;aD.Ay.show(mQ,{...e,defaultQueryName:e?.defaultQueryName??r,savedQueries:a,onSaveQuery:n}),t((0,mM.gJ)())},[i?.isTitleUserDefined,i?.title,t,e,a,n])}function m$({dialogProps:e,...t}){let a=mU(e);return(0,n.jsx)(as.$,{onClick:a,...t,children:mz("action.save")})}function mG({buttonProps:e={}}){let t,a=(0,_.YQ)(),r=(0,_.N4)(mM.aW),i=mU(),{saveQuery:s}=mO();return r?(t=[{action:()=>{s(r),a((0,lX.Xb)(!1)),a((0,mM.gJ)())},text:mz("action.edit-existing")},{action:i,text:mz("action.save-as-new")}],(0,n.jsx)(i6.r,{items:t,renderSwitcher:t=>(0,n.jsx)(as.$,{...t,...e,children:mz("action.edit")}),popupProps:{placement:"top"}})):(0,n.jsx)(m$,{})}function mB({onSuccess:e,onCancel:t,onClose:a,defaultQueryName:i,open:s,savedQueries:l,onSaveQuery:o}){let c=(0,_.YQ)(),[d,u]=r.useState(i??""),[m,p]=r.useState(),h=()=>{c((0,mM.NJ)("idle")),u(""),p(void 0),a?.()},g=()=>{t?.(),h()};return(0,n.jsxs)(aR.l,{open:s,hasCloseButton:!1,size:"s",onClose:g,children:[(0,n.jsx)(aR.l.Header,{caption:mz("action.save")}),(0,n.jsxs)("form",{onSubmit:t=>{t.preventDefault();let a=d?l?.some(e=>e.name.toLowerCase()===d.trim().toLowerCase())?mz("error.name-exists"):void 0:mz("error.name-not-empty");p(a),a||(o(d),c((0,lX.Xb)(!1)),h(),e?.())},children:[(0,n.jsxs)(aR.l.Body,{className:mF("dialog-body"),children:[(0,n.jsx)("div",{className:mF("dialog-row"),children:mz("description")}),(0,n.jsxs)("div",{className:mF("dialog-row"),children:[(0,n.jsx)("label",{htmlFor:"queryName",className:mF("field-title","required"),children:mz("input-label")}),(0,n.jsx)("div",{className:mF("control-wrapper"),children:(0,n.jsx)(aM.k,{id:"queryName",placeholder:mz("input-placeholder"),value:d,onUpdate:e=>{u(e),p(void 0)},hasClear:!0,autoFocus:!0,autoComplete:!1,validationState:m?"invalid":void 0,errorMessage:m})})]})]}),(0,n.jsx)(aR.l.Footer,{textButtonApply:mz("button-apply"),textButtonCancel:mz("button-cancel"),onClickButtonCancel:g,propsButtonApply:{type:"submit"}})]})]})}let mH=aD.Ay.create(e=>{let t=aD.Ay.useModal();return(0,n.jsx)(mB,{...e,onClose:()=>{e.onClose?.(),t.hide(),t.remove()},open:t.visible})});aD.Ay.register(mQ,mH);var mW=JSON.parse('{"action_apply":"Don\'t save","context_unsaved-changes-warning":"You have unsaved changes in query editor.\\nDo you want to proceed?"}');let mV=(0,en.g4)("ydb-change-input-confirmation",{en:mW});function mJ(){let e=aD.Ay.useModal(mk),t=r.useCallback(()=>{e.hide(),e.remove()},[e]),a=r.useCallback(()=>{e.resolve(!0),t()},[e,t]),i=r.useCallback(()=>{e.resolve(!1),t()},[t,e]),s=r.useMemo(()=>({onSuccess:a,onCancel:i}),[a,i]);return(0,n.jsx)(m$,{view:"action",size:"l",dialogProps:s})}async function mK(){return await aD.Ay.show(mk,{id:mk,caption:mV("context_unsaved-changes-warning"),textButtonApply:mV("action_apply"),propsButtonApply:{view:"l"},renderButtons:(e,t)=>(0,n.jsxs)(r.Fragment,{children:[t,(0,n.jsx)(mJ,{}),e]})})}function mY(e){let t=(0,_.N4)(lX.Wp),a=(0,_.N4)(lX.TY),n=r.useMemo(()=>async t=>{await mK()&&e(t)},[e]);return t&&a?n:e}var mZ=JSON.parse('{"controls.query-mode-selector_type":"Query type:","tabs.newQuery":"Editor","tabs.history":"History","tabs.saved":"Saved","history.empty":"History is empty","history.empty-search":"Search result is empty","saved.empty":"There are no saved queries","delete-dialog.header":"Delete query","delete-dialog.question":"Are you sure you want to delete query","delete-dialog.delete":"Delete","delete-dialog.cancel":"Cancel","preview.title":"Preview","preview.not-available":"Preview is not available","preview.close":"Close preview","preview.truncated":"truncated","method-description.script":"For YQL-scripts combining DDL and DML.\\nAPI call: schema.scripting","method-description.scan":"Read-only queries, potentially reading a lot of data.\\nAPI call: table.ExecuteScan","method-description.data":"DML queries for changing and fetching data in serialization mode.\\nAPI call: table.executeDataQuery","method-description.query":"Any query. An experimental API call supposed to replace all existing methods.\\nAPI Call: query.ExecuteScript","method-description.pg":"Queries in postgresql syntax.\\nAPI call: query.ExecuteScript","transaction-mode-description.serializable":"Provides the strictest isolation level for custom transactions","transaction-mode-description.onlinero":"Each read operation in the transaction is reading the data that is most recent at execution time","transaction-mode-description.stalero":"Read operations within a transaction may return results that are slightly out-of-date (lagging by fractions of a second)","transaction-mode-description.snapshot":"All the read operations within a transaction access the database snapshot. All the data reads are consistent","transaction-mode-description.implicit":"No transaction","tracing-level-description.basic":"Spans of main component operations","tracing-level-description.detailed":"Highest detail applicable for diagnosing problems in production","tracing-level-description.diagnostic":"Detailed debugging information for developers","tracing-level-description.off":"No tracing","tracing-level-description.toplevel":"Lowest detail, no more than two spans per request to the component","tracing-level-description.trace":"Very detailed debugging information","statistics-mode-description.none":"Don\'t collect statistics","statistics-mode-description.basic":"Collect statistics","statistics-mode-description.full":"Collect statistics and query plan","statistics-mode-description.profile":"Collect statistics for individual tasks","action.send-query":"Send query","action.send-selected-query":"Send selected query","action.previous-query":"Previous query in history","action.next-query":"Next query in history","action.save-query":"Save query","action.stop":"Stop","action.run":"Run","action.explain":"Explain","action.open-shortcuts":"Open Keyboard Shortcuts Panel","editor-tabs.untitled":"Untitled","editor-tabs.default-title":"Query {{index}}","editor-tabs.duplicate-title":"{{title}} copy","editor-tabs.rename":"Rename tab","editor-tabs.duplicate":"Duplicate tab","editor-tabs.add-to-favorites":"Add to favorites","editor-tabs.save-query-as":"Save query as...","editor-tabs.share-query":"Share query","editor-tabs.close":"Close tab","editor-tabs.close-other-tabs":"Close other tabs","editor-tabs.close-all-tabs":"Close all tabs","editor-tabs.rename-dialog.title":"Rename tab","editor-tabs.rename-dialog.input-placeholder":"Tab name","editor-tabs.rename-dialog.error-empty":"Tab name can\'t be empty","editor-tabs.rename-dialog.apply":"Rename","editor-tabs.rename-dialog.cancel":"Cancel","editor-tabs.action.new-tab":"New editor tab","editor-tabs.action.close-tab":"Close editor tab","editor-tabs.action.next-tab":"Next editor tab","editor-tabs.action.previous-tab":"Previous editor tab","filter.text.placeholder":"Search by query text...","gear.tooltip":"Query execution settings have been changed for ","banner.query-settings.message":"Query was executed with modified settings: ","banner.query-stopped.message":"Data is not up to date because the request was not completed.","banner.query-stopped.never-show":"Never show again","toaster.stop-error":"Something went wrong. Unable to stop request processing. Please wait.","history.queryText":"Query text","history.endTime":"End time","history.duration":"Duration"}');let mX=(0,en.g4)("ydb-query-editor",{en:mZ}),m0=(0,d.cn)("ydb-queries-history"),m1=function({changeUserInput:e,queriesHistory:t}){let a=(0,_.YQ)(),i=r.useMemo(()=>t.filteredHistoryQueries.toReversed(),[t.filteredHistoryQueries]),s=(0,_.N4)(lX.jY),l=mY(t=>{e({input:t.queryText}),a((0,lX.Xb)(!1)),a((0,T.sH)(j.tQ.newQuery))}),o=[{name:"queryText",header:mX("history.queryText"),render:({row:e})=>(0,n.jsx)("div",{className:m0("query"),children:(0,n.jsx)(mC,{value:e.queryText,maxQueryHeight:6})}),sortable:!1,width:600},{name:"EndTime",header:mX("history.endTime"),render:({row:e})=>e.endTime?(0,eW.r6)(e.endTime.toString()):"-",align:"right",width:200,sortable:!1},{name:"Duration",header:mX("history.duration"),render:({row:e})=>e.durationUs?(0,tM.Xo)((0,tM.Jc)(e.durationUs)):"-",align:"right",width:150,sortable:!1}];return(0,n.jsxs)(tu.L,{className:m0(),children:[(0,n.jsx)(tu.L.Controls,{children:(0,n.jsx)(tm.v,{value:s,onChange:e=>{a((0,lX.Ni)(e))},placeholder:mX("filter.text.placeholder"),className:m0("search")})}),(0,n.jsx)(tu.L.Table,{children:(0,n.jsx)(tc.l,{columnsWidthLSKey:"queriesHistoryTableColumnsWidth",columns:o,data:i,settings:l3,emptyDataMessage:mX(s?"history.empty-search":"history.empty"),onRowClick:e=>l(e),rowClassName:()=>m0("table-row")})})]})};var m2=a(78414);function m3(e,t){let a=new Map(Object.entries(e)),n=new Map(Object.entries(t));return Array.from(a.keys()).filter(e=>a.has(e)&&void 0!==a.get(e)&&a.get(e)!==n.get(e))}var m4=JSON.parse('{"action.settings":"Query settings","form.query-mode":"Query type","form.timeout":"Timeout","form.transaction-mode":"Transaction mode","form.statistics-mode":"Statistics collection mode","form.tracing-level":"Tracing level","form.limit-rows":"Limit rows","form.output.chunk.max.size":"Output chunk max size","form.output.chunk.max.size.bytes":"bytes","form.pragmas":"Pragmas","form.resource-pool":"Resource pool","form.resource-pool.no-override":"No pool override","button-done":"Save","tooltip_plan-to-svg-statistics":"Statistics option is set to \\"Full\\" due to the enabled \\"Execution plan\\" experiment.\\n To disable it, go to the \\"Experiments\\" section in the user settings.","button-cancel":"Cancel","form.timeout.seconds":"sec","form.limit.rows":"rows","form.timeout.disabled":"Not available to turn off in this query type","form.validation.timeout":"Must be positive","form.validation.limitRows":"Must be between 1 and 100000","description.default":" (default)","docs":"Documentation"}'),m5=JSON.parse('{"action.settings":"Настройки запроса","form.query-mode":"Тип запроса","form.timeout":"Таймаут","form.transaction-mode":"Уровень изоляции","form.statistics-mode":"Режим сбора статистики","form.tracing-level":"Tracing level","form.limit-rows":"Лимит строк","form.output.chunk.max.size":"Максимальный размер чанка","form.output.chunk.max.size.bytes":"байт","form.pragmas":"Прагмы","form.resource-pool":"Пул ресурсов","form.resource-pool.no-override":"Без переопределения пула","tooltip_plan-to-svg-statistics":"Опция статистики установлена в значение \\"Full\\" из-за включенного эксперимента \\"Execution plan\\".\\n Чтобы отключить его, перейдите в раздел \\"Experiments\\" в настройках пользователя.","button-done":"Готово","button-cancel":"Отменить","form.timeout.seconds":"сек","form.limit.rows":"строк","form.timeout.disabled":"Невозможно выключить для текущего типа запроса","form.validation.timeout":"Таймаут должен быть положительным","form.validation.limitRows":"Лимит строк должен быть между 1 и 100000","description.default":" (default)","docs":"Документация"}');let m6=(0,en.g4)("ydb-query-settings-dialog",{en:m4,ru:m5}),m7=[{value:tH.Wg.implicit,content:tH._d[tH.Wg.implicit],text:mX("transaction-mode-description.implicit"),isDefault:!0},{value:tH.Wg.serializable,content:tH._d[tH.Wg.serializable],text:mX("transaction-mode-description.serializable")},{value:tH.Wg.onlinero,content:tH._d[tH.Wg.onlinero],text:mX("transaction-mode-description.onlinero")},{value:tH.Wg.stalero,content:tH._d[tH.Wg.stalero],text:mX("transaction-mode-description.stalero")},{value:tH.Wg.snapshot,content:tH._d[tH.Wg.snapshot],text:mX("transaction-mode-description.snapshot")}],m8=[{value:tH.ei.query,content:tH.om[tH.ei.query],text:mX("method-description.query"),isDefault:!0},{value:tH.ei.script,content:tH.om[tH.ei.script],text:mX("method-description.script")},{value:tH.ei.scan,content:tH.om[tH.ei.scan],text:mX("method-description.scan")},{value:tH.ei.data,content:tH.om[tH.ei.data],text:mX("method-description.data")},{value:tH.ei.pg,content:tH.om[tH.ei.pg],text:mX("method-description.pg")}],m9=[{value:tH.pE.none,content:tH.Pn[tH.pE.none],text:mX("statistics-mode-description.none"),isDefault:!0},{value:tH.pE.basic,content:tH.Pn[tH.pE.basic],text:mX("statistics-mode-description.basic")},{value:tH.pE.full,content:tH.Pn[tH.pE.full],text:mX("statistics-mode-description.full")},{value:tH.pE.profile,content:tH.Pn[tH.pE.profile],text:mX("statistics-mode-description.profile")}],pe=[{value:tH.PB.off,content:tH.PX[tH.PB.off],text:mX("tracing-level-description.off"),isDefault:!0},{value:tH.PB.toplevel,content:tH.PX[tH.PB.toplevel],text:mX("tracing-level-description.toplevel")},{value:tH.PB.basic,content:tH.PX[tH.PB.basic],text:mX("tracing-level-description.basic")},{value:tH.PB.detailed,content:tH.PX[tH.PB.detailed],text:mX("tracing-level-description.detailed")},{value:tH.PB.diagnostic,content:tH.PX[tH.PB.diagnostic],text:mX("tracing-level-description.diagnostic")},{value:tH.PB.trace,content:tH.PX[tH.PB.trace],text:mX("tracing-level-description.trace")}],pt={transactionMode:{title:m6("form.transaction-mode"),options:m7},queryMode:{title:m6("form.query-mode"),options:m8},statisticsMode:{title:m6("form.statistics-mode"),options:m9},tracingLevel:{title:m6("form.tracing-level"),options:pe},timeout:{title:m6("form.timeout")},limitRows:{title:m6("form.limit-rows")},outputChunkMaxSize:{title:m6("form.output.chunk.max.size")},pragmas:{title:m6("form.pragmas")},resourcePool:{title:m6("form.resource-pool")}};function pa({currentSettings:e,defaultSettings:t}){let a=m3(e,t),n={};return a.forEach(t=>{let a=pt[t],r=e[t];if("options"in a){let e=a.options.find(e=>e.value===r)?.content;e&&(n[a.title]=e)}else r&&(n[a.title]=String(r))}),n}let pn=()=>{let e,[t,a]=(0,u.i)(s3.GS.LAST_QUERY_EXECUTION_SETTINGS);try{e=tH.id.parse(t)}catch{e=void 0}return[e,a]};var pr=a(2887);let pi=()=>{let[e,t]=(0,u.i)(s3.GS.QUERY_SETTINGS_BANNER_LAST_CLOSED),[a]=pn(),[n]=(0,pr.X)(),r=a?m3(a,tH.jU):[],i=n?m3(n,tH.jU):[],s=r.includes("transactionMode")||r.includes("queryMode"),l=a?pa({currentSettings:a,defaultSettings:tH.jU}):{},o=n?pa({currentSettings:n,defaultSettings:tH.jU}):{},c=e&&Date.now()-e<1e3*S.Du;return{isBannerShown:s&&!c,closeBanner:()=>t(Date.now()),resetBanner:()=>t(void 0),changedCurrentSettings:i,changedCurrentSettingsDescriptions:o,changedLastExecutionSettings:r,changedLastExecutionSettingsDescriptions:l}};var ps=a(14840);function pl(e,t){switch(t){case"triggerCollapse":return{...e,triggerCollapse:!0,triggerExpand:!1,collapsed:!0};case"triggerExpand":return{...e,triggerCollapse:!1,triggerExpand:!0,collapsed:!1};case"clear":return{triggerCollapse:!1,triggerExpand:!1,collapsed:!1};default:return e}}let po=(0,d.cn)("kv-pane-visibility-button");function pc({onCollapse:e,onExpand:t,isCollapsed:a,initialDirection:i="top",className:s}){return(0,ud.u)([a]),(0,n.jsxs)(r.Fragment,{children:[(0,n.jsx)(tA.m,{title:"Collapse",children:(0,n.jsx)(as.$,{view:"flat-secondary",onClick:e,className:po({hidden:a,type:"collapse"},s),children:(0,n.jsx)(tI.I,{data:ps.A,className:po({[i]:!0})})})}),(0,n.jsx)(tA.m,{title:"Expand",children:(0,n.jsx)(as.$,{view:"flat-secondary",onClick:t,className:po({hidden:!a,type:"expand"},s),children:(0,n.jsx)(tI.I,{data:ps.A,className:po({[i]:!0},"rotate")})})})]})}let pd=(0,d.cn)("ydb-preview");function pu({path:e,quantity:t=0,truncated:a,renderResult:r,loading:i,error:s}){let o=(0,_.YQ)();return(0,n.jsx)(l.r,{loading:i,children:(0,n.jsxs)("div",{className:pd(),children:[(0,n.jsxs)(tC.s,{justifyContent:"space-between",alignItems:"center",className:pd("header"),children:[(0,n.jsxs)(tC.s,{gap:1,children:[mX("preview.title"),(0,n.jsxs)(tE.E,{color:"secondary",variant:"body-2",children:[a?`${mX("preview.truncated")} `:"","(",t,")"]}),(0,n.jsx)("div",{className:pd("table-name"),children:e})]}),(0,n.jsxs)("div",{className:pd("controls-left"),children:[(0,n.jsx)(uc,{disabled:!!s}),(0,n.jsx)(as.$,{view:"flat-secondary",onClick:()=>{o((0,v.o)(!1))},title:mX("preview.close"),children:(0,n.jsx)(tI.I,{data:lq.A,size:18})})]})]}),(0,n.jsx)(uh,{children:(0,n.jsx)("div",{className:pd("result"),children:s?(0,n.jsx)("div",{className:pd("message-container","error"),children:(0,tH.Cb)(s)}):r?.()})})]})})}let pm=r.memo(function(e){let{className:t,value:a}=e,[i,s]=r.useState(!1),l=r.useRef(null),o=r.useCallback(()=>{s(e=>!e)},[]),c=r.useCallback(()=>{s(!1)},[]);return(0,n.jsxs)(r.Fragment,{children:[(0,n.jsx)(eF.z,{open:i,hasArrow:!0,placement:["top","bottom"],anchorRef:l,onOutsideClick:c,children:(0,n.jsx)("div",{className:py("cell-popup"),children:a})}),(0,n.jsx)("span",{ref:l,className:py("cell",t),onClick:o,children:a})]})});var pp=JSON.parse('{"empty":"Table is empty"}'),ph=JSON.parse('{"empty":"Таблица пустая"}');let pg=(0,en.g4)("ydb-query-result-table",{ru:ph,en:pp}),px={...S.N3,stripedRows:!0,sortable:!1,displayIndices:!0},py=(0,d.cn)("ydb-query-result-table"),pb=(e,t)=>t,pf=(e,t)=>t+1,pv=e=>{let{columns:t,data:a,settings:i}=e,s=r.useMemo(()=>t?((e,t)=>{if(!e.length)return[];let a=t?.slice(0,100);return e.map(({name:e,type:t})=>{let r=(0,tH.GE)(t);return{name:e,width:t0({data:a,name:e}),align:"number"===r?tX.Ay.RIGHT:tX.Ay.LEFT,render:({row:t})=>{let a=t[e],i="binary-string"===r&&"string"==typeof a?JSON.stringify(a).slice(1,-1):String(a);return(0,n.jsx)(pm,{value:i})}}})})(t,a):(e=>{if(!e?.length)return[];let t=e?.slice(0,100);return Object.keys(e[0]).map(a=>({name:a,width:t0({data:t,name:a}),align:(0,iA.kf)(e[0][a])?tX.Ay.RIGHT:tX.Ay.LEFT,render:({row:e})=>(0,n.jsx)(pm,{value:String(e[a])})}))})(a),[t,a]),l=r.useMemo(()=>({...px,...i}),[i]);return Array.isArray(a)?s.length?(0,n.jsx)(tc.l,{data:a,columns:s,settings:l,rowKey:pb,visibleRowIndex:pf,wrapperClassName:py("table-wrapper")}):(0,n.jsx)("div",{className:py("message"),children:pg("empty")}):null},pj=b.F.injectEndpoints({endpoints:e=>({sendQuery:e.query({queryFn:async({query:e,database:t,action:a,limitRows:n,base64:r},{signal:i})=>{try{let s=await window.api.viewer.sendQuery({query:e,database:t,action:a,limit_rows:n,base64:r},{signal:i,withRetries:!0});if((0,tH.We)(s))return{error:s};return{data:(0,tH.fW)(s)}}catch(e){return{error:e||Error("Unauthorized")}}},providesTags:["PreviewData"]})}),overrideExisting:"throw"});function pT({database:e,path:t,type:a,databaseFullPath:r}){let[i]=(0,pr.X)(),[s]=(0,u.i)(s3.GS.BINARY_DATA_IN_PLAIN_TEXT_DISPLAY),l=tG(t,r),o=`select * from \`${l}\` limit 101`,c=(0,mN.ZS)(o,i.pragmas),{currentData:d,isFetching:m,error:p}=pj.useSendQueryQuery({database:e,query:c,action:"EPathTypeExternalTable"===a?"execute-query":"execute-scan",limitRows:100,base64:!s},{refetchOnMountOrArgChange:!0}),h=m&&void 0===d,g=d?.resultSets?.[0]??{};return(0,n.jsx)(pu,{path:l,renderResult:()=>(0,n.jsx)(pv,{data:g.result,columns:g.columns}),loading:h,error:p,truncated:g.truncated,quantity:g.result?.length})}var pw=JSON.parse('{"label_partition-id":"Partition ID: {{id}}","label_offsets-range":"offsets: {{start}} - {{end}}"}');let pS=(0,en.g4)("ydb-preview",{en:pw}),p_=[{name:uN,header:uU[uN],render:({row:{Offset:e}})=>(0,o.isNil)(e)?S.Pd:e,sortable:!1},{name:uE,header:uU[uE],render:({row:{CreateTimestamp:e,TimestampDiff:t}})=>(0,n.jsxs)(r.Fragment,{children:[(0,n.jsx)(ml,{timestamp:e}),(0,n.jsx)("br",{}),(0,n.jsx)(mc,{value:t,baseColor:"secondary",variant:"body-1"})]}),width:200,sortable:!1},{name:uP,header:uU[uP],render:({row:{Message:e,OriginalSize:t}})=>(0,n.jsx)(md,{message:e,size:t}),width:500,sortable:!1},{name:uk,header:uU[uk],render:({row:{StorageSize:e}})=>(0,n.jsx)(mu,{size:e}),align:"right",width:100,sortable:!1}];function pN({messages:e}){return(0,n.jsx)(tc.l,{data:e,columns:p_,settings:S.N3,rowKey:(e,t)=>e.Offset??t,wrapperClassName:pd("table-wrapper"),emptyDataMessage:"No data"})}function pE({database:e,path:t,databaseFullPath:a}){let i=(0,x.kK)(),{data:s,isLoading:l,error:c}=dn.aD.useGetPartitionsQuery({path:t,database:e,databaseFullPath:a,useMetaProxy:i}),d=r.useMemo(()=>s?.[0],[s]),u=r.useMemo(()=>{let a=d?.partitionId;return!d||(0,o.isNil)(a)?de.hT:{database:e,path:t,partition:String(a),limit:100,offset:(0,iA.y3)(d.endOffset)-100,message_size_limit:100}},[e,t,d]),{currentData:m,error:p,isFetching:h}=a4.useGetTopicDataQuery(u),g=l||h&&void 0===m,y=r.useMemo(()=>{if(d)return{start:(0,iA.y3)(d.startOffset),end:Math.max((0,iA.y3)(d.endOffset)-1,0)}},[d]),b=r.useCallback(()=>(0,n.jsxs)(tC.s,{direction:"column",children:[(0,n.jsxs)(tC.s,{className:pd("partition-info"),alignItems:"center",gap:2,children:[!(0,o.isNil)(d?.partitionId)&&(0,n.jsx)(tE.E,{variant:"body-2",children:pS("label_partition-id",{id:d.partitionId})}),y&&(0,n.jsxs)(tE.E,{variant:"body-2",color:"secondary",children:["(",pS("label_offsets-range",y),")"]})]}),m&&(0,n.jsx)(pN,{messages:m.Messages?.toReversed()??[]})]}),[y,d,m]),f=(0,iA.y3)(m?.EndOffset)-(0,iA.y3)(m?.StartOffset);return(0,n.jsx)(pu,{path:t,renderResult:b,loading:g,error:c||p,truncated:f>100,quantity:m?.Messages?.length??0})}function pC(e){let{type:t,subType:a}=e,r=K(t),i="EPathTypePersQueueGroup"===t,s=(0,al._p)();return r?(0,n.jsx)(pT,{...e}):i&&"EPathSubTypeStreamImpl"!==a&&s?(0,n.jsx)(pE,{...e}):(0,n.jsx)(pu,{...e,renderResult:()=>(0,n.jsx)("div",{className:pd("message-container"),children:mX("preview.not-available")})})}let pA=b.F.injectEndpoints({endpoints:e=>({cancelQuery:e.mutation({queryFn:async({queryId:e,database:t},{signal:a})=>{try{let n=await window.api.viewer.sendQuery({database:t,action:"cancel-query",query_id:e,internal_call:!0},{signal:a});if((0,tH.We)(n))return{error:n};return{data:(0,tH.fW)(n)}}catch(e){return{error:e}}}})}),overrideExisting:"throw"});var pI=a(99951),pP=a(34687),pk=a(39952),pD=a(98887),pR=a(54745),pM=a(10891);async function pO(e){let t=1,a=async()=>{if(!window.ydbEditor)if(!t)return!1;else await new Promise(e=>{window.setTimeout(e,100)}),t-=1,a();return!0};await a()?window.ydbEditor?.trigger(void 0,"insertSnippetToEditor",e):console.error("Monaco editor not found")}function pq(e){return e.replace(/\$/g,"\\$")}let pL=e=>{let t=e?.relativePath?`\`${pq(e.relativePath)}/my_row_table\``:"${1:my_row_table}";return`-- docs: https://ydb.tech/en/docs/yql/reference/syntax/create_table
CREATE TABLE ${t} (
    category_id Uint64 NOT NULL,
    id Uint64,
    expire_at Datetime,
    updated_on Datetime,
    name Text,
    \`binary-payload\` Bytes,
    attributes JsonDocument,
    -- uncomment to add a secondary index
    -- INDEX idx_row_table_id GLOBAL SYNC ON ( id ) COVER ( name, attributes ), -- Secondary indexes docs https://ydb.tech/en/docs/yql/reference/syntax/create_table#secondary_index
    PRIMARY KEY (category_id, id)
) 
WITH (
    AUTO_PARTITIONING_BY_SIZE = ENABLED,
    AUTO_PARTITIONING_PARTITION_SIZE_MB = 2048,
    AUTO_PARTITIONING_BY_LOAD = ENABLED,
    AUTO_PARTITIONING_MIN_PARTITIONS_COUNT = 4,
    AUTO_PARTITIONING_MAX_PARTITIONS_COUNT = 1024
    -- uncomment to create a table with predefined partitions
    -- , UNIFORM_PARTITIONS = 4 -- The number of partitions for uniform initial table partitioning.
                            -- The primary key's first column must have type Uint64 or Uint32.
                            -- A created table is immediately divided into the specified number of partitions
    -- uncomment to launch read only replicas in every AZ
    -- , READ_REPLICAS_SETTINGS = 'PER_AZ:1' -- Enable read replicas for stale read, launch one replica in every availability zone
    -- uncomment to enable ttl
    -- , TTL = Interval("PT1H") ON expire_at -- Enable background deletion of expired rows https://ydb.tech/en/docs/concepts/ttl
    -- uncomment to create a table with a bloom filter
    -- , KEY_BLOOM_FILTER = ENABLED -- With a Bloom filter, you can more efficiently determine
                               -- if some keys are missing in a table when making multiple single queries by the primary key.
)`},pz=e=>{let t=e?.relativePath?`\`${pq(e.relativePath)}/my_column_table\``:"${1:my_column_table}";return`-- docs: https://ydb.tech/en/docs/yql/reference/syntax/create_table#olap-tables
CREATE TABLE ${t} (
    id Int64 NOT NULL,
    author Text,
    title Text,
    body Text,
    PRIMARY KEY (id)
)
PARTITION BY HASH(id)
WITH (STORE = COLUMN)`},pF=()=>`-- docs: https://ydb.tech/docs/en/yql/reference/syntax/create-async-replication
CREATE OBJECT secret_name (TYPE SECRET) WITH value="secret_value";

CREATE ASYNC REPLICATION my_replication
FOR \${1:<original_table>} AS \${2:replica_table} --[, \`/remote_database/another_table_name\` AS \`another_local_table_name\` ...]
WITH (
    CONNECTION_STRING="\${3:grpcs://mydb.ydb.tech:2135/?database=/remote_database}",
    TOKEN_SECRET_NAME = "secret_name"
    -- ENDPOINT="mydb.ydb.tech:2135",
    -- DATABASE=\`/remote_database\`,
    -- USER="user",
    -- PASSWORD_SECRET_NAME="your_password"
);`,pQ=()=>`-- docs: https://ydb.tech/docs/en/yql/reference/syntax/create-transfer
CREATE OBJECT secret_name (TYPE SECRET) WITH value="secret_value";

\\$l = (\\$x) -> {
    return [
        <|
            offset:\\$x._offset,
            message:\\$x._data
        |>
    ];
};

CREATE TRANSFER my_transfer
FROM \${1:<original_topic>} TO \${2:<target_table>} USING \\$l
WITH (
    CONNECTION_STRING="\${3:grpcs://mydb.ydb.tech:2135/?database=/remote_database}",
    TOKEN_SECRET_NAME = "secret_name"
    -- ENDPOINT="mydb.ydb.tech:2135",
    -- DATABASE=\`/remote_database\`,
    -- USER="user",
    -- PASSWORD_SECRET_NAME="your_password"
);`,pU=e=>{let t=e?.relativePath?`\`${pq(e.relativePath)}\``:"${1:<my_table>}";return`-- docs: https://ydb.tech/docs/en/yql/reference/syntax/alter_table/

ALTER TABLE ${t}
    -- RENAME TO new_table_name
    -- DROP COLUMN some_existing_column
\${2:ADD COLUMN numeric_column Int32};`},p$=e=>{let t=e?.relativePath?`\`${pq(e.relativePath)}\``:"${1:<my_table>}";return`-- documentation about partitioning https://ydb.tech/docs/en/concepts/datamodel/table#partitioning

ALTER TABLE ${t} SET 
(
    AUTO_PARTITIONING_BY_LOAD = ENABLED, -- If a partition consumes more than 50% of the CPU for a few dozens of seconds, it is enqueued for splitting.
    AUTO_PARTITIONING_BY_SIZE = ENABLED, --  If a partition size exceeds the value specified by the AUTO_PARTITIONING_PARTITION_SIZE_MB  parameter, it is enqueued for splitting.
    AUTO_PARTITIONING_PARTITION_SIZE_MB = 2048,
    AUTO_PARTITIONING_MIN_PARTITIONS_COUNT = 10, -- Partitions are merged only if their actual number exceeds the value specified by this parameter.
    AUTO_PARTITIONING_MAX_PARTITIONS_COUNT = 100 -- Partitions are split only if their number doesn't exceed the value specified by this parameter.
)`},pG=e=>{let t=e?.relativePath?`\`${pq(e.relativePath)}\``:"${1:<my_table>}";return`ALTER TABLE ${t} SET 
(
   READ_REPLICAS_SETTINGS = 'PER_AZ:1' -- Enable read replicas for stale read, launch one replica in every availability zone. docs: https://clck.ru/3Qh8iQ
)`},pB=e=>{let t=e?.relativePath?`\`${pq(e.relativePath)}\``:"${1:<my_table>}";return`-- Configure Time to Live (TTL) for automatic row deletion, see docs for more information
-- https://ydb.tech/docs/en/yql/reference/syntax/create_table/with#time-to-live

ALTER TABLE ${t} SET (
    TTL = Interval("PT24H") ON \${2:column_name} -- Enable background deletion of expired rows. Supported types: Date, Datetime, Timestamp
    -- Interval format: ISO 8601 duration, e.g., "PT1H" (1 hour), "PT24H" (24 hours), "P1D" (1 day)
    -- Examples:
    --   TTL = Interval("PT1H") ON created_at  -- Delete rows 1 hour after created_at
    --   TTL = Interval("P7D") ON expire_at    -- Delete rows 7 days after expire_at
    -- To disable TTL:
    --   TTL = Interval("PT0S") ON column_name -- Set interval to 0 to disable TTL
)`},pH=e=>{let t=e?.relativePath?`\`${pq(e.relativePath)}\``:"${2:<my_table>}",a=e?.schemaData?.map(e=>"`"+pq(e.name??"")+"`").join(", ")||"${1:*}",n=e?.relativePath?"":"WHERE ${3:Key1 = 1}\nORDER BY ${4:Key1}\n";return`SELECT ${a}
FROM ${t}
${n}LIMIT \${5:10};`},pW=e=>{if(e?.showCreateTableData)return e.showCreateTableData;let t=e?.relativePath?`\`${pq(e.relativePath)}\``:"${2:<my_table>}";return`SHOW CREATE TABLE ${t};`},pV=e=>{let t=e?.relativePath?`\`${pq(e.relativePath)}\``:"${1:<my_table>}",a=e?.schemaData?.map(e=>`\`${pq(e.name??"")}\``).join(", ")||"${2:id, name}",n=e?.schemaData?"${3: }":'${3:1, "foo"}';return`UPSERT INTO ${t}
( ${a} )
VALUES ( ${n} );`},pJ=e=>{let t=e?.relativePath?`\`${pq(e.relativePath)}\``:"${1:my_table}";return`DROP EXTERNAL TABLE ${t};`},pK=e=>{let t=e?.relativePath.split("/").slice(0,-1).join("/"),a=t?`\`${pq(t)}/my_external_table\``:"${1:<my_external_table>}",n=e?.relativePath?`${pq(e.relativePath)}`:"${2:<path_to_data_source>}";return`CREATE EXTERNAL TABLE ${a} (
    column1 Int,
    column2 Int
) WITH (
    DATA_SOURCE="${n}",
    LOCATION="",
    FORMAT="json_as_string",
    \`file_pattern\`=""
);`},pY=e=>{let t=e?.relativePath?`\`${pq(e.relativePath)}/my_topic\``:"${1:my_topic}";return`-- docs: https://ydb.tech/docs/en/yql/reference/syntax/create-topic
CREATE TOPIC ${t} (
    CONSUMER consumer1,
    CONSUMER consumer2 WITH (read_from = Datetime('1970-01-01T00:00:00Z')) -- Sets up the message write time starting from which the consumer will receive data.
                                                                           -- Value type: Datetime OR Timestamp OR integer (unix-timestamp in the numeric format). 
                                                                           -- Default value: now
) WITH (
    min_active_partitions = 1, -- Minimum number of topic partitions.
    partition_count_limit = 0, -- Maximum number of active partitions in the topic. 0 is interpreted as unlimited.
    retention_period = Interval('PT18H'), -- Data retention period in the topic. Value type: Interval.
    retention_storage_mb = 0, -- Limit on the maximum disk space occupied by the topic data. 
                              -- When this value is exceeded, the older data is cleared, like under a retention policy. 
                              -- 0 is interpreted as unlimited.
    partition_write_speed_bytes_per_second = 1048576, -- Maximum allowed write speed per partition.
    partition_write_burst_bytes = 0 -- Write quota allocated for write bursts. 
                                    -- When set to zero, the actual write_burst value is equalled to 
                                    -- the quota value (this allows write bursts of up to one second).
);`},pZ=e=>{let t=e?.relativePath?`\`${pq(e.relativePath)}\``:"${1:<my_topic>}";return`-- docs: https://ydb.tech/en/docs/yql/reference/syntax/alter_topic
ALTER TOPIC ${t}
    ADD CONSUMER new_consumer WITH (read_from = Datetime('1970-01-01T00:00:00Z')), -- Sets up the message write time starting from which the consumer will receive data.
                                                                                   -- Value type: Datetime OR Timestamp OR integer (unix-timestamp in the numeric format).
                                                                                   -- Default value: now
    ALTER CONSUMER consumer1 SET (read_from = Datetime('1970-01-01T00:00:00Z')),
    DROP CONSUMER consumer2,
    SET (
        min_active_partitions = 1, -- Minimum number of topic partitions.
        partition_count_limit = 0, -- Maximum number of active partitions in the topic. 0 is interpreted as unlimited.
        retention_period = Interval('PT18H'), -- Data retention period in the topic. Value type: Interval.
        retention_storage_mb = 0, -- Limit on the maximum disk space occupied by the topic data. 
                                  -- When this value is exceeded, the older data is cleared, like under a retention policy. 
                                  -- 0 is interpreted as unlimited.
        partition_write_speed_bytes_per_second = 1048576, -- Maximum allowed write speed per partition.
        partition_write_burst_bytes = 0 -- Write quota allocated for write bursts. 
                                        -- When set to zero, the actual write_burst value is equalled to
                                        -- the quota value (this allows write bursts of up to one second).
    );`},pX=e=>{let t=e?.relativePath?`\`${pq(e.relativePath)}\``:"${1:<my_topic>}";return`DROP TOPIC ${t};`},p0=e=>{let t=e?.relativePath?`\`${pq(e.relativePath)}/my_view\``:"${1:my_view}";return`CREATE VIEW ${t} WITH (security_invoker = TRUE) AS SELECT 1;`},p1=e=>{let t=e?.relativePath?`\`${pq(e.relativePath)}\``:"${1:<my_view>}";return`DROP VIEW ${t};`},p2=e=>{let t=e?.relativePath?`\`${pq(e.relativePath)}\``:"${1:<my_replication>}";return`DROP ASYNC REPLICATION ${t};`},p3=e=>{let t=e?.relativePath?`\`${pq(e.relativePath)}\``:"${1:<my_transfer>}";return`DROP TRANSFER ${t};`},p4=e=>{let t=e?.relativePath?`\`${pq(e.relativePath)}\``:"${1:<my_replication>}";return`-- docs: https://ydb.tech/docs/en/yql/reference/syntax/alter-async-replication
ALTER ASYNC REPLICATION ${t} SET (STATE = "DONE", FAILOVER_MODE = "FORCE");`},p5=e=>{let t=e?.relativePath?`\`${pq(e.relativePath)}\``:"${1:<my_transfer>}";return`-- docs: https://ydb.tech/docs/en/yql/reference/syntax/alter-transfer

\\$l = (\\$x) -> {
    return [
        <|
            offset:\\$x._offset,
            message:\\$x._data
        |>
    ];
};

ALTER TRANSFER ${t} 
SET USING \\$l;`},p6=e=>{let t=e?.relativePath?`\`${pq(e.relativePath)}/my_streaming_query\``:"${1:<my_streaming_query>}";return`CREATE STREAMING QUERY ${t} WITH (
    RUN = TRUE  -- Run the query after creation
) AS
DO BEGIN

INSERT INTO \${2:<external data source>}.\${3:<sink topic>} 
SELECT * FROM \${2:<external data source>}.\${4:<source topic>};

END DO;`},p7=e=>{let t=e?.relativePath?`\`${pq(e.relativePath)}\``:"${1:<my_streaming_query>}";return`ALTER STREAMING QUERY ${t} SET (
    RUN = FALSE, -- Stop query execution
    RESOURCE_POOL = "default" -- Workload manager pool for query
);`},p8=e=>{let t=e?.relativePath?`\`${pq(e.relativePath)}\``:"${1:<my_streaming_query>}",a=e?.streamingQueryData,n=(0,eW.vN)(a?.resultSets?.[0]?.result?.[0]?.Text).replace(/\r\n?/g,"\n");n=(0,eW.qe)(n);let r=(n=pq(n=(0,eW.YY)(n)))||"${2:<streaming_query_text>}";return`ALTER STREAMING QUERY ${t} SET (
    FORCE = TRUE, -- Allow to drop last query checkpoint if query state can't be loaded
) AS
DO BEGIN

${r}

END DO;`},p9=e=>{let t=e?.relativePath?`\`${pq(e.relativePath)}\``:"${1:<my_streaming_query>}";return`DROP STREAMING QUERY ${t};`},he=e=>{let t=e?.relativePath?`\`${pq(e.relativePath)}\``:"${1:<my_table>}";return`ALTER TABLE ${t} ADD INDEX \${2:index_name} GLOBAL ON (\${3:<column_name>});`},ht=e=>{let t=e?.relativePath?`\`${pq(e.relativePath)}\``:"${1:<my_table>}";return`-- docs: https://ydb.tech/docs/en/dev/vector-indexes?version=main#types
ALTER TABLE ${t}
ADD INDEX \${2:my_vector_index}
GLOBAL USING vector_kmeans_tree
ON (\${3:embedding})
WITH (
    distance=cosine,
    vector_type="uint8",
    vector_dimension=\${4:512},
    levels=\${5:2},
    clusters=\${6:128}
);`},ha=e=>{let t=e?.relativePath.split("/").pop(),a=e?.relativePath.split("/").slice(0,-1).join("/"),n=a?`\`${pq(a)}\``:"${1:<my_table>}";return`ALTER TABLE ${n} DROP INDEX ${pq(t??"")||"${2:<index_name>}"};`},hn=e=>{let t=e?.relativePath?`\`${pq(e.relativePath)}\``:"${1:<my_table>}";return`-- docs: https://ydb.tech/docs/en/yql/reference/syntax/alter_table/changefeed
ALTER TABLE ${t} ADD CHANGEFEED \${2:changefeed_name} WITH (
    MODE = \${3:'UPDATES'}, -- KEYS_ONLY, UPDATES, NEW_IMAGE, OLD_IMAGE, or NEW_AND_OLD_IMAGES
    FORMAT = \${4:'JSON'}, -- JSON or DEBEZIUM_JSON
    VIRTUAL_TIMESTAMPS = \${5:TRUE}, -- true or false
    RETENTION_PERIOD = \${6:Interval('PT12H')}, -- Interval value, e.g., Interval('PT24H')
    -- TOPIC_MIN_ACTIVE_PARTITIONS: The number of topic partitions. By default, the number of topic partitions is equal to the number of table partitions
    INITIAL_SCAN = \${8:TRUE} -- true or false
)

-- MODE options:
--   KEYS_ONLY: Only the primary key components and change flag are written.
--   UPDATES: Updated column values that result from updates are written.
--   NEW_IMAGE: Any column values resulting from updates are written.
--   OLD_IMAGE: Any column values before updates are written.
--   NEW_AND_OLD_IMAGES: A combination of NEW_IMAGE and OLD_IMAGE modes.`},hr=()=>`-- docs: https://ydb.tech/docs/en/yql/reference/syntax/create-group
CREATE GROUP \${1:group_name}
-- group_name: The name of the group. It may contain lowercase Latin letters and digits.`,hi=()=>`-- docs: https://ydb.tech/docs/en/yql/reference/syntax/create-user
CREATE USER \${1:user_name} PASSWORD \${2:'password'}
-- user_name: The name of the user. It may contain lowercase Latin letters and digits.
-- option: The password of the user:
    -- PASSWORD 'password' creates a user with the password password. The ENCRYPTED option is always enabled.
    -- PASSWORD NULL creates a user with an empty password.`,hs=e=>{let t=e?.relativePath?`\`${pq(e.relativePath)}\``:"${1:<my_table>}";return`-- docs: https://ydb.tech/docs/en/yql/reference/syntax/delete
DELETE FROM ${t}
WHERE \${2:Key1 = 1};`},hl=()=>`-- docs: https://ydb.tech/docs/en/yql/reference/syntax/drop-group
DROP GROUP \${1:<group_name>}

-- IF EXISTS: Suppress an error if the group doesn't exist.
-- group_name: The name of the group to be deleted.`,ho=()=>`-- docs: https://ydb.tech/docs/en/yql/reference/syntax/drop-user
DROP USER \${1:<user_name>}

-- IF EXISTS: Suppress an error if the user doesn't exist.
-- user_name: The name of the user to be deleted.`,hc=e=>{let t=e?.relativePath?`\`${pq(e?.relativePath)}\``:"${2:<path_to_scheme_object>}";return`GRANT \${1:<permission_name>}
ON ${t}
TO \${3:<role_name>}

-- permission_name: The name of the access right to schema objects that needs to be assigned.
-- path_to_scheme_object: The path to the schema object for which rights are being granted.
-- role_name: The name of the user or group to whom rights on the schema object are being granted.
-- WITH GRANT OPTION: Using this construct gives the user or group of users the right to manage access rights - 
--                    to assign or revoke certain rights. This construct has functionality similar to granting 
--                    the "ydb.access.grant" or GRANT right. A subject with the ydb.access.grant right cannot 
--                    grant rights broader than they possess themselves.`},hd=e=>{let t=e?.relativePath?`\`${pq(e?.relativePath)}\``:"${2:<path_to_scheme_object>}";return`REVOKE \${1:<permission_name>}
ON ${t}
FROM \${3:<role_name>}

-- permission_name: The name of the access right to schema objects that needs to be revoked.
-- path_to_scheme_object: The path to the schema object from which rights are being revoked.
-- role_name: The name of the user or group from whom rights on the schema object are being revoked.
-- GRANT OPTION FOR: Using this construct revokes the user's or group's right to manage access rights.
--                   All previously granted rights by this user remain in effect.
--                   This construct has functionality similar to revoking the "ydb.access.grant" or GRANT right.`},hu=e=>{let t=e?.relativePath?`\`${pq(e.relativePath)}\``:"${1:<my_table>}";return`-- docs: https://ydb.tech/docs/en/yql/reference/syntax/update
UPDATE ${t}
SET \${2:Column1 = 'foo', Column2 = 'bar'}
WHERE \${3:Key1 = 1};`},hm=e=>{let t=e?.relativePath?`\`${pq(e.relativePath)}\``:"${1:<my_table>}";return`DROP TABLE ${t};`};var hp=JSON.parse('{"button.new-sql":"New query","action.create-row-table":"Create row table","action.create-column-table":"Create column table","action.create-external-table":"Create external table","action.upsert-to-table":"Upsert into table","action.update-table":"Update table","action.alter-table":"Alter table","action.select-rows":"Select from a table","action.delete-rows":"Delete rows","action.drop-table":"Drop table","action.add-index":"Add index","action.add-vector-index":"Add vector index","action.drop-index":"Drop index","action.drop-external-table":"Drop external table","menu.tables":"Tables","menu.topics":"Topics","menu.streaming-query":"Streaming query","menu.capture":"Change data capture","menu.replication":"Async replication","menu.transfer":"Transfer","menu.users":"Users","action.create-topic":"Create Topic","action.drop-topic":"Drop Topic","action.alter-topic":"Alter Topic","action.create-cdc-stream":"Create changefeed","action.create-async-replication":"Create async replication","action.create-transfer":"Create transfer","action.create-user":"Create user","action.create-group":"Create group","action.drop-user":"Drop user","action.drop-group":"Drop group","action.grant-privilege":"Grant privilege","action.revoke-privilege":"Revoke privilege","action.alter-async-replication":"Alter async replication","action.drop-async-replication":"Drop async replication","action.alter-transfer":"Alter transfer","action.drop-transfer":"Drop transfer","action.create-streaming-query":"Create streaming query","action.show-create-table":"Show Create SQL","action.alter-streaming-query-settings":"Alter query settings","action.alter-streaming-query-text":"Alter query text","action.drop-streaming-query":"Drop query"}');let hh=(0,en.g4)("ydb-new-sql",{en:hp});function hg(){var e;let t,a=(e=mY(r.useCallback(e=>{pO(e)},[])),{createRowTable:(t=t=>()=>{e(t())})(pL),createColumnTable:t(pz),createAsyncReplication:t(pF),createStreamingQuery:t(p6),alterAsyncReplication:t(p4),dropAsyncReplication:t(p2),createTransfer:t(pQ),alterTransfer:t(p5),dropTransfer:t(p3),alterTable:t(pU),selectQuery:t(pH),upsertQuery:t(pV),createExternalTable:t(pK),dropExternalTable:t(pJ),createTopic:t(pY),alterTopic:t(pZ),dropTopic:t(pX),createView:t(p0),dropTable:t(hm),deleteRows:t(hs),updateTable:t(hu),alterStreamingQueryText:t(p8),alterStreamingQuerySettings:t(p7),dropStreamingQuery:t(p9),createUser:t(hi),createGroup:t(hr),createCdcStream:t(hn),grantPrivilege:t(hc),revokePrivilege:t(hd),dropUser:t(ho),dropGroup:t(hl),addVectorIndex:t(ht),addTableIndex:t(he),dropTableIndex:t(ha),showCreateTable:t(pW)}),i=[{text:hh("menu.tables"),iconStart:(0,n.jsx)(pP.K,{}),items:[{text:hh("action.create-row-table"),action:a.createRowTable},{text:hh("action.create-column-table"),action:a.createColumnTable},{text:hh("action.create-external-table"),action:a.createExternalTable},{text:hh("action.upsert-to-table"),action:a.upsertQuery},{text:hh("action.update-table"),action:a.updateTable},{text:hh("action.alter-table"),action:a.alterTable},{text:hh("action.select-rows"),action:a.selectQuery},{text:hh("action.delete-rows"),action:a.deleteRows},{text:hh("action.drop-table"),action:a.dropTable},{text:hh("action.drop-external-table"),action:a.dropExternalTable},{text:hh("action.add-index"),action:a.addTableIndex},{text:hh("action.add-vector-index"),action:a.addVectorIndex},{text:hh("action.drop-index"),action:a.dropTableIndex},{text:hh("action.show-create-table"),action:a.showCreateTable}]},{text:hh("menu.topics"),iconStart:(0,n.jsx)(pk.p,{}),items:[{text:hh("action.create-topic"),action:a.createTopic},{text:hh("action.alter-topic"),action:a.alterTopic},{text:hh("action.drop-topic"),action:a.dropTopic}]},{text:hh("menu.streaming-query"),iconStart:(0,n.jsx)(pD.G,{}),items:[{text:hh("action.create-streaming-query"),action:a.createStreamingQuery},{text:hh("action.alter-streaming-query-settings"),action:a.alterStreamingQuerySettings},{text:hh("action.alter-streaming-query-text"),action:a.alterStreamingQueryText},{text:hh("action.drop-streaming-query"),action:a.dropStreamingQuery}]},{text:hh("menu.replication"),iconStart:(0,n.jsx)(pR.A,{}),items:[{text:hh("action.create-async-replication"),action:a.createAsyncReplication},{text:hh("action.alter-async-replication"),action:a.alterAsyncReplication},{text:hh("action.drop-async-replication"),action:a.dropAsyncReplication}]},{text:hh("menu.transfer"),iconStart:(0,n.jsx)(pM.p,{}),items:[{text:hh("action.create-transfer"),action:a.createTransfer},{text:hh("action.alter-transfer"),action:a.alterTransfer},{text:hh("action.drop-transfer"),action:a.dropTransfer}]},{text:hh("menu.capture"),iconStart:(0,n.jsx)(pk.p,{}),items:[{text:hh("action.create-cdc-stream"),action:a.createCdcStream}]},{text:hh("menu.users"),iconStart:(0,n.jsx)(pI.A,{}),items:[{text:hh("action.create-user"),action:a.createUser},{text:hh("action.create-group"),action:a.createGroup},{text:hh("action.drop-user"),action:a.dropUser},{text:hh("action.drop-group"),action:a.dropGroup},{text:hh("action.grant-privilege"),action:a.grantPrivilege},{text:hh("action.revoke-privilege"),action:a.revokePrivilege}]}];return(0,n.jsx)(i6.r,{items:i,renderSwitcher:e=>(0,n.jsxs)(as.$,{...e,children:[hh("button.new-sql"),(0,n.jsx)(as.$.Icon,{children:(0,n.jsx)(rG.A,{})})]}),popupProps:{placement:"top"}})}class hx{queries=new Map;registerQuery(e,t){this.queries.set(e,t),t.finally(()=>{this.queries.get(e)===t&&this.queries.delete(e)})}abortQuery(e){let t=this.queries.get(e);t&&(t.abort(),this.queries.delete(e))}abortAll(){for(let e of this.queries.values())e.abort();this.queries.clear()}}let hy=new hx;var hb=a(98251),hf=a(78419);let hv=(0,d.cn)("ydb-query-settings-description"),hj=({querySettings:e,prefix:t})=>(0,n.jsxs)("div",{className:hv("message"),children:[t,Object.entries(e).map(([e,t],a,r)=>(0,n.jsxs)("span",{className:hv("description-item"),children:[`${e}: ${t}`,a<r.length-1?", ":null]},a))]}),hT=(0,d.cn)("ydb-query-editor-button"),hw=e=>(0,n.jsxs)(as.$,{...e,className:hT("run-button"),children:[(0,n.jsx)(tI.I,{data:iG.A,size:16}),mX("action.run")]}),hS=e=>(0,n.jsxs)(as.$,{...e,className:hT("stop-button",{error:e.error}),children:[(0,n.jsx)(tI.I,{data:tN.A,size:16}),mX("action.stop")]}),h_=e=>(0,n.jsxs)(as.$,{...e,className:hT("explain-button"),children:[(0,n.jsx)(tI.I,{data:hb.A,size:16}),mX("action.explain")]}),hN=({onClick:e,isLoading:t})=>{let{changedCurrentSettings:a,changedCurrentSettingsDescriptions:r}=pi(),i=a.length>0?{view:"outlined-info",selected:!0}:null;return(0,n.jsx)(hf.m,{disabled:0===a.length,content:(0,n.jsx)(hj,{prefix:mX("gear.tooltip"),querySettings:r}),openDelay:0,placement:["top-start"],children:(0,n.jsxs)(as.$,{onClick:e,loading:t,className:hT("gear-button"),...i,children:[(0,n.jsx)(tI.I,{data:rU.A,size:16}),i?(0,n.jsxs)("div",{className:hT("changed-settings"),children:["(",a.length,")"]}):null]})})},hE=(0,d.cn)("ydb-query-editor-controls"),hC=({type:e,isHighlighted:t,isLoading:a,isStoppable:r,controlsDisabled:i,onActionClick:s,renderStopButton:l})=>r&&a&&t?l():(0,n.jsx)("run"===e?hw:h_,{onClick:s,disabled:i,loading:a,view:t?"action":void 0}),hA=({disabled:e,isLoading:t,highlightedAction:a,queryId:i,database:s,isStreamingEnabled:l,handleSendExecuteClick:o,onSettingsButtonClick:c,handleGetExplainQueryClick:d})=>{let u=(0,_.N4)(lX.Wp),m=(0,_.N4)(lX.Vp),[p,h]=pA.useCancelQueryMutation(),[g,x]=r.useState(t),y=r.useRef(null),b=r.useRef(null),[f,v]=r.useState(!1),j=r.useCallback(async()=>{rJ("stopQuery");try{l?hy.abortQuery(m):i&&await p({queryId:i,database:s}).unwrap()}catch{(0,tR.A)({name:"stop-error",title:"",content:mX("toaster.stop-error"),theme:"danger",autoHiding:5e3}),v(!0),b.current&&window.clearTimeout(b.current),b.current=window.setTimeout(()=>{v(!1)},500)}},[l,i,p,s,m]),T=r.useCallback(()=>{y.current&&window.clearTimeout(y.current),x(!1),y.current=window.setTimeout(()=>{x(!0)},400)},[]),w=r.useCallback(()=>{o(u),T()},[o,u,T]),S=r.useCallback(()=>{d(u),T()},[d,u,T]);r.useEffect(()=>()=>{y.current&&window.clearTimeout(y.current),b.current&&window.clearTimeout(b.current)},[]);let N=e||!u,E=()=>(0,n.jsx)(hS,{loading:h.isLoading,error:f,onClick:j,view:"action"});return(0,n.jsxs)("div",{className:hE(),children:[(0,n.jsxs)("div",{className:hE("left"),children:[(0,n.jsx)(hC,{type:"run",isHighlighted:"execute"===a,isLoading:t,isStoppable:g,controlsDisabled:N,onActionClick:w,renderStopButton:E}),(0,n.jsx)(hC,{type:"explain",isHighlighted:"explain"===a,isLoading:t,isStoppable:g,controlsDisabled:N,onActionClick:S,renderStopButton:E}),(0,n.jsx)(hN,{onClick:c,isLoading:t})]}),(0,n.jsxs)("div",{className:hE("right"),children:[(0,n.jsx)(hg,{}),(0,n.jsx)(mG,{buttonProps:{disabled:e}})]})]})};var hI=a(80791);function hP(e){if("object"==typeof e&&null!==e&&"name"in e&&"AbortError"===e.name||(0,N.cH)(e)&&e.isCancelled)return!0;let t=(0,tH.KH)(e);return(0,tH.We)(t)&&t.error?.message==="Query was cancelled"}var hk=JSON.parse('{"value_preparing":"Preparing","value_running":"Running","value_fetching":"Fetching"}');let hD=(0,en.g4)("ydb-query-execution-status",{en:hk}),hR=10*S.KF,hM=(0,d.cn)("kv-query-execution-status"),hO={preparing:hD("value_preparing"),running:hD("value_running"),fetching:hD("value_fetching")},hq=({className:e,error:t,loading:a,streamingStatus:i})=>{let s,l,o,c,{startTime:d,endTime:u}=(0,_.N4)(lX.$u),m=function({startTime:e,endTime:t,loading:a}){let[n,i]=r.useState(e?(t||Date.now())-e:0),s=r.useCallback(()=>{e&&i((t||Date.now())-e)},[t,e]),l=r.useRef(void 0),o=r.useRef(!1),c=r.useCallback(()=>{if(o.current||(s(),!a||!e))return;let n=(t||Date.now())-e,r=Math.floor((2*Math.random()-1)*20);l.current=setTimeout(c,n<hR?100+r:S.KF)},[s,a,e,t]);return r.useEffect(()=>(o.current=!1,c(),()=>{o.current=!0,l.current&&clearTimeout(l.current)}),[c]),n}({startTime:d,endTime:u,loading:a}),p=r.useMemo(()=>m<10*S.KF?(0,dU.duration)(m).format("mm:ss.SSS"):m>S.Jg*S.KF?(0,dU.duration)(m).format("hh:mm:ss"):(0,dU.duration)(m).format("mm:ss"),[m]),h=hP(t);if(a)o="info",c="info-heavy",s=(0,n.jsx)(hI.t,{size:"xs"}),l=i?hO[i]:hD("value_running");else if((0,N.F0)(t)&&"ECONNABORTED"===t.code)o="danger",c="danger-heavy",s=(0,n.jsx)(tI.I,{data:sW.A}),l="Connection aborted";else if(h)o="warning",c="warning-heavy",s=(0,n.jsx)(tI.I,{data:tN.A,className:hM("result-status-icon",{error:!0})}),l="Stopped";else{let e=!!t;o=e?"danger":"success",c=e?"danger-heavy":"positive-heavy",s=(0,n.jsx)(tI.I,{data:e?a$.A:ix.A,className:hM("result-status-icon",{error:e})}),l=e?"Failed":"Completed"}return(0,n.jsx)(k.J,{theme:o,size:"m",className:hM(null,e),icon:s,value:p,children:(0,n.jsx)(tE.E,{color:c,children:l})})},hL=(0,d.cn)("ydb-query-settings-banner");function hz(){let{isBannerShown:e,changedLastExecutionSettingsDescriptions:t,closeBanner:a}=pi();return e?(0,n.jsx)(sD.F,{className:hL(),theme:"info",align:"baseline",style:{paddingTop:11,paddingBottom:11},message:(0,n.jsx)(hj,{prefix:mX("banner.query-settings.message"),querySettings:t}),onClose:a}):null}let hF=(0,d.cn)("ydb-query-stopped-banner");function hQ(){let[e,t]=(0,_.iK)(s3.GS.QUERY_STOPPED_BANNER_CLOSED),a=r.useCallback(()=>{t(!0)},[t]);return e?null:(0,n.jsx)(sD.F,{className:hF(),theme:"normal",align:"center",style:{paddingTop:11,paddingBottom:11},message:(0,n.jsx)("div",{className:hF("message"),children:mX("banner.query-stopped.message")}),layout:"horizontal",actions:(0,n.jsx)(sD.F.Actions,{children:(0,n.jsx)(sD.F.Action,{view:"normal",onClick:a,children:mX("banner.query-stopped.never-show")})})})}function hU(e){return e.replaceAll("\\","\\\\").replaceAll("\n","\\n").replaceAll("\r","\\r").replaceAll("	","\\t")}var h$=a(34495);let hG=(0,d.cn)("ydb-query-ast"),hB={automaticLayout:!0,selectOnLineNumbers:!0,readOnly:!0,minimap:{enabled:!1},wrappingIndent:"indent"};function hH({ast:e,theme:t}){return(0,n.jsx)("div",{className:hG(),children:(0,n.jsx)(h$.default,{language:"s-expression",value:e,options:hB,theme:`vs-${t}`})})}var hW=a(50448);function hV(e){let t=r.useRef(null),a=r.useId(),{data:i,opts:s,shapes:l}=e;return r.useEffect(()=>{let e=t.current;if(!e)return;e.innerHTML="",e.style.setProperty("width","100vw"),e.style.setProperty("height","100vh");let a=(0,hW.og)(e.id,i,s,l);return a.render(),e.style.setProperty("width","100%"),e.style.setProperty("height","100%"),()=>{a.destroy()}},[i,s,l]),(0,n.jsx)("div",{id:a,ref:t,style:{overflow:"auto"}})}let hJ={renderNodeTitle:e=>{let t=e.name.split("|");return t.length>1?t[1]:e.name},textOverflow:"normal",initialZoomFitsCanvas:!0},hK={node:hW.SO};function hY(e){return(0,n.jsx)(hV,{...e,opts:hJ,shapes:hK})}var hZ=JSON.parse('{"description.graph-is-not-supported":"Graph can not be rendered","description.empty-result":"There is no {{activeSection}} for the request","action.result":"Result","action.stats":"Stats","action.schema":"Computation Graph","action.explain-plan":"Explain","action.json":"JSON","action.ast":"AST","action.copy":"Copy {{activeSection}}","trace":"Trace","title.truncated":"Truncated","title.result":"Result","tooltip_actions":"Actions","text_open-execution-plan":"Open Execution Plan","text_open-execution-plan_description":"New tab","text_download":"Download Execution Plan","text_download_description":"SVG","text_diagnostics":"Download Diagnostics","text_diagnostics_description":"JSON","text_error-plan-svg":"Error: {{error}}","error.title":"Query Failed","error.description":"An error occurred, please see the Result tab for details","stopped.title":"Query stopped","stopped.description":"Query was stopped"}');let hX=(0,en.g4)("ydb-execute-result",{en:hZ}),h0=(0,d.cn)("ydb-query-result-stub-message");function h1({message:e}){return(0,n.jsx)("div",{className:h0(null),children:e})}let h2=(0,d.cn)("ydb-query-explain-graph");function h3({explain:e={},theme:t}){let{links:a,nodes:i}=e,s=r.useMemo(()=>({links:a,nodes:i}),[a,i]);return s.links&&s.nodes&&s.nodes.length?(0,n.jsx)("div",{className:h2("canvas-container"),children:(0,n.jsx)(hY,{data:s},t)}):(0,n.jsx)(h1,{message:hX("description.graph-is-not-supported")})}var h4=a(97634);let h5=(0,d.cn)("query-info-dropdown");var h6=a(14184);let h7=b.F.injectEndpoints({endpoints:e=>({planToSvgQuery:e.query({queryFn:async({plan:e,database:t},{signal:a})=>{try{return{data:await window.api.viewer.planToSvg({database:t,plan:e},{signal:a})}}catch(e){return{error:e}}}})}),overrideExisting:"throw"});var h8=a(99382);function h9({title:e,description:t}){return(0,n.jsxs)("div",{className:h5("menu-item-content"),children:[(0,n.jsx)(tE.E,{variant:"body-1",children:e}),(0,n.jsx)(tE.E,{variant:"body-1",color:"secondary",children:t})]})}function ge({queryResultsInfo:e,database:t,hasPlanToSvg:a,error:i}){let{isLoading:s,items:l}=function({queryResultsInfo:e,database:t,hasPlanToSvg:a,error:i}){let[s,l]=r.useState(null),[o,{isLoading:c}]=h7.useLazyPlanToSvgQueryQuery();return r.useEffect(()=>()=>{s&&URL.revokeObjectURL(s)},[s]),{isLoading:c,items:r.useMemo(()=>{let r=[],c=e.plan;if(c&&a){let e=()=>s?Promise.resolve(s):o({plan:c,database:t}).unwrap().then(e=>{let t=new Blob([e],{type:"image/svg+xml"}),a=URL.createObjectURL(t);return l(a),a}).catch(e=>{let t=(0,h8.a)(e);return(0,tR.A)({title:hX("text_error-plan-svg",{error:t}),name:"plan-svg-error",theme:"danger"}),null});r.push([{text:(0,n.jsx)(h9,{title:hX("text_open-execution-plan"),description:hX("text_open-execution-plan_description")}),iconStart:(0,n.jsx)(h6.A,{className:h5("icon")}),action:()=>{e().then(e=>{e&&window.open(e,"_blank")})},className:h5("menu-item")},{text:(0,n.jsx)(h9,{title:hX("text_download"),description:hX("text_download_description")}),iconStart:(0,n.jsx)(uH.A,{className:h5("icon")}),action:()=>{e().then(e=>{e&&uJ(e,"query-plan.svg")})},className:h5("menu-item")}])}return e&&r.push([{text:(0,n.jsx)(h9,{title:hX("text_diagnostics"),description:hX("text_diagnostics_description")}),iconStart:(0,n.jsx)(uH.A,{className:h5("icon")}),action:()=>{let a=i?(0,tH.KH)(i):void 0;uY({...e,database:t,...a&&{error:a}},`query-diagnostics-${new Date().getTime()}`)},className:h5("menu-item")}]),r},[e,a,s,o,t,i])}}({queryResultsInfo:e,database:t,hasPlanToSvg:a,error:i});return l.length?(0,n.jsx)(i6.r,{popupProps:{placement:["bottom-end","left"]},switcherWrapperClassName:h5("query-info-switcher-wrapper"),renderSwitcher:e=>(0,n.jsx)(tA.m,{title:hX("tooltip_actions"),children:(0,n.jsx)(as.$,{view:"flat-secondary",loading:s,disabled:s,...e,children:(0,n.jsx)(as.$.Icon,{children:(0,n.jsx)(h4.A,{})})})}),items:l,size:"xl"}):null}let gt=(0,d.cn)("ydb-query-json-viewer");function ga({data:e}){let t=r.useRef(null),a=(0,_.N4)(e=>e.fullscreen);return(0,n.jsx)("div",{className:gt(),children:(0,n.jsx)("div",{className:gt("tree"),ref:t,children:(0,n.jsx)(nU.p,{value:e,scrollContainerRef:t},String(a))})})}let gn=(0,d.cn)("ydb-query-result-error");function gr({error:e}){let t=(0,tH.KH)(e);return!t||hP(e)?null:(0,N.TX)(e)?(0,n.jsx)("div",{className:gn("message"),children:e.message}):"object"==typeof t?(0,n.jsx)("div",{className:gn("message"),children:(0,n.jsx)(rO.OI,{data:t})}):(0,n.jsx)("div",{className:gn("message"),children:t})}let gi=(0,d.cn)("ydb-query-result-sets-viewer");function gs(e){let{selectedResultSet:t,setSelectedResultSet:a,resultSets:i,error:s}=e,l=r.useRef(null),o=i?.[t];return(0,n.jsxs)("div",{className:gi("result-wrapper"),children:[e.error?(0,n.jsx)(gr,{error:s}):null,(()=>{if(i?.length)if(i?.length>1)return(0,n.jsx)(A.f,{value:String(t),children:(0,n.jsx)(I.w,{className:gi("tabs"),size:"l",children:i?.map((e,t)=>{let r=i?.[t];return(0,n.jsx)(P.o,{value:String(t),onClick:()=>a(t),children:(0,n.jsxs)(tC.s,{gap:2,alignItems:"center",children:[(0,n.jsx)(tE.E,{children:`Result #${t+1}${i?.[t]?.truncated?"(T)":""}`}),(0,n.jsx)(tE.E,{color:"secondary",children:r.result?.length||0})]})},t)})})});else{let e;return e=i?.[0],(0,n.jsxs)(tC.s,{gap:2,alignItems:"center",className:gi("title"),children:[(0,n.jsx)(tE.E,{children:e?.truncated?"Truncated":"Result"}),(0,n.jsx)(tE.E,{color:"secondary",children:e?.result?.length||0})]})}return null})(),o?(0,n.jsx)("div",{className:gi("result"),ref:l,children:(0,n.jsx)(pv,{settings:e.tableSettings,data:o.result,columns:o.columns})}):null]})}var gl=a(51936),go=a(43696),gc=a(79938);let gd=(0,d.cn)("ydb-query-simplified-plan");function gu({value:e,formatter:t}){if(!(0,iA.kf)(e))return;let a=t(Number(e));return(0,n.jsx)("div",{className:gd("metrics-cell"),children:a})}let gm={Table:"var(--g-color-text-info)",Predicate:"var(--g-color-text-positive)",Condition:"var(--g-color-text-utility)"};function gp(e){return e in gm?gm[e]:"var(--g-color-text-secondary)"}function gh({params:e}){return e?(0,n.jsxs)("span",{className:gd("operation-params"),children:["(",function(e={}){let t=[],a=Object.entries(e);if(1===a.length){let e=a[0][1],r=gp(a[0][0]);t.push((0,n.jsx)("span",{style:{color:r},children:(0,eW.vN)(e)},"param"))}else{let a=function(e){let t=[],{Table:a,Predicate:n,Condition:r,...i}=e;return a&&t.push(["Table",a]),n&&t.push(["Predicate",n]),r&&t.push(["Condition",r]),t.concat(Object.entries(i))}(e);for(let e=0;e<a.length;e++){let[r,i]=a[e],s=gp(r);e>0&&t.push(", "),t.push((0,n.jsxs)("span",{style:{color:s},children:[r,": ",(0,eW.vN)(i)]},e))}}return t}(e),")"]}):null}function gg({modifiers:e,left:t}){return(0,n.jsx)("div",{className:gd("divider",e),style:{left:t}})}function gx({row:e,depth:t=0,params:a}){let{name:i,operationParams:s,lines:l=""}=a,o=e.getLeafRows().length>0&&e.getIsExpanded(),c=r.useMemo(()=>(function(e,t){let a=e.split(".").map(Number),r=[];for(let e=0;e<a.length;e++)e===a.length-1&&0!==e&&(a[e]?r.push((0,n.jsx)(gg,{modifiers:{horizontal:!0},left:10+25*(e-1)},"last")):r.push((0,n.jsx)(gg,{modifiers:{last:!0},left:9+25*(e-1)},"last"))),e===a.length-1&&t&&r.push((0,n.jsx)(gg,{modifiers:{first:!0},left:9+25*e},"first")),a[e]&&r.push((0,n.jsx)(gg,{left:9+25*(e-1)},e));return r})(l,o),[l,o]);return(0,n.jsxs)("div",{style:{paddingLeft:25*t},className:gd("operation-name"),children:[c,(0,n.jsxs)(tC.s,{gap:1,className:gd("operation-content"),children:[e.getCanExpand()&&(0,n.jsx)(as.$,{view:"flat",size:"xs",onClick:e.getToggleExpandedHandler(),children:(0,n.jsx)(as.$.Icon,{children:(0,n.jsx)(rX.I,{direction:e.getIsExpanded()?"bottom":"right",size:14})})}),(0,n.jsx)("div",{className:gd("operation-name-content"),children:(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:gd("operation-name"),children:i}),"\xa0",(0,n.jsx)(gh,{params:s})]})})]})]})}function gy(e){return(0,n.jsx)(gu,{value:e.getValue(),formatter:e=>e<1e8?(0,gc.p)(e).format():(0,iA.z0)(e,1)})}let gb=[{accessorKey:"name",accessorFn:function(e){return{name:e.name,operationParams:e.operationParams,lines:e.lines}},header:()=>(0,n.jsx)(go.A,{children:"Operation"}),size:600,cell:e=>(0,n.jsx)(gx,{row:e.row,depth:e.row.depth,params:e.getValue()})},{accessorKey:"aCpu",header:()=>(0,n.jsx)(go.A,{children:"A-Cpu"}),size:90,minSize:90,cell:function(e){return(0,n.jsx)(gu,{value:e.getValue(),formatter:e=>(0,tM.Xo)(Math.round(e))})},meta:{align:"right",verticalAlign:"top"}},{accessorKey:"aRows",header:()=>(0,n.jsx)(go.A,{children:"A-Rows"}),size:90,minSize:90,cell:gy,meta:{align:"right",verticalAlign:"top"}},{accessorKey:"eCost",header:()=>(0,n.jsx)(go.A,{children:"E-Cost"}),size:90,minSize:90,cell:gy,meta:{align:"right",verticalAlign:"top"}},{accessorKey:"eRows",header:()=>(0,n.jsx)(go.A,{children:"E-Rows"}),size:90,minSize:90,cell:gy,meta:{align:"right",verticalAlign:"top"}},{accessorKey:"eSize",header:()=>(0,n.jsx)(go.A,{children:"E-Size"}),size:90,minSize:90,cell:gy,meta:{align:"right",verticalAlign:"top"}}];function gf({plan:e}){let t=r.useMemo(()=>(function(e,t=""){if(!e)return[];let a=[{items:e,prefix:t,parentIndex:-1,parentArray:[]}],n=[];for(;a.length>0;){let{items:e,prefix:t,parentIndex:r,parentArray:i}=a.pop(),s=[];for(let n=0;n<e.length;n++){let r={...e[n]},i=+(n<e.length-1),l=`${t}.${i}`;t||(l=String(i)),r.lines=l,s.push(r),r.children&&a.push({items:r.children,prefix:l,parentIndex:n,parentArray:s})}-1===r?n.push(...s):i[r].children=s}return n})(e),[e]),[a,i]=r.useState(!0),s=(0,gl.K2)({columns:gb,data:t,getSubRows:e=>e.children,enableExpanding:!0,onExpandedChange:i,state:{expanded:a},enableColumnResizing:!0,columnResizeMode:"onChange"});return(0,n.jsx)(go.X,{wrapperClassName:gd(),table:s,stickyHeader:!0,width:"max"})}function gv({traceId:e}){var t,a;let{traceView:r}=(0,x.Zd)(),i=r?.url?(t=r.url,a={traceId:e},t.replace(/\${(\w+)}/g,(e,t)=>a[t]||e)):"";return i?(0,n.jsxs)(as.$,{view:"flat-info",href:i,target:"_blank",children:[hX("trace"),(0,n.jsx)(as.$.Icon,{children:(0,n.jsx)(h6.A,{})})]}):null}let gj=(0,d.cn)("ydb-query-result"),gT="result",gw="schema",gS="simplified",g_="json",gN="stats",gE={get result(){return hX("action.result")},get schema(){return hX("action.schema")},get simplified(){return hX("action.explain-plan")},get json(){return hX("action.json")},get stats(){return hX("action.stats")},get ast(){return hX("action.ast")}},gC=["result","schema","simplified","stats"],gA=["schema","simplified","json","ast"];function gI({result:e,resultType:t="execute",isResultsCollapsed:a,theme:i,database:s,queryText:o,tableSettings:c,onCollapseResults:d,onExpandResults:u}){let m,p=(0,_.YQ)(),h=(0,_.N4)(lX.LI),g="execute"===t,x="explain"===t,[y,b]=r.useState(0),[f]=(0,_.iK)(s3.GS.USE_SHOW_PLAN_SVG),v=r.useMemo(()=>{let e=h?.[t];return e&&(g?gC:gA).includes(e)?e:g?gT:gw},[h,t,g]),{error:j,isLoading:T,streamingStatus:w,data:S={}}=e,{preparedPlan:N,simplifiedPlan:E,stats:C,resultSets:A,ast:I}=S;r.useEffect(()=>()=>{p((0,us.sM)())},[p]);let P=r.useMemo(()=>{let e=[];return g?e=gC:x&&(e=gA),e.map(e=>({value:e,content:gE[e]}))},[g,x]),k=()=>(0,n.jsx)(h1,{message:hX("description.empty-result",{activeSection:gE[v]})}),D=e=>(0,n.jsxs)(tC.s,{justifyContent:"center",alignItems:"center",width:"100%",gap:8,children:[(0,n.jsx)(cJ.v,{name:"error",className:gj("illustration")}),(0,n.jsxs)(tC.s,{direction:"column",gap:2,children:[(0,n.jsx)(tE.E,{variant:"subheader-2",children:e?hX("stopped.title"):hX("error.title")}),(0,n.jsx)(tE.E,{color:"complementary",children:e?hX("stopped.description"):hX("error.description")})]})]}),R=hP(j);return(0,n.jsxs)(r.Fragment,{children:[(0,n.jsxs)("div",{className:gj("controls"),children:[(0,n.jsxs)("div",{className:gj("controls-left"),children:[P.length&&v?(0,n.jsx)(dk.x,{options:P,value:v,onUpdate:e=>{p((0,lX.Hp)({queryType:t,tabId:e}))}}):null,(0,n.jsx)(hq,{error:j,loading:T,streamingStatus:w}),S?.traceId&&g?(0,n.jsx)(gv,{traceId:S.traceId}):null]}),(0,n.jsxs)("div",{className:gj("controls-right"),children:[T||hP(j)?null:(0,n.jsx)(ge,{queryResultsInfo:{queryText:o,ast:S.ast,stats:S.stats,plan:S.plan},error:j,database:s,hasPlanToSvg:!!(S?.plan&&f&&g)}),(()=>{if(T)return null;let e=(()=>{switch(v){case gT:{let e=S?.resultSets?.[y];return function(e){if(!e?.length)return"";let t=Object.keys(e[0]),a=[t.map(hU).join("	")];for(let n of e){let e=[];for(let a of t){let t=n[a];e.push(hU("object"==typeof t?JSON.stringify(t):`${t}`))}a.push(e.join("	"))}return a.join("\n")}(e?.result)}case g_:return N?.pristine;case gS:return E?.pristine;case gN:return C;case"ast":return I;default:return}})(),t=(0,eW.vN)(e);return t?(0,n.jsx)(uW.b,{text:t,view:"flat-secondary",tooltipInitialText:hX("action.copy",{activeSection:v})}):null})(),(0,n.jsx)(uc,{}),(0,n.jsx)(pc,{onCollapse:d,onExpand:u,isCollapsed:a,initialDirection:"bottom"})]})]}),T||R?null:(0,n.jsx)(hz,{}),R&&S.resultSets?.length?(0,n.jsx)(hQ,{}):null,(0,n.jsx)(l.r,{loading:T&&(!S.resultSets||"result"!==v),children:(0,n.jsx)(uh,{className:gj("result"),children:(m=hP(j),v===gT?j&&m&&!A?.length?D(m):(0,n.jsx)(gs,{resultSets:A,error:j,selectedResultSet:y,tableSettings:c,setSelectedResultSet:b}):j?g||m?D(m):(0,n.jsx)(gr,{error:j}):v===gw?N?.nodes?.length?(0,n.jsx)(h3,{theme:i,explain:N}):k():v===g_?N?.pristine?(0,n.jsx)(ga,{data:N?.pristine}):k():v===gS?E?.plan?.length?(0,n.jsx)(gf,{plan:E.plan}):k():v===gN?C?(0,n.jsx)(ga,{data:C}):k():"ast"===v?I?(0,n.jsx)(hH,{ast:I,theme:i}):k():null)})})]})}var gP=a(42368);let gk=()=>-1,gD=(0,d.cn)("ydb-query-settings-select");function gR(e){return(0,n.jsx)("div",{className:gD("selector"),children:(0,n.jsx)(eQ.l,{id:e.id,disabled:e.disabled,options:e.settingOptions,value:[e.setting],onUpdate:t=>{e.onUpdateSetting(t[0])},getOptionHeight:gk,popupClassName:gD("popup"),renderOption:e=>(0,n.jsxs)("div",{className:gD("item",{type:e.value}),children:[(0,n.jsxs)("div",{className:gD("item-title"),children:[e.content,e.isDefault?m6("description.default"):""]}),e.text&&(0,n.jsx)("span",{className:gD("item-description"),children:e.text})]}),width:"max"})})}let gM=(0,d.cn)("ydb-timeout-label");function gO({isDisabled:e,isChecked:t,onToggle:a}){let[r]=(0,_.gz)();return r?(0,n.jsxs)("div",{className:gM("switch-title"),children:[(0,n.jsx)(rK.d,{disabled:e,checked:t,onUpdate:a,className:gM("switch"),content:pt.timeout.title}),e&&(0,n.jsx)(nm.H,{className:gM("question-icon"),popoverProps:{placement:"bottom-start"},children:m6("form.timeout.disabled")})]}):(0,n.jsx)("label",{htmlFor:"timeout",className:gM("label-title"),children:pt.timeout.title})}let gq=(0,d.cn)("ydb-query-settings-timeout");function gL({id:e,value:t,onChange:a,onToggle:i,validationState:s,errorMessage:l,isDisabled:o}){let c=r.useCallback(e=>{a(e.target.value?Number(e.target.value):void 0)},[a]),d=null!==t;return(0,n.jsxs)(r.Fragment,{children:[(0,n.jsx)(gO,{isDisabled:o,isChecked:d,onToggle:i}),d&&(0,n.jsx)("div",{className:gq("control-wrapper"),children:(0,n.jsx)(aM.k,{id:e,type:"number",value:t?.toString()||"",onChange:c,className:gq("input"),placeholder:"60",validationState:s,errorMessage:l,errorPlacement:"inside",endContent:(0,n.jsx)("span",{className:gq("postfix"),children:m6("form.timeout.seconds")})})})]})}let gz=(0,d.cn)("ydb-query-settings-dialog");function gF(){let e=(0,_.YQ)(),t=(0,_.N4)(mM.xM),[a,i]=(0,_.XS)(),s=r.useCallback(()=>{e((0,mM.NJ)("idle"))},[e]),l=r.useCallback(e=>{i(e),s()},[s,i]);return(0,n.jsxs)(aR.l,{open:"settings"===t,size:"s",onClose:s,className:gz(),hasCloseButton:!1,children:[(0,n.jsx)(aR.l.Header,{caption:m6("action.settings")}),(0,n.jsx)(gQ,{initialValues:a,onSubmit:l,onClose:s})]})}function gQ({initialValues:e,onSubmit:t,onClose:a}){let{control:i,handleSubmit:s,setValue:l,watch:o,formState:{errors:c}}=(0,rY.mN)({defaultValues:e,resolver:(0,r8.u)(tH.id)}),[d]=(0,_.iK)(s3.GS.USE_SHOW_PLAN_SVG),u=(0,al.Oi)(),[m]=(0,_.gz)(),{database:p}=aj(),{resourcePools:h,isLoading:g}=(0,_.ny)(p,e.resourcePool),x=r.useMemo(()=>[{value:tH.nh,content:m6("form.resource-pool.no-override")},...h.map(e=>({value:e,content:e}))],[h]),y=o("timeout"),b=o("resourcePool"),f=o("queryMode");return r.useEffect(()=>{g||b&&b!==tH.nh&&(h.length&&h.includes(b)||l("resourcePool",tH.nh))},[g,h,b,l]),(0,n.jsxs)("form",{onSubmit:s(t),children:[(0,n.jsxs)(aR.l.Body,{className:gz("dialog-body"),children:[(0,n.jsxs)(tC.s,{direction:"row",alignItems:"flex-start",className:gz("dialog-row"),children:[(0,n.jsx)("label",{htmlFor:"queryMode",className:gz("field-title"),children:pt.queryMode.title}),(0,n.jsx)("div",{className:gz("control-wrapper",{queryMode:!0}),children:(0,n.jsx)(rY.xI,{name:"queryMode",control:i,render:({field:e})=>(0,n.jsx)(gR,{id:"queryMode",setting:e.value,onUpdateSetting:t=>{e.onChange(t),"query"!==t&&null===y?l("timeout",""):"query"===t&&l("timeout",null)},settingOptions:pt.queryMode.options})})})]}),u&&(0,n.jsxs)(tC.s,{direction:"row",alignItems:"flex-start",className:gz("dialog-row"),children:[(0,n.jsx)("label",{htmlFor:"tracingLevel",className:gz("field-title"),children:pt.tracingLevel.title}),(0,n.jsx)("div",{className:gz("control-wrapper"),children:(0,n.jsx)(rY.xI,{name:"tracingLevel",control:i,render:({field:e})=>(0,n.jsx)(gR,{id:"tracingLevel",setting:e.value,onUpdateSetting:e.onChange,settingOptions:pt.tracingLevel.options})})})]}),(0,n.jsxs)(tC.s,{direction:"row",alignItems:"flex-start",className:gz("dialog-row"),children:[(0,n.jsx)("label",{htmlFor:"transactionMode",className:gz("field-title"),children:pt.transactionMode.title}),(0,n.jsx)("div",{className:gz("control-wrapper",{transactionMode:!0}),children:(0,n.jsx)(rY.xI,{name:"transactionMode",control:i,render:({field:e})=>(0,n.jsx)(gR,{id:"transactionMode",setting:e.value,onUpdateSetting:e.onChange,settingOptions:pt.transactionMode.options})})})]}),(0,n.jsxs)(tC.s,{direction:"row",alignItems:"flex-start",className:gz("dialog-row"),children:[(0,n.jsx)("label",{htmlFor:"statisticsMode",className:gz("field-title"),children:pt.statisticsMode.title}),(0,n.jsx)(hf.m,{className:gz("statistics-mode-tooltip"),disabled:!d,openDelay:0,content:m6("tooltip_plan-to-svg-statistics"),children:(0,n.jsx)("div",{className:gz("control-wrapper",{statisticsMode:!0}),children:(0,n.jsx)(rY.xI,{name:"statisticsMode",control:i,render:({field:e})=>(0,n.jsx)(gR,{id:"statisticsMode",disabled:d,setting:e.value,onUpdateSetting:e.onChange,settingOptions:pt.statisticsMode.options})})})})]}),(0,n.jsxs)(tC.s,{direction:"row",alignItems:"flex-start",className:gz("dialog-row"),children:[(0,n.jsx)("label",{htmlFor:"limitRows",className:gz("field-title"),children:pt.limitRows.title}),(0,n.jsx)("div",{className:gz("control-wrapper"),children:(0,n.jsx)(rY.xI,{name:"limitRows",control:i,render:({field:e})=>(0,n.jsx)(aM.k,{id:"limitRows",type:"number",...e,value:e.value?.toString(),className:gz("limit-rows"),placeholder:"10000",validationState:c.limitRows?"invalid":void 0,errorMessage:c.limitRows?.message,errorPlacement:"inside",endContent:(0,n.jsx)("span",{className:gz("postfix"),children:m6("form.limit.rows")})})})})]}),m&&(0,n.jsxs)(tC.s,{direction:"row",alignItems:"flex-start",className:gz("dialog-row"),children:[(0,n.jsx)("label",{htmlFor:"outputChunkMaxSize",className:gz("field-title"),children:pt.outputChunkMaxSize.title}),(0,n.jsx)("div",{className:gz("control-wrapper"),children:(0,n.jsx)(rY.xI,{name:"outputChunkMaxSize",control:i,render:({field:e})=>(0,n.jsx)(aM.k,{id:"outputChunkMaxSize",type:"number",...e,value:e.value?.toString(),className:gz("output-chunk-max-size"),placeholder:"1000000",validationState:c.outputChunkMaxSize?"invalid":void 0,errorMessage:c.outputChunkMaxSize?.message,errorPlacement:"inside",endContent:(0,n.jsx)("span",{className:gz("postfix"),children:m6("form.output.chunk.max.size.bytes")})})})})]}),(0,n.jsxs)(tC.s,{direction:"row",alignItems:"flex-start",className:gz("dialog-row"),children:[(0,n.jsx)("label",{htmlFor:"resourcePool",className:gz("field-title"),children:pt.resourcePool.title}),(0,n.jsx)("div",{className:gz("control-wrapper",{resourcePool:!0}),children:(0,n.jsx)(rY.xI,{name:"resourcePool",control:i,render:({field:e})=>(0,n.jsx)(gR,{id:"resourcePool",setting:e.value??tH.nh,disabled:g||!h.length,onUpdateSetting:t=>e.onChange(t),settingOptions:x})})})]}),(0,n.jsxs)(tC.s,{direction:"row",alignItems:"flex-start",className:gz("dialog-row"),children:[(0,n.jsx)("label",{htmlFor:"pragmas",className:gz("field-title"),children:pt.pragmas.title}),(0,n.jsx)("div",{className:gz("control-wrapper"),children:(0,n.jsx)(rY.xI,{name:"pragmas",control:i,render:({field:e})=>(0,n.jsx)(gP.f,{id:"pragmas",...e,className:gz("pragmas"),placeholder:"PRAGMA OrderedColumns;",rows:3,validationState:c.pragmas?"invalid":void 0,errorMessage:c.pragmas?.message,errorPlacement:"inside"})})})]}),(0,n.jsx)(tC.s,{direction:"row",alignItems:"flex-start",className:gz("dialog-row"),children:(0,n.jsx)(rY.xI,{name:"timeout",control:i,render:({field:e})=>(0,n.jsx)(gL,{id:"timeout",value:"string"==typeof e.value?void 0:e.value,onChange:e.onChange,onToggle:t=>e.onChange(t?"":null),validationState:c.timeout?"invalid":void 0,errorMessage:c.timeout?.message,isDisabled:f!==tH.ei.query})})})]}),(0,n.jsx)(aR.l.Footer,{textButtonApply:m6("button-done"),textButtonCancel:m6("button-cancel"),onClickButtonCancel:a,propsButtonApply:{type:"submit"},renderButtons:(e,t)=>(0,n.jsxs)("div",{className:gz("buttons-container"),children:[(0,n.jsx)(as.$,{href:"https://ydb.tech/docs",target:"_blank",view:"outlined",size:"l",children:m6("docs")}),(0,n.jsxs)("div",{className:gz("main-buttons"),children:[t,e]})]})})]})}var gU=a(16400),g$=a(42344),gG=a(34230),gB=a(74069),gH=a(16509);function gW(){let e=(0,_.YQ)(),t=(0,_.N4)(lX.Vp),a=(0,_.N4)(lX.dl),n=(0,_.N4)(lX.pY),i=r.useCallback(t=>{e((0,lX.I2)({tabId:t}))},[e]),s=r.useCallback(t=>{hy.abortQuery(t),e((0,lX.Uh)({tabId:t}))},[e]),l=r.useCallback(()=>{s(t)},[t,s]),o=r.useCallback(e=>{a.filter(t=>t!==e).forEach(s)},[s,a]),c=r.useCallback(()=>{a.forEach(s)},[s,a]),d=r.useCallback(t=>{let a=n[t];if(!a)return;let r=a.title||mX("editor-tabs.untitled"),i=(0,m2.A)();e((0,lX.dF)({tabId:i,title:mX("editor-tabs.duplicate-title",{title:r}),input:a.input,makeActive:!0}))},[e,n]),u=r.useCallback((t,a)=>{e((0,lX.u2)({tabId:t,title:a}))},[e]),m=r.useCallback(()=>{let t=(0,m2.A)(),n=a.length+1;e((0,lX.dF)({tabId:t,title:mX("editor-tabs.default-title",{index:n})}))},[e,a.length]),p=r.useCallback(e=>{if(!a.length||1===a.length)return;let n=a.indexOf(t);if(-1===n)return void i(a[0]);let r=(n+e+a.length)%a.length;i(a[r])},[t,i,a]);return{activeTabId:t,tabsOrder:a,tabsById:n,handleTabSwitch:i,handleActivateTab:i,handleNewTabClick:m,handleCloseTab:s,handleCloseActiveTab:l,handleCloseOtherTabs:o,handleCloseAllTabs:c,handleDuplicateTab:d,handleRenameTab:u,handleNextTab:r.useCallback(()=>{p(1)},[p]),handlePreviousTab:r.useCallback(()=>{p(-1)},[p])}}let gV="rename-tab-dialog";function gJ({open:e,title:t,onRename:a,onClose:i}){let[s,l]=r.useState(t),[o,c]=r.useState(),d=r.useCallback(()=>{i()},[i]),u=r.useCallback(e=>{l(e),c(void 0)},[]),m=r.useCallback(()=>{let e=s.trim();e?(a(e),d()):c(mX("editor-tabs.rename-dialog.error-empty"))},[d,s,a]),p=r.useRef(null);return(0,n.jsxs)(aR.l,{open:e,hasCloseButton:!1,size:"s",onClose:d,onEnterKeyDown:m,initialFocus:p,children:[(0,n.jsx)(aR.l.Header,{caption:mX("editor-tabs.rename-dialog.title")}),(0,n.jsx)(aR.l.Body,{children:(0,n.jsx)(aM.k,{value:s,onUpdate:u,placeholder:mX("editor-tabs.rename-dialog.input-placeholder"),controlRef:p,hasClear:!0,autoComplete:!1,validationState:o?"invalid":void 0,errorMessage:o})}),(0,n.jsx)(aR.l.Footer,{textButtonApply:mX("editor-tabs.rename-dialog.apply"),textButtonCancel:mX("editor-tabs.rename-dialog.cancel"),onClickButtonApply:m,onClickButtonCancel:d})]})}let gK=aD.Ay.create(e=>{let t=aD.Ay.useModal(),a=r.useCallback(()=>{t.hide(),t.remove()},[t]);return(0,n.jsx)(gJ,{...e,open:t.visible,onClose:a})});aD.Ay.register(gV,gK);let gY=(0,d.cn)("query-editor");function gZ({tabId:e,tab:t,isActive:a,onActivate:i,onCloseTab:s,onDuplicateTab:l,onRenameTab:o,onSaveQueryAs:c,onCloseOtherTabs:d,onCloseAllTabs:u}){let m=t.title||mX("editor-tabs.untitled"),p=!!t.isDirty,h=!!t.result?.isLoading,g=r.useCallback(t=>{t.stopPropagation(),i(e)},[i,e]),x=r.useCallback(t=>{t.stopPropagation(),s(e)},[s,e]),y=r.useCallback(()=>{o(e,t.title)},[o,t.title,e]),b=r.useCallback(()=>{l(e)},[l,e]),f=r.useCallback(()=>{c(e)},[c,e]),v=r.useCallback(()=>{d(e)},[d,e]),j=r.useCallback(()=>{u()},[u]),T=r.useMemo(()=>{let t=e=>(0,n.jsx)("span",{children:e});return[[{text:mX("editor-tabs.rename"),iconStart:(0,n.jsx)(aS.A,{}),iconEnd:t("⌘T"),action:y},{text:mX("editor-tabs.duplicate"),iconStart:(0,n.jsx)(gU.A,{}),action:b}],[{text:mX("editor-tabs.add-to-favorites"),iconStart:(0,n.jsx)(g$.A,{}),disabled:!0,action:()=>{}},{text:mX("editor-tabs.save-query-as"),iconStart:(0,n.jsx)(gG.A,{}),iconEnd:t("⌘⇧S"),action:f},{text:mX("editor-tabs.share-query"),iconStart:(0,n.jsx)(gB.A,{}),disabled:!0,action:()=>{}}],[{text:mX("editor-tabs.close"),iconStart:(0,n.jsx)(lq.A,{}),iconEnd:t("⌘⌫"),action:()=>s(e)},{text:mX("editor-tabs.close-other-tabs"),iconStart:(0,n.jsx)(lq.A,{}),iconEnd:t("⌘⇧⌫"),action:v},{text:mX("editor-tabs.close-all-tabs"),iconStart:(0,n.jsx)(lq.A,{}),iconEnd:t("⌘⌥⌫"),action:j}]]},[j,v,b,y,f,s,e]),w=r.useCallback(e=>(0,n.jsx)("span",{...e,className:gY("editor-tab-action",{menu:!0}),children:(0,n.jsx)(h4.A,{})}),[]);return(0,n.jsx)(P.o,{value:e,children:(0,n.jsxs)(tC.s,{className:gY("editor-tab"),alignItems:"center",gap:1,children:[(0,n.jsx)("span",{className:gY("editor-tab-title"),children:m}),p?(0,n.jsx)("span",{className:gY("editor-tab-indicator",{dirty:!0})}):null,h?(0,n.jsx)("span",{className:gY("editor-tab-indicator",{loading:!0}),children:(0,n.jsx)(cL.a,{size:"s"})}):null,(0,n.jsxs)(tC.s,{className:gY("editor-tab-actions"),alignItems:"center",gap:0,children:[(0,n.jsx)("span",{className:gY("editor-tab-action",{close:!0,active:a}),onClick:x,children:(0,n.jsx)(lq.A,{})}),(0,n.jsx)(i6.r,{items:T,onSwitcherClick:g,renderSwitcher:w,switcherWrapperClassName:gY("editor-tab-menu-switcher"),popupProps:{placement:["bottom-start","top-start"],floatingStyles:{width:264}},size:"m"})]})]})})}function gX(){let{activeTabId:e,tabsOrder:t,tabsById:a,handleTabSwitch:i,handleActivateTab:s,handleNewTabClick:l,handleCloseTab:o,handleCloseOtherTabs:c,handleCloseAllTabs:d,handleDuplicateTab:u,handleRenameTab:m}=gW(),{savedQueries:p,saveQuery:h}=mO(),g=r.useCallback(e=>{s(e);let t=a[e],n={savedQueries:p,onSaveQuery:h};t?.isTitleUserDefined?aD.Ay.show(mQ,{...n,defaultQueryName:t.title}):aD.Ay.show(mQ,n)},[s,p,h,a]),x=r.useCallback((e,t)=>{aD.Ay.show(gV,{title:t,onRename:t=>m(e,t)})},[m]),y=r.useCallback(t=>{let r=a[t];return r?(0,n.jsx)(gZ,{tabId:t,tab:r,isActive:t===e,onActivate:s,onCloseTab:o,onDuplicateTab:u,onRenameTab:x,onSaveQueryAs:g,onCloseOtherTabs:c,onCloseAllTabs:d},t):null},[e,s,o,d,c,u,x,g,a]);return(0,n.jsxs)(tC.s,{className:gY("editor-tabs"),alignItems:"center",justifyContent:"space-between",children:[(0,n.jsx)(A.f,{value:e,onUpdate:i,children:(0,n.jsx)(I.w,{size:"m",children:t.map(y)})}),(0,n.jsx)(tC.s,{className:gY("editor-tabs-actions"),alignItems:"center",gap:1,children:(0,n.jsx)(as.$,{view:"flat-secondary",size:"xs",onClick:l,children:(0,n.jsx)(as.$.Icon,{children:(0,n.jsx)(gH.A,{})})})})]})}var g0=a(23398);let g1=(0,a(84187)._)(async()=>({Editor:(await Promise.resolve().then(a.bind(a,34495))).default}),"Editor");var g2=a(15452),g3=a(72680),g4=JSON.parse('{"context_syntax-error":"Syntax error"}');let g5=(0,en.g4)("ydb-monaco",{en:g4}),g6=(0,o.debounce)(function(){let e=window.ydbEditor?.getModel();if(!e)return void console.error("unable to retrieve model when highlighting errors");let t=(0,g2.kh)(e.getValue()).errors;if(!t.length)return void g7();let a=t.map(e=>({message:g5("context_syntax-error"),source:e.message,severity:g3.MarkerSeverity.Error,startLineNumber:e.startLine,startColumn:e.startColumn+1,endLineNumber:e.endLine,endColumn:e.endColumn+1}));g3.editor.setModelMarkers(e,"ydb",a)},500);function g7(){g3.editor.removeAllMarkers("ydb")}let g8=b.F.injectEndpoints({endpoints:e=>({getCodeAssistSuggestions:e.query({queryFn:async e=>{try{if(window.api.codeAssist)return{data:await window.api.codeAssist.getCodeAssistSuggestions(e)};throw Error("Method is not implemented.")}catch{return{data:{items:[]}}}}}),acceptSuggestion:e.mutation({queryFn:async e=>{try{if(window.api.codeAssist)return{data:await window.api.codeAssist.sendCodeAssistTelemetry({Accepted:{AcceptedText:e.acceptedText,ConvertedText:e.acceptedText,Timestamp:Date.now(),RequestId:e.requestId}})};throw Error("Method is not implemented.")}catch(e){return{error:e}}}}),discardSuggestion:e.mutation({queryFn:async e=>{try{if(window.api.codeAssist)return{data:await window.api.codeAssist.sendCodeAssistTelemetry({Discarded:{RequestId:e.requestId,Timestamp:Date.now(),DiscardReason:"OnCancel",DiscardedText:e.suggestionText,CacheHitCount:e.hitCount}})};throw Error("Method is not implemented.")}catch(e){return{error:e}}}}),ignoreSuggestion:e.mutation({queryFn:async e=>{try{if(window.api.codeAssist)return{data:await window.api.codeAssist.sendCodeAssistTelemetry({Ignored:{RequestId:e.requestId,Timestamp:Date.now(),IgnoredText:e.suggestionText}})};throw Error("Method is not implemented.")}catch(e){return{error:e}}}}),sendUserQueriesData:e.mutation({queryFn:async e=>{try{if(window.api.codeAssist)return{data:await window.api.codeAssist.sendCodeAssistOpenTabs(e)};throw Error("Method is not implemented.")}catch(e){return{error:e}}}})}),overrideExisting:"throw"}),g9={automaticLayout:!0,selectOnLineNumbers:!0,minimap:{enabled:!1},fixedOverflowWidgets:!0};class xe{modelsByTabId=new Map;viewStatesByTabId=new Map;activeTabId=null;setActiveTabModel(e){let{tabId:t,nextValue:a,editor:n,monaco:r}=e,i=this.activeTabId,s=!!(i&&i!==t);s&&i&&this.viewStatesByTabId.set(i,n.saveViewState());let l=this.getOrCreateModel(t,a,r);l.getValue()!==a&&l.setValue(a);let o=n.getModel()!==l;if(o&&n.setModel(l),s||o){let e=this.viewStatesByTabId.get(t);e&&n.restoreViewState(e)}this.activeTabId=t,(s||o)&&n.focus()}disposeRemovedTabs(e){let t=new Set(e);for(let e of this.modelsByTabId.keys()){if(t.has(e))continue;let a=this.modelsByTabId.get(e);a&&a.dispose(),this.modelsByTabId.delete(e),this.viewStatesByTabId.delete(e),this.activeTabId===e&&(this.activeTabId=null)}}disposeAll(){for(let e of this.modelsByTabId.values())e.dispose();this.modelsByTabId.clear(),this.viewStatesByTabId.clear(),this.activeTabId=null}getOrCreateModel(e,t,a){let n=this.modelsByTabId.get(e);if(n&&!n.isDisposed())return n;let r=a.editor.createModel(t,"yql");return this.modelsByTabId.set(e,r),r}}let xt="navigation";function xa({changeUserInput:e,theme:t,handleSendExecuteClick:a,handleGetExplainQueryClick:i,historyQueries:s,goToPreviousQuery:l,goToNextQuery:o}){let c,d=(0,_.N4)(lX.Wp),u=(0,_.N4)(lX.gU),{savedQueries:m,saveQuery:p}=mO(),{activeTabId:h,tabsOrder:g,handleNewTabClick:x,handleCloseActiveTab:y,handleNextTab:b,handlePreviousTab:f}=gW(),v=(0,_.YQ)(),[j,T]=r.useState(),[S]=(0,_.iK)(s3.GS.ENABLE_CODE_ASSISTANT),N=function(){let[e]=(0,_.iK)(s3.GS.ENABLE_AUTOCOMPLETE),[t]=(0,_.iK)(s3.GS.AUTOCOMPLETE_ON_ENTER);return r.useMemo(()=>{let a=!!e;return{quickSuggestions:a,suggestOnTriggerCharacters:a,acceptSuggestionOnEnter:t?"on":"off",...g9}},[e,t])}(),E=(r.useEffect(()=>()=>{g6.cancel()},[g6]),c=g6,r.useCallback(()=>{g7(),c()},[c])),C=r.useRef(null),A=r.useRef(null),I=r.useRef(new xe),P=!!w.J.enableMultiTabQueryEditor;r.useEffect(()=>{if(!P)return;let e=C.current,t=A.current;e&&t&&I.current.setActiveTabModel({tabId:h,nextValue:d,editor:e,monaco:t})},[h,d,P]),r.useEffect(()=>{P&&I.current.disposeRemovedTabs(g)},[P,g]);let[k]=(0,_.iK)(s3.GS.LAST_USED_QUERY_ACTION),D=(0,_.A5)(()=>s&&0!==s.length?s[s.length-1].queryText:""),R=(0,_.A5)(()=>{k===tH.x5.explain?i(d):a(d)}),M=(0,_.A5)(()=>{x()}),O=(0,_.A5)(()=>{y()}),q=(0,_.A5)(()=>{b()}),L=(0,_.A5)(()=>{f()}),z=r.useCallback(e=>{hy.abortQuery(e),v((0,lX.Uh)({tabId:e}))},[v]),F=(0,_.A5)(()=>{g.filter(e=>e!==h).forEach(z)}),Q=(0,_.A5)(()=>{g.forEach(z)}),U=(0,_.A5)(()=>{aD.Ay.show(gV,{title:u?.title||"",onRename:e=>{v((0,lX.u2)({tabId:h,title:e}))}})}),$=(0,_.A5)(()=>{let e={savedQueries:m,onSaveQuery:p};u?.isTitleUserDefined?aD.Ay.show(mQ,{...e,defaultQueryName:u.title}):aD.Ay.show(mQ,e)}),{monacoGhostConfig:G,prepareUserQueriesCache:B}=function(e){let[t]=g8.useLazyGetCodeAssistSuggestionsQuery(),[a]=g8.useAcceptSuggestionMutation(),[n]=g8.useDiscardSuggestionMutation(),[i]=g8.useIgnoreSuggestionMutation(),[s]=g8.useSendUserQueriesDataMutation(),{savedQueries:l}=mO(),o=r.useCallback(async e=>t(e).unwrap(),[t]),c=r.useCallback(async e=>a(e).unwrap(),[a]),d=r.useCallback(async e=>n(e).unwrap(),[n]),u=r.useCallback(async e=>i(e).unwrap(),[i]),m=r.useMemo(()=>[...e.map((e,t)=>({name:`query${t}.yql`,text:e.queryText})),...(l??[]).map(e=>({name:e.name,text:e.body}))],[e,l]);return{prepareUserQueriesCache:r.useCallback(async()=>{let e=m.map((e,t)=>({FileName:e.name||`query${t}.yql`,Text:e.text}));try{return await s(e).unwrap()}catch{return{items:[]}}},[s,m]),monacoGhostConfig:r.useMemo(()=>({api:{getCodeAssistSuggestions:o},eventHandlers:{onCompletionAccept:c,onCompletionDecline:d,onCompletionIgnore:u},config:{language:"yql"}}),[o,c,d,u])}}(s);return r.useEffect(()=>(j&&S&&(j.register(G),B()),()=>{j?.unregister()}),[S,G,j,B]),(0,n.jsx)(g1,{language:"yql",value:d,options:N,onChange:t=>{E(),e({input:t}),v((0,lX.Xb)(!0))},editorDidMount:(e,t)=>{var n,r,i;let s;window.ydbEditor=e,C.current=e,A.current=t,P&&I.current.setActiveTabModel({tabId:h,nextValue:d,editor:e,monaco:t});let c=function(e){let{KeyMod:t,KeyCode:a}=e,n=t.CtrlCmd,r=t.Alt;return{sendQuery:n|a.Enter,sendSelectedQuery:n|t.Shift|e.KeyCode.Enter,saveQuery:n|a.KeyS,saveQueryAs:n|t.Shift|a.KeyS,shortcutsHotkey:n|a.KeyK,newTab:n|r|a.KeyT,renameTab:n|a.KeyT,closeTab:n|a.Backspace,closeOtherTabs:n|t.Shift|a.Backspace,closeAllTabs:n|r|a.Backspace,nextTab:n|r|a.RightArrow,previousTab:n|r|a.LeftArrow}}(t);t.editor.registerCommand("insertSnippetToEditor",(t,a)=>{let n=e.getContribution("snippetController2");"object"==typeof n&&null!==n&&"function"==typeof n.insert&&(e.focus(),e.setValue(""),n.insert(a),v((0,lX.Xb)(!1)))}),window.api.codeAssist&&T((0,g0._z)(e)),n=e,s=eJ()(()=>{n.layout()},100),n.layout(),window.addEventListener("resize",s),n.onDidDispose(()=>{window.removeEventListener("resize",s)}),r=e,i=D,xn(r.getValue(),i()),r.onDidChangeModelContent(()=>{xn(r.getValue(),i())}),r.onDidDispose(()=>{window.onbeforeunload=null}),e.focus(),e.addAction({id:"sendQuery",label:mX("action.send-query"),keybindings:[c.sendQuery],precondition:void 0,keybindingContext:void 0,contextMenuGroupId:xt,contextMenuOrder:1,run:()=>R()});let u=e.createContextKey("canSendSelectedText",!1);e.onDidChangeCursorSelection(({selection:e,secondarySelections:t})=>{let a=e.selectionStartLineNumber!==e.positionLineNumber||e.selectionStartColumn!==e.positionColumn,n=t.length>0;u.set(a&&!n)}),e.addAction({id:"sendSelectedQuery",label:mX("action.send-selected-query"),keybindings:[c.sendSelectedQuery],precondition:"canSendSelectedText",contextMenuGroupId:xt,contextMenuOrder:1,run:e=>{let t=e.getSelection(),n=e.getModel();t&&n&&a(n.getValueInRange({startLineNumber:t.getSelectionStart().lineNumber,startColumn:t.getSelectionStart().column,endLineNumber:t.getPosition().lineNumber,endColumn:t.getPosition().column}),!0)}}),e.addAction({id:"previous-query",label:mX("action.previous-query"),contextMenuGroupId:xt,contextMenuOrder:2,run:()=>{l()}}),e.addAction({id:"next-query",label:mX("action.next-query"),contextMenuGroupId:xt,contextMenuOrder:3,run:()=>{o()}}),e.addAction({id:"save-query",label:mX("action.save-query"),keybindings:[c.saveQuery],run:()=>$()}),e.addAction({id:"openKeyboardShortcutsPanel",label:mX("action.open-shortcuts"),keybindings:[c.shortcutsHotkey],contextMenuGroupId:xt,contextMenuOrder:4,run:()=>{let e=new CustomEvent("openKeyboardShortcutsPanel");window.dispatchEvent(e)}}),P&&(e.addAction({id:"newEditorTab",label:mX("editor-tabs.action.new-tab"),keybindings:[c.newTab],run:()=>M()}),e.addAction({id:"closeEditorTab",label:mX("editor-tabs.action.close-tab"),keybindings:[c.closeTab],run:()=>O()}),e.addAction({id:"renameEditorTab",label:mX("editor-tabs.rename"),keybindings:[c.renameTab],run:()=>U()}),e.addAction({id:"nextEditorTab",label:mX("editor-tabs.action.next-tab"),keybindings:[c.nextTab],run:()=>q()}),e.addAction({id:"previousEditorTab",label:mX("editor-tabs.action.previous-tab"),keybindings:[c.previousTab],run:()=>L()}),e.addAction({id:"closeOtherEditorTabs",label:mX("editor-tabs.close-other-tabs"),keybindings:[c.closeOtherTabs],run:()=>F()}),e.addAction({id:"closeAllEditorTabs",label:mX("editor-tabs.close-all-tabs"),keybindings:[c.closeAllTabs],run:()=>Q()}),e.addAction({id:"saveQueryAs",label:mX("editor-tabs.save-query-as"),keybindings:[c.saveQueryAs],run:()=>$()}))},theme:`vs-${t}`,editorWillUnmount:()=>{window.ydbEditor=void 0,I.current.disposeAll(),C.current=null,A.current=null}})}function xn(e,t){e&&e!==t?window.onbeforeunload=e=>{e.preventDefault(),e.returnValue=""}:window.onbeforeunload=null}let xr=(0,d.cn)("query-editor"),xi={triggerExpand:!1,triggerCollapse:!1,collapsed:!0};function xs({theme:e,changeUserInput:t,queriesHistory:a}){let i=(0,_.YQ)(),{database:s,path:l,type:c,subType:d,databaseFullPath:u}=aj(),m=(0,_.N4)(lX.yJ),p=(0,_.N4)(lX.Vp),h=(0,_.N4)(lX.wf),x=(0,_.N4)(v.Ab),{historyQueries:y,historyCurrentQueryId:b,saveQueryToHistory:f,updateQueryInHistory:j,goToPreviousQuery:T,goToNextQuery:N}=a,E=!!h,[C,A]=(0,_.XS)(),I=(0,al.Oi)(),[P,k]=pn(),{resetBanner:D}=pi(),[R,M]=(0,_.iK)(s3.GS.LAST_USED_QUERY_ACTION),O=(0,_.N4)(lX.BL)||"",[q]=(0,_.gz)(),[L]=(0,_.iK)(s3.GS.BINARY_DATA_IN_PLAIN_TEXT_DISPLAY),{resourcePools:z,normalizedResourcePool:F,isLoading:Q}=(0,_.ny)(s,C.resourcePool),U=!L,$=(0,al.j2)()&&q&&C.queryMode===tH.ei.query,[G]=lX.JO.useUseSendQueryMutation(),[B]=lX.JO.useUseStreamQueryMutation(),H=!!w.J.enableMultiTabQueryEditor;r.useEffect(()=>{Q||C.resourcePool!==F&&A({...C,resourcePool:F})},[Q,F,C,z.length,A]);let W=r.useMemo(()=>$?{displayIndices:{maxIndex:(C.limitRows||tH.jU.limitRows)+1}}:void 0,[$,C.limitRows]);r.useEffect(()=>{m!==s&&i((0,lX.Id)(s))},[i,s,m]);let[V,J]=r.useReducer(pl,xi),K=r.useRef(V.collapsed);K.current=V.collapsed,r.useEffect(()=>{J("triggerCollapse")},[]),r.useEffect(()=>{x||E?K.current&&J("triggerExpand"):J("triggerCollapse")},[x,E]);let Y=(0,_.A5)((e,t)=>{M(tH.x5.execute),i((0,lX.v1)({tabId:p,queryText:e})),(0,o.isEqual)(P,C)||(D(),k(C));let a=(0,m2.A)();if(hy.abortQuery(p),$){rJ("runQuery",{actionType:"execute",isStreaming:!0,...C});let t=B({tabId:p,actionType:"execute",query:e,database:s,querySettings:C,enableTracingLevel:I,base64:U});hy.registerQuery(p,t)}else{rJ("runQuery",{actionType:"execute",...C});let t=G({tabId:p,actionType:"execute",query:e,database:s,querySettings:C,enableTracingLevel:I,queryId:a,base64:U});t.then(({data:e})=>{e?.queryId&&j(e.queryId,e?.queryStats)}).catch(e=>{console.error("Failed to update query history:",e)}),hy.registerQuery(p,t)}if(i((0,v.o)(!1)),!t){let t=b?y.find(e=>e.queryId===b):null;e!==t?.queryText&&f(e,a),i((0,lX.Xb)(!1))}V.collapsed&&J("triggerExpand")}),Z=(0,_.A5)(e=>{M(tH.x5.explain),i((0,lX.v1)({tabId:p,queryText:e})),(0,o.isEqual)(P,C)||(D(),k(C));let t=(0,m2.A)();rJ("runQuery",{actionType:"explain",...C});let a=G({tabId:p,actionType:"explain",query:e,database:s,querySettings:C,enableTracingLevel:I,queryId:t,base64:U});hy.registerQuery(p,a),i((0,v.o)(!1)),V.collapsed&&J("triggerExpand")});return(0,n.jsxs)("div",{className:xr(),children:[(0,n.jsxs)(g,{direction:"vertical",defaultSizePaneKey:S.l_,triggerCollapse:V.triggerCollapse,triggerExpand:V.triggerExpand,minSize:[0,52],collapsedSizes:[100,0],onSplitStartDragAdditional:()=>{J("clear")},children:[(0,n.jsxs)("div",{className:xr("pane-wrapper",{top:!0}),children:[H?(0,n.jsx)(gX,{}):null,(0,n.jsx)("div",{className:xr("monaco-wrapper"),children:(0,n.jsx)("div",{className:xr("monaco"),children:(0,n.jsx)(xa,{changeUserInput:t,theme:e,handleSendExecuteClick:Y,handleGetExplainQueryClick:Z,historyQueries:y,goToPreviousQuery:T,goToNextQuery:N})})}),(0,n.jsx)(hA,{handleSendExecuteClick:Y,onSettingsButtonClick:()=>{i((0,mM.NJ)("settings"))},isLoading:!!h?.isLoading,handleGetExplainQueryClick:Z,highlightedAction:R,database:s,queryId:h?.queryId,isStreamingEnabled:$})]}),(0,n.jsx)("div",{className:xr("pane-wrapper"),children:(0,n.jsx)(xl,{resultVisibilityState:V,onExpandResultHandler:()=>{J("triggerExpand")},onCollapseResultHandler:()=>{J("triggerCollapse")},type:c,subType:d,theme:e,result:h,database:s,databaseFullPath:u,path:l,showPreview:x,queryText:O,tableSettings:W},h?.queryId)})]}),(0,n.jsx)(gF,{})]})}function xl({resultVisibilityState:e,onExpandResultHandler:t,onCollapseResultHandler:a,type:r,subType:i,theme:s,result:l,database:o,databaseFullPath:c,path:d,showPreview:u,queryText:m,tableSettings:p}){return u?(0,n.jsx)(pC,{database:o,path:d,type:r,subType:i,databaseFullPath:c}):l?(0,n.jsx)(gI,{result:l,resultType:l?.type,theme:s,database:o,isResultsCollapsed:e.collapsed,tableSettings:p,onExpandResults:t,onCollapseResults:a,queryText:m}):null}var xo=a(19122);let xc=[{id:j.tQ.newQuery,title:mX("tabs.newQuery")},{id:j.tQ.history,title:mX("tabs.history")},{id:j.tQ.saved,title:mX("tabs.saved")}],xd=({className:e,activeTab:t})=>{let a=(0,M.zy)(),r=(0,O.mA)(a);return(0,n.jsx)("div",{className:e,children:(0,n.jsx)(A.f,{value:t,children:(0,n.jsx)(I.w,{size:"l",children:xc.map(({id:e,title:t})=>{let a=(0,O.YL)({...r,[q.vh.queryTab]:e});return(0,n.jsx)(P.o,{value:e,children:(0,n.jsx)(xo.E,{to:a,as:"tab",children:t})},e)})})})})};var xu=a(68910);let xm=(0,d.cn)("ydb-saved-queries"),xp=({visible:e,queryName:t,onCancelClick:a,onConfirmClick:r})=>(0,n.jsxs)(aR.l,{open:e,hasCloseButton:!1,size:"s",onClose:a,onEnterKeyDown:r,children:[(0,n.jsx)(aR.l.Header,{caption:mX("delete-dialog.header")}),(0,n.jsxs)(aR.l.Body,{className:xm("dialog-body"),children:[mX("delete-dialog.question"),(0,n.jsx)("span",{className:xm("dialog-query-name"),children:` ${t}?`})]}),(0,n.jsx)(aR.l.Footer,{textButtonApply:mX("delete-dialog.delete"),textButtonCancel:mX("delete-dialog.cancel"),onClickButtonCancel:a,onClickButtonApply:r})]}),xh=({changeUserInput:e})=>{let{filteredSavedQueries:t,deleteSavedQuery:a}=mO(),i=(0,_.YQ)(),s=(0,_.N4)(mM.cu),[l,o]=r.useState(!1),[c,d]=r.useState(""),u=()=>{o(!1),d("")},m=mY(r.useCallback(({queryText:t,queryName:a})=>{e({input:t}),i((0,lX.Xb)(!1)),i((0,mM.JP)(a)),i((0,T.sH)(j.tQ.newQuery))},[e,i])),p=[{name:"name",header:"Name",render:({row:e})=>(0,n.jsx)("div",{className:xm("query-name"),children:e.name}),width:200},{name:"body",header:"Query Text",render:({row:e})=>{let t;return(0,n.jsxs)("div",{className:xm("query"),children:[(0,n.jsx)("div",{className:xm("query-body"),children:(0,n.jsx)(mC,{value:e.body,maxQueryHeight:6})}),(0,n.jsxs)("span",{className:xm("controls"),children:[(0,n.jsx)(as.$,{view:"flat-secondary",children:(0,n.jsx)(tI.I,{data:aS.A})}),(0,n.jsx)(as.$,{view:"flat-secondary",onClick:(t=e.name,e=>{e.stopPropagation(),o(!0),d(t)}),children:(0,n.jsx)(tI.I,{data:xu.A})})]})]})},sortable:!1,resizeMinWidth:650}];return(0,n.jsxs)(r.Fragment,{children:[(0,n.jsxs)(tu.L,{className:xm(),children:[(0,n.jsx)(tu.L.Controls,{children:(0,n.jsx)(tm.v,{onChange:e=>{i((0,mM.ys)(e))},placeholder:mX("filter.text.placeholder"),className:xm("search")})}),(0,n.jsx)(tu.L.Table,{children:(0,n.jsx)(tc.l,{columnsWidthLSKey:"savedQueriesTableColumnsWidth",columns:p,data:t,settings:l3,emptyDataMessage:mX(s?"history.empty-search":"saved.empty"),rowClassName:()=>xm("row"),onRowClick:e=>m({queryText:e.body,queryName:e.name}),initialSortOrder:{columnId:"name",order:tX.Ay.ASCENDING}})})]}),(0,n.jsx)(xp,{visible:l,queryName:c,onCancelClick:()=>{u()},onConfirmClick:()=>{u(),a(c),d("")}})]})},xg=(0,d.cn)("ydb-query"),xx=e=>{let t=(0,_.YQ)(),{queryTab:a=j.tQ.newQuery}=(0,_.N4)(e=>e.tenant),s=function(){let e=(0,_.YQ)(),t=(0,_.N4)(lX.jY),a=(0,_.N4)(lX.L9),[n,i]=(0,_.iK)(s3.GS.QUERIES_HISTORY),s=r.useMemo(()=>(n??[]).map(mN.QG),[n]),l=r.useMemo(()=>{let e=t?.toLowerCase();return e?s.filter(t=>t.queryText.toLowerCase().includes(e)):s},[s,t]),o=(0,_.A5)(()=>{let t;if(0===s.length)return;let n=s.findIndex(e=>e.queryId===a);(t=-1===n||0===n?s.at(-1):s[n-1])&&(e((0,lX.iZ)({input:t.queryText})),e((0,lX.zO)(t.queryId)))}),c=(0,_.A5)(()=>{let t;if(0===s.length)return;let n=s.findIndex(e=>e.queryId===a);(t=-1===n?s.at(-1):n===s.length-1?s[0]:s[n+1])&&(e((0,lX.iZ)({input:t.queryText})),e((0,lX.zO)(t.queryId)))}),d=(0,_.A5)((t,a)=>{if(!t)return;let n=s.length+1-20;i([...s.slice(n<0?0:n),{queryText:t,queryId:a}]),e((0,lX.zO)(a))}),u=(0,_.A5)((e,t)=>{if(!t||!s.length)return;let a=s.findIndex(t=>t.queryId===e);if(-1!==a){let e=[...s],{durationUs:n,endTime:r}=t;e[a]={...s[a],durationUs:n,endTime:r},i(e)}});return{historyQueries:s,historyCurrentQueryId:a,filteredHistoryQueries:l,goToPreviousQuery:o,goToNextQuery:c,saveQueryToHistory:d,updateQueryInHistory:u}}(),l=e=>{t((0,lX.iZ)(e))},o=r.useMemo(()=>xc.find(({id:e})=>e===a),[a]);return(0,n.jsxs)("div",{className:xg(),children:[o?(0,n.jsx)(i.mg,{children:(0,n.jsx)("title",{children:o.title})}):null,(0,n.jsx)(xd,{className:xg("tabs"),activeTab:a}),(0,n.jsx)("div",{className:xg("content"),children:(()=>{switch(a){case j.tQ.newQuery:return(0,n.jsx)(xs,{changeUserInput:l,queriesHistory:s,...e});case j.tQ.history:return(0,n.jsx)(m1,{changeUserInput:l,queriesHistory:s});case j.tQ.saved:return(0,n.jsx)(xh,{changeUserInput:l});default:return null}})()})]})},xy=(0,d.cn)("ydb-tenant-navigation"),xb=({id:e,title:t,icon:a})=>({value:e,content:(0,n.jsxs)("span",{className:xy("item"),children:[(0,n.jsx)(tI.I,{data:a,size:16,className:xy("icon")}),(0,n.jsx)("span",{className:xy("text"),children:t})]})}),xf=()=>{let e=(0,sk.S)();return(0,n.jsx)("div",{className:xy(),children:(0,n.jsx)(dk.x,{width:"auto",onUpdate:t=>{let a=e.find(e=>e.id===t);a?.onForward()},size:"l",className:xy("body"),value:(e.find(e=>e.current)||e[0]).id,options:e.map(xb)})})},xv=(0,d.cn)("object-general"),xj=function({additionalTenantProps:e}){let t=(0,m_.i)(),a=(0,nB.D)(),{path:r,database:i,type:s,subType:l,databaseFullPath:o}=aj(),{tenantPage:c}=(0,sk.H)();return(0,n.jsxs)("div",{className:xv(),children:[!a&&(0,n.jsx)(xf,{}),(()=>{switch(c){case j.Dg.query:return(0,n.jsx)(xx,{theme:t});case j.Dg.schema:case j.Dg.diagnostics:default:return(0,n.jsx)(mS,{path:r,database:i,type:s,subType:l,databaseFullPath:o,additionalTenantProps:e,databasePagesDisplay:a?"schema":"all"})}})()]})};var xT=a(89578);let xw=(e,t,a)=>{let{setActivePath:n,setTenantPage:r}=a;return{openPreview:()=>{t(b.F.util.invalidateTags(["PreviewData"])),t((0,v.o)(!0)),r(j.Dg.query),t((0,T.sH)(j.tQ.newQuery)),n(e)}}},xS=(e,t)=>(0,n.jsx)(as.$,{view:"flat-secondary",onClick:e.openPreview,title:(0,L.A)("actions.openPreview"),size:t||"s",children:(0,n.jsx)(tI.I,{data:xT.A})});var x_=a(11589),xN=a(10844);let xE=b.F.injectEndpoints({endpoints:e=>({getShowCreateTable:e.query({queryFn:async({database:e,path:t},{signal:a})=>{try{let n,r=await window.api.viewer.sendQuery({query:(n=t.replace(/`/g,"``"),`${S.Zi}
SHOW CREATE TABLE \`${n}\``),database:e,action:"execute-query"},{signal:a,withRetries:!0});if((0,tH.We)(r))return{error:r};let i=(0,tH.fW)(r),s=i?.resultSets?.[0]?.result||[];return{data:s[0]?.CreateQuery}}catch(e){return{error:e}}},providesTags:["All"]})}),overrideExisting:"throw"}),xC=5*S.KF,xA=b.F.injectEndpoints({endpoints:e=>({getTableSchemaData:e.query({queryFn:async({path:e,database:t,type:a,databaseFullPath:n,useMetaProxy:r},{dispatch:i})=>{try{if("EPathTypeView"===a){let a=await i(tW.endpoints.getViewSchema.initiate({database:t,path:e,databaseFullPath:n,timeout:xC}));if((0,tH.We)(a))return{error:a};return{data:an(a.data)}}let s=await i(f.endpoints.getOverview.initiate({path:e,database:t,timeout:xC,databaseFullPath:n,useMetaProxy:r}));return{data:aa(a,s.data)}}catch(e){return{error:e}}}})})});var xI=a(33172),xP=a(33269),xk=a(17965),xD=a.n(xk);let xR=({text:e,action:t,isLoading:a,iconStart:r})=>({text:(0,n.jsxs)(tC.s,{justifyContent:"space-between",alignItems:"center",children:[e,a&&(0,n.jsx)(hI.t,{size:"xs"})]}),action:t,disabled:a,iconStart:r}),xM=(0,d.cn)("ydb-schema-create-directory-dialog"),xO="relativePath";function xq({open:e,onClose:t,database:a,databaseFullPath:i,parentPath:s,onSuccess:l}){let o=(0,x.kK)(),[c,d]=r.useState(""),[u,m]=r.useState(""),[p,h]=v.sM.useCreateDirectoryMutation(),g=r.useRef(null),y=()=>{d(""),h.reset()},b=()=>{t(),m(""),y()},f=tG(s,i);return(0,n.jsxs)(aR.l,{open:e,onClose:b,size:"s",initialFocus:g,children:[(0,n.jsx)(aR.l.Header,{caption:(0,L.A)("schema.tree.dialog.header")}),(0,n.jsxs)("form",{onSubmit:e=>{e.preventDefault();let t=u?/\s/.test(u)?(0,L.A)("schema.tree.dialog.whitespace"):"":(0,L.A)("schema.tree.dialog.empty");d(t),t||p({database:a,databaseFullPath:i,path:`${s}/${u}`,useMetaProxy:o}).unwrap().then(()=>{b(),l(u)})},children:[(0,n.jsxs)(aR.l.Body,{children:[(0,n.jsxs)("label",{htmlFor:xO,className:xM("label"),children:[(0,n.jsx)("span",{className:xM("description"),children:(0,L.A)("schema.tree.dialog.description")}),`${f}/`]}),(0,n.jsx)("div",{className:xM("input-wrapper"),children:(0,n.jsx)(aM.k,{controlRef:g,placeholder:(0,L.A)("schema.tree.dialog.placeholder"),value:u,onUpdate:e=>{m(e),y()},autoFocus:!0,hasClear:!0,autoComplete:!1,disabled:h.isLoading,validationState:c?"invalid":void 0,id:xO,errorMessage:c})}),h.isError&&(0,n.jsx)(e$.o,{error:h.error,defaultMessage:(0,L.A)("schema.tree.dialog.invalid")})]}),(0,n.jsx)(aR.l.Footer,{loading:h.isLoading,textButtonApply:(0,L.A)("schema.tree.dialog.buttonApply"),textButtonCancel:(0,L.A)("schema.tree.dialog.buttonCancel"),onClickButtonCancel:b,propsButtonApply:{type:"submit"}})]})]})}let xL=r.createContext(void 0),xz=r.createContext(void 0);function xF({children:e}){let[t,a]=r.useState("");return(0,n.jsx)(xL.Provider,{value:t,children:(0,n.jsx)(xz.Provider,{value:a,children:e})})}function xQ(){let e=r.useContext(xz);if(void 0===e)throw Error("useDispatchTreeKey must be used within a TreeKeyProvider");return e}function xU(e){let t,a,i=(0,al.Ii)(),{rootName:s,rootType:l,currentPath:o,onActivePathUpdate:c,databaseFullPath:d,database:u}=e,m=(0,_.YQ)(),p=(0,x.kK)(),h=(0,_.N4)(lX.Wp),g=(0,_.N4)(lX.TY),[y,{currentData:b,isFetching:f}]=xA.useLazyGetTableSchemaDataQuery(),[w,{currentData:S,isFetching:N}]=rM.useLazyGetStreamingQueryInfoQuery(),[E,{currentData:C,isFetching:A}]=xE.useLazyGetShowCreateTableQuery(),I=(0,al._p)(),{handleTenantPageChange:P}=(0,sk.H)(),[k,D]=r.useState(!1),[R,M]=r.useState(""),O=xQ(),q=function(){let e=r.useContext(xL);if(void 0===e)throw Error("useTreeKey must be used within a TreeKeyProvider");return e}(),z=tB(d,l)?"database":G(l),F=r.useCallback(async e=>{let t;for(;;){let a=m(v.sM.endpoints.getSchema.initiate({path:e,database:u,databaseFullPath:d,useMetaProxy:p},{forceRefetch:!0})),{data:n,originalArgs:r}=await a;if(a.unsubscribe(),r?.path===e){t=n?.[e];break}}if(!t)throw Error(`No describe data about path ${e}`);let{PathDescription:{Children:a=[]}={}}=t;return a.map(e=>{let{Name:t="",PathType:a,PathSubType:n,ChildrenExist:r}=e,i=((n&&et[n]||a&&ea[a])??!1)||(0,xI.f8)(r)&&!r;return{name:t,type:G(a,n),expandable:!i,meta:{subType:n}}})},[m,u,d,p]);r.useEffect(()=>{o?.startsWith(d)||c(d)},[o,c,d]);let B=e=>{M(e),D(!0)},{monitoring:H}=(0,x.Zd)(),{controlPlane:W}=(0,T.Ry)(u),V=r.useMemo(()=>{let e=(0,sP.P)(W,H);return((e,t,a="",r)=>(i,s)=>{let l=tG(i,a),o=((e,t,a)=>{let{setActivePath:n,setTenantPage:r,showCreateDirectoryDialog:i,getConfirmation:s,getConnectToDBDialog:l,schemaData:o,streamingQueryData:c,showCreateTableData:d}=a,u=a=>()=>{let i=()=>{r(j.Dg.query),t((0,T.sH)(j.tQ.newQuery)),n(e.path),pO(a({...e,schemaData:o,streamingQueryData:c,showCreateTableData:d}))};s?s().then(e=>{e&&i()}):i()};return{createDirectory:i?()=>{i(e.path)}:void 0,getConnectToDBDialog:()=>l?.({database:e.database}),openMonitoring:()=>{r(j.Dg.diagnostics),t((0,T.WO)(j.iJ.monitoring)),n(e.path)},createTable:u(pL),createColumnTable:u(pz),createAsyncReplication:u(pF),alterAsyncReplication:u(p4),dropAsyncReplication:u(p2),createTransfer:u(pQ),alterTransfer:u(p5),dropTransfer:u(p3),alterTable:u(pU),dropTable:u(hm),manageAutoPartitioning:u(p$),manageReadReplicas:u(pG),manageTTL:u(pB),selectQuery:u(pH),showCreateTable:u(pW),upsertQuery:u(pV),createExternalTable:u(pK),dropExternalTable:u(pJ),selectQueryFromExternalTable:u(pH),createTopic:u(pY),alterTopic:u(pZ),dropTopic:u(pX),createView:u(p0),dropView:u(p1),createStreamingQuery:u(p6),alterStreamingQuerySettings:u(p7),alterStreamingQueryText:u(p8),dropStreamingQuery:u(p9),dropIndex:u(ha),addVectorIndex:u(ht),addTableIndex:u(he),createCdcStream:u(hn),copyPath:()=>{try{xD()(e.relativePath),(0,tR.A)({name:"Copied",title:(0,L.A)("actions.copied"),theme:"success"})}catch{(0,tR.A)({name:"Not copied",title:(0,L.A)("actions.notCopied"),theme:"danger"})}}}})({path:i,relativePath:l,database:r,type:s,databaseFullPath:a},e,t),c={text:(0,L.A)("actions.copyPath"),action:o.copyPath,iconStart:(0,n.jsx)(gU.A,{})},d={text:(0,L.A)("actions.connectToDB"),action:o.getConnectToDBDialog,iconStart:(0,n.jsx)(xP.A,{})},u={text:(0,L.A)("actions.openMonitoring"),action:o.openMonitoring,iconStart:(0,n.jsx)(iU.A,{})},m=[{text:(0,L.A)("actions.createTable"),action:o.createTable},{text:(0,L.A)("actions.createColumnTable"),action:o.createColumnTable},{text:(0,L.A)("actions.createAsyncReplication"),action:o.createAsyncReplication},{text:(0,L.A)("actions.createTransfer"),action:o.createTransfer},{text:(0,L.A)("actions.createTopic"),action:o.createTopic},{text:(0,L.A)("actions.createView"),action:o.createView},{text:(0,L.A)("actions.createStreamingQuery"),action:o.createStreamingQuery}],p={text:(0,L.A)("actions.manageColumns"),action:o.alterTable},h={text:(0,L.A)("actions.manageAutoPartitioning"),action:o.manageAutoPartitioning},g={text:(0,L.A)("actions.manageReadReplicas"),action:o.manageReadReplicas},x={text:(0,L.A)("actions.manageTTL"),action:o.manageTTL},y={text:(0,L.A)("actions.alterTable"),items:[p,h,g,x]},b={text:(0,L.A)("actions.alterTable"),items:[p,h,x]},f=[[c,d],m],v=[[c],m];if(t.hasMonitoring&&(f=[[c,d,u],m]),o.createDirectory){let e={text:(0,L.A)("actions.createDirectory"),action:o.createDirectory,iconStart:(0,n.jsx)(gH.A,{})};f.splice(1,0,[e]),v.splice(1,0,[e])}let w=xR({text:(0,L.A)("actions.showCreateTable"),action:o.showCreateTable,isLoading:t.isShowCreateTableLoading,iconStart:(0,n.jsx)(oa.A,{})}),S=[[c],[y,{text:(0,L.A)("actions.dropTable"),action:o.dropTable},xR({text:(0,L.A)("actions.selectQuery"),action:o.selectQuery,isLoading:t.isSchemaDataLoading}),xR({text:(0,L.A)("actions.upsertQuery"),action:o.upsertQuery,isLoading:t.isSchemaDataLoading}),{text:(0,L.A)("actions.addTableIndex"),action:o.addTableIndex},{text:(0,L.A)("actions.addVectorIndex"),action:o.addVectorIndex},{text:(0,L.A)("actions.createCdcStream"),action:o.createCdcStream}],[w]],_=[[c],[b,{text:(0,L.A)("actions.dropTable"),action:o.dropTable},{text:(0,L.A)("actions.selectQuery"),action:o.selectQuery},{text:(0,L.A)("actions.upsertQuery"),action:o.upsertQuery}],[w]],N=[[c],[{text:(0,L.A)("actions.alterTopic"),action:o.alterTopic},{text:(0,L.A)("actions.dropTopic"),action:o.dropTopic}]],E=[[c],[{text:(0,L.A)("actions.selectQuery"),action:o.selectQueryFromExternalTable}],[{text:(0,L.A)("actions.dropTable"),action:o.dropExternalTable}]],C=[[c],[{text:(0,L.A)("actions.createExternalTable"),action:o.createExternalTable}]],A=[[c],[{text:(0,L.A)("actions.selectQuery"),action:o.selectQuery}],[{text:(0,L.A)("actions.dropView"),action:o.dropView}]],I=[[c],[{text:(0,L.A)("actions.selectQuery"),action:o.selectQuery}]],P=[[c],[{text:(0,L.A)("actions.alterReplication"),action:o.alterAsyncReplication},{text:(0,L.A)("actions.dropReplication"),action:o.dropAsyncReplication}]],k=[[c],[{text:(0,L.A)("actions.alterTransfer"),action:o.alterTransfer},{text:(0,L.A)("actions.dropTransfer"),action:o.dropTransfer}]],D=[[c,{text:(0,L.A)("actions.dropIndex"),action:o.dropIndex}]],R=[[c],[{text:(0,L.A)("actions.alterStreamingQuerySettings"),action:o.alterStreamingQuerySettings},xR({text:(0,L.A)("actions.alterStreamingQueryText"),action:o.alterStreamingQueryText,isLoading:t.isStreamingQueryTextLoading}),{text:(0,L.A)("actions.dropStreamingQuery"),action:o.dropStreamingQuery}]],M=[c];return({async_replication:P,transfer:k,database:f,directory:v,resource_pool:M,table:S,column_table:_,system_table:I,index_table:M,topic:N,stream:M,index:D,external_table:E,external_data_source:C,view:A,streaming_query:R})[s]})(m,{setActivePath:c,setTenantPage:P,showCreateDirectoryDialog:i?B:void 0,getConfirmation:h&&g?mK:void 0,getConnectToDBDialog:xN.S,schemaData:b,isSchemaDataLoading:f,hasMonitoring:e,streamingQueryData:S,showCreateTableData:(0,eW.vN)(C),isShowCreateTableLoading:A,isStreamingQueryTextLoading:N},d,u)},[b,i,m,h,f,g,N,c,S,u,d,W,H,C,A,P]);return(0,n.jsxs)(r.Fragment,{children:[(0,n.jsx)(xq,{onClose:()=>{D(!1)},open:k,database:u,databaseFullPath:d,parentPath:R,onSuccess:e=>{let t=`${R}/${e}`;c(t),O(t)}}),(0,n.jsx)(x_.F,{rootState:{path:d,name:s,type:z,collapsed:!1},fetchPath:F,getActions:V,onActionsOpenToggle:({path:e,type:t,isOpen:a})=>{let n=Q[t];a&&n&&y({path:e,database:u,type:n,databaseFullPath:d,useMetaProxy:p});let r=U[t];a&&r&&E({path:tG(e,d),database:u});let i=$[t];return a&&i&&w({database:u,path:e},!0),[]},renderAdditionalNodeElements:(t={setActivePath:c,setTenantPage:P},a=void 0,(e,n,r)=>{let i=xS(xw(e,m,t),a),s=r?.subType==="EPathSubTypeStreamImpl";return({async_replication:void 0,transfer:void 0,database:void 0,directory:void 0,resource_pool:void 0,table:i,column_table:i,system_table:i,index_table:i,topic:I&&!s?i:void 0,stream:void 0,index:void 0,external_table:i,external_data_source:void 0,view:i,streaming_query:void 0})[n]}),activePath:o,onActivePathUpdate:c,cache:!1,virtualize:!0},q)]})}var x$=JSON.parse('{"title_navigation":"Navigation","field_source-type":"Source Type","field_data-source":"Data Source","action_copySchemaPath":"Copy schema path","action_openInDiagnostics":"Open in Diagnostics","field_type":"Type","field_subtype":"SubType","field_id":"Id","field_version":"Version","field_created":"Created","field_data-size":"Data size","field_row-count":"Row count","field_partitions":"Partitions count","field_system-view-type":"System view type","field_paths":"Paths","field_shards":"Shards","field_state":"State","field_mode":"Mode","field_format":"Format","field_retention":"Retention"}');let xG=(0,en.g4)("ydb-object-summary",{en:x$}),xB=(0,d.cn)("ydb-object-summary");function xH({database:e,path:t,databaseFullPath:a}){var r;let i=(0,x.kK)(),{data:s={},isLoading:l}=(0,v.Tn)({path:a,databaseFullPath:a,database:e,useMetaProxy:i}),o=s?.PathDescription?.Self,{handleSchemaChange:c}=aT();return!o&&l?(0,n.jsx)("div",{children:(0,n.jsx)(eG.a,{})}):(0,n.jsxs)("div",{className:xB("tree-wrapper"),children:[(0,n.jsx)("div",{className:xB("tree-header"),children:xG("title_navigation")}),(0,n.jsx)("div",{className:xB("tree"),children:o?(0,n.jsx)(xU,{database:e,databaseFullPath:a,rootName:(r=o.Name,r?r.startsWith("/")?r:`/${r}`:a.startsWith("/")?a:`/${a}`),rootType:o.PathType,currentPath:t,onActivePathUpdate:c}):null})]})}var xW=a(94555);function xV(){let e=(0,_.YQ)(),{diagnosticsTab:t}=(0,_.N4)(e=>e.tenant),{tenantPage:a,handleTenantPageChange:r}=(0,sk.H)(),i=a===j.Dg.diagnostics&&t===j.iJ.schema;return(0,n.jsx)("div",{children:!i&&(0,n.jsx)(as.$,{title:xG("action_openInDiagnostics"),onClick:()=>{r(j.Dg.diagnostics),e((0,T.WO)(j.iJ.schema))},size:"s",children:(0,n.jsx)(tI.I,{data:xW.A,size:14})})})}var xJ=a(32065),xK=a(992);function xY(){let e=xQ(),t=(0,_.YQ)();return(0,n.jsx)(tA.m,{title:"Refresh",children:(0,n.jsx)(as.$,{className:xB("refresh-button"),view:"flat-secondary",onClick:()=>{e((0,xK.Ak)()),t(b.F.util.invalidateTags(["SchemaTree"]))},children:(0,n.jsx)(tI.I,{data:xJ.A})})})}function xZ({onCollapseSummary:e,onExpandSummary:t,isCollapsed:a}){let i,s,l,{path:o,database:c,type:d,databaseFullPath:m}=aj(),p=(0,x.kK)(),h=(0,_.YQ)(),{handleSchemaChange:y}=aT(),[b,v]=(0,u.i)(S.hh,!1),[w,N]=r.useReducer(pl,void 0,()=>({triggerExpand:!1,triggerCollapse:!1,collapsed:b})),{summaryTab:E=j.ml.overview}=(0,_.N4)(e=>e.tenant),{handleTenantPageChange:C}=(0,sk.H)(),k=(0,M.zy)(),D=nd().parse(k.search,{ignoreQueryPrefix:!0}),{currentData:L}=f.useGetOverviewQuery({path:o,database:c,databaseFullPath:m,useMetaProxy:p}),z=L?.PathDescription?.Self;r.useEffect(()=>{let e=K(d);!d||e||q.x$.find(e=>e.id===E)||h((0,T.Mj)(j.ml.overview))},[h,d,E]);let F=tG(o,m);return(0,n.jsx)(xF,{children:(0,n.jsxs)("div",{className:xB(),children:[(0,n.jsx)("div",{className:xB({hidden:a}),children:(0,n.jsxs)(g,{direction:"vertical",defaultSizePaneKey:S.ED,onSplitStartDragAdditional:()=>{v(!1),N("clear")},triggerCollapse:w.triggerCollapse,triggerExpand:w.triggerExpand,minSize:[200,52],collapsedSizes:[100,0],children:[(0,n.jsx)(xH,{database:c,path:o,databaseFullPath:m}),(0,n.jsxs)("div",{className:xB("info"),children:[(0,n.jsxs)("div",{className:xB("sticky-top"),children:[(0,n.jsxs)("div",{className:xB("info-header"),children:[(0,n.jsxs)("div",{className:xB("info-title"),children:[(()=>{let e,{Status:t,Reason:a}=L??{};if(d){let e=d.replace("EPathType","");return tB(o,d)&&(e="domain"),(0,n.jsx)("div",{className:xB("entity-type"),children:e})}return t&&a&&(e=`${t}: ${a}`),(0,n.jsx)("div",{className:xB("entity-type",{error:!0}),children:(0,n.jsx)(nm.H,{content:e})})})(),(0,n.jsx)("div",{className:xB("path-name"),children:F})]}),(0,n.jsx)("div",{className:xB("info-controls"),children:(i=K(d),(0,n.jsxs)(r.Fragment,{children:[i&&(s={setActivePath:y,setTenantPage:C},(e,t)=>({preview:xS(xw(e,h,s),"m")})[t])(o,"preview"),(0,n.jsx)(uW.b,{text:F,view:"flat-secondary",title:xG("action_copySchemaPath")}),(0,n.jsx)(pc,{onCollapse:()=>{v(!0),N("triggerCollapse")},onExpand:()=>{v(!1),N("triggerExpand")},isCollapsed:w.collapsed,initialDirection:"bottom"})]}))})]}),(l=K(d)?[...q.x$,...q.nb]:q.x$,(0,n.jsx)("div",{className:xB("tabs"),children:(0,n.jsxs)(tC.s,{className:xB("tabs-inner"),justifyContent:"space-between",alignItems:"center",children:[(0,n.jsx)(A.f,{value:E,children:(0,n.jsx)(I.w,{size:"l",children:l.map(({id:e,title:t})=>{let a=(0,O.YL)({...D,[q.vh.summaryTab]:e});return(0,n.jsx)(P.o,{value:e,children:(0,n.jsx)(R.E,{to:a,as:"tab",children:t})},e)})})}),E===j.ml.schema&&(0,n.jsx)(xV,{})]})}))]}),(0,n.jsx)("div",{className:xB("overview-wrapper"),children:E===j.ml.schema?(0,n.jsx)(ar,{type:d,path:o,database:c,databaseFullPath:m}):(()=>{if(!z)return;let{CreateStep:e,PathType:t,PathSubType:a,PathId:i,PathVersion:s}=z,l=[],c=tB(o,t)?"Domain":t?.replace(/^EPathType/,"");l.push({name:xG("field_type"),content:c}),"EPathSubTypeEmpty"!==a&&l.push({name:xG("field_subtype"),content:a?.replace(/^EPathSubType/,"")}),l.push({name:xG("field_id"),content:i}),l.push({name:xG("field_version"),content:s}),Number(e)&&l.push({name:xG("field_created"),content:(0,eW.r6)(e)});let{PathDescription:d}=L;if(d?.TableStats){let{DataSize:e,RowCount:t}=d.TableStats;l.push({name:xG("field_data-size"),content:n0(e)},{name:xG("field_row-count"),content:(0,eW.ZV)(t)})}let u=()=>{let{PathsInside:e,ShardsInside:t,PathsLimit:a,ShardsLimit:n}=d?.DomainDescription??{},r=(0,eW.ZV)(e),i=(0,eW.ZV)(t);return r&&a&&(r=`${r} / ${(0,eW.ZV)(a)}`),i&&n&&(i=`${i} / ${(0,eW.ZV)(n)}`),[{name:xG("field_paths"),content:r},{name:xG("field_shards"),content:i}]},m=t&&({EPathTypeInvalid:void 0,EPathTypeDir:void 0,EPathTypeResourcePool:void 0,EPathTypeTable:()=>[{name:xG("field_partitions"),content:d?.TablePartitions?.length}],EPathTypeSysView:()=>[{name:xG("field_system-view-type"),content:rm(d?.SysViewDescription?.Type)}],EPathTypeSubDomain:u,EPathTypeTableIndex:void 0,EPathTypeExtSubDomain:u,EPathTypeColumnStore:()=>[{name:xG("field_partitions"),content:d?.ColumnStoreDescription?.ColumnShards?.length}],EPathTypeColumnTable:()=>[{name:xG("field_partitions"),content:d?.ColumnTableDescription?.Sharding?.ColumnShards?.length}],EPathTypeCdcStream:()=>{let{Mode:e,Format:t}=d?.CdcStreamDescription||{};return[{name:xG("field_mode"),content:e?.replace(/^ECdcStreamMode/,"")},{name:xG("field_format"),content:t?.replace(/^ECdcStreamFormat/,"")}]},EPathTypePersQueueGroup:()=>{let e=d?.PersQueueGroup,t=e?.PQTabletConfig?.PartitionConfig?.LifetimeSeconds;return[{name:xG("field_partitions"),content:e?.Partitions?.length},{name:xG("field_retention"),content:t&&(0,eW.Pt)(t)}]},EPathTypeExternalTable:()=>{let e=(0,O.Ow)({...D,schema:d?.ExternalTableDescription?.DataSourcePath}),{SourceType:t,DataSourcePath:a}=d?.ExternalTableDescription||{},r=a?.match(/([^/]*)\/*$/)?.[1]||"";return[{name:xG("field_source-type"),content:t},{name:xG("field_data-source"),content:a&&(0,n.jsx)("span",{title:a,children:(0,n.jsx)(ro.K,{title:r||"",url:e})})}]},EPathTypeExternalDataSource:()=>[{name:xG("field_source-type"),content:d?.ExternalDataSourceDescription?.SourceType}],EPathTypeView:void 0,EPathTypeReplication:()=>{let e=d?.ReplicationDescription?.State;return e?[{name:xG("field_state"),content:(0,n.jsx)(rx,{state:e})}]:[]},EPathTypeTransfer:()=>{let e=d?.ReplicationDescription?.State;return e?[{name:xG("field_state"),content:(0,n.jsx)(rx,{state:e})}]:[]},EPathTypeStreamingQuery:void 0})[t]?.()||[];l.push(...m);let p=l.filter(e=>e.content).map(e=>({...e,content:(0,n.jsx)("div",{className:xB("overview-item-content"),children:e.content})}));return(0,n.jsxs)(r.Fragment,{children:[(0,n.jsx)("div",{className:xB("overview-title"),children:(0,n.jsx)(rk,{data:d})}),(0,n.jsx)(cn.u,{responsive:!0,children:p.map(e=>(0,n.jsx)(cn.u.Item,{name:e.name,children:e.content},e.name))})]})})()})]})]})}),(0,n.jsxs)(tC.s,{className:xB("actions"),gap:.5,children:[!a&&(0,n.jsx)(xY,{}),(0,n.jsx)(pc,{onCollapse:e,onExpand:t,isCollapsed:a,initialDirection:"left"})]})]})})}var xX=a(11169),x0=a(52198),x1=a(21852),x2=JSON.parse('{"title_degraded":"Degraded","title_emergency":"Emergency","title_maintenance":"Maintenance required","title_good":"Good","title_unspecified":"Unspecified"}');let x3=(0,en.g4)("ydb-healthcheck-status",{en:x2}),x4={GOOD:"success",DEGRADED:"info",MAINTENANCE_REQUIRED:"warning",EMERGENCY:"danger",UNSPECIFIED:"normal"},x5={GOOD:xX.A,DEGRADED:x0.A,MAINTENANCE_REQUIRED:u2.A,EMERGENCY:x1.A,UNSPECIFIED:xP.A},x6={get GOOD(){return x3("title_good")},get DEGRADED(){return x3("title_degraded")},get MAINTENANCE_REQUIRED(){return x3("title_maintenance")},get EMERGENCY(){return x3("title_emergency")},get UNSPECIFIED(){return x3("title_unspecified")}};function x7({status:e,size:t="m"}){let a=x4[e];return(0,n.jsx)(k.J,{theme:a,icon:(0,n.jsx)(tI.I,{size:14,data:x5[e]}),size:t,children:x6[e]})}var x8=a(63054);function x9(){let{issuesFilter:e,handleIssuesFilterChange:t}=aT();return(0,n.jsx)(tm.v,{value:e??"",onChange:t,placeholder:(0,x8.A)("description_search-issue"),width:"250px"})}var ye=a(78636),yt=a(60117),ya=a(30692);function yn({title:e,children:t,titleVariant:a="body-2",gap:r=3}){return(0,n.jsxs)(tC.s,{direction:"column",gap:r,children:[e&&(0,n.jsx)(tE.E,{variant:a,children:e}),t]})}function yr({title:e,fields:t,titleVariant:a}){let r=t.filter(e=>e.value);return 0===r.length?null:(0,n.jsx)(yn,{title:e,titleVariant:a,children:(0,n.jsx)(cn.u,{nameMaxWidth:200,children:r.map(e=>(0,n.jsx)(cn.u.Item,{name:e.title,copyText:e.copy,children:e.value},e.title))})})}function yi({ids:e,renderItem:t}){return(0,n.jsx)(tC.s,{direction:"column",gap:1,children:e.map(e=>(0,n.jsx)("div",{children:t?t(e):e},e))})}function ys({node:e,title:t}){let{database:a}=aT();if(!e)return null;let r=e.id?(0,n.jsx)(R.E,{to:(0,O.vI)({id:e.id},{database:a}),children:e.id}):void 0;return(0,n.jsx)(yr,{title:t,fields:[{value:r,title:(0,x8.A)("label_node-id")},{value:e.host,title:(0,x8.A)("label_node-host"),copy:e.host},{value:e.port,title:(0,x8.A)("label_node-port")}]})}function yl({location:e}){let{pool:t}=e??{},{name:a}=t??{};return a?(0,n.jsx)(yr,{fields:[{value:a,title:(0,x8.A)("label_pool-name")}]}):null}let yo={node:e=>(0,n.jsx)(ys,{node:e?.node},"node"),pool:e=>(0,n.jsx)(yl,{location:e},"pool"),tablet:e=>(0,n.jsx)(yd,{location:e},"tablet"),schema:e=>(0,n.jsx)(yu,{location:e},"schema")};function yc({location:e,hiddenFields:t=[]}){let{node:a,tablet:i,schema:s,pool:l}=e??{},c=r.useMemo(()=>{let e=[];return a&&e.push("node"),l&&e.push("pool"),i&&e.push("tablet"),s&&e.push("schema"),e.filter(e=>!t.includes(e))},[a,l,i,s,t]);return!e||(0,o.isEmpty)(e)||0===c.length?null:(0,n.jsx)(yn,{title:(0,x8.A)("label_compute_location"),titleVariant:"subheader-2",children:(0,n.jsx)(tC.s,{direction:"column",gap:3,children:c.map(t=>yo[t](e))})})}function yd({location:e}){let t=(0,O.Cs)(),{tablet:a}=e??{};return a?(0,n.jsx)(yr,{fields:[{value:a.id?.length?(0,n.jsx)(yi,{ids:a.id,renderItem:e=>(0,n.jsx)(R.E,{to:t(e),children:e})}):void 0,title:(0,x8.A)("label_tablet-id")},{value:a.type,title:(0,x8.A)("label_tablet-type")},{value:a.count,title:(0,x8.A)("label_tablet-count")}]}):null}function yu({location:e}){let{schema:t}=e??{};return t?(0,n.jsx)(yr,{fields:[{value:t.type,title:(0,x8.A)("label_schema-type")},{value:t.path,title:(0,x8.A)("label_schema-path")}]}):null}let ym={node:e=>(0,n.jsx)(ys,{node:e?.node},"node"),pool:e=>(0,n.jsx)(yl,{location:e},"pool"),group:e=>(0,n.jsx)(yh,{location:e},"group"),vdisk:e=>(0,n.jsx)(yg,{location:e},"vdisk"),pdisk:e=>(0,n.jsx)(yx,{location:e},"pdisk")};function yp({location:e,hiddenFields:t=[]}){let{node:a,pool:i}=e??{},{group:s}=i??{},{vdisk:l}=s??{},{pdisk:c}=l??{},d=r.useMemo(()=>{let e=[];return a&&e.push("node"),i&&e.push("pool"),s&&e.push("group"),l&&e.push("vdisk"),c&&e.push("pdisk"),e.filter(e=>!t.includes(e))},[a,i,s,l,c,t]);return!e||(0,o.isEmpty)(e)||0===d.length?null:(0,n.jsx)(yn,{title:(0,x8.A)("label_storage_location"),titleVariant:"subheader-2",children:(0,n.jsx)(tC.s,{direction:"column",gap:3,children:d.map(t=>ym[t](e))})})}function yh({location:e}){let{pool:t}=e??{},{group:a}=t??{},r=a?.id;return r?.length?(0,n.jsx)(yr,{fields:[{value:r?.length?(0,n.jsx)(yi,{ids:r}):void 0,title:(0,x8.A)("label_group-id")}]}):null}function yg({location:e}){let t=(0,O.Z$)(),{node:a,pool:r}=e??{},{group:i}=r??{},{vdisk:s}=i??{},l=s?.id;return l?.length?(0,n.jsx)(yr,{fields:[{value:l?.length?(0,n.jsx)(yi,{ids:l,renderItem:e=>(0,n.jsx)(R.E,{to:t({vDiskId:e,nodeId:a?.id}),children:e})}):void 0,title:(0,x8.A)("label_vdisk-id")}]}):null}function yx({location:e}){let{pool:t}=e??{},{group:a}=t??{},{vdisk:r}=a??{},{pdisk:i}=r??{};return i?.length?i.map(e=>{let t,a;if(e.id){let n=e.id.split("-");t=n[0],a=n.slice(1).join("-")}return(0,n.jsx)(yr,{fields:[{value:t&&a?(0,n.jsx)(R.E,{to:(0,O.Ck)(a,t),children:e.id}):e.id,title:(0,x8.A)("label_pdisk-id")},{value:e.path,title:(0,x8.A)("label_pdisk-path")}]},e.id||e.path)}):null}function yy({location:e,hiddenStorageFields:t,hiddenComputeFields:a}){return(0,n.jsxs)(r.Fragment,{children:[(0,n.jsx)(yp,{location:e?.storage,hiddenFields:t}),(0,n.jsx)(yc,{location:e?.compute,hiddenFields:a}),(0,n.jsx)(yb,{location:e?.node}),(0,n.jsx)(yf,{location:e?.peer})]})}function yb({location:e}){return!e||(0,o.isEmpty)(e)?null:(0,n.jsx)(yn,{title:(0,x8.A)("label_node_location"),children:(0,n.jsx)(ys,{node:e})})}function yf({location:e}){return!e||(0,o.isEmpty)(e)?null:(0,n.jsx)(yn,{title:(0,x8.A)("label_peer_location"),children:(0,n.jsx)(ys,{node:e})})}function yv({issue:e}){let t=(0,O.Cs)(),{detailsFields:a,hiddenStorageFields:i,hiddenComputeFields:s}=r.useMemo(()=>{let a=[],r=[],i=[{value:e.message,title:(0,x8.A)("label_description")}];if("STORAGE_POOL"===e.type&&(i.push({value:e.location?.storage?.pool?.name,title:(0,x8.A)("label_pool-name")}),a.push("pool")),"COMPUTE_POOL"===e.type&&(i.push({value:e.location?.compute?.pool?.name,title:(0,x8.A)("label_pool-name")}),r.push("pool")),"TABLET"===e.type){let a=e.location?.compute?.tablet;i.push({value:a?.id?.length?(0,n.jsx)(yi,{ids:a.id,renderItem:e=>(0,n.jsx)(R.E,{to:t(e),children:e})}):void 0,title:(0,x8.A)("label_tablet-id")},{value:a?.type,title:(0,x8.A)("label_tablet-type")},{value:a?.count,title:(0,x8.A)("label_tablet-count")}),r.push("tablet")}return{detailsFields:i,hiddenComputeFields:r,hiddenStorageFields:a}},[e,t]),{location:l}=e;return(0,n.jsxs)(tC.s,{direction:"column",gap:4,children:[(0,n.jsx)(yr,{title:(0,x8.A)("label_details"),fields:a,titleVariant:"subheader-2"}),(0,n.jsx)(yy,{location:l,hiddenStorageFields:i,hiddenComputeFields:s})]})}function yj({parents:e,selectedTab:t,setSelectedTab:a}){return e.length<=1?null:(0,n.jsx)(tC.s,{gap:2,wrap:"nowrap",children:e.map((r,i)=>{let s;return(0,n.jsxs)(tC.s,{gap:2,wrap:"nowrap",children:[(0,n.jsx)(yT,{active:r.id===t,onClick:()=>a(r.id),children:(0,n.jsxs)(tC.s,{gap:2,wrap:"nowrap",alignItems:"center",children:[r.status&&(0,n.jsx)(yw,{status:r.status}),r.type&&((s=r.type.split("_").join(" ")).charAt(0).toUpperCase()+s.slice(1).toLowerCase()).replace(/\bvdisk\b/gi,"VDisk").replace(/\bpdisk\b/gi,"PDisk")]})}),i!==e.length-1&&(0,n.jsx)(tE.E,{color:"secondary",children:"/"})]},r.id)})})}function yT({children:e,active:t,onClick:a}){return(0,n.jsx)(tE.E,{variant:"body-2",color:t?"primary":"secondary",className:(0,ya.b)("issue-tab",{active:t}),onClick:a,children:e})}function yw({status:e}){return(0,n.jsx)("div",{className:(0,ya.b)("tab-status",{[e.toLowerCase()]:!0})})}function yS({issue:e,expanded:t}){let[a,i]=r.useState(e.id),s=r.useMemo(()=>{let t=[],a=e;for(;a;)t.push(a),a=a.parent;return t.reverse()},[e]),l=r.useMemo(()=>s.find(e=>e.id===a),[s,a]);return(0,n.jsx)(tC.s,{className:(0,ya.b)("issue-wrapper"),children:(0,n.jsxs)(rB.E,{className:(0,ya.b)("issue-content"),defaultExpanded:t,children:[(0,n.jsx)(rB.E.Summary,{children:t=>(0,n.jsx)("button",{...t,className:(0,ya.b)("disclosure-trigger"),children:(0,n.jsxs)(tC.s,{wrap:"nowrap",gap:2,justifyContent:"space-between",className:(0,ya.b)("issue-summary"),children:[(0,n.jsxs)(tC.s,{direction:"column",gap:1,alignSelf:"center",children:[(0,n.jsx)(tE.E,{variant:"subheader-2",children:e.message}),e.status&&(0,n.jsx)("div",{className:(0,ya.b)("issue-status"),children:(0,n.jsx)(yt.c.Label,{size:"s",status:sM[e.status]})})]}),(0,n.jsxs)(tC.s,{wrap:"nowrap",gap:2,alignItems:"center",height:"max-content",children:[(0,n.jsx)(aN.c,{className:(0,ya.b)("issue-divider"),orientation:"vertical"}),(0,n.jsx)(rX.I,{direction:t.expanded?"top":"bottom"})]})]})})}),(0,n.jsx)("div",{className:(0,ya.b)("animation-container"),children:(0,n.jsxs)(tC.s,{className:(0,ya.b)("issue-details"),direction:"column",gap:3,grow:1,children:[(0,n.jsx)(yj,{parents:s,selectedTab:a,setSelectedTab:i}),l&&(0,n.jsx)(yv,{issue:l})]})})]})})}function y_({issues:e}){let{view:t,issuesFilter:a}=aT(),i=r.useMemo(()=>{let t=a?.toLowerCase().trim();return t?e.filter(e=>{let a=Object.values(e);for(;a.length;){let e=a.pop();if("object"==typeof e)a.push(...Object.values(e));else if(String(e).toLowerCase().includes(t))return!0}return!1}):e},[e,a]),s=r.useMemo(()=>t?i.filter(e=>{let a=e.rootTypeForUI||e.type;return a?.toLowerCase().startsWith(t)}):[],[i,t]);return 0===s.length?(0,n.jsx)(tC.s,{grow:1,justifyContent:"center",alignItems:"center",children:(0,n.jsx)(ye.pp,{image:(0,n.jsx)(un.oN,{width:100,height:100}),position:"center",size:"xs",title:(0,x8.A)("label_no-issues"),description:(0,x8.A)("description_no-issues")})}):s.map(e=>(0,n.jsx)(yS,{issue:e,expanded:!!a},e.id+!!a))}function yN(e=0){return Date.now()-e}function yE({lastFullfiled:e,refresh:t}){let[a,i]=r.useState(yN(e));return r.useEffect(()=>{i(yN(e));let t=setInterval(()=>{i(yN(e))},60*S.KF);return()=>clearInterval(t)},[e]),(0,n.jsxs)(tC.s,{gap:2,alignItems:"center",children:[(()=>{if((0,o.isNil)(e))return null;let t=a>S.Jg*S.KF,r=a>S.tt*S.KF,i=(0,dU.duration)(a),s="";if(r){let e=i.asDays();s=(0,x8.A)("description_days",{count:Math.round(e)})}else if(t){let e=i.asHours();s=(0,x8.A)("description_hours",{count:Math.round(e)})}else{let e=i.asMinutes();s=(0,x8.A)("description_minutes",{count:Math.round(e)})}return(0,n.jsx)(tE.E,{color:"secondary",children:s})})(),(0,n.jsx)(tA.m,{title:(0,x8.A)("action_refresh"),children:(0,n.jsx)(as.$,{view:"outlined",onClick:()=>{t()},children:(0,n.jsx)(as.$.Icon,{children:(0,n.jsx)(xJ.A,{})})})})]})}let yC="storage",yA="compute";function yI({issuesCount:e,viewTitles:t=w.J.healthcheck.getHealthckechViewTitles(),sortOrder:a=w.J.healthcheck.getHealthcheckViewsOrder()}){let{view:i,handleHealthcheckViewChange:s,handleIssuesFilterChange:l}=aT(),o=r.useMemo(()=>Object.keys(e),[e]),c=r.useMemo(()=>a.filter(t=>"unknown"!==t||"unknown"===t&&e[t]>0),[e,a]);return r.useEffect(()=>{i||(e[yC]?s(yC):e[yA]?s(yA):s(a.find(t=>e[t]>0)))},[i,s,e,o,a]),(0,n.jsx)(dk.x,{value:i??c[0],onUpdate:e=>{s(e),l("")},className:(0,ya.b)("control-wrapper"),children:c.map(a=>(0,n.jsxs)(dk.x.Option,{value:a,children:[t[a]??a,"\xa0",(0,n.jsx)(tE.E,{color:"secondary",children:e[a]??0})]},a))})}function yP({database:e,countIssueTypes:t=w.J.healthcheck.countHealthcheckIssuesByType}){let a=(0,_.N4)(e=>e.fullscreen),{loading:i,error:s,selfCheckResult:l,fulfilledTimeStamp:o,leavesIssues:c,refetch:d}=((e,{autorefresh:t}={})=>{let{databaseType:a}=(0,T.Ry)(e),{currentData:n,isFetching:r,error:i,refetch:s,fulfilledTimeStamp:l}=sL.useGetHealthcheckInfoQuery({database:e},{pollingInterval:t,skip:"Serverless"===a}),o=n?.self_check_result||"UNSPECIFIED";return{loading:void 0===n&&r,error:i,refetch:s,selfCheckResult:o,fulfilledTimeStamp:l,leavesIssues:(0,_.N4)(t=>sB(t,e))}})(e),u=r.useMemo(()=>t(c),[c,t]);return(0,n.jsx)(uh,{children:(0,n.jsx)(tC.s,{className:(0,ya.b)(),grow:1,children:s?(0,n.jsxs)(tC.s,{direction:"column",gap:1,className:(0,ya.b)("stub-wrapper"),children:[(0,n.jsx)(e$.o,{error:s,defaultMessage:(0,x8.A)("description_no-data")}),(0,n.jsx)(tI.I,{data:l9,size:100})]}):i?(0,n.jsx)(eG.a,{size:"m"}):"GOOD"!==l||c&&c.length?(0,n.jsxs)(tC.s,{direction:"column",grow:1,children:[(0,n.jsxs)(tC.s,{direction:"column",gap:3,className:(0,ya.b)("controls",{fullscreen:a}),children:[(0,n.jsxs)(tC.s,{justifyContent:"space-between",gap:2,children:[(0,n.jsx)(x7,{status:l}),(0,n.jsx)(yE,{lastFullfiled:o,refresh:d})]}),(0,n.jsx)(yI,{issuesCount:u}),(0,n.jsx)(x9,{})]}),(0,n.jsx)(tC.s,{direction:"column",gap:4,grow:1,className:(0,ya.b)("issues"),children:(0,n.jsx)(y_,{issues:c})})]}):(0,n.jsxs)(tC.s,{direction:"column",gap:1,className:(0,ya.b)("stub-wrapper"),children:[(0,n.jsx)(cJ.v,{name:"thumbsUp",width:200}),sK[l]]})})})}function yk({children:e}){let{database:t}=aj(),{handleShowHealthcheckChange:a,showHealthcheck:i,handleIssuesFilterChange:s,handleHealthcheckViewChange:l}=aT(),o=(0,_.N4)(e=>sU(e,t||"")),c=(0,_.N4)(e=>sH(e,t||"")),d=r.useCallback(()=>{a(!1),s(void 0),l(void 0)},[a,s,l]),u=r.useCallback(()=>(0,n.jsx)(yP,{database:t}),[t]);return(0,n.jsx)(lZ,{isDrawerVisible:!!i,onCloseDrawer:d,renderDrawerContent:u,drawerId:"tenant-healthcheck-details",storageKey:"tenant-healthcheck-details-drawer-width",detectClickOutside:!0,hideVeil:!1,isPercentageWidth:!0,drawerControls:[{type:"custom",key:"download",node:(0,n.jsx)(tA.m,{title:(0,L.A)("label_download"),children:(0,n.jsx)(as.$,{view:"flat",onClick:e=>{e.stopPropagation(),uY(c,`${t}-healthcheck-${new Date().getTime()}`)},children:(0,n.jsx)(tI.I,{data:uH.A})})})},{type:"custom",node:(0,n.jsx)(uc,{view:"flat"}),key:"fullscreen"},{type:"close"}],title:(0,n.jsx)(yD,{status:o}),children:e})}function yD({status:e}){return(0,n.jsxs)(tC.s,{direction:"column",children:[(0,n.jsx)(tE.E,{variant:"subheader-2",children:(0,L.A)("label_healthcheck-dashboard")}),(0,n.jsx)(tE.E,{color:"secondary",children:e&&sK[e]})]})}var yR=JSON.parse('{"description_select-row":"Retrieve data rows from tables using SELECT queries.","description_update-row":"Modify existing data rows with UPDATE operations.","description_erase-row":"Modify existing data rows with UPDATE operations.","description_write-attributes":"Modify object metadata and manage access permissions.","description_create-directory":"Create new subdirectories in the database namespace.","description_create-table":"Define new tables with specified schemas.","description_create-queue":"Set up new message queue instances.","description_remove-schema":"Delete database objects (tables, directories, queues).","description_alter-schema":"Modify object definitions (add/remove columns, change types).","description_create-database":"Initialize new database instances.","description_drop-database":"Permanently delete databases and all contained objects.","description_read-attributes":"View object metadata and access control lists.","description_describe-schema":"Inspect object structure and properties.","description_connect-database":"Establish connections and submit requests to the database.","description_grant-access-rights":"Delegate permissions to other users (within own privilege scope).","description_generic-read":"Read data and metadata. Basic viewing permissions for tables/objects.","description_generic-write":"Modify data and schemas. Write/delete data + alter structure.","description_generic-manage":"Create/drop databases. Infrastructure-level change.","description_generic-list":"View object metadata and schemas. For inspecting structure without data access.","description_generic-use":"Complete data operations. Modern full access excluding DB management.","description_generic-use-legacy":"[Legacy] Complete data operations. Modern full access excluding DB management.","description_generic-full":"Unrestricted system access. All permissions including DB management.","description_generic-full-legacy":"[Legacy] Unrestricted system access. All permissions including DB management.","label_groups":"Groups","label_granular":"Granular","label_inherited":"Inherited","description_no-granular-permissions":"No granular permissions available.","description_no-group-permissions":"No group permissions available.","action_discard":"Discard Changes","action_cancel":"Cancel","action_save":"Apply","label_rights-updated":"Access rights has been successfully changed","description_failed":"Failed","label_grant-access-to":"Grant access to"}');let yM=(0,en.g4)("ydb-grant-access",{en:yR}),yO=(0,d.cn)("ydb-grant-access"),yq={1:yM("description_select-row"),2:yM("description_update-row"),4:yM("description_erase-row"),16:yM("description_write-attributes"),32:yM("description_create-directory"),64:yM("description_create-table"),128:yM("description_create-queue"),256:yM("description_remove-schema"),1024:yM("description_alter-schema"),2048:yM("description_create-database"),4096:yM("description_drop-database"),8:yM("description_read-attributes"),512:yM("description_describe-schema"),32768:yM("description_connect-database"),8192:yM("description_grant-access-rights"),521:yM("description_generic-read"),17910:yM("description_generic-write"),6144:yM("description_generic-manage"),520:yM("description_generic-list"),59391:yM("description_generic-use"),26623:yM("description_generic-use-legacy"),65535:yM("description_generic-full"),32767:yM("description_generic-full-legacy")};function yL({onCancel:e,onSave:t,onDiscard:a,loading:r,error:i,disabled:s}){return(0,n.jsxs)(tC.s,{justifyContent:"space-between",gap:2,className:yO("footer"),children:[(0,n.jsx)(as.$,{view:"outlined",onClick:a,size:"l",className:yO("footer-button"),disabled:s,children:yM("action_discard")}),(0,n.jsxs)(tC.s,{gap:2,alignItems:"center",children:[i&&(0,n.jsx)(tA.m,{title:i,children:(0,n.jsx)(k.J,{size:"m",theme:"danger",icon:(0,n.jsx)(tI.I,{data:sJ.A}),children:yM("description_failed")})}),(0,n.jsx)(as.$,{view:"flat",onClick:e,size:"l",className:yO("footer-button"),children:yM("action_cancel")}),(0,n.jsx)(as.$,{onClick:t,view:"action",size:"l",className:yO("footer-button"),loading:r,disabled:s,children:yM("action_save")})]})]})}function yz({rights:e,availablePermissions:t,handleChangeRightGetter:a,inheritedRights:r,view:i}){return"Groups"===i?(0,n.jsx)(yF,{rights:e,availablePermissions:t?.AccessRules,handleChangeRightGetter:a,inheritedRights:r}):(0,n.jsx)(yQ,{rights:e,availablePermissions:t?.AccessRights,handleChangeRightGetter:a,inheritedRights:r})}function yF({rights:e,availablePermissions:t,handleChangeRightGetter:a,inheritedRights:r}){return t?.length?(0,n.jsx)(tC.s,{gap:3,direction:"column",children:t.map(({Name:t,Mask:i,AccessRights:s=[],AccessRules:l=[]})=>{let o=s.concat(l),c=e.get(t),d=r.has(t);return 32767!==i&&26623!==i||c||d?(0,n.jsx)(yU,{active:c,right:t,onUpdate:a(t),includedRights:o,description:yq[i],inherited:d},t):null})}):yM("description_no-group-permissions")}function yQ({rights:e,availablePermissions:t,handleChangeRightGetter:a,inheritedRights:r}){return t?.length?(0,n.jsx)(tC.s,{gap:3,direction:"column",children:t.map(({Name:t,Mask:i})=>(0,n.jsx)(yU,{active:e.get(t),right:t,onUpdate:a(t),description:yq[i],inherited:r.has(t)},t))}):yM("description_no-granular-permissions")}function yU({right:e,onUpdate:t,active:a,includedRights:r,description:i,inherited:s}){let l=s&&!a;return(0,n.jsx)(a_.Z,{className:yO("single-right"),theme:a||s?"info":"normal",children:(0,n.jsxs)(tC.s,{justifyContent:"space-between",alignItems:"flex-start",gap:4,children:[(0,n.jsxs)(tC.s,{direction:"column",gap:2,children:[(0,n.jsxs)(tC.s,{direction:"column",children:[(0,n.jsx)(tE.E,{variant:"subheader-2",children:e}),i&&(0,n.jsx)(tE.E,{color:"secondary",children:i})]}),r?.length?(0,n.jsx)(tC.s,{wrap:"wrap",gap:1,children:r.map(e=>(0,n.jsx)(k.J,{theme:"unknown",children:e},e))}):null]}),(0,n.jsxs)(tC.s,{direction:"column",gap:2,children:[s&&(0,n.jsx)(k.J,{theme:"info",children:yM("label_inherited")}),!l&&(0,n.jsx)(rK.d,{checked:!!a,onUpdate:t})]})]})})}let y$={Groups:yM("label_groups"),Granular:yM("label_granular")};function yG({value:e,onUpdate:t,availablePermissions:a,rights:i}){let s=a?.AccessRules?.filter(e=>i.get(e.Name))?.length,l=a?.AccessRights?.filter(e=>i.get(e.Name))?.length;return(0,n.jsx)("div",{className:yO("view-selector"),children:(0,n.jsxs)(dk.x,{value:e,onUpdate:t,children:[(0,n.jsxs)(dk.x.Option,{value:"Groups",children:[y$.Groups,s?(0,n.jsxs)(r.Fragment,{children:["\xa0",s]}):null]}),(0,n.jsxs)(dk.x.Option,{value:"Granular",children:[y$.Granular,"\xa0",l?(0,n.jsxs)(r.Fragment,{children:["\xa0",l]}):null]})]})})}function yB({newSubjects:e,setNewSubjects:t}){let[a,i]=r.useState(!0),[s,l]=r.useState(""),o=r.useRef(null),c=r.useRef(null),d=(e=0)=>{c.current&&o.current&&((c.current.offsetWidth+e)*2>=o.current.offsetWidth?i(!1):i(!0))},u=()=>{s&&(t(e=>[...e,s]),l(""),d(10*s.length))},m=(a="nowrap")=>(0,n.jsx)(tC.s,{gap:1,className:yO("input-content"),wrap:a,ref:c,maxWidth:"100%",children:e.map(e=>(0,n.jsx)(k.J,{type:"close",onCloseClick:()=>{t(t=>t.filter(t=>t!==e)),d(-1*e.length*10)},children:e},e))});return(0,n.jsx)(tC.s,{direction:"column",gap:2,children:(0,n.jsxs)(tC.s,{gap:2,alignItems:"start",children:[(0,n.jsx)("label",{htmlFor:"subjectInput",children:(0,n.jsx)(tE.E,{as:"div",whiteSpace:"nowrap",color:"secondary",className:yO("subject-input-label"),children:yM("label_grant-access-to")})}),(0,n.jsxs)(tC.s,{direction:"column",gap:1,className:yO("subject-input-wrapper"),children:[(0,n.jsx)(aM.k,{name:"subjectInput",className:yO("subject-input"),onBlur:u,onKeyDown:e=>{"Enter"===e.key&&u()},value:s,onUpdate:l,ref:o,startContent:a?m():void 0,autoFocus:!0}),!a&&m("wrap")]})]})})}function yH({handleCloseDrawer:e}){let{aclSubject:t}=aT(),[a,i]=r.useState([]),[s,o]=r.useState("Groups"),{path:c,database:d,databaseFullPath:u}=aj(),m=(0,x.kK)(),p=(0,_.XC)(),{currentRightsMap:h,setExplicitRightsChanges:g,rightsToGrant:y,rightsToRevoke:b,hasChanges:f}=function({aclSubject:e,path:t,database:a,databaseFullPath:n}){let i=(0,x.kK)(),s=(0,_.XC)(),l=(0,_.N4)(r=>ag(r,e??void 0,t,a,n,s,i)),[o,c]=r.useState(()=>new Map),d=r.useMemo(()=>Array.from(o.entries()).reduce((e,[t,a])=>(a&&!l.includes(t)&&e.push(t),e),[]),[o,l]),u=r.useMemo(()=>Array.from(o.entries()).reduce((e,[t,a])=>(!a&&l.includes(t)&&e.push(t),e),[]),[o,l]),m=r.useMemo(()=>new Map(l.map(e=>[e,!0])),[l]),p=r.useMemo(()=>{let e=new Map(m);return o.forEach((t,a)=>{e.set(a,t)}),e},[m,o]),h=r.useMemo(()=>!!(d.length||u.length),[d,u]);return{currentRightsMap:p,setExplicitRightsChanges:c,rightsToGrant:d,rightsToRevoke:u,hasChanges:h}}({aclSubject:t??void 0,path:c,database:d,databaseFullPath:u}),{isFetching:v}=ac.useGetSchemaAclQuery({path:c,database:d,databaseFullPath:u,dialect:p,useMetaProxy:m},{skip:!t}),{isFetching:j}=ac.useGetAvailablePermissionsQuery({database:d,databaseFullPath:u,dialect:p,useMetaProxy:m}),[T,w]=ac.useUpdateAccessMutation(),[S,N]=r.useState(""),E=(0,_.N4)(e=>ax(e,t??void 0,c,d,u,p,m)),C=r.useCallback(()=>{g(new Map)},[g]),A=r.useCallback(()=>{let n=t?[t]:a;n.length&&T({path:c,database:d,databaseFullPath:u,dialect:p,rights:{AddAccess:n.map(e=>({AccessRights:y,Subject:e,AccessType:"Allow"})),RemoveAccess:n.map(e=>({AccessRights:b,Subject:e,AccessType:"Allow"}))}}).unwrap().then(()=>{e(),(0,tR.A)({name:"updateAcl",content:yM("label_rights-updated"),autoHiding:1e3,isClosable:!1})}).catch(e=>{N((0,aO.$)(e))})},[T,c,d,p,y,t,b,a,e,u]),I=(0,_.N4)(e=>ab(e,d,u,p,m)),P=r.useCallback(e=>t=>{N(""),g(a=>new Map(a).set(e,t))},[g]),k=!!(t||a.length>0);return(0,n.jsxs)(tC.s,{direction:"column",className:yO(),height:"100%",children:[(0,n.jsxs)(tC.s,{direction:"column",grow:1,children:[(0,n.jsxs)(tC.s,{gap:4,direction:"column",className:yO("navigation"),children:[t?(0,n.jsx)(aA,{subject:t}):(0,n.jsx)(yB,{newSubjects:a,setNewSubjects:i}),k&&(0,n.jsx)(yG,{value:s,onUpdate:o,rights:h,availablePermissions:I})]}),k&&(0,n.jsx)(l.r,{loading:v||j,children:(0,n.jsx)(tC.s,{grow:1,position:"relative",qa:"access-rights-wrapper",children:(0,n.jsx)(yz,{inheritedRights:E,rights:h,availablePermissions:I,handleChangeRightGetter:P,view:s})})})]}),k&&(0,n.jsx)(yL,{onCancel:e,onDiscard:C,onSave:A,loading:w.isLoading,error:S,disabled:!f})]})}function yW({children:e}){let t=(0,al.nz)(),{showGrantAccess:a,handleShowGrantAccessChange:i,handleAclSubjectChange:s}=aT(),l=r.useCallback(()=>{i(!1),s(void 0)},[i,s]),o=r.useCallback(()=>(0,n.jsx)(yH,{handleCloseDrawer:l}),[l]);return t?(0,n.jsx)(lZ,{isDrawerVisible:!!a,onCloseDrawer:l,renderDrawerContent:o,drawerId:"tenant-grant-access",storageKey:"tenant-grant-access-drawer-width",detectClickOutside:!0,hideVeil:!1,isPercentageWidth:!0,drawerControls:[{type:"close"}],title:(0,n.jsx)(yV,{}),children:e}):e}function yV(){return(0,n.jsxs)(tC.s,{direction:"column",children:[(0,n.jsx)(tE.E,{variant:"subheader-2",children:(0,L.A)("label_grant-access")}),(0,n.jsx)(tE.E,{color:"secondary",children:(0,L.A)("context_grant-access")})]})}function yJ({children:e}){return(0,n.jsx)(C.e,{children:(0,n.jsx)(yk,{children:(0,n.jsx)(yW,{children:e})})})}let yK=(0,d.cn)("tenant-page");function yY({additionalTenantProps:e}){let[t,o]=(0,u.i)(S.jX,!1),c=(0,x.kK)(),[d,m]=r.useReducer(pl,void 0,()=>({triggerExpand:!1,triggerCollapse:!1,collapsed:t})),{database:p,schema:h}=aT(),{name:b,isLoading:C}=(0,T.Ry)(p??"");if(!p)throw Error("Tenant name is not defined");let A=r.useRef();r.useEffect(()=>{A.current!==p&&((async()=>{let{registerYQLCompletionItemProvider:e}=await Promise.all([a.e("89738"),a.e("40248")]).then(a.bind(a,50379));e(p)})().catch(console.error),A.current=p)},[p]);let I=b??"",P=h??I,{currentData:k,error:D,isLoading:R}=f.useGetOverviewQuery({path:P,database:p,databaseFullPath:I,useMetaProxy:c}),M=(0,_.YQ)();r.useEffect(()=>{M((0,y.g)("tenant",{databaseName:I,database:p}))},[I,p,M]);let O=(0,_.N4)(e=>(0,v.Tp)(e,P,p,I,c)),q=k?.PathDescription?.Self?.PathType??O?.PathDescription?.Self?.PathType,z=k?.PathDescription?.Self?.PathSubType??O?.PathDescription?.Self?.PathSubType,F=(0,N.Pq)(D),Q=F?w.J.clusterOrDatabaseAccessError:void 0,[U,$]=r.useState(!0);!U||R||C||$(!1);let G=(0,nB.D)(),{tenantPage:B}=(0,sk.H)(),H=G&&B===j.Dg.diagnostics,W=P||(0,L.A)("page.title"),{appTitle:V}=(0,E.J)();return(0,n.jsxs)("div",{className:yK(),children:[(0,n.jsx)(i.mg,{defaultTitle:`${W} — ${V}`,titleTemplate:`%s — ${W} — ${V}`}),(0,n.jsx)(l.r,{loading:U,children:(0,n.jsx)(s.A,{error:F?D:void 0,...Q,children:(0,n.jsx)(av,{database:p,path:P,type:q,subType:z,databaseFullPath:I,children:(0,n.jsx)(yJ,{children:H?(0,n.jsx)("div",{className:yK("main"),children:(0,n.jsx)(mS,{database:p,path:I,databaseFullPath:I,databasePagesDisplay:"diagnostics",additionalTenantProps:e})}):(0,n.jsxs)(g,{defaultSizePaneKey:S.jQ,defaultSizes:[25,75],triggerCollapse:d.triggerCollapse,triggerExpand:d.triggerExpand,minSize:[36,200],onSplitStartDragAdditional:()=>{o(!1),m("clear")},children:[(0,n.jsx)(xZ,{onCollapseSummary:()=>{o(!0),m("triggerCollapse")},onExpandSummary:()=>{o(!1),m("triggerExpand")},isCollapsed:d.collapsed}),(0,n.jsx)("div",{className:yK("main"),children:(0,n.jsx)(xj,{additionalTenantProps:e})})]})})})})})]})}},75191:function(){},9155:function(){},42819:function(){}}]);