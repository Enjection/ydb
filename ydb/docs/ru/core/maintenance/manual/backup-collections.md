# Операции с коллекциями резервных копий

Данное руководство охватывает все практические операции для создания, управления и восстановления из коллекций резервных копий. Для получения концептуальной информации см. [Концепции коллекций резервных копий](../../concepts/backup-collections.md). Для полного синтаксиса команд см. [справочник по синтаксису YQL](../../yql/reference/syntax/backup-collections.md).

## Создание коллекций резервных копий {#creating-collections}

### Базовое создание коллекции

Создайте коллекцию резервных копий с помощью SQL команд. Коллекция определяет, какие таблицы включить и настройки хранения:

```sql
CREATE BACKUP COLLECTION `shop_backups`
    ( TABLE `/Root/shop/orders`, TABLE `/Root/shop/products` )
WITH ( STORAGE = 'cluster', INCREMENTAL_BACKUP_ENABLED = 'true' );
```

### Планирование коллекции

Перед созданием коллекции рассмотрите:

- **Выбор таблиц**: Включите связанные таблицы, которые должны резервироваться согласованно
- **Требования к хранению**: Оцените размер резервной копии и рост
- **Частота резервного копирования**: Планируйте расписания полного и инкрементального резервного копирования
- **Политика хранения**: Определите, как долго хранить цепочки резервных копий

### Соглашения об именах

Используйте описательные имена, которые указывают:

- Имя приложения или сервиса
- Окружение (prod, staging, test)
- Цель или область применения

Примеры:

- `production_user_data`
- `staging_analytics`
- `daily_transaction_backups`

## Создание резервных копий {#taking-backups}

### Начальная полная резервная копия

После создания коллекции сделайте начальную полную резервную копию:

```sql
BACKUP `shop_backups`;
```

Первая резервная копия без ключевого слова `INCREMENTAL` создает полную резервную копию, содержащую все данные из указанных таблиц.

### Инкрементальные резервные копии

Для последующих резервных копий используйте инкрементальный режим:

```sql
BACKUP `shop_backups` INCREMENTAL;
```

Инкрементальные резервные копии содержат только изменения с момента последней резервной копии.

### Автоматизация резервного копирования

Рекомендуется автоматизировать процесс резервного копирования:

1. **Расписание**: Создайте регулярные задания для полных и инкрементальных резервных копий
2. **Мониторинг**: Отслеживайте успешность выполнения резервных копий
3. **Оповещения**: Настройте уведомления о сбоях резервного копирования

## Управление коллекциями {#managing-collections}

### Просмотр информации о коллекции

Получите информацию о существующих коллекциях:

```sql
SELECT * FROM SYS.BACKUP_COLLECTIONS;
```

### Изменение коллекции

Изменение существующих коллекций резервных копий:

```sql
ALTER BACKUP COLLECTION `shop_backups`
    ADD TABLE `/Root/shop/customers`;
```

### Удаление коллекции

Удалите коллекцию, когда она больше не нужна:

```sql
DROP BACKUP COLLECTION `shop_backups`;
```

**Предупреждение**: Удаление коллекции также удаляет все связанные резервные копии.

## Восстановление данных {#restoring-data}

### Восстановление из полной резервной копии

Восстановите данные из полной резервной копии:

```sql
RESTORE FROM `shop_backups` 
    TO `/Root/shop_restored/orders`, `/Root/shop_restored/products`;
```

### Восстановление на определенный момент времени

Восстановите данные на определенный момент времени:

```sql
RESTORE FROM `shop_backups` 
    AS OF SYSTEM TIME '2024-01-15T12:00:00Z'
    TO `/Root/shop_restored/orders`, `/Root/shop_restored/products`;
```

### Частичное восстановление

Восстановите только определенные таблицы:

```sql
RESTORE TABLE `/Root/shop/orders` FROM `shop_backups` 
    TO `/Root/shop_restored/orders`;
```

## Мониторинг и отладка {#monitoring-debugging}

### Проверка статуса резервных копий

Мониторьте статус операций резервного копирования:

```sql
SELECT * FROM SYS.BACKUP_OPERATIONS 
WHERE collection_name = 'shop_backups';
```

### Просмотр истории резервных копий

Просмотрите историю резервных копий для коллекции:

```sql
SELECT * FROM SYS.BACKUP_HISTORY 
WHERE collection_name = 'shop_backups'
ORDER BY created_at DESC;
```

### Диагностика проблем

При возникновении проблем проверьте:

1. **Права доступа**: Убедитесь, что у пользователя есть необходимые права
2. **Место на диске**: Проверьте наличие достаточного места для резервных копий
3. **Состояние таблиц**: Убедитесь, что все таблицы в коллекции доступны

## Лучшие практики {#best-practices}

### Стратегия резервного копирования

- **Регулярность**: Выполняйте резервное копирование регулярно
- **Тестирование**: Регулярно тестируйте процедуры восстановления
- **Документирование**: Ведите документацию по процедурам резервного копирования

### Производительность

- **Время выполнения**: Планируйте резервное копирование в периоды низкой нагрузки
- **Параллелизм**: Используйте параллельное выполнение для больших наборов данных
- **Сжатие**: Включите сжатие для экономии места

### Безопасность

- **Шифрование**: Включите шифрование резервных копий
- **Контроль доступа**: Ограничьте доступ к резервным копиям
- **Аудит**: Ведите журнал операций с резервными копиями

## См. также {#see-also}

- [Концепции коллекций резервных копий](../../concepts/backup-collections.md)
- [Справочник по YQL синтаксису для коллекций резервных копий](../../yql/reference/syntax/backup-collections.md)
- [Команды YDB CLI для коллекций резервных копий](../../reference/ydb-cli/backup-collections.md)
- [Рецепты по коллекциям резервных копий](../../recipes/backup-collections.md)
